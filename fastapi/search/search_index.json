{"config":{"lang":["ja"],"separator":"[\\s\\-\uff0c\u3002]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"FastAPI","text":"<p> FastAPI \u6846\u67b6\uff0c\u9ad8\u6027\u80fd\uff0c\u6613\u4e8e\u5b66\u4e60\uff0c\u9ad8\u6548\u7f16\u7801\uff0c\u751f\u4ea7\u53ef\u7528 </p> <p> </p> <p>\u6587\u6863\uff1a https://fastapi.tiangolo.com</p> <p>\u6e90\u7801\uff1a https://github.com/tiangolo/fastapi</p> <p>FastAPI \u662f\u4e00\u4e2a\u7528\u4e8e\u6784\u5efa API \u7684\u73b0\u4ee3\u3001\u5feb\u901f\uff08\u9ad8\u6027\u80fd\uff09\u7684 web \u6846\u67b6\uff0c\u4f7f\u7528 Python 3.6+ \u5e76\u57fa\u4e8e\u6807\u51c6\u7684 Python \u7c7b\u578b\u63d0\u793a\u3002</p> <p>\u5173\u952e\u7279\u6027:</p> <ul> <li> <p>\u5feb\u901f\uff1a\u53ef\u4e0e NodeJS \u548c Go \u5e76\u80a9\u7684\u6781\u9ad8\u6027\u80fd\uff08\u5f52\u529f\u4e8e Starlette \u548c Pydantic\uff09\u3002\u6700\u5feb\u7684 Python web \u6846\u67b6\u4e4b\u4e00\u3002</p> </li> <li> <p>\u9ad8\u6548\u7f16\u7801\uff1a\u63d0\u9ad8\u529f\u80fd\u5f00\u53d1\u901f\u5ea6\u7ea6 200\uff05 \u81f3 300\uff05\u3002*</p> </li> <li>\u66f4\u5c11 bug\uff1a\u51cf\u5c11\u7ea6 40\uff05 \u7684\u4eba\u4e3a\uff08\u5f00\u53d1\u8005\uff09\u5bfc\u81f4\u9519\u8bef\u3002*</li> <li>\u667a\u80fd\uff1a\u6781\u4f73\u7684\u7f16\u8f91\u5668\u652f\u6301\u3002\u5904\u5904\u7686\u53ef\u81ea\u52a8\u8865\u5168\uff0c\u51cf\u5c11\u8c03\u8bd5\u65f6\u95f4\u3002</li> <li>\u7b80\u5355\uff1a\u8bbe\u8ba1\u7684\u6613\u4e8e\u4f7f\u7528\u548c\u5b66\u4e60\uff0c\u9605\u8bfb\u6587\u6863\u7684\u65f6\u95f4\u66f4\u77ed\u3002</li> <li>\u7b80\u77ed\uff1a\u4f7f\u4ee3\u7801\u91cd\u590d\u6700\u5c0f\u5316\u3002\u901a\u8fc7\u4e0d\u540c\u7684\u53c2\u6570\u58f0\u660e\u5b9e\u73b0\u4e30\u5bcc\u529f\u80fd\u3002bug \u66f4\u5c11\u3002</li> <li>\u5065\u58ee\uff1a\u751f\u4ea7\u53ef\u7528\u7ea7\u522b\u7684\u4ee3\u7801\u3002\u8fd8\u6709\u81ea\u52a8\u751f\u6210\u7684\u4ea4\u4e92\u5f0f\u6587\u6863\u3002</li> <li>\u6807\u51c6\u5316\uff1a\u57fa\u4e8e\uff08\u5e76\u5b8c\u5168\u517c\u5bb9\uff09API \u7684\u76f8\u5173\u5f00\u653e\u6807\u51c6\uff1aOpenAPI (\u4ee5\u524d\u88ab\u79f0\u4e3a Swagger) \u548c JSON Schema\u3002</li> </ul> <p>* \u6839\u636e\u5bf9\u67d0\u4e2a\u6784\u5efa\u7ebf\u4e0a\u5e94\u7528\u7684\u5185\u90e8\u5f00\u53d1\u56e2\u961f\u6240\u8fdb\u884c\u7684\u6d4b\u8bd5\u4f30\u7b97\u5f97\u51fa\u3002</p>"},{"location":"#sponsors","title":"Sponsors","text":"<p>Other sponsors</p>"},{"location":"#_1","title":"\u8bc4\u4ef7","text":"<p>\u300c[...] \u6700\u8fd1\u6211\u4e00\u76f4\u5728\u4f7f\u7528 FastAPI\u3002[...] \u5b9e\u9645\u4e0a\u6211\u6b63\u5728\u8ba1\u5212\u5c06\u5176\u7528\u4e8e\u6211\u6240\u5728\u7684\u5fae\u8f6f\u56e2\u961f\u7684\u6240\u6709\u673a\u5668\u5b66\u4e60\u670d\u52a1\u3002\u5176\u4e2d\u4e00\u4e9b\u670d\u52a1\u6b63\u88ab\u96c6\u6210\u8fdb\u6838\u5fc3 Windows \u4ea7\u54c1\u548c\u4e00\u4e9b Office \u4ea7\u54c1\u3002\u300d</p> Kabir Khan - \u5fae\u8f6f (ref) <p>\u300c\u6211\u4eec\u9009\u62e9\u4e86 FastAPI \u6765\u521b\u5efa\u7528\u4e8e\u83b7\u53d6\u9884\u6d4b\u7ed3\u679c\u7684 REST \u670d\u52a1\u3002[\u7528\u4e8e Ludwig]\u300d</p> Piero Molino\uff0cYaroslav Dudin \u548c Sai Sumanth Miryala - Uber (ref) <p>\u300cNetflix \u975e\u5e38\u9ad8\u5174\u5730\u5ba3\u5e03\uff0c\u6b63\u5f0f\u5f00\u6e90\u6211\u4eec\u7684\u5371\u673a\u7ba1\u7406\u7f16\u6392\u6846\u67b6\uff1aDispatch\uff01[\u4f7f\u7528 FastAPI \u6784\u5efa]\u300d</p> Kevin Glisson\uff0cMarc Vilanova\uff0cForest Monsen - Netflix (ref) <p>\u300cFastAPI \u8ba9\u6211\u5174\u594b\u7684\u6b23\u559c\u82e5\u72c2\u3002\u5b83\u592a\u68d2\u4e86\uff01\u300d</p> Brian Okken - Python Bytes \u64ad\u5ba2\u4e3b\u6301\u4eba (ref) <p>\u300c\u8001\u5b9e\u8bf4\uff0c\u4f60\u7684\u4f5c\u54c1\u770b\u8d77\u6765\u975e\u5e38\u53ef\u9760\u548c\u4f18\u7f8e\u3002\u5728\u5f88\u591a\u65b9\u9762\uff0c\u8fd9\u5c31\u662f\u6211\u60f3\u8ba9 Hug \u6210\u4e3a\u7684\u6837\u5b50 - \u770b\u5230\u6709\u4eba\u5b9e\u73b0\u4e86\u5b83\u771f\u7684\u5f88\u9f13\u821e\u4eba\u5fc3\u3002\u300d</p> Timothy Crosley - Hug \u4f5c\u8005 (ref) <p>\u300c\u5982\u679c\u4f60\u6b63\u6253\u7b97\u5b66\u4e60\u4e00\u4e2a\u73b0\u4ee3\u6846\u67b6\u7528\u6765\u6784\u5efa REST API\uff0c\u6765\u770b\u4e0b FastAPI [...] \u5b83\u5feb\u901f\u3001\u6613\u7528\u4e14\u6613\u4e8e\u5b66\u4e60 [...]\u300d</p> <p>\u300c\u6211\u4eec\u5df2\u7ecf\u5c06 API \u670d\u52a1\u5207\u6362\u5230\u4e86 FastAPI [...] \u6211\u8ba4\u4e3a\u4f60\u4f1a\u559c\u6b22\u5b83\u7684 [...]\u300d</p> Ines Montani - Matthew Honnibal - Explosion AI \u521b\u59cb\u4eba - spaCy \u4f5c\u8005 (ref) - (ref)"},{"location":"#typer-fastapi","title":"Typer\uff0c\u547d\u4ee4\u884c\u4e2d\u7684 FastAPI","text":"<p>\u5982\u679c\u4f60\u6b63\u5728\u5f00\u53d1\u4e00\u4e2a\u5728\u7ec8\u7aef\u4e2d\u8fd0\u884c\u7684\u547d\u4ee4\u884c\u5e94\u7528\u800c\u4e0d\u662f web API\uff0c\u4e0d\u59a8\u8bd5\u4e0b Typer\u3002</p> <p>Typer \u662f FastAPI \u7684\u5c0f\u540c\u80de\u3002\u5b83\u60f3\u8981\u6210\u4e3a\u547d\u4ee4\u884c\u4e2d\u7684 FastAPI\u3002 \u2328\ufe0f \ud83d\ude80</p>"},{"location":"#_2","title":"\u4f9d\u8d56","text":"<p>Python 3.6 \u53ca\u66f4\u9ad8\u7248\u672c</p> <p>FastAPI \u7ad9\u5728\u4ee5\u4e0b\u5de8\u4eba\u7684\u80a9\u8180\u4e4b\u4e0a\uff1a</p> <ul> <li>Starlette \u8d1f\u8d23 web \u90e8\u5206\u3002</li> <li>Pydantic \u8d1f\u8d23\u6570\u636e\u90e8\u5206\u3002</li> </ul>"},{"location":"#_3","title":"\u5b89\u88c5","text":"<pre><code>$ pip install fastapi\n\n---&gt; 100%\n</code></pre> <p>\u4f60\u8fd8\u4f1a\u9700\u8981\u4e00\u4e2a ASGI \u670d\u52a1\u5668\uff0c\u751f\u4ea7\u73af\u5883\u53ef\u4ee5\u4f7f\u7528 Uvicorn \u6216\u8005 Hypercorn\u3002</p> <pre><code>$ pip install \"uvicorn[standard]\"\n\n---&gt; 100%\n</code></pre>"},{"location":"#_4","title":"\u793a\u4f8b","text":""},{"location":"#_5","title":"\u521b\u5efa","text":"<ul> <li>\u521b\u5efa\u4e00\u4e2a <code>main.py</code> \u6587\u4ef6\u5e76\u5199\u5165\u4ee5\u4e0b\u5185\u5bb9:</li> </ul> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/\")\ndef read_root():\n    return {\"Hello\": \"World\"}\n\n\n@app.get(\"/items/{item_id}\")\ndef read_item(item_id: int, q: Union[str, None] = None):\n    return {\"item_id\": item_id, \"q\": q}\n</code></pre> \u6216\u8005\u4f7f\u7528 <code>async def</code>... <p>\u5982\u679c\u4f60\u7684\u4ee3\u7801\u91cc\u4f1a\u51fa\u73b0 <code>async</code> / <code>await</code>\uff0c\u8bf7\u4f7f\u7528 <code>async def</code>\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/\")\nasync def read_root():\nreturn {\"Hello\": \"World\"}\n\n\n@app.get(\"/items/{item_id}\")\nasync def read_item(item_id: int, q: Union[str, None] = None):\nreturn {\"item_id\": item_id, \"q\": q}\n</code></pre> <p>Note:</p> <p>\u5982\u679c\u4f60\u4e0d\u77e5\u9053\u662f\u5426\u4f1a\u7528\u5230\uff0c\u53ef\u4ee5\u67e5\u770b\u6587\u6863\u7684 \"In a hurry?\" \u7ae0\u8282\u4e2d \u5173\u4e8e <code>async</code> \u548c <code>await</code> \u7684\u90e8\u5206\u3002</p>"},{"location":"#_6","title":"\u8fd0\u884c","text":"<p>\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u8fd0\u884c\u670d\u52a1\u5668\uff1a</p> <pre><code>$ uvicorn main:app --reload\n\nINFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\nINFO:     Started reloader process [28720]\nINFO:     Started server process [28722]\nINFO:     Waiting for application startup.\nINFO:     Application startup complete.\n</code></pre> \u5173\u4e8e <code>uvicorn main:app --reload</code> \u547d\u4ee4...... <p><code>uvicorn main:app</code> \u547d\u4ee4\u542b\u4e49\u5982\u4e0b:</p> <ul> <li><code>main</code>\uff1a<code>main.py</code> \u6587\u4ef6\uff08\u4e00\u4e2a Python \"\u6a21\u5757\"\uff09\u3002</li> <li><code>app</code>\uff1a\u5728 <code>main.py</code> \u6587\u4ef6\u4e2d\u901a\u8fc7 <code>app = FastAPI()</code> \u521b\u5efa\u7684\u5bf9\u8c61\u3002</li> <li><code>--reload</code>\uff1a\u8ba9\u670d\u52a1\u5668\u5728\u66f4\u65b0\u4ee3\u7801\u540e\u91cd\u65b0\u542f\u52a8\u3002\u4ec5\u5728\u5f00\u53d1\u65f6\u4f7f\u7528\u8be5\u9009\u9879\u3002</li> </ul>"},{"location":"#_7","title":"\u68c0\u67e5","text":"<p>\u4f7f\u7528\u6d4f\u89c8\u5668\u8bbf\u95ee http://127.0.0.1:8000/items/5?q=somequery\u3002</p> <p>\u4f60\u5c06\u4f1a\u770b\u5230\u5982\u4e0b JSON \u54cd\u5e94\uff1a</p> <pre><code>{\"item_id\": 5, \"q\": \"somequery\"}\n</code></pre> <p>\u4f60\u5df2\u7ecf\u521b\u5efa\u4e86\u4e00\u4e2a\u5177\u6709\u4ee5\u4e0b\u529f\u80fd\u7684 API\uff1a</p> <ul> <li>\u901a\u8fc7 \u8def\u5f84 <code>/</code> \u548c <code>/items/{item_id}</code> \u63a5\u53d7 HTTP \u8bf7\u6c42\u3002</li> <li>\u4ee5\u4e0a \u8def\u5f84 \u90fd\u63a5\u53d7 <code>GET</code> \u64cd\u4f5c\uff08\u4e5f\u88ab\u79f0\u4e3a HTTP \u65b9\u6cd5\uff09\u3002</li> <li><code>/items/{item_id}</code> \u8def\u5f84 \u6709\u4e00\u4e2a \u8def\u5f84\u53c2\u6570 <code>item_id</code> \u5e76\u4e14\u5e94\u8be5\u4e3a <code>int</code> \u7c7b\u578b\u3002</li> <li><code>/items/{item_id}</code> \u8def\u5f84 \u6709\u4e00\u4e2a\u53ef\u9009\u7684 <code>str</code> \u7c7b\u578b\u7684 \u67e5\u8be2\u53c2\u6570 <code>q</code>\u3002</li> </ul>"},{"location":"#api","title":"\u4ea4\u4e92\u5f0f API \u6587\u6863","text":"<p>\u73b0\u5728\u8bbf\u95ee http://127.0.0.1:8000/docs\u3002</p> <p>\u4f60\u4f1a\u770b\u5230\u81ea\u52a8\u751f\u6210\u7684\u4ea4\u4e92\u5f0f API \u6587\u6863\uff08\u7531 Swagger UI\u751f\u6210\uff09\uff1a</p> <p></p>"},{"location":"#api_1","title":"\u53ef\u9009\u7684 API \u6587\u6863","text":"<p>\u8bbf\u95ee http://127.0.0.1:8000/redoc\u3002</p> <p>\u4f60\u4f1a\u770b\u5230\u53e6\u4e00\u4e2a\u81ea\u52a8\u751f\u6210\u7684\u6587\u6863\uff08\u7531 ReDoc \u751f\u6210\uff09\uff1a</p> <p></p>"},{"location":"#_8","title":"\u793a\u4f8b\u5347\u7ea7","text":"<p>\u73b0\u5728\u4fee\u6539 <code>main.py</code> \u6587\u4ef6\u6765\u4ece <code>PUT</code> \u8bf7\u6c42\u4e2d\u63a5\u6536\u8bf7\u6c42\u4f53\u3002</p> <p>\u6211\u4eec\u501f\u52a9 Pydantic \u6765\u4f7f\u7528\u6807\u51c6\u7684 Python \u7c7b\u578b\u58f0\u660e\u8bf7\u6c42\u4f53\u3002</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\napp = FastAPI()\n\n\nclass Item(BaseModel):\nname: str\nprice: float\nis_offer: Union[bool, None] = None\n@app.get(\"/\")\ndef read_root():\n    return {\"Hello\": \"World\"}\n\n\n@app.get(\"/items/{item_id}\")\ndef read_item(item_id: int, q: Union[str, None] = None):\n    return {\"item_id\": item_id, \"q\": q}\n\n\n@app.put(\"/items/{item_id}\")\ndef update_item(item_id: int, item: Item):\nreturn {\"item_name\": item.name, \"item_id\": item_id}\n</code></pre> <p>\u670d\u52a1\u5668\u5c06\u4f1a\u81ea\u52a8\u91cd\u8f7d\uff08\u56e0\u4e3a\u5728\u4e0a\u9762\u7684\u6b65\u9aa4\u4e2d\u4f60\u5411 <code>uvicorn</code> \u547d\u4ee4\u6dfb\u52a0\u4e86 <code>--reload</code> \u9009\u9879\uff09\u3002</p>"},{"location":"#api_2","title":"\u4ea4\u4e92\u5f0f API \u6587\u6863\u5347\u7ea7","text":"<p>\u8bbf\u95ee http://127.0.0.1:8000/docs\u3002</p> <ul> <li>\u4ea4\u4e92\u5f0f API \u6587\u6863\u5c06\u4f1a\u81ea\u52a8\u66f4\u65b0\uff0c\u5e76\u52a0\u5165\u65b0\u7684\u8bf7\u6c42\u4f53\uff1a</li> </ul> <p></p> <ul> <li>\u70b9\u51fb\u300cTry it out\u300d\u6309\u94ae\uff0c\u4e4b\u540e\u4f60\u53ef\u4ee5\u586b\u5199\u53c2\u6570\u5e76\u76f4\u63a5\u8c03\u7528 API\uff1a</li> </ul> <p></p> <ul> <li>\u7136\u540e\u70b9\u51fb\u300cExecute\u300d\u6309\u94ae\uff0c\u7528\u6237\u754c\u9762\u5c06\u4f1a\u548c API \u8fdb\u884c\u901a\u4fe1\uff0c\u53d1\u9001\u53c2\u6570\uff0c\u83b7\u53d6\u7ed3\u679c\u5e76\u5728\u5c4f\u5e55\u4e0a\u5c55\u793a\uff1a</li> </ul> <p></p>"},{"location":"#_9","title":"\u53ef\u9009\u6587\u6863\u5347\u7ea7","text":"<p>\u8bbf\u95ee http://127.0.0.1:8000/redoc\u3002</p> <ul> <li>\u53ef\u9009\u6587\u6863\u540c\u6837\u4f1a\u4f53\u73b0\u65b0\u52a0\u5165\u7684\u8bf7\u6c42\u53c2\u6570\u548c\u8bf7\u6c42\u4f53\uff1a</li> </ul> <p></p>"},{"location":"#_10","title":"\u603b\u7ed3","text":"<p>\u603b\u7684\u6765\u8bf4\uff0c\u4f60\u5c31\u50cf\u58f0\u660e\u51fd\u6570\u7684\u53c2\u6570\u7c7b\u578b\u4e00\u6837\u53ea\u58f0\u660e\u4e86\u4e00\u6b21\u8bf7\u6c42\u53c2\u6570\u3001\u8bf7\u6c42\u4f53\u7b49\u7684\u7c7b\u578b\u3002</p> <p>\u4f60\u4f7f\u7528\u4e86\u6807\u51c6\u7684\u73b0\u4ee3 Python \u7c7b\u578b\u6765\u5b8c\u6210\u58f0\u660e\u3002</p> <p>\u4f60\u4e0d\u9700\u8981\u53bb\u5b66\u4e60\u65b0\u7684\u8bed\u6cd5\u3001\u4e86\u89e3\u7279\u5b9a\u5e93\u7684\u65b9\u6cd5\u6216\u7c7b\uff0c\u7b49\u7b49\u3002</p> <p>\u53ea\u9700\u8981\u4f7f\u7528\u6807\u51c6\u7684 Python 3.6 \u53ca\u66f4\u9ad8\u7248\u672c\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6bd4\u5982\u58f0\u660e <code>int</code> \u7c7b\u578b\uff1a</p> <pre><code>item_id: int\n</code></pre> <p>\u6216\u8005\u4e00\u4e2a\u66f4\u590d\u6742\u7684 <code>Item</code> \u6a21\u578b\uff1a</p> <pre><code>item: Item\n</code></pre> <p>......\u5728\u8fdb\u884c\u4e00\u6b21\u58f0\u660e\u4e4b\u540e\uff0c\u4f60\u5c06\u83b7\u5f97\uff1a</p> <ul> <li>\u7f16\u8f91\u5668\u652f\u6301\uff0c\u5305\u62ec\uff1a<ul> <li>\u81ea\u52a8\u8865\u5168</li> <li>\u7c7b\u578b\u68c0\u67e5</li> </ul> </li> <li>\u6570\u636e\u6821\u9a8c\uff1a<ul> <li>\u5728\u6821\u9a8c\u5931\u8d25\u65f6\u81ea\u52a8\u751f\u6210\u6e05\u6670\u7684\u9519\u8bef\u4fe1\u606f</li> <li>\u5bf9\u591a\u5c42\u5d4c\u5957\u7684 JSON \u5bf9\u8c61\u4f9d\u7136\u6267\u884c\u6821\u9a8c</li> </ul> </li> <li>\u8f6c\u6362 \u6765\u81ea\u7f51\u7edc\u8bf7\u6c42\u7684\u8f93\u5165\u6570\u636e\u4e3a Python \u6570\u636e\u7c7b\u578b\u3002\u5305\u62ec\u4ee5\u4e0b\u6570\u636e\uff1a<ul> <li>JSON</li> <li>\u8def\u5f84\u53c2\u6570</li> <li>\u67e5\u8be2\u53c2\u6570</li> <li>Cookies</li> <li>\u8bf7\u6c42\u5934</li> <li>\u8868\u5355</li> <li>\u6587\u4ef6</li> </ul> </li> <li>\u8f6c\u6362 \u8f93\u51fa\u7684\u6570\u636e\uff1a\u8f6c\u6362 Python \u6570\u636e\u7c7b\u578b\u4e3a\u4f9b\u7f51\u7edc\u4f20\u8f93\u7684 JSON \u6570\u636e\uff1a<ul> <li>\u8f6c\u6362 Python \u57fa\u7840\u7c7b\u578b \uff08<code>str</code>\u3001 <code>int</code>\u3001 <code>float</code>\u3001 <code>bool</code>\u3001 <code>list</code> \u7b49\uff09</li> <li><code>datetime</code> \u5bf9\u8c61</li> <li><code>UUID</code> \u5bf9\u8c61</li> <li>\u6570\u636e\u5e93\u6a21\u578b</li> <li>......\u4ee5\u53ca\u66f4\u591a\u5176\u4ed6\u7c7b\u578b</li> </ul> </li> <li>\u81ea\u52a8\u751f\u6210\u7684\u4ea4\u4e92\u5f0f API \u6587\u6863\uff0c\u5305\u62ec\u4e24\u79cd\u53ef\u9009\u7684\u7528\u6237\u754c\u9762\uff1a<ul> <li>Swagger UI</li> <li>ReDoc</li> </ul> </li> </ul> <p>\u56de\u5230\u524d\u9762\u7684\u4ee3\u7801\u793a\u4f8b\uff0cFastAPI \u5c06\u4f1a\uff1a</p> <ul> <li>\u6821\u9a8c <code>GET</code> \u548c <code>PUT</code> \u8bf7\u6c42\u7684\u8def\u5f84\u4e2d\u662f\u5426\u542b\u6709 <code>item_id</code>\u3002</li> <li>\u6821\u9a8c <code>GET</code> \u548c <code>PUT</code> \u8bf7\u6c42\u4e2d\u7684 <code>item_id</code> \u662f\u5426\u4e3a <code>int</code> \u7c7b\u578b\u3002<ul> <li>\u5982\u679c\u4e0d\u662f\uff0c\u5ba2\u6237\u7aef\u5c06\u4f1a\u6536\u5230\u6e05\u6670\u6709\u7528\u7684\u9519\u8bef\u4fe1\u606f\u3002</li> </ul> </li> <li>\u68c0\u67e5 <code>GET</code> \u8bf7\u6c42\u4e2d\u662f\u5426\u6709\u547d\u540d\u4e3a <code>q</code> \u7684\u53ef\u9009\u67e5\u8be2\u53c2\u6570\uff08\u6bd4\u5982 <code>http://127.0.0.1:8000/items/foo?q=somequery</code>\uff09\u3002<ul> <li>\u56e0\u4e3a <code>q</code> \u88ab\u58f0\u660e\u4e3a <code>= None</code>\uff0c\u6240\u4ee5\u5b83\u662f\u53ef\u9009\u7684\u3002</li> <li>\u5982\u679c\u6ca1\u6709 <code>None</code> \u5b83\u5c06\u4f1a\u662f\u5fc5\u9700\u7684 (\u5982 <code>PUT</code> \u4f8b\u5b50\u4e2d\u7684\u8bf7\u6c42\u4f53)\u3002</li> </ul> </li> <li>\u5bf9\u4e8e\u8bbf\u95ee <code>/items/{item_id}</code> \u7684 <code>PUT</code> \u8bf7\u6c42\uff0c\u5c06\u8bf7\u6c42\u4f53\u8bfb\u53d6\u4e3a JSON \u5e76\uff1a<ul> <li>\u68c0\u67e5\u662f\u5426\u6709\u5fc5\u9700\u5c5e\u6027 <code>name</code> \u5e76\u4e14\u503c\u4e3a <code>str</code> \u7c7b\u578b \u3002</li> <li>\u68c0\u67e5\u662f\u5426\u6709\u5fc5\u9700\u5c5e\u6027 <code>price</code> \u5e76\u4e14\u503c\u4e3a <code>float</code> \u7c7b\u578b\u3002</li> <li>\u68c0\u67e5\u662f\u5426\u6709\u53ef\u9009\u5c5e\u6027 <code>is_offer</code>\uff0c \u5982\u679c\u6709\u7684\u8bdd\u503c\u5e94\u8be5\u4e3a <code>bool</code> \u7c7b\u578b\u3002</li> <li>\u4ee5\u4e0a\u8fc7\u7a0b\u5bf9\u4e8e\u591a\u5c42\u5d4c\u5957\u7684 JSON \u5bf9\u8c61\u540c\u6837\u4e5f\u4f1a\u6267\u884c</li> </ul> </li> <li>\u81ea\u52a8\u5bf9 JSON \u8fdb\u884c\u8f6c\u6362\u6216\u8f6c\u6362\u6210 JSON\u3002</li> <li>\u901a\u8fc7 OpenAPI \u6587\u6863\u6765\u8bb0\u5f55\u6240\u6709\u5185\u5bb9\uff0c\u53ef\u88ab\u7528\u4e8e\uff1a<ul> <li>\u4ea4\u4e92\u5f0f\u6587\u6863\u7cfb\u7edf</li> <li>\u8bb8\u591a\u7f16\u7a0b\u8bed\u8a00\u7684\u5ba2\u6237\u7aef\u4ee3\u7801\u81ea\u52a8\u751f\u6210\u7cfb\u7edf</li> </ul> </li> <li>\u76f4\u63a5\u63d0\u4f9b 2 \u79cd\u4ea4\u4e92\u5f0f\u6587\u6863 web \u754c\u9762\u3002</li> </ul> <p>\u867d\u7136\u6211\u4eec\u624d\u521a\u521a\u5f00\u59cb\uff0c\u4f46\u5176\u5b9e\u4f60\u5df2\u7ecf\u4e86\u89e3\u4e86\u8fd9\u4e00\u5207\u662f\u5982\u4f55\u5de5\u4f5c\u7684\u3002</p> <p>\u5c1d\u8bd5\u66f4\u6539\u4e0b\u9762\u8fd9\u884c\u4ee3\u7801\uff1a</p> <pre><code>    return {\"item_name\": item.name, \"item_id\": item_id}\n</code></pre> <p>......\u4ece\uff1a</p> <pre><code>        ... \"item_name\": item.name ...\n</code></pre> <p>......\u6539\u4e3a\uff1a</p> <pre><code>        ... \"item_price\": item.price ...\n</code></pre> <p>......\u6ce8\u610f\u89c2\u5bdf\u7f16\u8f91\u5668\u662f\u5982\u4f55\u81ea\u52a8\u8865\u5168\u5c5e\u6027\u5e76\u4e14\u8fd8\u77e5\u9053\u5b83\u4eec\u7684\u7c7b\u578b\uff1a</p> <p></p> <p>\u6559\u7a0b - \u7528\u6237\u6307\u5357 \u4e2d\u6709\u5305\u542b\u66f4\u591a\u7279\u6027\u7684\u66f4\u5b8c\u6574\u793a\u4f8b\u3002</p> <p>\u5267\u900f\u8b66\u544a\uff1a \u6559\u7a0b - \u7528\u6237\u6307\u5357\u4e2d\u7684\u5185\u5bb9\u6709\uff1a</p> <ul> <li>\u5bf9\u6765\u81ea\u4e0d\u540c\u5730\u65b9\u7684\u53c2\u6570\u8fdb\u884c\u58f0\u660e\uff0c\u5982\uff1a\u8bf7\u6c42\u5934\u3001cookies\u3001form \u8868\u5355\u4ee5\u53ca\u4e0a\u4f20\u7684\u6587\u4ef6\u3002</li> <li>\u5982\u4f55\u8bbe\u7f6e\u6821\u9a8c\u7ea6\u675f\u5982 <code>maximum_length</code> \u6216\u8005 <code>regex</code>\u3002</li> <li>\u4e00\u4e2a\u5f3a\u5927\u5e76\u6613\u4e8e\u4f7f\u7528\u7684 \u4f9d\u8d56\u6ce8\u5165 \u7cfb\u7edf\u3002</li> <li>\u5b89\u5168\u6027\u548c\u8eab\u4efd\u9a8c\u8bc1\uff0c\u5305\u62ec\u901a\u8fc7 JWT \u4ee4\u724c\u548c HTTP \u57fa\u672c\u8eab\u4efd\u8ba4\u8bc1\u6765\u652f\u6301 OAuth2\u3002</li> <li>\u66f4\u8fdb\u9636\uff08\u4f46\u540c\u6837\u7b80\u5355\uff09\u7684\u6280\u5de7\u6765\u58f0\u660e \u591a\u5c42\u5d4c\u5957 JSON \u6a21\u578b \uff08\u501f\u52a9 Pydantic\uff09\u3002</li> <li>\u8bb8\u591a\u989d\u5916\u529f\u80fd\uff08\u5f52\u529f\u4e8e Starlette\uff09\u6bd4\u5982\uff1a<ul> <li>WebSockets</li> <li>GraphQL</li> <li>\u57fa\u4e8e HTTPX \u548c <code>pytest</code> \u7684\u6781\u5176\u7b80\u5355\u7684\u6d4b\u8bd5</li> <li>CORS</li> <li>Cookie Sessions</li> <li>......\u4ee5\u53ca\u66f4\u591a</li> </ul> </li> </ul>"},{"location":"#_11","title":"\u6027\u80fd","text":"<p>\u72ec\u7acb\u673a\u6784 TechEmpower \u6240\u4f5c\u7684\u57fa\u51c6\u6d4b\u8bd5\u7ed3\u679c\u663e\u793a\uff0c\u57fa\u4e8e Uvicorn \u8fd0\u884c\u7684 FastAPI \u7a0b\u5e8f\u662f \u6700\u5feb\u7684 Python web \u6846\u67b6\u4e4b\u4e00\uff0c\u4ec5\u6b21\u4e8e Starlette \u548c Uvicorn \u672c\u8eab\uff08FastAPI \u5185\u90e8\u4f7f\u7528\u4e86\u5b83\u4eec\uff09\u3002(*)</p> <p>\u60f3\u4e86\u89e3\u66f4\u591a\uff0c\u8bf7\u67e5\u9605 \u57fa\u51c6\u6d4b\u8bd5 \u7ae0\u8282\u3002</p>"},{"location":"#_12","title":"\u53ef\u9009\u4f9d\u8d56","text":"<p>\u7528\u4e8e Pydantic\uff1a</p> <ul> <li><code>ujson</code> - \u66f4\u5feb\u7684 JSON \u300c\u89e3\u6790\u300d\u3002</li> <li><code>email_validator</code> - \u7528\u4e8e email \u6821\u9a8c\u3002</li> </ul> <p>\u7528\u4e8e Starlette\uff1a</p> <ul> <li><code>httpx</code> - \u4f7f\u7528 <code>TestClient</code> \u65f6\u5b89\u88c5\u3002</li> <li><code>jinja2</code> - \u4f7f\u7528\u9ed8\u8ba4\u6a21\u677f\u914d\u7f6e\u65f6\u5b89\u88c5\u3002</li> <li><code>python-multipart</code> - \u9700\u8981\u901a\u8fc7 <code>request.form()</code> \u5bf9\u8868\u5355\u8fdb\u884c\u300c\u89e3\u6790\u300d\u65f6\u5b89\u88c5\u3002</li> <li><code>itsdangerous</code> - \u9700\u8981 <code>SessionMiddleware</code> \u652f\u6301\u65f6\u5b89\u88c5\u3002</li> <li><code>pyyaml</code> - \u4f7f\u7528 Starlette \u63d0\u4f9b\u7684 <code>SchemaGenerator</code> \u65f6\u5b89\u88c5\uff08\u6709 FastAPI \u4f60\u53ef\u80fd\u5e76\u4e0d\u9700\u8981\u5b83\uff09\u3002</li> <li><code>graphene</code> - \u9700\u8981 <code>GraphQLApp</code> \u652f\u6301\u65f6\u5b89\u88c5\u3002</li> <li><code>ujson</code> - \u4f7f\u7528 <code>UJSONResponse</code> \u65f6\u5b89\u88c5\u3002</li> </ul> <p>\u7528\u4e8e FastAPI / Starlette\uff1a</p> <ul> <li><code>uvicorn</code> - \u7528\u4e8e\u52a0\u8f7d\u548c\u8fd0\u884c\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u670d\u52a1\u5668\u3002</li> <li><code>orjson</code> - \u4f7f\u7528 <code>ORJSONResponse</code> \u65f6\u5b89\u88c5\u3002</li> </ul> <p>\u4f60\u53ef\u4ee5\u901a\u8fc7 <code>pip install fastapi[all]</code> \u547d\u4ee4\u6765\u5b89\u88c5\u4ee5\u4e0a\u6240\u6709\u4f9d\u8d56\u3002</p>"},{"location":"#_13","title":"\u8bb8\u53ef\u534f\u8bae","text":"<p>\u8be5\u9879\u76ee\u9075\u5faa MIT \u8bb8\u53ef\u534f\u8bae\u3002</p>"},{"location":"benchmarks/","title":"\u57fa\u51c6\u6d4b\u8bd5","text":"<p>\u7b2c\u4e09\u65b9\u673a\u6784 TechEmpower \u7684\u57fa\u51c6\u6d4b\u8bd5\u8868\u660e\u5728 Uvicorn \u4e0b\u8fd0\u884c\u7684 FastAPI \u5e94\u7528\u7a0b\u5e8f\u662f \u53ef\u7528\u7684\u6700\u5feb\u7684 Python \u6846\u67b6\u4e4b\u4e00\uff0c\u4ec5\u6b21\u4e8e Starlette \u548c Uvicorn \u672c\u8eab (\u7531 FastAPI \u5185\u90e8\u4f7f\u7528\uff09\u3002(*)</p> <p>\u4f46\u662f\u5728\u67e5\u770b\u57fa\u51c6\u5f97\u5206\u548c\u5bf9\u6bd4\u65f6\uff0c\u8bf7\u6ce8\u610f\u4ee5\u4e0b\u51e0\u70b9\u3002</p>"},{"location":"benchmarks/#_2","title":"\u57fa\u51c6\u6d4b\u8bd5\u548c\u901f\u5ea6","text":"<p>\u5f53\u4f60\u67e5\u770b\u57fa\u51c6\u6d4b\u8bd5\u65f6\uff0c\u51e0\u4e2a\u4e0d\u540c\u7c7b\u578b\u7684\u5de5\u5177\u88ab\u7b49\u6548\u5730\u505a\u6bd4\u8f83\u662f\u5f88\u5e38\u89c1\u7684\u60c5\u51b5\u3002</p> <p>\u5177\u4f53\u6765\u8bf4\uff0c\u662f\u5c06 Uvicorn\uff0cStarlette \u548c FastAPI \u4e00\u8d77\u6bd4\u8f83\uff08\u5728\u8bb8\u591a\u5176\u5b83\u5de5\u5177\u4e2d\uff09\u3002</p> <p>\u8be5\u5de5\u5177\u89e3\u51b3\u7684\u95ee\u9898\u6700\u7b80\u5355\uff0c\u5b83\u5c06\u83b7\u5f97\u66f4\u597d\u7684\u6027\u80fd\u3002\u800c\u4e14\u5927\u591a\u6570\u57fa\u51c6\u6d4b\u8bd5\u5e76\u672a\u6d4b\u8bd5\u8be5\u5de5\u5177\u63d0\u4f9b\u7684\u5176\u4ed6\u529f\u80fd\u3002</p> <p>\u5c42\u6b21\u7ed3\u6784\u5982\u4e0b\uff1a</p> <ul> <li> <p>Uvicorn\uff1aASGI\u670d\u52a1\u5668</p> <ul> <li>Starlette\uff1a\uff08\u4f7f\u7528 Uvicorn\uff09\u7f51\u7edc\u5fae\u6846\u67b6<ul> <li>FastAPI\uff1a\uff08\u4f7f\u7528 Starlette\uff09 \u5177\u6709\u591a\u4e2a\u9644\u52a0\u529f\u80fd\u7684API\u5fae\u6846\u67b6\uff0c\u7528\u4e8e\u6784\u5efaAPI\uff0c\u8fdb\u884c\u6570\u636e\u9a8c\u8bc1\u7b49\u3002</li> </ul> </li> </ul> </li> <li> <p>Uvicorn:</p> <ul> <li>\u5177\u6709\u6700\u4f73\u6027\u80fd\uff0c\u56e0\u4e3a\u9664\u4e86\u670d\u52a1\u5668\u672c\u8eab\u5916\uff0c\u5b83\u6ca1\u6709\u592a\u591a\u989d\u5916\u7684\u4ee3\u7801\u3002</li> <li>\u60a8\u4e0d\u4f1a\u76f4\u63a5\u5728 Uvicorn \u4e2d\u7f16\u5199\u5e94\u7528\u7a0b\u5e8f\u3002\u8fd9\u610f\u5473\u7740\u60a8\u7684\u4ee3\u7801\u81f3\u5c11\u5fc5\u987b\u5305\u542b Starlette\uff08\u6216 FastAPI\uff09\u63d0\u4f9b\u7684\u4ee3\u7801\u3002\u5982\u679c\u60a8\u8fd9\u6837\u505a\u4e86\uff08\u5373\u76f4\u63a5\u5728 Uvicorn \u4e2d\u7f16\u5199\u5e94\u7528\u7a0b\u5e8f\uff09\uff0c\u6700\u7ec8\u7684\u5e94\u7528\u7a0b\u5e8f\u4f1a\u548c\u4f7f\u7528\u4e86\u6846\u67b6\u5e76\u4e14\u6700\u5c0f\u5316\u4e86\u5e94\u7528\u4ee3\u7801\u548c bug \u7684\u60c5\u51b5\u5177\u6709\u76f8\u540c\u7684\u6027\u80fd\u635f\u8017\u3002</li> <li>\u5982\u679c\u8981\u5bf9\u6bd4\u4e0e Uvicorn \u5bf9\u6807\u7684\u670d\u52a1\u5668\uff0c\u8bf7\u5c06\u5176\u4e0e Daphne\uff0cHypercorn\uff0cuWSGI\u7b49\u5e94\u7528\u670d\u52a1\u5668\u8fdb\u884c\u6bd4\u8f83\u3002</li> </ul> </li> <li>Starlette:<ul> <li>\u5728 Uvicorn \u540e\u4f7f\u7528 Starlette\uff0c\u6027\u80fd\u4f1a\u7565\u6709\u4e0b\u964d\u3002\u5b9e\u9645\u4e0a\uff0cStarlette \u4f7f\u7528 Uvicorn\u8fd0\u884c\u3002\u56e0\u6b64\uff0c\u7531\u4e8e\u5fc5\u987b\u6267\u884c\u66f4\u591a\u7684\u4ee3\u7801\uff0c\u5b83\u53ea\u4f1a\u6bd4 Uvicorn \u66f4\u6162\u3002</li> <li>\u4f46\u5b83\u4e3a\u60a8\u63d0\u4f9b\u4e86\u6784\u5efa\u7b80\u5355\u7684\u7f51\u7edc\u7a0b\u5e8f\u7684\u5de5\u5177\uff0c\u5e76\u5177\u6709\u57fa\u4e8e\u8def\u5f84\u7684\u8def\u7531\u7b49\u529f\u80fd\u3002</li> <li>\u5982\u679c\u60f3\u5bf9\u6bd4\u4e0e Starlette \u5bf9\u6807\u7684\u5f00\u53d1\u6846\u67b6\uff0c\u8bf7\u5c06\u5176\u4e0e Sanic\uff0cFlask\uff0cDjango \u7b49\u7f51\u7edc\u6846\u67b6\uff08\u6216\u5fae\u6846\u67b6\uff09\u8fdb\u884c\u6bd4\u8f83\u3002</li> </ul> </li> <li>FastAPI:<ul> <li>\u4e0e Starlette \u4f7f\u7528 Uvicorn \u4e00\u6837\uff0c\u7531\u4e8e FastAPI \u4f7f\u7528 Starlette\uff0c\u56e0\u6b64 FastAPI \u4e0d\u80fd\u6bd4 Starlette \u66f4\u5feb\u3002</li> <li>FastAPI \u5728 Starlette \u57fa\u7840\u4e0a\u63d0\u4f9b\u4e86\u66f4\u591a\u529f\u80fd\u3002\u4f8b\u5982\u5728\u5f00\u53d1 API \u65f6\uff0c\u6240\u9700\u7684\u6570\u636e\u9a8c\u8bc1\u548c\u5e8f\u5217\u5316\u529f\u80fd\u3002FastAPI \u53ef\u4ee5\u5e2e\u52a9\u60a8\u81ea\u52a8\u751f\u6210 API\u6587\u6863\uff0c\uff08\u6587\u6863\u5728\u5e94\u7528\u7a0b\u5e8f\u542f\u52a8\u65f6\u81ea\u52a8\u751f\u6210\uff0c\u6240\u4ee5\u4e0d\u4f1a\u589e\u52a0\u5e94\u7528\u7a0b\u5e8f\u8fd0\u884c\u65f6\u7684\u5f00\u9500\uff09\u3002</li> <li>\u5982\u679c\u60a8\u4e0d\u4f7f\u7528 FastAPI \u800c\u76f4\u63a5\u4f7f\u7528 Starlette\uff08\u6216\u8bf8\u5982 Sanic\uff0cFlask\uff0cResponder \u7b49\u5176\u5b83\u5de5\u5177\uff09\uff0c\u60a8\u5219\u8981\u81ea\u5df1\u5b9e\u73b0\u6240\u6709\u7684\u6570\u636e\u9a8c\u8bc1\u548c\u5e8f\u5217\u5316\u3002\u90a3\u4e48\u6700\u7ec8\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u4f1a\u548c\u4f7f\u7528 FastAPI \u6784\u5efa\u7684\u7a0b\u5e8f\u6709\u76f8\u540c\u7684\u5f00\u9500\u3002\u4e00\u822c\u8fd9\u79cd\u6570\u636e\u9a8c\u8bc1\u548c\u5e8f\u5217\u5316\u7684\u64cd\u4f5c\u5728\u60a8\u5e94\u7528\u7a0b\u5e8f\u7684\u4ee3\u7801\u4e2d\u4f1a\u5360\u5f88\u5927\u6bd4\u91cd\u3002</li> <li>\u56e0\u6b64\uff0c\u901a\u8fc7\u4f7f\u7528 FastAPI \u610f\u5473\u7740\u60a8\u53ef\u4ee5\u8282\u7701\u5f00\u53d1\u65f6\u95f4\uff0c\u51cf\u5c11\u7f16\u7801\u9519\u8bef\uff0c\u7528\u66f4\u5c11\u7684\u7f16\u7801\u5b9e\u73b0\u5176\u529f\u80fd\uff0c\u5e76\u4e14\u76f8\u6bd4\u4e0d\u4f7f\u7528 FastAPI \u60a8\u5f88\u5927\u53ef\u80fd\u4f1a\u83b7\u5f97\u76f8\u540c\u6216\u66f4\u597d\u7684\u6027\u80fd\uff08\u56e0\u4e3a\u90a3\u6837\u60a8\u5fc5\u987b\u5728\u4ee3\u7801\u4e2d\u5b9e\u73b0\u6240\u6709\u76f8\u540c\u7684\u529f\u80fd\uff09\u3002</li> <li>\u5982\u679c\u60a8\u60f3\u5bf9\u6bd4\u4e0e FastAPI \u5bf9\u6807\u7684\u5f00\u53d1\u6846\u67b6\uff0c\u8bf7\u4e0e\u80fd\u591f\u63d0\u4f9b\u6570\u636e\u9a8c\u8bc1\uff0c\u5e8f\u5217\u5316\u548c\u5e26\u6709\u81ea\u52a8\u6587\u6863\u751f\u6210\u7684\u7f51\u7edc\u5e94\u7528\u7a0b\u5e8f\u6846\u67b6\uff08\u6216\u5de5\u5177\u96c6\uff09\u8fdb\u884c\u5bf9\u6bd4\uff0c\u4f8b\u5982\u5177\u6709\u96c6\u6210\u81ea\u52a8\u6570\u636e\u9a8c\u8bc1\uff0c\u5e8f\u5217\u5316\u548c\u81ea\u52a8\u5316\u6587\u6863\u7684 Flask-apispec\uff0cNestJS\uff0cMolten \u7b49\u3002</li> </ul> </li> </ul>"},{"location":"contributing/","title":"\u5f00\u53d1 - \u8d21\u732e","text":"<p>\u9996\u5148\uff0c\u4f60\u6700\u597d\u5148\u4e86\u89e3 \u5e2e\u52a9 FastAPI \u53ca\u83b7\u53d6\u5e2e\u52a9\u7684\u57fa\u672c\u65b9\u5f0f\u3002</p>"},{"location":"contributing/#_1","title":"\u5f00\u53d1","text":"<p>\u5982\u679c\u4f60\u5df2\u7ecf\u514b\u9686\u4e86\u6e90\u7801\u4ed3\u5e93\uff0c\u5e76\u4e14\u9700\u8981\u6df1\u5165\u7814\u7a76\u4ee3\u7801\uff0c\u4e0b\u9762\u662f\u8bbe\u7f6e\u5f00\u53d1\u73af\u5883\u7684\u6307\u5357\u3002</p>"},{"location":"contributing/#venv","title":"\u901a\u8fc7 <code>venv</code> \u7ba1\u7406\u865a\u62df\u73af\u5883","text":"<p>\u4f60\u53ef\u4ee5\u4f7f\u7528 Python \u7684 <code>venv</code> \u6a21\u5757\u5728\u4e00\u4e2a\u76ee\u5f55\u4e2d\u521b\u5efa\u865a\u62df\u73af\u5883\uff1a</p> <pre><code>$ python -m venv env\n</code></pre> <p>\u8fd9\u5c06\u4f7f\u7528 Python \u7a0b\u5e8f\u521b\u5efa\u4e00\u4e2a <code>./env/</code> \u76ee\u5f55\uff0c\u7136\u540e\u4f60\u5c06\u80fd\u591f\u4e3a\u8fd9\u4e2a\u9694\u79bb\u7684\u73af\u5883\u5b89\u88c5\u8f6f\u4ef6\u5305\u3002</p>"},{"location":"contributing/#_2","title":"\u6fc0\u6d3b\u865a\u62df\u73af\u5883","text":"<p>\u4f7f\u7528\u4ee5\u4e0b\u65b9\u6cd5\u6fc0\u6d3b\u65b0\u73af\u5883\uff1a</p> Linux, macOSWindows PowerShellWindows Bash <pre><code>$ source ./env/bin/activate\n</code></pre> <pre><code>$ .\\env\\Scripts\\Activate.ps1\n</code></pre> <p>Or if you use Bash for Windows (e.g. Git Bash):</p> <pre><code>$ source ./env/Scripts/activate\n</code></pre> <p>\u8981\u68c0\u67e5\u64cd\u4f5c\u662f\u5426\u6210\u529f\uff0c\u8fd0\u884c\uff1a</p> Linux, macOS, Windows BashWindows PowerShell <pre><code>$ which pip\n\nsome/directory/fastapi/env/bin/pip\n</code></pre> <pre><code>$ Get-Command pip\n\nsome/directory/fastapi/env/bin/pip\n</code></pre> <p>\u5982\u679c\u663e\u793a <code>pip</code> \u7a0b\u5e8f\u6587\u4ef6\u4f4d\u4e8e <code>env/bin/pip</code> \u5219\u8bf4\u660e\u6fc0\u6d3b\u6210\u529f\u3002 \ud83c\udf89</p> <p>Tip</p> <p>\u6bcf\u4e00\u6b21\u4f60\u5728\u8be5\u73af\u5883\u4e0b\u4f7f\u7528 <code>pip</code> \u5b89\u88c5\u4e86\u65b0\u8f6f\u4ef6\u5305\u65f6\uff0c\u8bf7\u518d\u6b21\u6fc0\u6d3b\u8be5\u73af\u5883\u3002</p> <p>\u8fd9\u6837\u53ef\u4ee5\u786e\u4fdd\u4f60\u5728\u4f7f\u7528\u7531\u8be5\u8f6f\u4ef6\u5305\u5b89\u88c5\u7684\u7ec8\u7aef\u7a0b\u5e8f\u65f6\u4f7f\u7528\u7684\u662f\u5f53\u524d\u865a\u62df\u73af\u5883\u4e2d\u7684\u7a0b\u5e8f\uff0c\u800c\u4e0d\u662f\u5176\u4ed6\u7684\u53ef\u80fd\u662f\u5168\u5c40\u5b89\u88c5\u7684\u7a0b\u5e8f\u3002</p>"},{"location":"contributing/#pip","title":"pip","text":"<p>\u5982\u4e0a\u6240\u8ff0\u6fc0\u6d3b\u73af\u5883\u540e\uff1a</p> <pre><code>$ pip install -e .\"[dev,doc,test]\"\n\n---&gt; 100%\n</code></pre> <p>\u8fd9\u5c06\u5728\u865a\u62df\u73af\u5883\u4e2d\u5b89\u88c5\u6240\u6709\u4f9d\u8d56\u548c\u672c\u5730\u7248\u672c\u7684 FastAPI\u3002</p>"},{"location":"contributing/#fastapi","title":"\u4f7f\u7528\u672c\u5730 FastAPI","text":"<p>\u5982\u679c\u4f60\u521b\u5efa\u4e00\u4e2a\u5bfc\u5165\u5e76\u4f7f\u7528 FastAPI \u7684 Python \u6587\u4ef6\uff0c\u7136\u540e\u4f7f\u7528\u865a\u62df\u73af\u5883\u4e2d\u7684 Python \u8fd0\u884c\u5b83\uff0c\u5b83\u5c06\u4f7f\u7528\u4f60\u672c\u5730\u7684 FastAPI \u6e90\u7801\u3002</p> <p>\u5e76\u4e14\u5982\u679c\u4f60\u66f4\u6539\u8be5\u672c\u5730 FastAPI \u7684\u6e90\u7801\uff0c\u7531\u4e8e\u5b83\u662f\u901a\u8fc7 <code>-e</code> \u5b89\u88c5\u7684\uff0c\u5f53\u4f60\u518d\u6b21\u8fd0\u884c\u90a3\u4e2a Python \u6587\u4ef6\uff0c\u5b83\u5c06\u4f7f\u7528\u4f60\u521a\u521a\u7f16\u8f91\u8fc7\u7684\u6700\u65b0\u7248\u672c\u7684 FastAPI\u3002</p> <p>\u8fd9\u6837\uff0c\u4f60\u4e0d\u5fc5\u518d\u53bb\u91cd\u65b0\"\u5b89\u88c5\"\u4f60\u7684\u672c\u5730\u7248\u672c\u5373\u53ef\u6d4b\u8bd5\u6240\u6709\u66f4\u6539\u3002</p>"},{"location":"contributing/#_3","title":"\u683c\u5f0f\u5316","text":"<p>\u4f60\u53ef\u4ee5\u8fd0\u884c\u4e0b\u9762\u7684\u811a\u672c\u6765\u683c\u5f0f\u5316\u548c\u6e05\u7406\u6240\u6709\u4ee3\u7801\uff1a</p> <pre><code>$ bash scripts/format.sh\n</code></pre> <p>\u5b83\u8fd8\u4f1a\u81ea\u52a8\u5bf9\u6240\u6709\u5bfc\u5165\u4ee3\u7801\u8fdb\u884c\u6574\u7406\u3002</p> <p>\u4e3a\u4e86\u4f7f\u6574\u7406\u6b63\u786e\u8fdb\u884c\uff0c\u4f60\u9700\u8981\u5728\u5f53\u524d\u73af\u5883\u4e2d\u5b89\u88c5\u672c\u5730\u7684 FastAPI\uff0c\u5373\u5728\u8fd0\u884c\u4e0a\u8ff0\u6bb5\u843d\u4e2d\u7684\u547d\u4ee4\u65f6\u6dfb\u52a0 <code>-e</code>\u3002</p>"},{"location":"contributing/#_4","title":"\u683c\u5f0f\u5316\u5bfc\u5165","text":"<p>\u8fd8\u6709\u53e6\u4e00\u4e2a\u811a\u672c\u53ef\u4ee5\u683c\u5f0f\u5316\u6240\u6709\u5bfc\u5165\uff0c\u5e76\u786e\u4fdd\u4f60\u6ca1\u6709\u672a\u4f7f\u7528\u7684\u5bfc\u5165\u4ee3\u7801\uff1a</p> <pre><code>$ bash scripts/format-imports.sh\n</code></pre> <p>\u7531\u4e8e\u5b83\u4f9d\u6b21\u8fd0\u884c\u4e86\u591a\u4e2a\u547d\u4ee4\uff0c\u5e76\u4fee\u6539\u548c\u8fd8\u539f\u4e86\u8bb8\u591a\u6587\u4ef6\uff0c\u6240\u4ee5\u8fd0\u884c\u65f6\u95f4\u4f1a\u66f4\u957f\u4e00\u4e9b\uff0c\u56e0\u6b64\u7ecf\u5e38\u5730\u4f7f\u7528 <code>scripts/format.sh</code> \u7136\u540e\u4ec5\u5728\u63d0\u4ea4\u524d\u6267\u884c <code>scripts/format-imports.sh</code> \u4f1a\u66f4\u597d\u4e00\u4e9b\u3002</p>"},{"location":"contributing/#_5","title":"\u6587\u6863","text":"<p>\u9996\u5148\uff0c\u8bf7\u786e\u4fdd\u6309\u4e0a\u8ff0\u6b65\u9aa4\u8bbe\u7f6e\u597d\u73af\u5883\uff0c\u8fd9\u5c06\u5b89\u88c5\u6240\u6709\u9700\u8981\u7684\u4f9d\u8d56\u3002</p> <p>\u6587\u6863\u4f7f\u7528 MkDocs \u751f\u6210\u3002</p> <p>\u5e76\u4e14\u5728 <code>./scripts/docs.py</code> \u4e2d\u8fd8\u6709\u9002\u7528\u7684\u989d\u5916\u5de5\u5177/\u811a\u672c\u6765\u5904\u7406\u7ffb\u8bd1\u3002</p> <p>Tip</p> <p>\u4f60\u4e0d\u9700\u8981\u53bb\u4e86\u89e3 <code>./scripts/docs.py</code> \u4e2d\u7684\u4ee3\u7801\uff0c\u53ea\u9700\u5728\u547d\u4ee4\u884c\u4e2d\u4f7f\u7528\u5b83\u5373\u53ef\u3002</p> <p>\u6240\u6709\u6587\u6863\u5747\u5728 <code>./docs/en/</code> \u76ee\u5f55\u4e2d\u4ee5 Markdown \u6587\u4ef6\u683c\u5f0f\u4fdd\u5b58\u3002</p> <p>\u8bb8\u591a\u7684\u6559\u7a0b\u7ae0\u8282\u91cc\u5305\u542b\u6709\u4ee3\u7801\u5757\u3002</p> <p>\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e9b\u4ee3\u7801\u5757\u662f\u53ef\u4ee5\u76f4\u63a5\u8fd0\u884c\u7684\u771f\u5b9e\u5b8c\u6574\u7684\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u8fd9\u4e9b\u4ee3\u7801\u5757\u4e0d\u662f\u5199\u5728 Markdown \u6587\u4ef6\u5185\u7684\uff0c\u5b83\u4eec\u662f\u4f4d\u4e8e <code>./docs_src/</code> \u76ee\u5f55\u4e2d\u7684 Python \u6587\u4ef6\u3002</p> <p>\u751f\u6210\u7ad9\u70b9\u65f6\uff0c\u8fd9\u4e9b Python \u6587\u4ef6\u4f1a\u88ab\u5305\u542b/\u6ce8\u5165\u5230\u6587\u6863\u4e2d\u3002</p>"},{"location":"contributing/#_6","title":"\u7528\u4e8e\u6d4b\u8bd5\u7684\u6587\u6863","text":"<p>\u5927\u591a\u6570\u7684\u6d4b\u8bd5\u5b9e\u9645\u4e0a\u90fd\u662f\u9488\u5bf9\u6587\u6863\u4e2d\u7684\u793a\u4f8b\u6e90\u6587\u4ef6\u8fd0\u884c\u7684\u3002</p> <p>\u8fd9\u6709\u52a9\u4e8e\u786e\u4fdd\uff1a</p> <ul> <li>\u6587\u6863\u59cb\u7ec8\u662f\u6700\u65b0\u7684\u3002</li> <li>\u6587\u6863\u793a\u4f8b\u53ef\u4ee5\u76f4\u63a5\u8fd0\u884c\u3002</li> <li>\u7edd\u5927\u591a\u6570\u7279\u6027\u65e2\u5728\u6587\u6863\u4e2d\u5f97\u4ee5\u9610\u8ff0\uff0c\u53c8\u901a\u8fc7\u6d4b\u8bd5\u8986\u76d6\u8fdb\u884c\u4fdd\u969c\u3002</li> </ul> <p>\u5728\u672c\u5730\u5f00\u53d1\u671f\u95f4\uff0c\u6709\u4e00\u4e2a\u811a\u672c\u53ef\u4ee5\u5b9e\u65f6\u91cd\u8f7d\u5730\u6784\u5efa\u7ad9\u70b9\u5e76\u7528\u6765\u68c0\u67e5\u6240\u505a\u7684\u4efb\u4f55\u66f4\u6539\uff1a</p> <pre><code>$ python ./scripts/docs.py live\n\n&lt;span style=\"color: green;\"&gt;[INFO]&lt;/span&gt; Serving on http://127.0.0.1:8008\n&lt;span style=\"color: green;\"&gt;[INFO]&lt;/span&gt; Start watching changes\n&lt;span style=\"color: green;\"&gt;[INFO]&lt;/span&gt; Start detecting changes\n</code></pre> <p>\u5b83\u5c06\u5728 <code>http://127.0.0.1:8008</code> \u63d0\u4f9b\u5bf9\u6587\u6863\u7684\u8bbf\u95ee\u3002</p> <p>\u8fd9\u6837\uff0c\u4f60\u53ef\u4ee5\u7f16\u8f91\u6587\u6863/\u6e90\u6587\u4ef6\u5e76\u5b9e\u65f6\u67e5\u770b\u66f4\u6539\u3002</p>"},{"location":"contributing/#typer-cli","title":"Typer CLI \uff08\u53ef\u9009\uff09","text":"<p>\u672c\u6307\u5f15\u5411\u4f60\u5c55\u793a\u4e86\u5982\u4f55\u76f4\u63a5\u7528 <code>python</code> \u7a0b\u5e8f\u8fd0\u884c <code>./scripts/docs.py</code> \u4e2d\u7684\u811a\u672c\u3002</p> <p>\u4f46\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 Typer CLI\uff0c\u800c\u4e14\u5728\u5b89\u88c5\u4e86\u8865\u5168\u529f\u80fd\u540e\uff0c\u4f60\u5c06\u53ef\u4ee5\u5728\u7ec8\u7aef\u4e2d\u5bf9\u547d\u4ee4\u8fdb\u884c\u81ea\u52a8\u8865\u5168\u3002</p> <p>\u5982\u679c\u4f60\u6253\u7b97\u5b89\u88c5 Typer CLI \uff0c\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88c5\u81ea\u52a8\u8865\u5168\u529f\u80fd\uff1a</p> <pre><code>$ typer --install-completion\n\nzsh completion installed in /home/user/.bashrc.\nCompletion will take effect once you restart the terminal.\n</code></pre>"},{"location":"contributing/#_7","title":"\u5e94\u7528\u548c\u6587\u6863\u540c\u65f6\u8fd0\u884c","text":"<p>\u5982\u679c\u4f60\u4f7f\u7528\u4ee5\u4e0b\u65b9\u5f0f\u8fd0\u884c\u793a\u4f8b\u7a0b\u5e8f\uff1a</p> <pre><code>$ uvicorn tutorial001:app --reload\n\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n</code></pre> <p>\u7531\u4e8e Uvicorn \u9ed8\u8ba4\u4f7f\u7528 <code>8000</code> \u7aef\u53e3 \uff0c\u56e0\u6b64\u8fd0\u884c\u5728 <code>8008</code> \u7aef\u53e3\u4e0a\u7684\u6587\u6863\u4e0d\u4f1a\u4e0e\u4e4b\u51b2\u7a81\u3002</p>"},{"location":"contributing/#_8","title":"\u7ffb\u8bd1","text":"<p>\u975e\u5e38\u611f\u8c22\u4f60\u80fd\u591f\u53c2\u4e0e\u6587\u6863\u7684\u7ffb\u8bd1\uff01\u8fd9\u9879\u5de5\u4f5c\u9700\u8981\u793e\u533a\u7684\u5e2e\u52a9\u624d\u80fd\u5b8c\u6210\u3002 \ud83c\udf0e \ud83d\ude80</p> <p>\u4ee5\u4e0b\u662f\u53c2\u4e0e\u5e2e\u52a9\u7ffb\u8bd1\u7684\u6b65\u9aa4\u3002</p>"},{"location":"contributing/#_9","title":"\u5efa\u8bae\u548c\u6307\u5357","text":"<ul> <li>\u5728\u5f53\u524d \u5df2\u6709\u7684 pull requests \u4e2d\u67e5\u627e\u4f60\u4f7f\u7528\u7684\u8bed\u8a00\uff0c\u6dfb\u52a0\u8981\u6c42\u4fee\u6539\u6216\u540c\u610f\u5408\u5e76\u7684\u8bc4\u5ba1\u610f\u89c1\u3002</li> </ul> <p>Tip</p> <p>\u4f60\u53ef\u4ee5\u4e3a\u5df2\u6709\u7684 pull requests \u6dfb\u52a0\u5305\u542b\u4fee\u6539\u5efa\u8bae\u7684\u8bc4\u8bba\u3002</p> <p>\u8be6\u60c5\u53ef\u67e5\u770b\u5173\u4e8e \u6dfb\u52a0 pull request \u8bc4\u5ba1\u610f\u89c1 \u4ee5\u540c\u610f\u5408\u5e76\u6216\u8981\u6c42\u4fee\u6539\u7684\u6587\u6863\u3002</p> <ul> <li> <p>\u5728 issues \u4e2d\u67e5\u627e\u662f\u5426\u6709\u5bf9\u4f60\u6240\u7528\u8bed\u8a00\u6240\u8fdb\u884c\u7684\u534f\u4f5c\u7ffb\u8bd1\u3002</p> </li> <li> <p>\u6bcf\u7ffb\u8bd1\u4e00\u4e2a\u9875\u9762\u65b0\u589e\u4e00\u4e2a pull request\u3002\u8fd9\u5c06\u4f7f\u5176\u4ed6\u4eba\u66f4\u5bb9\u6613\u5bf9\u5176\u8fdb\u884c\u8bc4\u5ba1\u3002</p> </li> </ul> <p>\u5bf9\u4e8e\u6211\uff08\u8bd1\u6ce8\uff1a\u4f5c\u8005\u4f7f\u7528\u897f\u73ed\u7259\u8bed\u548c\u82f1\u8bed\uff09\u4e0d\u61c2\u7684\u8bed\u8a00\uff0c\u6211\u5c06\u5728\u7b49\u5f85\u5176\u4ed6\u4eba\u8bc4\u5ba1\u7ffb\u8bd1\u4e4b\u540e\u5c06\u5176\u5408\u5e76\u3002</p> <ul> <li> <p>\u4f60\u8fd8\u53ef\u4ee5\u67e5\u770b\u662f\u5426\u6709\u4f60\u6240\u7528\u8bed\u8a00\u7684\u7ffb\u8bd1\uff0c\u5e76\u5bf9\u5176\u8fdb\u884c\u8bc4\u5ba1\uff0c\u8fd9\u5c06\u5e2e\u52a9\u6211\u4e86\u89e3\u7ffb\u8bd1\u662f\u5426\u6b63\u786e\u4ee5\u53ca\u80fd\u5426\u5c06\u5176\u5408\u5e76\u3002</p> </li> <li> <p>\u4f7f\u7528\u76f8\u540c\u7684 Python \u793a\u4f8b\u5e76\u4e14\u4ec5\u7ffb\u8bd1\u6587\u6863\u4e2d\u7684\u6587\u672c\u3002\u65e0\u9700\u8fdb\u884c\u4efb\u4f55\u5176\u4ed6\u66f4\u6539\u793a\u4f8b\u4e5f\u80fd\u6b63\u5e38\u5de5\u4f5c\u3002</p> </li> <li> <p>\u4f7f\u7528\u76f8\u540c\u7684\u56fe\u7247\u3001\u6587\u4ef6\u540d\u4ee5\u53ca\u94fe\u63a5\u5730\u5740\u3002\u65e0\u9700\u8fdb\u884c\u4efb\u4f55\u5176\u4ed6\u8c03\u6574\u6765\u8ba9\u5b83\u4eec\u517c\u5bb9\u3002</p> </li> <li> <p>\u4f60\u53ef\u4ee5\u4ece ISO 639-1 \u4ee3\u7801\u5217\u8868 \u8868\u4e2d\u67e5\u627e\u4f60\u60f3\u8981\u7ffb\u8bd1\u8bed\u8a00\u7684\u4e24\u4f4d\u5b57\u6bcd\u4ee3\u7801\u3002</p> </li> </ul>"},{"location":"contributing/#_10","title":"\u5df2\u6709\u7684\u8bed\u8a00","text":"<p>\u5047\u8bbe\u4f60\u60f3\u5c06\u67d0\u4e2a\u9875\u9762\u7ffb\u8bd1\u6210\u5df2\u7ecf\u7ffb\u8bd1\u4e86\u4e00\u4e9b\u9875\u9762\u7684\u8bed\u8a00\uff0c\u4f8b\u5982\u897f\u73ed\u7259\u8bed\u3002</p> <p>\u5bf9\u4e8e\u897f\u73ed\u7259\u8bed\u6765\u8bf4\uff0c\u5b83\u7684\u4e24\u4f4d\u5b57\u6bcd\u4ee3\u7801\u662f <code>es</code>\u3002\u6240\u4ee5\u897f\u73ed\u7259\u8bed\u7ffb\u8bd1\u7684\u76ee\u5f55\u4f4d\u4e8e <code>docs/es/</code>\u3002</p> <p>Tip</p> <p>\u4e3b\u8981\uff08\"\u5b98\u65b9\"\uff09\u8bed\u8a00\u662f\u82f1\u8bed\uff0c\u4f4d\u4e8e <code>docs/en/</code>\u76ee\u5f55\u3002</p> <p>\u73b0\u5728\u4e3a\u897f\u73ed\u7259\u8bed\u6587\u6863\u8fd0\u884c\u5b9e\u65f6\u670d\u52a1\u5668\uff1a</p> <pre><code>// Use the command \"live\" and pass the language code as a CLI argument\n$ python ./scripts/docs.py live es\n\n&lt;span style=\"color: green;\"&gt;[INFO]&lt;/span&gt; Serving on http://127.0.0.1:8008\n&lt;span style=\"color: green;\"&gt;[INFO]&lt;/span&gt; Start watching changes\n&lt;span style=\"color: green;\"&gt;[INFO]&lt;/span&gt; Start detecting changes\n</code></pre> <p>\u73b0\u5728\u4f60\u53ef\u4ee5\u8bbf\u95ee http://127.0.0.1:8008 \u5b9e\u65f6\u67e5\u770b\u4f60\u6240\u505a\u7684\u66f4\u6539\u3002</p> <p>\u5982\u679c\u4f60\u67e5\u770b FastAPI \u7684\u7ebf\u4e0a\u6587\u6863\u7f51\u7ad9\uff0c\u4f1a\u770b\u5230\u6bcf\u79cd\u8bed\u8a00\u90fd\u6709\u6240\u6709\u9875\u9762\u3002\u4f46\u662f\u67d0\u4e9b\u9875\u9762\u5e76\u672a\u88ab\u7ffb\u8bd1\u5e76\u4e14\u4f1a\u6709\u4e00\u5904\u5173\u4e8e\u7f3a\u5c11\u7ffb\u8bd1\u7684\u63d0\u793a\u3002</p> <p>\u4f46\u662f\u5f53\u4f60\u50cf\u4e0a\u9762\u8fd9\u6837\u5728\u672c\u5730\u8fd0\u884c\u6587\u6863\u65f6\uff0c\u4f60\u53ea\u4f1a\u770b\u5230\u5df2\u7ecf\u7ffb\u8bd1\u7684\u9875\u9762\u3002</p> <p>\u73b0\u5728\u5047\u8bbe\u4f60\u8981\u4e3a Features \u7ae0\u8282\u6dfb\u52a0\u7ffb\u8bd1\u3002</p> <ul> <li>\u590d\u5236\u4e0b\u9762\u7684\u6587\u4ef6\uff1a</li> </ul> <pre><code>docs/en/docs/features.md\n</code></pre> <ul> <li>\u7c98\u8d34\u5230\u4f60\u60f3\u8981\u7ffb\u8bd1\u8bed\u8a00\u76ee\u5f55\u7684\u76f8\u540c\u4f4d\u7f6e\uff0c\u6bd4\u5982\uff1a</li> </ul> <pre><code>docs/es/docs/features.md\n</code></pre> <p>Tip</p> <p>\u6ce8\u610f\u8def\u5f84\u548c\u6587\u4ef6\u540d\u7684\u552f\u4e00\u53d8\u5316\u662f\u8bed\u8a00\u4ee3\u7801\uff0c\u4ece <code>en</code> \u66f4\u6539\u4e3a <code>es</code>\u3002</p> <ul> <li>\u73b0\u5728\u6253\u5f00\u4f4d\u4e8e\u82f1\u8bed\u6587\u6863\u76ee\u5f55\u4e0b\u7684 MkDocs \u914d\u7f6e\u6587\u4ef6\uff1a</li> </ul> <pre><code>docs/en/docs/mkdocs.yml\n</code></pre> <ul> <li>\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u627e\u5230 <code>docs/features.md</code> \u6240\u5728\u7684\u4f4d\u7f6e\u3002\u7ed3\u679c\u50cf\u8fd9\u6837\uff1a</li> </ul> <pre><code>site_name: FastAPI\n# More stuff\nnav:\n- FastAPI: index.md\n- Languages:\n- en: /\n- es: /es/\n- features.md\n</code></pre> <ul> <li>\u6253\u5f00\u4f60\u6b63\u5728\u7f16\u8f91\u7684\u8bed\u8a00\u76ee\u5f55\u4e2d\u7684 MkDocs \u914d\u7f6e\u6587\u4ef6\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>docs/es/docs/mkdocs.yml\n</code></pre> <ul> <li>\u5c06\u5176\u6dfb\u52a0\u5230\u4e0e\u82f1\u8bed\u6587\u6863\u5b8c\u5168\u76f8\u540c\u7684\u4f4d\u7f6e\uff0c\u4f8b\u5982\uff1a</li> </ul> <pre><code>site_name: FastAPI\n# More stuff\nnav:\n- FastAPI: index.md\n- Languages:\n- en: /\n- es: /es/\n- features.md\n</code></pre> <p>\u5982\u679c\u914d\u7f6e\u6587\u4ef6\u4e2d\u8fd8\u6709\u5176\u4ed6\u6761\u76ee\uff0c\u8bf7\u786e\u4fdd\u4f60\u6240\u7ffb\u8bd1\u7684\u65b0\u6761\u76ee\u548c\u5b83\u4eec\u4e4b\u95f4\u7684\u987a\u5e8f\u4e0e\u82f1\u6587\u7248\u672c\u5b8c\u5168\u76f8\u540c\u3002</p> <p>\u6253\u5f00\u6d4f\u89c8\u5668\uff0c\u73b0\u5728\u4f60\u5c06\u770b\u5230\u6587\u6863\u5c55\u793a\u4e86\u4f60\u6240\u52a0\u5165\u7684\u65b0\u7ae0\u8282\u3002 \ud83c\udf89</p> <p>\u73b0\u5728\uff0c\u4f60\u53ef\u4ee5\u5c06\u5b83\u5168\u90e8\u7ffb\u8bd1\u5b8c\u5e76\u5728\u4fdd\u5b58\u6587\u4ef6\u540e\u8fdb\u884c\u9884\u89c8\u3002</p>"},{"location":"contributing/#_11","title":"\u65b0\u8bed\u8a00","text":"<p>\u5047\u8bbe\u4f60\u60f3\u8981\u4e3a\u5c1a\u672a\u6709\u4efb\u4f55\u9875\u9762\u88ab\u7ffb\u8bd1\u7684\u8bed\u8a00\u6dfb\u52a0\u7ffb\u8bd1\u3002</p> <p>\u5047\u8bbe\u4f60\u60f3\u8981\u6dfb\u52a0\u514b\u91cc\u5965\u5c14\u8bed\u7ffb\u8bd1\uff0c\u800c\u4e14\u6587\u6863\u4e2d\u8fd8\u6ca1\u6709\u8be5\u8bed\u8a00\u7684\u7ffb\u8bd1\u3002</p> <p>\u70b9\u51fb\u4e0a\u9762\u63d0\u5230\u7684\u94fe\u63a5\uff0c\u53ef\u4ee5\u67e5\u5230\"\u514b\u91cc\u5965\u5c14\u8bed\"\u7684\u4ee3\u7801\u4e3a <code>ht</code>\u3002</p> <p>\u4e0b\u4e00\u6b65\u662f\u8fd0\u884c\u811a\u672c\u4ee5\u751f\u6210\u65b0\u7684\u7ffb\u8bd1\u76ee\u5f55\uff1a</p> <pre><code>// Use the command new-lang, pass the language code as a CLI argument\n$ python ./scripts/docs.py new-lang ht\n\nSuccessfully initialized: docs/ht\nUpdating ht\nUpdating en\n</code></pre> <p>\u73b0\u5728\uff0c\u4f60\u53ef\u4ee5\u5728\u7f16\u8f91\u5668\u4e2d\u67e5\u770b\u65b0\u521b\u5efa\u7684\u76ee\u5f55 <code>docs/ht/</code>\u3002</p> <p>Tip</p> <p>\u5728\u6dfb\u52a0\u5b9e\u9645\u7684\u7ffb\u8bd1\u4e4b\u524d\uff0c\u4ec5\u4ee5\u6b64\u521b\u5efa\u9996\u4e2a pull request \u6765\u8bbe\u5b9a\u65b0\u8bed\u8a00\u7684\u914d\u7f6e\u3002</p> <p>\u8fd9\u6837\u5f53\u4f60\u5728\u7ffb\u8bd1\u7b2c\u4e00\u4e2a\u9875\u9762\u65f6\uff0c\u5176\u4ed6\u4eba\u53ef\u4ee5\u5e2e\u52a9\u7ffb\u8bd1\u5176\u4ed6\u9875\u9762\u3002\ud83d\ude80</p> <p>\u9996\u5148\u7ffb\u8bd1\u6587\u6863\u4e3b\u9875 <code>docs/ht/index.md</code>\u3002</p> <p>\u7136\u540e\uff0c\u4f60\u53ef\u4ee5\u6839\u636e\u4e0a\u9762\u7684\"\u5df2\u6709\u8bed\u8a00\"\u7684\u6307\u5f15\u7ee7\u7eed\u8fdb\u884c\u7ffb\u8bd1\u3002</p>"},{"location":"contributing/#_12","title":"\u4e0d\u652f\u6301\u7684\u65b0\u8bed\u8a00","text":"<p>\u5982\u679c\u5728\u8fd0\u884c\u5b9e\u65f6\u670d\u52a1\u5668\u811a\u672c\u65f6\u6536\u5230\u5173\u4e8e\u4e0d\u652f\u6301\u8be5\u8bed\u8a00\u7684\u9519\u8bef\uff0c\u7c7b\u4f3c\u4e8e\uff1a</p> <pre><code> raise TemplateNotFound(template)\njinja2.exceptions.TemplateNotFound: partials/language/xx.html\n</code></pre> <p>\u8fd9\u610f\u5473\u7740\u6587\u6863\u7684\u4e3b\u9898\u4e0d\u652f\u6301\u8be5\u8bed\u8a00\uff08\u5728\u8fd9\u79cd\u4f8b\u5b50\u4e2d\uff0c\u7f16\u9020\u7684\u8bed\u8a00\u4ee3\u7801\u662f <code>xx</code>\uff09\u3002</p> <p>\u4f46\u662f\u522b\u62c5\u5fc3\uff0c\u4f60\u53ef\u4ee5\u5c06\u4e3b\u9898\u8bed\u8a00\u8bbe\u7f6e\u4e3a\u82f1\u8bed\uff0c\u7136\u540e\u7ffb\u8bd1\u6587\u6863\u7684\u5185\u5bb9\u3002</p> <p>\u5982\u679c\u4f60\u9700\u8981\u8fd9\u4e48\u505a\uff0c\u7f16\u8f91\u65b0\u8bed\u8a00\u76ee\u5f55\u4e0b\u7684 <code>mkdocs.yml</code>\uff0c\u5b83\u5c06\u6709\u7c7b\u4f3c\u4e0b\u9762\u7684\u5185\u5bb9\uff1a</p> <pre><code>site_name: FastAPI\n# More stuff\ntheme:\n# More stuff\nlanguage: xx\n</code></pre> <p>\u5c06\u5176\u4e2d\u7684 language \u9879\u4ece <code>xx</code>\uff08\u4f60\u7684\u8bed\u8a00\u4ee3\u7801\uff09\u66f4\u6539\u4e3a <code>en</code>\u3002</p> <p>\u7136\u540e\uff0c\u4f60\u5c31\u53ef\u4ee5\u518d\u6b21\u542f\u52a8\u5b9e\u65f6\u670d\u52a1\u5668\u4e86\u3002</p>"},{"location":"contributing/#_13","title":"\u9884\u89c8\u7ed3\u679c","text":"<p>\u5f53\u4f60\u901a\u8fc7 <code>live</code> \u547d\u4ee4\u4f7f\u7528 <code>./scripts/docs.py</code> \u4e2d\u7684\u811a\u672c\u65f6\uff0c\u8be5\u811a\u672c\u4ec5\u5c55\u793a\u5f53\u524d\u8bed\u8a00\u5df2\u6709\u7684\u6587\u4ef6\u548c\u7ffb\u8bd1\u3002</p> <p>\u4f46\u662f\u5f53\u4f60\u5b8c\u6210\u7ffb\u8bd1\u540e\uff0c\u4f60\u53ef\u4ee5\u50cf\u5728\u7ebf\u4e0a\u5c55\u793a\u4e00\u6837\u6d4b\u8bd5\u6240\u6709\u5185\u5bb9\u3002</p> <p>\u4e3a\u6b64\uff0c\u9996\u5148\u6784\u5efa\u6240\u6709\u6587\u6863\uff1a</p> <pre><code>// Use the command \"build-all\", this will take a bit\n$ python ./scripts/docs.py build-all\n\nUpdating es\nUpdating en\nBuilding docs for: en\nBuilding docs for: es\nSuccessfully built docs for: es\nCopying en index.md to README.md\n</code></pre> <p>\u8fd9\u5c06\u5728 <code>./docs_build/</code> \u76ee\u5f55\u4e2d\u4e3a\u6bcf\u4e00\u79cd\u8bed\u8a00\u751f\u6210\u5168\u90e8\u7684\u6587\u6863\u3002\u8fd8\u5305\u62ec\u6dfb\u52a0\u6240\u6709\u7f3a\u5c11\u7ffb\u8bd1\u7684\u6587\u4ef6\uff0c\u5e76\u5e26\u6709\u4e00\u6761\"\u6b64\u6587\u4ef6\u8fd8\u6ca1\u6709\u7ffb\u8bd1\"\u7684\u63d0\u9192\u3002\u4f46\u662f\u4f60\u4e0d\u9700\u8981\u5bf9\u8be5\u76ee\u5f55\u6267\u884c\u4efb\u4f55\u64cd\u4f5c\u3002</p> <p>\u7136\u540e\uff0c\u5b83\u9488\u5bf9\u6bcf\u79cd\u8bed\u8a00\u6784\u5efa\u72ec\u7acb\u7684 MkDocs \u7ad9\u70b9\uff0c\u5c06\u5b83\u4eec\u7ec4\u5408\u5728\u4e00\u8d77\uff0c\u5e76\u5728 <code>./site/</code> \u76ee\u5f55\u4e2d\u751f\u6210\u6700\u7ec8\u7684\u8f93\u51fa\u3002</p> <p>\u7136\u540e\u4f60\u53ef\u4ee5\u4f7f\u7528\u547d\u4ee4 <code>serve</code> \u6765\u8fd0\u884c\u751f\u6210\u7684\u7ad9\u70b9\uff1a</p> <pre><code>// Use the command \"serve\" after running \"build-all\"\n$ python ./scripts/docs.py serve\n\nWarning: this is a very simple server. For development, use mkdocs serve instead.\nThis is here only to preview a site with translations already built.\nMake sure you run the build-all command first.\nServing at: http://127.0.0.1:8008\n</code></pre>"},{"location":"contributing/#_14","title":"\u6d4b\u8bd5","text":"<p>\u4f60\u53ef\u4ee5\u5728\u672c\u5730\u8fd0\u884c\u4e0b\u9762\u7684\u811a\u672c\u6765\u6d4b\u8bd5\u6240\u6709\u4ee3\u7801\u5e76\u751f\u6210 HTML \u683c\u5f0f\u7684\u8986\u76d6\u7387\u62a5\u544a\uff1a</p> <pre><code>$ bash scripts/test-cov-html.sh\n</code></pre> <p>\u8be5\u547d\u4ee4\u751f\u6210\u4e86\u4e00\u4e2a <code>./htmlcov/</code> \u76ee\u5f55\uff0c\u5982\u679c\u4f60\u5728\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00 <code>./htmlcov/index.html</code> \u6587\u4ef6\uff0c\u4f60\u53ef\u4ee5\u4ea4\u4e92\u5f0f\u5730\u6d4f\u89c8\u88ab\u6d4b\u8bd5\u6240\u8986\u76d6\u7684\u4ee3\u7801\u533a\u5757\uff0c\u5e76\u6ce8\u610f\u662f\u5426\u7f3a\u5c11\u4e86\u4efb\u4f55\u533a\u5757\u3002</p>"},{"location":"fastapi-people/","title":"FastAPI \u793e\u533a","text":"<p>FastAPI \u6709\u4e00\u4e2a\u975e\u5e38\u68d2\u7684\u793e\u533a\uff0c\u5b83\u6b22\u8fce\u6765\u81ea\u5404\u4e2a\u9886\u57df\u548c\u80cc\u666f\u7684\u670b\u53cb\u3002</p>"},{"location":"fastapi-people/#_1","title":"\u521b\u5efa\u8005 &amp; \u7ef4\u62a4\u8005","text":"<p>\u563f! \ud83d\udc4b</p> <p>\u8fd9\u5c31\u662f\u6211:</p> <p>\u6211\u662f FastAPI \u7684\u521b\u5efa\u8005\u548c\u7ef4\u62a4\u8005. \u4f60\u80fd\u5728 \u5e2e\u52a9 FastAPI - \u83b7\u53d6\u5e2e\u52a9 - \u4e0e\u4f5c\u8005\u8054\u7cfb \u9605\u8bfb\u6709\u5173\u6b64\u5185\u5bb9\u7684\u66f4\u591a\u4fe1\u606f\u3002</p> <p>...\u4f46\u662f\u5728\u8fd9\u91cc\u6211\u60f3\u5411\u60a8\u5c55\u793a\u793e\u533a\u3002</p> <p>FastAPI \u5f97\u5230\u4e86\u793e\u533a\u7684\u5927\u529b\u652f\u6301\u3002\u56e0\u6b64\u6211\u60f3\u7a81\u51fa\u4ed6\u4eec\u7684\u8d21\u732e\u3002</p> <p>\u8fd9\u4e9b\u4eba\uff1a</p> <ul> <li>\u5e2e\u52a9\u4ed6\u4eba\u89e3\u51b3 GitHub \u7684 issues\u3002</li> <li>\u521b\u5efa Pull Requests\u3002</li> <li>\u5ba1\u6838 Pull Requests\uff0c \u5bf9\u4e8e \u7ffb\u8bd1 \u5c24\u4e3a\u91cd\u8981\u3002</li> </ul> <p>\u5411\u4ed6\u4eec\u81f4\u4ee5\u638c\u58f0\u3002 \ud83d\udc4f \ud83d\ude47</p>"},{"location":"fastapi-people/#_2","title":"\u4e0a\u4e2a\u6708\u6700\u6d3b\u8dc3\u7684\u7528\u6237","text":"<p>\u4e0a\u4e2a\u6708\u8fd9\u4e9b\u7528\u6237\u81f4\u529b\u4e8e \u5e2e\u52a9\u4ed6\u4eba\u89e3\u51b3 GitHub \u7684 issues\u3002</p>"},{"location":"fastapi-people/#_3","title":"\u4e13\u5bb6\u7ec4","text":"<p>\u4ee5\u4e0b\u662f FastAPI \u4e13\u5bb6\u3002 \ud83e\udd13</p> <p>\u8fd9\u4e9b\u7528\u6237\u4e00\u76f4\u4ee5\u6765\u81f4\u529b\u4e8e \u5e2e\u52a9\u4ed6\u4eba\u89e3\u51b3 GitHub \u7684 issues\u3002</p> <p>\u4ed6\u4eec\u901a\u8fc7\u5e2e\u52a9\u8bb8\u591a\u4eba\u800c\u88ab\u8bc1\u660e\u662f\u4e13\u5bb6\u3002\u2728</p>"},{"location":"fastapi-people/#_4","title":"\u6770\u51fa\u8d21\u732e\u8005","text":"<p>\u4ee5\u4e0b\u662f \u6770\u51fa\u7684\u8d21\u732e\u8005\u3002 \ud83d\udc77</p> <p>\u8fd9\u4e9b\u7528\u6237 \u521b\u5efa\u4e86\u6700\u591a\u5df2\u88ab\u5408\u5e76\u7684 Pull Requests\u3002</p> <p>\u4ed6\u4eec\u8d21\u732e\u4e86\u6e90\u4ee3\u7801\uff0c\u6587\u6863\uff0c\u7ffb\u8bd1\u7b49\u3002 \ud83d\udce6</p> <p>\u8fd8\u6709\u5f88\u591a\u5176\u4ed6\u8d21\u732e\u8005\uff08\u8d85\u8fc7100\u4e2a\uff09\uff0c\u4f60\u53ef\u4ee5\u5728 FastAPI GitHub \u8d21\u732e\u8005\u9875\u9762 \u4e2d\u770b\u5230\u4ed6\u4eec\u3002\ud83d\udc77</p>"},{"location":"fastapi-people/#_5","title":"\u6770\u51fa\u5ba1\u6838\u8005","text":"<p>\u4ee5\u4e0b\u7528\u6237\u662f\u300c\u6770\u51fa\u7684\u8bc4\u5ba1\u8005\u300d\u3002 \ud83d\udd75\ufe0f</p>"},{"location":"fastapi-people/#_6","title":"\u7ffb\u8bd1\u5ba1\u6838","text":"<p>\u6211\u53ea\u4f1a\u8bf4\u5c11\u6570\u51e0\u79cd\u8bed\u8a00\uff08\u800c\u4e14\u8fd8\u4e0d\u662f\u5f88\u6d41\u5229 \ud83d\ude05\uff09\u3002\u6240\u4ee5\uff0c\u5177\u5907\u80fd\u529b\u53bb\u6279\u51c6\u6587\u6863\u7ffb\u8bd1 \u662f\u8fd9\u4e9b\u8bc4\u5ba1\u8005\u4eec\u3002\u5982\u679c\u6ca1\u6709\u5b83\u4eec\uff0c\u5c31\u4e0d\u4f1a\u6709\u591a\u8bed\u8a00\u6587\u6863\u3002</p> <p>\u6770\u51fa\u7684\u8bc4\u5ba1\u8005 \ud83d\udd75\ufe0f \u8bc4\u5ba1\u4e86\u6700\u591a\u6765\u81ea\u4ed6\u4eba\u7684 Pull Requests\uff0c\u4ed6\u4eec\u4fdd\u8bc1\u4e86\u4ee3\u7801\u3001\u6587\u6863\u5c24\u5176\u662f \u7ffb\u8bd1 \u7684\u8d28\u91cf\u3002</p>"},{"location":"fastapi-people/#_7","title":"\u8d5e\u52a9\u5546","text":"<p>\u4ee5\u4e0b\u662f \u8d5e\u52a9\u5546 \u3002\ud83d\ude0e</p> <p>\u4ed6\u4eec\u4e3b\u8981\u901a\u8fc7GitHub Sponsors\u652f\u6301\u6211\u5728 FastAPI (\u548c\u5176\u4ed6\u9879\u76ee)\u7684\u5de5\u4f5c\u3002</p>"},{"location":"fastapi-people/#_8","title":"\u4e2a\u4eba\u8d5e\u52a9","text":""},{"location":"fastapi-people/#-","title":"\u5173\u4e8e\u6570\u636e - \u6280\u672f\u7ec6\u8282","text":"<p>\u8be5\u9875\u9762\u7684\u76ee\u7684\u662f\u7a81\u51fa\u793e\u533a\u4e3a\u5e2e\u52a9\u4ed6\u4eba\u800c\u4ed8\u51fa\u7684\u52aa\u529b\u3002</p> <p>\u5c24\u5176\u662f\u90a3\u4e9b\u4e0d\u5f15\u4eba\u6ce8\u76ee\u4e14\u6d89\u53ca\u66f4\u56f0\u96be\u7684\u4efb\u52a1\uff0c\u4f8b\u5982\u5e2e\u52a9\u4ed6\u4eba\u89e3\u51b3\u95ee\u9898\u6216\u8005\u8bc4\u5ba1\u7ffb\u8bd1 Pull Requests\u3002</p> <p>\u8be5\u6570\u636e\u6bcf\u6708\u8ba1\u7b97\u4e00\u6b21\uff0c\u60a8\u53ef\u4ee5\u9605\u8bfb \u6e90\u4ee3\u7801\u3002</p> <p>\u8fd9\u91cc\u4e5f\u5f3a\u8c03\u4e86\u8d5e\u52a9\u5546\u7684\u8d21\u732e\u3002</p> <p>\u6211\u4e5f\u4fdd\u7559\u66f4\u65b0\u7b97\u6cd5\uff0c\u680f\u76ee\uff0c\u7edf\u8ba1\u9608\u503c\u7b49\u7684\u6743\u5229\uff08\u4ee5\u9632\u4e07\u4e00\ud83e\udd37\uff09\u3002</p>"},{"location":"features/","title":"\u7279\u6027","text":""},{"location":"features/#fastapi","title":"FastAPI \u7279\u6027","text":"<p>FastAPI \u63d0\u4f9b\u4e86\u4ee5\u4e0b\u5185\u5bb9\uff1a</p>"},{"location":"features/#_2","title":"\u57fa\u4e8e\u5f00\u653e\u6807\u51c6","text":"<ul> <li>\u7528\u4e8e\u521b\u5efa API \u7684 OpenAPI \u5305\u542b\u4e86\u8def\u5f84\u64cd\u4f5c\uff0c\u8bf7\u6c42\u53c2\u6570\uff0c\u8bf7\u6c42\u4f53\uff0c\u5b89\u5168\u6027\u7b49\u7684\u58f0\u660e\u3002</li> <li>\u4f7f\u7528 JSON Schema (\u56e0\u4e3a OpenAPI \u672c\u8eab\u5c31\u662f\u57fa\u4e8e JSON Schema \u7684)\u81ea\u52a8\u751f\u6210\u6570\u636e\u6a21\u578b\u6587\u6863\u3002</li> <li>\u7ecf\u8fc7\u4e86\u7f1c\u5bc6\u7684\u7814\u7a76\u540e\u56f4\u7ed5\u8fd9\u4e9b\u6807\u51c6\u800c\u8bbe\u8ba1\u3002\u5e76\u975e\u72d7\u5c3e\u7eed\u8c82\u3002</li> <li>\u8fd9\u4e5f\u5141\u8bb8\u4e86\u5728\u5f88\u591a\u8bed\u8a00\u4e2d\u81ea\u52a8\u751f\u6210\u5ba2\u6237\u7aef\u4ee3\u7801\u3002</li> </ul>"},{"location":"features/#_3","title":"\u81ea\u52a8\u751f\u6210\u6587\u6863","text":"<p>\u4ea4\u4e92\u5f0f API \u6587\u6863\u4ee5\u53ca\u5177\u63a2\u7d22\u6027 web \u754c\u9762\u3002\u56e0\u4e3a\u8be5\u6846\u67b6\u662f\u57fa\u4e8e OpenAPI\uff0c\u6240\u4ee5\u6709\u5f88\u591a\u53ef\u9009\u9879\uff0cFastAPI \u9ed8\u8ba4\u81ea\u5e26\u4e24\u4e2a\u4ea4\u4e92\u5f0f API \u6587\u6863\u3002</p> <ul> <li>Swagger UI\uff0c\u53ef\u4ea4\u4e92\u5f0f\u64cd\u4f5c\uff0c\u80fd\u5728\u6d4f\u89c8\u5668\u4e2d\u76f4\u63a5\u8c03\u7528\u548c\u6d4b\u8bd5\u4f60\u7684 API  \u3002</li> </ul> <p></p> <ul> <li>\u53e6\u5916\u7684 API \u6587\u6863\uff1aReDoc</li> </ul> <p></p>"},{"location":"features/#python","title":"\u66f4\u4e3b\u6d41\u7684 Python","text":"<p>\u5168\u90e8\u90fd\u57fa\u4e8e\u6807\u51c6\u7684 Python 3.6 \u7c7b\u578b\u58f0\u660e\uff08\u611f\u8c22 Pydantic \uff09\u3002\u6ca1\u6709\u65b0\u7684\u8bed\u6cd5\u9700\u8981\u5b66\u4e60\u3002\u53ea\u9700\u8981\u6807\u51c6\u7684 Python \u3002</p> <p>\u5982\u679c\u4f60\u9700\u89812\u5206\u949f\u6765\u5b66\u4e60\u5982\u4f55\u4f7f\u7528 Python \u7c7b\u578b\uff08\u5373\u4f7f\u4f60\u4e0d\u4f7f\u7528 FastAPI \uff09\uff0c\u770b\u770b\u8fd9\u4e2a\u7b80\u77ed\u7684\u6559\u7a0b\uff1aPython Types\u3002</p> <p>\u7f16\u5199\u5e26\u6709\u7c7b\u578b\u6807\u6ce8\u7684\u6807\u51c6 Python\uff1a</p> <pre><code>from datetime import date\n\nfrom pydantic import BaseModel\n\n# Declare a variable as a str\n# and get editor support inside the function\ndef main(user_id: str):\n    return user_id\n\n\n# A Pydantic model\nclass User(BaseModel):\n    id: int\n    name: str\n    joined: date\n</code></pre> <p>\u53ef\u4ee5\u50cf\u8fd9\u6837\u6765\u4f7f\u7528\uff1a</p> <pre><code>my_user: User = User(id=3, name=\"John Doe\", joined=\"2018-07-19\")\n\nsecond_user_data = {\n    \"id\": 4,\n    \"name\": \"Mary\",\n    \"joined\": \"2018-11-30\",\n}\n\nmy_second_user: User = User(**second_user_data)\n</code></pre> <p>Info</p> <p><code>**second_user_data</code> \u610f\u601d\u662f:</p> <p>\u76f4\u63a5\u5c06<code>second_user_data</code>\u5b57\u5178\u7684\u952e\u548c\u503c\u76f4\u63a5\u4f5c\u4e3akey-value\u53c2\u6570\u4f20\u9012\uff0c\u7b49\u540c\u4e8e\uff1a<code>User(id=4, name=\"Mary\", joined=\"2018-11-30\")</code></p>"},{"location":"features/#_4","title":"\u7f16\u8f91\u5668\u652f\u6301","text":"<p>\u6574\u4e2a\u6846\u67b6\u90fd\u88ab\u8bbe\u8ba1\u5f97\u6613\u4e8e\u4f7f\u7528\u4e14\u76f4\u89c2\uff0c\u6240\u6709\u7684\u51b3\u5b9a\u90fd\u5728\u5f00\u53d1\u4e4b\u524d\u5c31\u5728\u591a\u4e2a\u7f16\u8f91\u5668\u4e0a\u8fdb\u884c\u4e86\u6d4b\u8bd5\uff0c\u6765\u786e\u4fdd\u6700\u4f73\u7684\u5f00\u53d1\u4f53\u9a8c\u3002</p> <p>\u5728\u6700\u8fd1\u7684 Python \u5f00\u53d1\u8005\u8c03\u67e5\u4e2d\uff0c\u6211\u4eec\u80fd\u770b\u5230  \u88ab\u4f7f\u7528\u6700\u591a\u7684\u529f\u80fd\u662f\"\u81ea\u52a8\u8865\u5168\"\u3002</p> <p>\u6574\u4e2a FastAPI \u6846\u67b6\u5c31\u662f\u57fa\u4e8e\u8fd9\u4e00\u70b9\u7684\u3002\u4efb\u4f55\u5730\u65b9\u90fd\u53ef\u4ee5\u8fdb\u884c\u81ea\u52a8\u8865\u5168\u3002</p> <p>\u4f60\u51e0\u4e4e\u4e0d\u9700\u8981\u7ecf\u5e38\u56de\u6765\u770b\u6587\u6863\u3002</p> <p>\u5728\u8fd9\u91cc\uff0c\u4f60\u7684\u7f16\u8f91\u5668\u53ef\u80fd\u4f1a\u8fd9\u6837\u5e2e\u52a9\u4f60\uff1a</p> <ul> <li>Visual Studio Code \u4e2d:</li> </ul> <p></p> <ul> <li>PyCharm \u4e2d:</li> </ul> <p></p> <p>\u4f60\u5c06\u80fd\u8fdb\u884c\u4ee3\u7801\u8865\u5168\uff0c\u8fd9\u662f\u5728\u4e4b\u524d\u4f60\u53ef\u80fd\u66fe\u8ba4\u4e3a\u4e0d\u53ef\u80fd\u7684\u4e8b\u3002\u4f8b\u5982\uff0c\u5728\u6765\u81ea\u8bf7\u6c42 JSON \u4f53\uff08\u53ef\u80fd\u662f\u5d4c\u5957\u7684\uff09\u4e2d\u7684\u952e <code>price</code>\u3002</p> <p>\u4e0d\u4f1a\u518d\u8f93\u9519\u952e\u540d\uff0c\u6765\u56de\u7ffb\u770b\u6587\u6863\uff0c\u6216\u8005\u6765\u56de\u6eda\u52a8\u5bfb\u627e\u4f60\u6700\u540e\u4f7f\u7528\u7684 <code>username</code> \u6216\u8005 <code>user_name</code> \u3002</p>"},{"location":"features/#_5","title":"\u7b80\u6d01","text":"<p>\u4efb\u4f55\u7c7b\u578b\u90fd\u6709\u5408\u7406\u7684\u9ed8\u8ba4\u503c\uff0c\u4efb\u4f55\u548c\u5730\u65b9\u90fd\u6709\u53ef\u9009\u914d\u7f6e\u3002\u6240\u6709\u7684\u53c2\u6570\u88ab\u5fae\u8c03\uff0c\u6765\u6ee1\u8db3\u4f60\u7684\u9700\u6c42\uff0c\u5b9a\u4e49\u6210\u4f60\u9700\u8981\u7684 API\u3002</p> <p>\u4f46\u662f\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4e00\u5207\u90fd\u80fd\u201c\u987a\u5229\u5de5\u4f5c\u201d\u3002</p>"},{"location":"features/#_6","title":"\u9a8c\u8bc1","text":"<ul> <li> <p>\u6821\u9a8c\u5927\u90e8\u5206\uff08\u751a\u81f3\u6240\u6709\uff1f\uff09\u7684 Python \u6570\u636e\u7c7b\u578b\uff0c\u5305\u62ec\uff1a</p> <ul> <li>JSON \u5bf9\u8c61 (<code>dict</code>).</li> <li>JSON \u6570\u7ec4 (<code>list</code>) \u5b9a\u4e49\u6210\u5458\u7c7b\u578b\u3002</li> <li>\u5b57\u7b26\u4e32 (<code>str</code>) \u5b57\u6bb5, \u5b9a\u4e49\u6700\u5c0f\u6216\u6700\u5927\u957f\u5ea6\u3002</li> <li>\u6570\u5b57 (<code>int</code>, <code>float</code>) \u6709\u6700\u5927\u503c\u548c\u6700\u5c0f\u503c\uff0c \u7b49\u7b49\u3002</li> </ul> </li> <li> <p>\u6821\u9a8c\u5916\u6765\u7c7b\u578b\uff0c \u6bd4\u5982:</p> <ul> <li>URL.</li> <li>Email.</li> <li>UUID.</li> <li>...\u53ca\u5176\u4ed6.</li> </ul> </li> </ul> <p>\u6240\u6709\u7684\u6821\u9a8c\u90fd\u7531\u5b8c\u5584\u4e14\u5f3a\u5927\u7684 Pydantic \u5904\u7406\u3002</p>"},{"location":"features/#_7","title":"\u5b89\u5168\u6027\u53ca\u8eab\u4efd\u9a8c\u8bc1","text":"<p>\u96c6\u6210\u4e86\u5b89\u5168\u6027\u548c\u8eab\u4efd\u8ba4\u8bc1\u3002\u675c\u7edd\u6570\u636e\u5e93\u6216\u8005\u6570\u636e\u6a21\u578b\u7684\u6e17\u900f\u98ce\u9669\u3002</p> <p>OpenAPI \u4e2d\u5b9a\u4e49\u7684\u5b89\u5168\u6a21\u5f0f\uff0c\u5305\u62ec\uff1a</p> <ul> <li>HTTP \u57fa\u672c\u8ba4\u8bc1\u3002</li> <li>OAuth2 (\u4e5f\u4f7f\u7528 JWT tokens)\u3002\u5728 OAuth2 with JWT\u67e5\u770b\u6559\u7a0b\u3002</li> <li>API \u5bc6\u94a5\uff0c\u5728:<ul> <li>\u8bf7\u6c42\u5934\u3002</li> <li>\u67e5\u8be2\u53c2\u6570\u3002</li> <li>Cookies, \u7b49\u7b49\u3002</li> </ul> </li> </ul> <p>\u52a0\u4e0a\u6765\u81ea Starlette\uff08\u5305\u62ec session cookie\uff09\u7684\u6240\u6709\u5b89\u5168\u7279\u6027\u3002</p> <p>\u6240\u6709\u7684\u8fd9\u4e9b\u90fd\u662f\u53ef\u590d\u7528\u7684\u5de5\u5177\u548c\u7ec4\u4ef6\uff0c\u53ef\u4ee5\u8f7b\u677e\u4e0e\u4f60\u7684\u7cfb\u7edf\uff0c\u6570\u636e\u4ed3\u5e93\uff0c\u5173\u7cfb\u578b\u4ee5\u53ca NoSQL \u6570\u636e\u5e93\u7b49\u7b49\u96c6\u6210\u3002</p>"},{"location":"features/#_8","title":"\u4f9d\u8d56\u6ce8\u5165","text":"<p>FastAPI \u6709\u4e00\u4e2a\u4f7f\u7528\u975e\u5e38\u7b80\u5355\uff0c\u4f46\u662f\u975e\u5e38\u5f3a\u5927\u7684\u4f9d\u8d56\u6ce8\u5165\u7cfb\u7edf\u3002</p> <ul> <li>\u751a\u81f3\u4f9d\u8d56\u4e5f\u53ef\u4ee5\u6709\u4f9d\u8d56\uff0c\u521b\u5efa\u4e00\u4e2a\u5c42\u7ea7\u6216\u8005\u201c\u56fe\u201d\u4f9d\u8d56\u3002</li> <li>\u6240\u6709\u81ea\u52a8\u5316\u5904\u7406\u90fd\u7531\u6846\u67b6\u5b8c\u6210\u3002</li> <li>\u6240\u6709\u7684\u4f9d\u8d56\u5173\u7cfb\u90fd\u53ef\u4ee5\u4ece\u8bf7\u6c42\u4e2d\u83b7\u53d6\u6570\u636e\uff0c\u5e76\u4e14\u589e\u52a0\u4e86\u8def\u5f84\u64cd\u4f5c\u7ea6\u675f\u548c\u81ea\u52a8\u6587\u6863\u751f\u6210\u3002</li> <li>\u5373\u4f7f\u5728\u4f9d\u8d56\u9879\u4e2d\u88ab\u5b9a\u4e49\u7684\u8def\u5f84\u64cd\u4f5c \u4e5f\u4f1a\u81ea\u52a8\u9a8c\u8bc1\u3002</li> <li>\u652f\u6301\u590d\u6742\u7684\u7528\u6237\u8eab\u4efd\u8ba4\u8bc1\u7cfb\u7edf\uff0c\u6570\u636e\u5e93\u8fde\u63a5\u7b49\u7b49\u3002</li> <li>\u4e0d\u4f9d\u8d56\u6570\u636e\u5e93\uff0c\u524d\u7aef\u7b49\u3002 \u4f46\u662f\u548c\u5b83\u4eec\u96c6\u6210\u5f88\u7b80\u5355\u3002</li> </ul>"},{"location":"features/#_9","title":"\u65e0\u9650\u5236\"\u63d2\u4ef6\"","text":"<p>\u6216\u8005\u8bf4\uff0c\u5bfc\u5165\u5e76\u4f7f\u7528\u4f60\u9700\u8981\u7684\u4ee3\u7801\uff0c\u800c\u4e0d\u9700\u8981\u5b83\u4eec\u3002</p> <p>\u4efb\u4f55\u96c6\u6210\u90fd\u88ab\u8bbe\u8ba1\u5f97\u88ab\u6613\u4e8e\u4f7f\u7528\uff08\u7528\u4f9d\u8d56\u5173\u7cfb\uff09\uff0c\u4f60\u53ef\u4ee5\u7528\u548c\u8def\u5f84\u64cd\u4f5c\u76f8\u540c\u7684\u7ed3\u6784\u548c\u8bed\u6cd5\uff0c\u5728\u4e24\u884c\u4ee3\u7801\u4e2d\u4e3a\u4f60\u7684\u5e94\u7528\u521b\u5efa\u4e00\u4e2a\u201c\u63d2\u4ef6\u201d\u3002</p>"},{"location":"features/#_10","title":"\u6d4b\u8bd5","text":"<ul> <li>100% \u6d4b\u8bd5\u8986\u76d6\u3002</li> <li>\u4ee3\u7801\u5e93100% \u7c7b\u578b\u6ce8\u91ca\u3002</li> <li>\u7528\u4e8e\u751f\u4ea7\u5e94\u7528\u3002</li> </ul>"},{"location":"features/#starlette","title":"Starlette \u7279\u6027","text":"<p>FastAPI \u548c Starlette \u5b8c\u5168\u517c\u5bb9(\u5e76\u57fa\u4e8e)\u3002\u6240\u4ee5\uff0c\u4f60\u6709\u7684\u5176\u4ed6\u7684 Starlette \u4ee3\u7801\u4e5f\u80fd\u6b63\u5e38\u5de5\u4f5c\u3002<code>FastAPI</code> \u5b9e\u9645\u4e0a\u662f <code>Starlette</code>\u7684\u4e00\u4e2a\u5b50\u7c7b\u3002\u6240\u4ee5\uff0c\u5982\u679c\u4f60\u5df2\u7ecf\u77e5\u9053\u6216\u8005\u4f7f\u7528 Starlette\uff0c\u5927\u90e8\u5206\u7684\u529f\u80fd\u4f1a\u4ee5\u76f8\u540c\u7684\u65b9\u5f0f\u5de5\u4f5c\u3002</p> <p>\u901a\u8fc7 FastAPI \u4f60\u53ef\u4ee5\u83b7\u5f97\u6240\u6709 Starlette \u7684\u7279\u6027 ( FastAPI \u5c31\u50cf\u52a0\u5f3a\u7248\u7684 Starlette )\uff1a</p> <ul> <li>\u4ee4\u4eba\u60ca\u53f9\u7684\u6027\u80fd\u3002\u5b83\u662f Python \u53ef\u7528\u7684\u6700\u5feb\u7684\u6846\u67b6\u4e4b\u4e00\uff0c\u548c\u00a0NodeJS \u53ca\u00a0Go \u76f8\u5f53\u3002</li> <li>\u652f\u6301 WebSocket \u3002</li> <li>\u652f\u6301 GraphQL \u3002</li> <li>\u540e\u53f0\u4efb\u52a1\u5904\u7406\u3002</li> <li>Startup \u548c shutdown \u4e8b\u4ef6\u3002</li> <li>\u6d4b\u8bd5\u5ba2\u6237\u7aef\u57fa\u4e8e HTTPX\u3002</li> <li>CORS, GZip, \u9759\u6001\u6587\u4ef6, \u6d41\u54cd\u5e94\u3002</li> <li>\u652f\u6301 Session \u548c Cookie \u3002</li> <li>100% \u6d4b\u8bd5\u8986\u76d6\u7387\u3002</li> <li>\u4ee3\u7801\u5e93 100% \u7c7b\u578b\u6ce8\u91ca\u3002</li> </ul>"},{"location":"features/#pydantic","title":"Pydantic \u7279\u6027","text":"<p>FastAPI \u548c Pydantic \u5b8c\u5168\u517c\u5bb9(\u5e76\u57fa\u4e8e)\u3002\u6240\u4ee5\uff0c\u4f60\u6709\u7684\u5176\u4ed6\u7684 Pydantic \u4ee3\u7801\u4e5f\u80fd\u6b63\u5e38\u5de5\u4f5c\u3002</p> <p>\u517c\u5bb9\u5305\u62ec\u57fa\u4e8e Pydantic \u7684\u5916\u90e8\u5e93\uff0c \u4f8b\u5982\u7528\u4e0e\u6570\u636e\u5e93\u7684 ORMs, ODMs\u3002</p> <p>\u8fd9\u4e5f\u610f\u5473\u7740\u5728\u5f88\u591a\u60c5\u51b5\u4e0b\uff0c\u4f60\u53ef\u4ee5\u5c06\u4ece\u8bf7\u6c42\u4e2d\u83b7\u5f97\u7684\u76f8\u540c\u5bf9\u8c61\u76f4\u63a5\u4f20\u5230\u6570\u636e\u5e93\uff0c\u56e0\u4e3a\u6240\u6709\u7684\u9a8c\u8bc1\u90fd\u662f\u81ea\u52a8\u7684\u3002</p> <p>\u53cd\u4e4b\u4ea6\u7136\uff0c\u5728\u5f88\u591a\u60c5\u51b5\u4e0b\uff0c\u4f60\u4e5f\u53ef\u4ee5\u5c06\u4ece\u6570\u636e\u5e93\u4e2d\u83b7\u53d6\u7684\u5bf9\u8c61\u76f4\u63a5\u4f20\u5230\u5ba2\u6237\u7aef\u3002</p> <p>\u901a\u8fc7 FastAPI \u4f60\u53ef\u4ee5\u83b7\u5f97\u6240\u6709 Pydantic  (FastAPI \u57fa\u4e8e Pydantic \u505a\u4e86\u6240\u6709\u7684\u6570\u636e\u5904\u7406)\uff1a</p> <ul> <li>\u66f4\u7b80\u5355\uff1a<ul> <li>\u6ca1\u6709\u65b0\u7684\u6a21\u5f0f\u5b9a\u4e49 micro-language \u9700\u8981\u5b66\u4e60\u3002</li> <li>\u5982\u679c\u4f60\u77e5\u9053 Python types\uff0c\u4f60\u5c31\u77e5\u9053\u5982\u4f55\u4f7f\u7528 Pydantic\u3002</li> </ul> </li> <li>\u548c\u4f60 IDE/linter/brain \u9002\u914d:<ul> <li>\u56e0\u4e3a pydantic \u6570\u636e\u7ed3\u6784\u4ec5\u4ec5\u662f\u4f60\u5b9a\u4e49\u7684\u7c7b\u7684\u5b9e\u4f8b\uff1b\u81ea\u52a8\u8865\u5168\uff0clinting\uff0cmypy \u4ee5\u53ca\u4f60\u7684\u76f4\u89c9\u5e94\u8be5\u53ef\u4ee5\u548c\u4f60\u9a8c\u8bc1\u7684\u6570\u636e\u4e00\u8d77\u6b63\u5e38\u5de5\u4f5c\u3002</li> </ul> </li> <li>\u66f4\u5feb\uff1a<ul> <li>\u5728 \u57fa\u51c6\u6d4b\u8bd5 \u4e2d\uff0cPydantic \u6bd4\u5176\u4ed6\u88ab\u6d4b\u8bd5\u7684\u5e93\u90fd\u8981\u5feb\u3002</li> </ul> </li> <li>\u9a8c\u8bc1\u590d\u6742\u7ed3\u6784:<ul> <li>\u4f7f\u7528\u5206\u5c42\u7684 Pydantic \u6a21\u578b, Python <code>typing</code>\u7684 <code>List</code> \u548c <code>Dict</code> \u7b49\u7b49\u3002</li> <li>\u9a8c\u8bc1\u5668\u4f7f\u6211\u4eec\u80fd\u591f\u7b80\u5355\u6e05\u695a\u7684\u5c06\u590d\u6742\u7684\u6570\u636e\u6a21\u5f0f\u5b9a\u4e49\u3001\u68c0\u67e5\u5e76\u8bb0\u5f55\u4e3a JSON Schema\u3002</li> <li>\u4f60\u53ef\u4ee5\u62e5\u6709\u6df1\u5ea6\u5d4c\u5957\u7684 JSON \u5bf9\u8c61\u5e76\u5bf9\u5b83\u4eec\u8fdb\u884c\u9a8c\u8bc1\u548c\u6ce8\u91ca\u3002</li> </ul> </li> <li>\u53ef\u6269\u5c55:<ul> <li>Pydantic \u5141\u8bb8\u5b9a\u4e49\u81ea\u5b9a\u4e49\u6570\u636e\u7c7b\u578b\u6216\u8005\u4f60\u53ef\u4ee5\u7528\u9a8c\u8bc1\u5668\u88c5\u9970\u5668\u5bf9\u88ab\u88c5\u9970\u7684\u6a21\u578b\u4e0a\u7684\u65b9\u6cd5\u6269\u5c55\u9a8c\u8bc1\u3002</li> </ul> </li> <li>100% \u6d4b\u8bd5\u8986\u76d6\u7387\u3002</li> </ul>"},{"location":"help-fastapi/","title":"\u5e2e\u52a9 FastAPI \u4e0e\u6c42\u52a9","text":"<p>\u60a8\u559c\u6b22 FastAPI \u5417\uff1f</p> <p>\u60f3\u5e2e\u52a9 FastAPI\uff1f\u5176\u5b83\u7528\u6237\uff1f\u8fd8\u6709\u9879\u76ee\u4f5c\u8005\uff1f</p> <p>\u6216\u8981\u6c42\u52a9\u600e\u4e48\u4f7f\u7528 FastAPI\uff1f</p> <p>\u4ee5\u4e0b\u51e0\u79cd\u5e2e\u52a9\u7684\u65b9\u5f0f\u90fd\u975e\u5e38\u7b80\u5355\uff08\u6709\u4e9b\u53ea\u9700\u8981\u70b9\u51fb\u4e00\u4e24\u4e0b\u9f20\u6807\uff09\u3002</p> <p>\u6c42\u52a9\u7684\u6e20\u9053\u4e5f\u5f88\u591a\u3002</p>"},{"location":"help-fastapi/#_1","title":"\u8ba2\u9605\u65b0\u95fb\u90ae\u4ef6","text":"<p>\u60a8\u53ef\u4ee5\u8ba2\u9605 FastAPI \u548c\u5b83\u7684\u5c0f\u4f19\u4f34 \u65b0\u95fb\u90ae\u4ef6\uff08\u4e0d\u4f1a\u7ecf\u5e38\u6536\u5230\uff09</p> <ul> <li>FastAPI \u53ca\u5176\u5c0f\u4f19\u4f34\u7684\u65b0\u95fb \ud83d\ude80</li> <li>\u6307\u5357 \ud83d\udcdd</li> <li>\u529f\u80fd \u2728</li> <li>\u7834\u574f\u6027\u66f4\u6539 \ud83d\udea8</li> <li>\u5f00\u53d1\u6280\u5de7 \u2705</li> </ul>"},{"location":"help-fastapi/#fastapi_1","title":"\u5728\u63a8\u7279\u4e0a\u5173\u6ce8 FastAPI","text":"<p>\u5728 Twitter\u00a0\u4e0a\u5173\u6ce8 @fastapi \u83b7\u53d6 FastAPI \u7684\u6700\u65b0\u6d88\u606f\u3002\ud83d\udc26</p>"},{"location":"help-fastapi/#github-fastapi","title":"\u5728 GitHub \u4e0a\u4e3a FastAPI \u52a0\u661f","text":"<p>\u60a8\u53ef\u4ee5\u5728 GitHub \u4e0a Star FastAPI\uff08\u53ea\u8981\u70b9\u51fb\u53f3\u4e0a\u89d2\u7684\u661f\u661f\u5c31\u53ef\u4ee5\u4e86\uff09\uff1a https://github.com/tiangolo/fastapi\u3002\u2b50\ufe0f</p> <p>Star \u4ee5\u540e\uff0c\u5176\u5b83\u7528\u6237\u5c31\u80fd\u66f4\u5bb9\u6613\u627e\u5230 FastAPI\uff0c\u5e76\u4e86\u89e3\u5230\u5df2\u7ecf\u6709\u5176\u4ed6\u7528\u6237\u5728\u4f7f\u7528\u5b83\u4e86\u3002</p>"},{"location":"help-fastapi/#github","title":"\u5173\u6ce8 GitHub \u8d44\u6e90\u5e93\u7684\u7248\u672c\u53d1\u5e03","text":"<p>\u60a8\u8fd8\u53ef\u4ee5\u5728 GitHub \u4e0a Watch FastAPI\uff0c\uff08\u70b9\u51fb\u53f3\u4e0a\u89d2\u7684 Watch \u6309\u94ae\uff09https://github.com/tiangolo/fastapi\u3002\ud83d\udc40</p> <p>\u60a8\u53ef\u4ee5\u9009\u62e9\u53ea\u5173\u6ce8\u53d1\u5e03\uff08Releases only\uff09\u3002</p> <p>\u8fd9\u6837\uff0c\u60a8\u5c31\u53ef\u4ee5\uff08\u5728\u7535\u5b50\u90ae\u4ef6\u91cc\uff09\u63a5\u6536\u5230 FastAPI \u65b0\u7248\u53d1\u5e03\u7684\u901a\u77e5\uff0c\u53ca\u65f6\u4e86\u89e3 bug \u4fee\u590d\u4e0e\u65b0\u529f\u80fd\u3002</p>"},{"location":"help-fastapi/#_2","title":"\u8054\u7cfb\u4f5c\u8005","text":"<p>\u60a8\u53ef\u4ee5\u8054\u7cfb\u9879\u76ee\u4f5c\u8005\uff0c\u5c31\u662f\u6211\uff08Sebasti\u00e1n Ram\u00edrez / <code>tiangolo</code>\uff09\u3002</p> <p>\u60a8\u53ef\u4ee5\uff1a</p> <ul> <li>\u5728\u00a0GitHub\u00a0\u4e0a\u5173\u6ce8\u6211<ul> <li>\u4e86\u89e3\u5176\u5b83\u6211\u521b\u5efa\u7684\u5f00\u6e90\u9879\u76ee\uff0c\u6216\u8bb8\u5bf9\u60a8\u4f1a\u6709\u5e2e\u52a9</li> <li>\u5173\u6ce8\u6211\u4ec0\u4e48\u65f6\u5019\u521b\u5efa\u65b0\u7684\u5f00\u6e90\u9879\u76ee</li> </ul> </li> <li>\u5728 Twitter\u00a0\u4e0a\u5173\u6ce8\u6211<ul> <li>\u544a\u8bc9\u6211\u60a8\u4f7f\u7528 FastAPI\uff08\u6211\u975e\u5e38\u4e50\u610f\u542c\u5230\u8fd9\u79cd\u6d88\u606f\uff09</li> <li>\u63a5\u6536\u6211\u53d1\u5e03\u516c\u544a\u6216\u65b0\u5de5\u5177\u7684\u6d88\u606f</li> <li>\u60a8\u8fd8\u53ef\u4ee5\u5173\u6ce8@fastapi on Twitter\uff0c\u8fd9\u662f\u4e2a\u72ec\u7acb\u7684\u8d26\u53f7</li> </ul> </li> <li>\u5728\u9886\u82f1\u4e0a\u8054\u7cfb\u6211<ul> <li>\u63a5\u6536\u6211\u53d1\u5e03\u516c\u544a\u6216\u65b0\u5de5\u5177\u7684\u6d88\u606f\uff08\u867d\u7136\u6211\u7528 Twitter \u6bd4\u8f83\u591a\uff09</li> </ul> </li> <li>\u9605\u8bfb\u6211\u5728 Dev.to \u6216 Medium \u4e0a\u7684\u6587\u7ae0\uff0c\u6216\u5173\u6ce8\u6211<ul> <li>\u9605\u8bfb\u6211\u7684\u5176\u5b83\u60f3\u6cd5\u3001\u6587\u7ae0\uff0c\u4e86\u89e3\u6211\u521b\u5efa\u7684\u5de5\u5177</li> <li>\u5173\u6ce8\u6211\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u968f\u65f6\u770b\u5230\u6211\u53d1\u5e03\u7684\u65b0\u6587\u7ae0</li> </ul> </li> </ul>"},{"location":"help-fastapi/#tweet-about-fastapi","title":"Tweet about FastAPI","text":"<p>Tweet about FastAPI \u8ba9\u6211\u548c\u5927\u5bb6\u77e5\u9053\u60a8\u4e3a\u4ec0\u4e48\u559c\u6b22 FastAPI\u3002\ud83c\udf89</p> <p>\u77e5\u9053\u6709\u4eba\u4f7f\u7528 FastAPI\uff0c\u6211\u4f1a\u5f88\u5f00\u5fc3\uff0c\u6211\u4e5f\u60f3\u77e5\u9053\u60a8\u4e3a\u4ec0\u4e48\u559c\u6b22 FastAPI\uff0c\u4ee5\u53ca\u60a8\u5728\u4ec0\u4e48\u9879\u76ee/\u54ea\u4e9b\u516c\u53f8\u4f7f\u7528 FastAPI\uff0c\u7b49\u7b49\u3002</p>"},{"location":"help-fastapi/#fastapi_2","title":"\u4e3a FastAPI \u6295\u7968","text":"<ul> <li>\u5728 Slant \u4e0a\u4e3a\u00a0FastAPI \u6295\u7968</li> <li>\u5728 AlternativeTo \u4e0a\u4e3a\u00a0FastAPI \u6295\u7968</li> </ul>"},{"location":"help-fastapi/#github_1","title":"\u5728 GitHub \u4e0a\u5e2e\u52a9\u5176\u4ed6\u4eba\u89e3\u51b3\u95ee\u9898","text":"<p>\u60a8\u53ef\u4ee5\u67e5\u770b\u73b0\u6709 issues\uff0c\u5e76\u5c1d\u8bd5\u5e2e\u52a9\u5176\u4ed6\u4eba\u89e3\u51b3\u95ee\u9898\uff0c\u8bf4\u4e0d\u5b9a\u60a8\u80fd\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\u5462\u3002\ud83e\udd13</p> <p>\u5982\u679c\u5e2e\u52a9\u5f88\u591a\u4eba\u89e3\u51b3\u4e86\u95ee\u9898\uff0c\u60a8\u5c31\u6709\u53ef\u80fd\u6210\u4e3a FastAPI \u7684\u5b98\u65b9\u4e13\u5bb6\u3002\ud83c\udf89</p>"},{"location":"help-fastapi/#github_2","title":"\u76d1\u542c GitHub \u8d44\u6e90\u5e93","text":"<p>\u60a8\u53ef\u4ee5\u5728 GitHub \u4e0a\u300c\u76d1\u542c\u300dFastAPI\uff08\u70b9\u51fb\u53f3\u4e0a\u89d2\u7684 \"watch\" \u6309\u94ae\uff09\uff1a https://github.com/tiangolo/fastapi. \ud83d\udc40</p> <p>\u5982\u679c\u60a8\u9009\u62e9 \"Watching\" \u800c\u4e0d\u662f \"Releases only\"\uff0c\u6709\u4eba\u521b\u5efa\u65b0 Issue \u65f6\uff0c\u60a8\u4f1a\u63a5\u6536\u5230\u901a\u77e5\u3002</p> <p>\u7136\u540e\u60a8\u5c31\u53ef\u4ee5\u5c1d\u8bd5\u5e76\u5e2e\u52a9\u4ed6\u4eec\u89e3\u51b3\u95ee\u9898\u3002</p>"},{"location":"help-fastapi/#issue","title":"\u521b\u5efa Issue","text":"<p>\u60a8\u53ef\u4ee5\u5728 GitHub \u8d44\u6e90\u5e93\u4e2d\u521b\u5efa Issue\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>\u63d0\u51fa\u95ee\u9898\u6216\u610f\u89c1</li> <li>\u63d0\u51fa\u65b0\u7279\u6027\u5efa\u8bae</li> </ul> <p>\u6ce8\u610f\uff1a\u5982\u679c\u60a8\u521b\u5efa Issue\uff0c\u6211\u4f1a\u8981\u6c42\u60a8\u4e5f\u8981\u5e2e\u52a9\u522b\u7684\u7528\u6237\u3002\ud83d\ude09</p>"},{"location":"help-fastapi/#pr","title":"\u521b\u5efa PR","text":"<p>\u60a8\u53ef\u4ee5\u521b\u5efa PR \u4e3a\u6e90\u4ee3\u7801\u505a\u8d21\u732e\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>\u4fee\u6539\u6587\u6863\u9519\u522b\u5b57</li> <li>\u7f16\u8f91\u8fd9\u4e2a\u6587\u4ef6\uff0c\u5206\u4eab FastAPI \u7684\u6587\u7ae0\u3001\u89c6\u9891\u3001\u535a\u5ba2\uff0c\u4e0d\u8bba\u662f\u60a8\u81ea\u5df1\u7684\uff0c\u8fd8\u662f\u60a8\u770b\u5230\u7684\u90fd\u6210<ul> <li>\u6ce8\u610f\uff0c\u6dfb\u52a0\u7684\u94fe\u63a5\u8981\u653e\u5728\u5bf9\u5e94\u533a\u5757\u7684\u5f00\u5934</li> </ul> </li> <li>\u7ffb\u8bd1\u6587\u6863<ul> <li>\u5ba1\u9605\u522b\u4eba\u7ffb\u8bd1\u7684\u6587\u6863</li> </ul> </li> <li>\u6dfb\u52a0\u65b0\u7684\u6587\u6863\u5185\u5bb9</li> <li>\u4fee\u590d\u73b0\u6709\u95ee\u9898/Bug</li> <li>\u6dfb\u52a0\u65b0\u529f\u80fd</li> </ul>"},{"location":"help-fastapi/#_3","title":"\u52a0\u5165\u804a\u5929","text":"<p>\u5feb\u52a0\u5165 \ud83d\udc65 Discord \u804a\u5929\u670d\u52a1\u5668 \ud83d\udc65 \u548c FastAPI \u793e\u533a\u91cc\u7684\u5c0f\u4f19\u4f34\u4e00\u8d77\u54c8\u76ae\u5427\u3002</p> <p>\u63d0\u793a</p> <p>\u5982\u6709\u95ee\u9898\uff0c\u8bf7\u5728 GitHub Issues \u91cc\u63d0\u95ee\uff0c\u5728\u8fd9\u91cc\u66f4\u5bb9\u6613\u5f97\u5230 FastAPI \u4e13\u5bb6\u7684\u5e2e\u52a9\u3002</p> <p>\u804a\u5929\u5ba4\u4ec5\u4f9b\u95f2\u804a\u3002</p> <p>\u6211\u4eec\u4e4b\u524d\u8fd8\u4f7f\u7528\u8fc7 Gitter chat\uff0c\u4f46\u5b83\u4e0d\u652f\u6301\u9891\u9053\u7b49\u9ad8\u7ea7\u529f\u80fd\uff0c\u804a\u5929\u4e5f\u6bd4\u8f83\u9ebb\u70e6\uff0c\u6240\u4ee5\u73b0\u5728\u63a8\u8350\u4f7f\u7528 Discord\u3002</p>"},{"location":"help-fastapi/#_4","title":"\u522b\u5728\u804a\u5929\u5ba4\u91cc\u63d0\u95ee","text":"<p>\u6ce8\u610f\uff0c\u804a\u5929\u5ba4\u66f4\u503e\u5411\u4e8e\u201c\u95f2\u804a\u201d\uff0c\u7ecf\u5e38\u6709\u4eba\u4f1a\u63d0\u51fa\u4e00\u4e9b\u7b3c\u7edf\u5f97\u8ba9\u4eba\u96be\u4ee5\u56de\u7b54\u7684\u95ee\u9898\uff0c\u6240\u4ee5\u5728\u8fd9\u91cc\u63d0\u95ee\u4e00\u822c\u6ca1\u4eba\u56de\u7b54\u3002</p> <p>GitHub Issues \u91cc\u63d0\u4f9b\u4e86\u6a21\u677f\uff0c\u6307\u5f15\u60a8\u63d0\u51fa\u6b63\u786e\u7684\u95ee\u9898\uff0c\u6709\u5229\u4e8e\u83b7\u5f97\u4f18\u8d28\u7684\u56de\u7b54\uff0c\u751a\u81f3\u53ef\u80fd\u89e3\u51b3\u60a8\u8fd8\u6ca1\u6709\u60f3\u5230\u7684\u95ee\u9898\u3002\u800c\u4e14\u5c31\u7b97\u7b54\u7591\u89e3\u60d1\u8981\u8017\u8d39\u4e0d\u5c11\u65f6\u95f4\uff0c\u6211\u8fd8\u662f\u4f1a\u5c3d\u91cf\u5728 GitHub \u91cc\u56de\u7b54\u95ee\u9898\u3002\u4f46\u5728\u804a\u5929\u5ba4\u91cc\uff0c\u6211\u5c31\u6ca1\u529f\u592b\u8fd9\u4e48\u505a\u4e86\u3002\ud83d\ude05</p> <p>\u804a\u5929\u5ba4\u91cc\u7684\u804a\u5929\u5185\u5bb9\u4e5f\u4e0d\u5982 GitHub \u91cc\u597d\u641c\u7d22\uff0c\u804a\u5929\u91cc\u7684\u95ee\u7b54\u5f88\u5bb9\u6613\u5c31\u627e\u4e0d\u5230\u4e86\u3002\u53ea\u6709\u5728 GitHub Issues \u91cc\u7684\u95ee\u7b54\u624d\u80fd\u5e2e\u52a9\u60a8\u6210\u4e3a  FastAPI \u4e13\u5bb6\uff0c\u5728 GitHub Issues \u4e2d\u4e3a\u60a8\u5e26\u6765\u66f4\u591a\u5173\u6ce8\u3002</p> <p>\u53e6\u4e00\u65b9\u9762\uff0c\u804a\u5929\u5ba4\u91cc\u6709\u6210\u5343\u4e0a\u4e07\u7684\u7528\u6237\uff0c\u5728\u8fd9\u91cc\uff0c\u60a8\u6709\u5f88\u5927\u53ef\u80fd\u9047\u5230\u804a\u5f97\u6765\u7684\u4eba\u3002\ud83d\ude04</p>"},{"location":"help-fastapi/#_5","title":"\u8d5e\u52a9\u4f5c\u8005","text":"<p>\u60a8\u8fd8\u53ef\u4ee5\u901a\u8fc7 GitHub \u8d5e\u52a9\u5546\u8d44\u52a9\u672c\u9879\u76ee\u7684\u4f5c\u8005\uff08\u5c31\u662f\u6211\uff09\u3002</p> <p>\u7ed9\u6211\u4e70\u676f\u5496\u5561 \u2615\ufe0f \u4ee5\u793a\u611f\u8c22 \ud83d\ude04</p> <p>\u5f53\u7136\u60a8\u4e5f\u53ef\u4ee5\u6210\u4e3a FastAPI \u7684\u91d1\u724c\u6216\u94f6\u724c\u8d5e\u52a9\u5546\u3002\ud83c\udfc5\ud83c\udf89</p>"},{"location":"help-fastapi/#fastapi_3","title":"\u8d5e\u52a9 FastAPI \u4f7f\u7528\u7684\u5de5\u5177","text":"<p>\u5982\u60a8\u5728\u672c\u6587\u6863\u4e2d\u6240\u89c1\uff0cFastAPI \u7ad9\u5728\u5de8\u4eba\u7684\u80a9\u8180\u4e0a\uff0c\u5b83\u4eec\u5206\u522b\u662f Starlette \u548c Pydantic\u3002</p> <p>\u60a8\u8fd8\u53ef\u4ee5\u8d5e\u52a9\uff1a</p> <ul> <li>Samuel Colvin \uff08Pydantic\uff09</li> <li>Encode \uff08Starlette, Uvicorn\uff09</li> </ul> <p>\u8c22\u8c22\uff01\ud83d\ude80</p>"},{"location":"python-types/","title":"Python \u7c7b\u578b\u63d0\u793a\u7b80\u4ecb","text":"<p>Python 3.6+ \u7248\u672c\u52a0\u5165\u4e86\u5bf9\"\u7c7b\u578b\u63d0\u793a\"\u7684\u652f\u6301\u3002</p> <p>\u8fd9\u4e9b\"\u7c7b\u578b\u63d0\u793a\"\u662f\u4e00\u79cd\u65b0\u7684\u8bed\u6cd5\uff08\u5728 Python 3.6 \u7248\u672c\u52a0\u5165\uff09\u7528\u6765\u58f0\u660e\u4e00\u4e2a\u53d8\u91cf\u7684\u7c7b\u578b\u3002</p> <p>\u901a\u8fc7\u58f0\u660e\u53d8\u91cf\u7684\u7c7b\u578b\uff0c\u7f16\u8f91\u5668\u548c\u4e00\u4e9b\u5de5\u5177\u80fd\u7ed9\u4f60\u63d0\u4f9b\u66f4\u597d\u7684\u652f\u6301\u3002</p> <p>\u8fd9\u53ea\u662f\u4e00\u4e2a\u5173\u4e8e Python \u7c7b\u578b\u63d0\u793a\u7684\u5feb\u901f\u5165\u95e8 / \u590d\u4e60\u3002\u5b83\u4ec5\u6db5\u76d6\u4e0e FastAPI \u4e00\u8d77\u4f7f\u7528\u6240\u9700\u7684\u6700\u5c11\u90e8\u5206...\u5b9e\u9645\u4e0a\u53ea\u6709\u5f88\u5c11\u4e00\u70b9\u3002</p> <p>\u6574\u4e2a FastAPI \u90fd\u57fa\u4e8e\u8fd9\u4e9b\u7c7b\u578b\u63d0\u793a\u6784\u5efa\uff0c\u5b83\u4eec\u5e26\u6765\u4e86\u8bb8\u591a\u4f18\u70b9\u548c\u597d\u5904\u3002</p> <p>\u4f46\u5373\u4f7f\u4f60\u4e0d\u4f1a\u7528\u5230 FastAPI\uff0c\u4e86\u89e3\u4e00\u4e0b\u7c7b\u578b\u63d0\u793a\u4e5f\u4f1a\u8ba9\u4f60\u4ece\u4e2d\u53d7\u76ca\u3002</p> <p>Note</p> <p>\u5982\u679c\u4f60\u5df2\u7ecf\u7cbe\u901a Python\uff0c\u5e76\u4e14\u4e86\u89e3\u5173\u4e8e\u7c7b\u578b\u63d0\u793a\u7684\u4e00\u5207\u77e5\u8bc6\uff0c\u76f4\u63a5\u8df3\u5230\u4e0b\u4e00\u7ae0\u8282\u5427\u3002</p>"},{"location":"python-types/#_1","title":"\u52a8\u673a","text":"<p>\u8ba9\u6211\u4eec\u4ece\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\u5f00\u59cb\uff1a</p> <pre><code>def get_full_name(first_name, last_name):\n    full_name = first_name.title() + \" \" + last_name.title()\n    return full_name\n\n\nprint(get_full_name(\"john\", \"doe\"))\n</code></pre> <p>\u8fd0\u884c\u8fd9\u6bb5\u7a0b\u5e8f\u5c06\u8f93\u51fa\uff1a</p> <pre><code>John Doe\n</code></pre> <p>\u8fd9\u4e2a\u51fd\u6570\u505a\u4e86\u4e0b\u9762\u8fd9\u4e9b\u4e8b\u60c5\uff1a</p> <ul> <li>\u63a5\u6536 <code>first_name</code> \u548c <code>last_name</code> \u53c2\u6570\u3002</li> <li>\u901a\u8fc7 <code>title()</code> \u5c06\u6bcf\u4e2a\u53c2\u6570\u7684\u7b2c\u4e00\u4e2a\u5b57\u6bcd\u8f6c\u6362\u4e3a\u5927\u5199\u5f62\u5f0f\u3002</li> <li>\u4e2d\u95f4\u7528\u4e00\u4e2a\u7a7a\u683c\u6765\u62fc\u63a5\u5b83\u4eec\u3002</li> </ul> <pre><code>def get_full_name(first_name, last_name):\nfull_name = first_name.title() + \" \" + last_name.title()\nreturn full_name\n\n\nprint(get_full_name(\"john\", \"doe\"))\n</code></pre>"},{"location":"python-types/#_2","title":"\u4fee\u6539\u793a\u4f8b","text":"<p>\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u7b80\u5355\u7684\u7a0b\u5e8f\u3002</p> <p>\u73b0\u5728\u5047\u8bbe\u4f60\u5c06\u4ece\u5934\u5f00\u59cb\u7f16\u5199\u8fd9\u6bb5\u7a0b\u5e8f\u3002</p> <p>\u5728\u67d0\u4e00\u65f6\u523b\uff0c\u4f60\u5f00\u59cb\u5b9a\u4e49\u51fd\u6570\uff0c\u5e76\u4e14\u51c6\u5907\u597d\u4e86\u53c2\u6570...\u3002</p> <p>\u73b0\u5728\u4f60\u9700\u8981\u8c03\u7528\u4e00\u4e2a\"\u5c06\u7b2c\u4e00\u4e2a\u5b57\u6bcd\u8f6c\u6362\u4e3a\u5927\u5199\u5f62\u5f0f\u7684\u65b9\u6cd5\"\u3002</p> <p>\u7b49\u7b49\uff0c\u90a3\u4e2a\u65b9\u6cd5\u662f\u4ec0\u4e48\u6765\u7740\uff1f<code>upper</code>\uff1f\u8fd8\u662f <code>uppercase</code>\uff1f<code>first_uppercase</code>\uff1f<code>capitalize</code>\uff1f</p> <p>\u7136\u540e\u4f60\u5c1d\u8bd5\u5411\u7a0b\u5e8f\u5458\u8001\u624b\u7684\u670b\u53cb\u2014\u2014\u7f16\u8f91\u5668\u81ea\u52a8\u8865\u5168\u5bfb\u6c42\u5e2e\u52a9\u3002</p> <p>\u8f93\u5165\u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570 <code>first_name</code>\uff0c\u8f93\u5165\u70b9\u53f7\uff08<code>.</code>\uff09\u7136\u540e\u6572\u4e0b <code>Ctrl+Space</code> \u6765\u89e6\u53d1\u4ee3\u7801\u8865\u5168\u3002</p> <p>\u4f46\u9057\u61be\u7684\u662f\u5e76\u6ca1\u6709\u8d77\u4ec0\u4e48\u4f5c\u7528\uff1a</p> <p></p>"},{"location":"python-types/#_3","title":"\u6dfb\u52a0\u7c7b\u578b","text":"<p>\u8ba9\u6211\u4eec\u6765\u4fee\u6539\u4e0a\u9762\u4f8b\u5b50\u7684\u4e00\u884c\u4ee3\u7801\u3002</p> <p>\u6211\u4eec\u5c06\u628a\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\u4e2d\u7684\u51fd\u6570\u53c2\u6570\u4ece\uff1a</p> <pre><code>    first_name, last_name\n</code></pre> <p>\u6539\u6210\uff1a</p> <pre><code>    first_name: str, last_name: str\n</code></pre> <p>\u5c31\u662f\u8fd9\u6837\u3002</p> <p>\u8fd9\u4e9b\u5c31\u662f\"\u7c7b\u578b\u63d0\u793a\"\uff1a</p> <pre><code>def get_full_name(first_name: str, last_name: str):\nfull_name = first_name.title() + \" \" + last_name.title()\n    return full_name\n\n\nprint(get_full_name(\"john\", \"doe\"))\n</code></pre> <p>\u8fd9\u548c\u58f0\u660e\u9ed8\u8ba4\u503c\u662f\u4e0d\u540c\u7684\uff0c\u4f8b\u5982\uff1a</p> <pre><code>    first_name=\"john\", last_name=\"doe\"\n</code></pre> <p>\u8fd9\u4e24\u8005\u4e0d\u4e00\u6837\u3002</p> <p>\u6211\u4eec\u7528\u7684\u662f\u5192\u53f7\uff08<code>:</code>\uff09\uff0c\u4e0d\u662f\u7b49\u53f7\uff08<code>=</code>\uff09\u3002</p> <p>\u800c\u4e14\u6dfb\u52a0\u7c7b\u578b\u63d0\u793a\u4e00\u822c\u4e0d\u4f1a\u6539\u53d8\u539f\u6765\u7684\u8fd0\u884c\u7ed3\u679c\u3002</p> <p>\u73b0\u5728\u5047\u8bbe\u6211\u4eec\u53c8\u4e00\u6b21\u6b63\u5728\u521b\u5efa\u8fd9\u4e2a\u51fd\u6570\uff0c\u8fd9\u6b21\u6dfb\u52a0\u4e86\u7c7b\u578b\u63d0\u793a\u3002</p> <p>\u5728\u540c\u6837\u7684\u5730\u65b9\uff0c\u901a\u8fc7 <code>Ctrl+Space</code> \u89e6\u53d1\u81ea\u52a8\u8865\u5168\uff0c\u4f60\u4f1a\u53d1\u73b0\uff1a</p> <p></p> <p>\u8fd9\u6837\uff0c\u4f60\u53ef\u4ee5\u6eda\u52a8\u67e5\u770b\u9009\u9879\uff0c\u76f4\u5230\u4f60\u627e\u5230\u770b\u8d77\u6765\u773c\u719f\u7684\u90a3\u4e2a\uff1a</p> <p></p>"},{"location":"python-types/#_4","title":"\u66f4\u591a\u52a8\u673a","text":"<p>\u4e0b\u9762\u662f\u4e00\u4e2a\u5df2\u7ecf\u6709\u7c7b\u578b\u63d0\u793a\u7684\u51fd\u6570\uff1a</p> <pre><code>def get_name_with_age(name: str, age: int):\nname_with_age = name + \" is this old: \" + age\n    return name_with_age\n</code></pre> <p>\u56e0\u4e3a\u7f16\u8f91\u5668\u5df2\u7ecf\u77e5\u9053\u4e86\u8fd9\u4e9b\u53d8\u91cf\u7684\u7c7b\u578b\uff0c\u6240\u4ee5\u4e0d\u4ec5\u80fd\u5bf9\u4ee3\u7801\u8fdb\u884c\u8865\u5168\uff0c\u8fd8\u80fd\u68c0\u67e5\u5176\u4e2d\u7684\u9519\u8bef\uff1a</p> <p></p> <p>\u73b0\u5728\u4f60\u77e5\u9053\u4e86\u5fc5\u987b\u5148\u4fee\u590d\u8fd9\u4e2a\u95ee\u9898\uff0c\u901a\u8fc7 <code>str(age)</code> \u628a <code>age</code> \u8f6c\u6362\u6210\u5b57\u7b26\u4e32\uff1a</p> <pre><code>def get_name_with_age(name: str, age: int):\nname_with_age = name + \" is this old: \" + str(age)\nreturn name_with_age\n</code></pre>"},{"location":"python-types/#_5","title":"\u58f0\u660e\u7c7b\u578b","text":"<p>\u4f60\u521a\u521a\u770b\u5230\u7684\u5c31\u662f\u58f0\u660e\u7c7b\u578b\u63d0\u793a\u7684\u4e3b\u8981\u573a\u666f\u3002\u7528\u4e8e\u51fd\u6570\u7684\u53c2\u6570\u3002</p> <p>\u8fd9\u4e5f\u662f\u4f60\u5c06\u5728 FastAPI \u4e2d\u4f7f\u7528\u5b83\u4eec\u7684\u4e3b\u8981\u573a\u666f\u3002</p>"},{"location":"python-types/#_6","title":"\u7b80\u5355\u7c7b\u578b","text":"<p>\u4e0d\u53ea\u662f <code>str</code>\uff0c\u4f60\u80fd\u591f\u58f0\u660e\u6240\u6709\u7684\u6807\u51c6 Python \u7c7b\u578b\u3002</p> <p>\u6bd4\u5982\u4ee5\u4e0b\u7c7b\u578b\uff1a</p> <ul> <li><code>int</code></li> <li><code>float</code></li> <li><code>bool</code></li> <li><code>bytes</code></li> </ul> <pre><code>def get_items(item_a: str, item_b: int, item_c: float, item_d: bool, item_e: bytes):\nreturn item_a, item_b, item_c, item_d, item_d, item_e\n</code></pre>"},{"location":"python-types/#_7","title":"\u5d4c\u5957\u7c7b\u578b","text":"<p>\u6709\u4e9b\u5bb9\u5668\u6570\u636e\u7ed3\u6784\u53ef\u4ee5\u5305\u542b\u5176\u4ed6\u7684\u503c\uff0c\u6bd4\u5982 <code>dict</code>\u3001<code>list</code>\u3001<code>set</code> \u548c <code>tuple</code>\u3002\u5b83\u4eec\u5185\u90e8\u7684\u503c\u4e5f\u4f1a\u62e5\u6709\u81ea\u5df1\u7684\u7c7b\u578b\u3002</p> <p>\u4f60\u53ef\u4ee5\u4f7f\u7528 Python \u7684 <code>typing</code> \u6807\u51c6\u5e93\u6765\u58f0\u660e\u8fd9\u4e9b\u7c7b\u578b\u4ee5\u53ca\u5b50\u7c7b\u578b\u3002</p> <p>\u5b83\u4e13\u95e8\u7528\u6765\u652f\u6301\u8fd9\u4e9b\u7c7b\u578b\u63d0\u793a\u3002</p>"},{"location":"python-types/#_8","title":"\u5217\u8868","text":"<p>\u4f8b\u5982\uff0c\u8ba9\u6211\u4eec\u6765\u5b9a\u4e49\u4e00\u4e2a\u7531 <code>str</code> \u7ec4\u6210\u7684 <code>list</code> \u53d8\u91cf\u3002</p> <p>\u4ece <code>typing</code> \u6a21\u5757\u5bfc\u5165 <code>List</code>\uff08\u6ce8\u610f\u662f\u5927\u5199\u7684 <code>L</code>\uff09\uff1a</p> <pre><code>from typing import List\ndef process_items(items: List[str]):\n    for item in items:\n        print(item)\n</code></pre> <p>\u540c\u6837\u4ee5\u5192\u53f7\uff08<code>:</code>\uff09\u6765\u58f0\u660e\u8fd9\u4e2a\u53d8\u91cf\u3002</p> <p>\u8f93\u5165 <code>List</code> \u4f5c\u4e3a\u7c7b\u578b\u3002</p> <p>\u7531\u4e8e\u5217\u8868\u662f\u5e26\u6709\"\u5b50\u7c7b\u578b\"\u7684\u7c7b\u578b\uff0c\u6240\u4ee5\u6211\u4eec\u628a\u5b50\u7c7b\u578b\u653e\u5728\u65b9\u62ec\u53f7\u4e2d\uff1a</p> <pre><code>from typing import List\n\n\ndef process_items(items: List[str]):\nfor item in items:\n        print(item)\n</code></pre> <p>\u8fd9\u8868\u793a\uff1a\"\u53d8\u91cf <code>items</code> \u662f\u4e00\u4e2a <code>list</code>\uff0c\u5e76\u4e14\u8fd9\u4e2a\u5217\u8868\u91cc\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u90fd\u662f <code>str</code>\"\u3002</p> <p>\u8fd9\u6837\uff0c\u5373\u4f7f\u5728\u5904\u7406\u5217\u8868\u4e2d\u7684\u5143\u7d20\u65f6\uff0c\u4f60\u7684\u7f16\u8f91\u5668\u4e5f\u53ef\u4ee5\u63d0\u4f9b\u652f\u6301\u3002</p> <p>\u6ca1\u6709\u7c7b\u578b\uff0c\u51e0\u4e4e\u662f\u4e0d\u53ef\u80fd\u5b9e\u73b0\u4e0b\u9762\u8fd9\u6837\uff1a</p> <p></p> <p>\u6ce8\u610f\uff0c\u53d8\u91cf <code>item</code> \u662f\u5217\u8868 <code>items</code> \u4e2d\u7684\u5143\u7d20\u4e4b\u4e00\u3002</p> <p>\u800c\u4e14\uff0c\u7f16\u8f91\u5668\u4ecd\u7136\u77e5\u9053\u5b83\u662f\u4e00\u4e2a <code>str</code>\uff0c\u5e76\u4e3a\u6b64\u63d0\u4f9b\u4e86\u652f\u6301\u3002</p>"},{"location":"python-types/#_9","title":"\u5143\u7ec4\u548c\u96c6\u5408","text":"<p>\u58f0\u660e <code>tuple</code> \u548c <code>set</code> \u7684\u65b9\u6cd5\u4e5f\u662f\u4e00\u6837\u7684\uff1a</p> <pre><code>from typing import Set, Tuple\ndef process_items(items_t: Tuple[int, int, str], items_s: Set[bytes]):\nreturn items_t, items_s\n</code></pre> <p>\u8fd9\u8868\u793a\uff1a</p> <ul> <li>\u53d8\u91cf <code>items_t</code> \u662f\u4e00\u4e2a <code>tuple</code>\uff0c\u5176\u4e2d\u7684\u524d\u4e24\u4e2a\u5143\u7d20\u90fd\u662f <code>int</code> \u7c7b\u578b, \u6700\u540e\u4e00\u4e2a\u5143\u7d20\u662f <code>str</code> \u7c7b\u578b\u3002</li> <li>\u53d8\u91cf <code>items_s</code> \u662f\u4e00\u4e2a <code>set</code>\uff0c\u5176\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u90fd\u662f <code>bytes</code> \u7c7b\u578b\u3002</li> </ul>"},{"location":"python-types/#_10","title":"\u5b57\u5178","text":"<p>\u5b9a\u4e49 <code>dict</code> \u65f6\uff0c\u9700\u8981\u4f20\u5165\u4e24\u4e2a\u5b50\u7c7b\u578b\uff0c\u7528\u9017\u53f7\u8fdb\u884c\u5206\u9694\u3002</p> <p>\u7b2c\u4e00\u4e2a\u5b50\u7c7b\u578b\u58f0\u660e <code>dict</code> \u7684\u6240\u6709\u952e\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u5b50\u7c7b\u578b\u58f0\u660e <code>dict</code> \u7684\u6240\u6709\u503c\uff1a</p> <pre><code>from typing import Dict\ndef process_items(prices: Dict[str, float]):\nfor item_name, item_price in prices.items():\n        print(item_name)\n        print(item_price)\n</code></pre> <p>\u8fd9\u8868\u793a\uff1a</p> <ul> <li>\u53d8\u91cf <code>prices</code> \u662f\u4e00\u4e2a <code>dict</code>\uff1a<ul> <li>\u8fd9\u4e2a <code>dict</code> \u7684\u6240\u6709\u952e\u4e3a <code>str</code> \u7c7b\u578b\uff08\u53ef\u4ee5\u770b\u4f5c\u662f\u5b57\u5178\u5185\u6bcf\u4e2a\u5143\u7d20\u7684\u540d\u79f0\uff09\u3002</li> <li>\u8fd9\u4e2a <code>dict</code> \u7684\u6240\u6709\u503c\u4e3a <code>float</code> \u7c7b\u578b\uff08\u53ef\u4ee5\u770b\u4f5c\u662f\u5b57\u5178\u5185\u6bcf\u4e2a\u5143\u7d20\u7684\u4ef7\u683c\uff09\u3002</li> </ul> </li> </ul>"},{"location":"python-types/#_11","title":"\u7c7b\u4f5c\u4e3a\u7c7b\u578b","text":"<p>\u4f60\u4e5f\u53ef\u4ee5\u5c06\u7c7b\u58f0\u660e\u4e3a\u53d8\u91cf\u7684\u7c7b\u578b\u3002</p> <p>\u5047\u8bbe\u4f60\u6709\u4e00\u4e2a\u540d\u4e3a <code>Person</code> \u7684\u7c7b\uff0c\u62e5\u6709 name \u5c5e\u6027\uff1a</p> <pre><code>class Person:\ndef __init__(self, name: str):\nself.name = name\ndef get_person_name(one_person: Person):\n    return one_person.name\n</code></pre> <p>\u63a5\u4e0b\u6765\uff0c\u4f60\u53ef\u4ee5\u5c06\u4e00\u4e2a\u53d8\u91cf\u58f0\u660e\u4e3a <code>Person</code> \u7c7b\u578b\uff1a</p> <pre><code>class Person:\n    def __init__(self, name: str):\n        self.name = name\n\n\ndef get_person_name(one_person: Person):\nreturn one_person.name\n</code></pre> <p>\u7136\u540e\uff0c\u4f60\u5c06\u518d\u6b21\u83b7\u5f97\u6240\u6709\u7684\u7f16\u8f91\u5668\u652f\u6301\uff1a</p> <p></p>"},{"location":"python-types/#pydantic","title":"Pydantic \u6a21\u578b","text":"<p>Pydantic \u662f\u4e00\u4e2a\u7528\u6765\u7528\u6765\u6267\u884c\u6570\u636e\u6821\u9a8c\u7684 Python \u5e93\u3002</p> <p>\u4f60\u53ef\u4ee5\u5c06\u6570\u636e\u7684\"\u7ed3\u6784\"\u58f0\u660e\u4e3a\u5177\u6709\u5c5e\u6027\u7684\u7c7b\u3002</p> <p>\u6bcf\u4e2a\u5c5e\u6027\u90fd\u62e5\u6709\u7c7b\u578b\u3002</p> <p>\u63a5\u7740\u4f60\u7528\u4e00\u4e9b\u503c\u6765\u521b\u5efa\u8fd9\u4e2a\u7c7b\u7684\u5b9e\u4f8b\uff0c\u8fd9\u4e9b\u503c\u4f1a\u88ab\u6821\u9a8c\uff0c\u5e76\u88ab\u8f6c\u6362\u4e3a\u9002\u5f53\u7684\u7c7b\u578b\uff08\u5728\u9700\u8981\u7684\u60c5\u51b5\u4e0b\uff09\uff0c\u8fd4\u56de\u4e00\u4e2a\u5305\u542b\u6240\u6709\u6570\u636e\u7684\u5bf9\u8c61\u3002</p> <p>\u7136\u540e\uff0c\u4f60\u5c06\u83b7\u5f97\u8fd9\u4e2a\u5bf9\u8c61\u7684\u6240\u6709\u7f16\u8f91\u5668\u652f\u6301\u3002</p> <p>\u4e0b\u9762\u7684\u4f8b\u5b50\u6765\u81ea Pydantic \u5b98\u65b9\u6587\u6863\uff1a</p> <pre><code>class Person:\n    def __init__(self, name: str):\n        self.name = name\n\n\ndef get_person_name(one_person: Person):\n    return one_person.name\n</code></pre> <p>Info</p> <p>\u60f3\u8fdb\u4e00\u6b65\u4e86\u89e3 Pydantic\uff0c\u8bf7\u9605\u8bfb\u5176\u6587\u6863.</p> <p>\u6574\u4e2a FastAPI \u5efa\u7acb\u5728 Pydantic \u7684\u57fa\u7840\u4e4b\u4e0a\u3002</p> <p>\u5b9e\u9645\u4e0a\u4f60\u5c06\u5728 \u6559\u7a0b - \u7528\u6237\u6307\u5357 \u770b\u5230\u5f88\u591a\u8fd9\u79cd\u60c5\u51b5\u3002</p>"},{"location":"python-types/#fastapi","title":"FastAPI \u4e2d\u7684\u7c7b\u578b\u63d0\u793a","text":"<p>FastAPI \u5229\u7528\u8fd9\u4e9b\u7c7b\u578b\u63d0\u793a\u6765\u505a\u4e0b\u9762\u51e0\u4ef6\u4e8b\u3002</p> <p>\u4f7f\u7528 FastAPI \u65f6\u7528\u7c7b\u578b\u63d0\u793a\u58f0\u660e\u53c2\u6570\u53ef\u4ee5\u83b7\u5f97\uff1a</p> <ul> <li>\u7f16\u8f91\u5668\u652f\u6301\u3002</li> <li>\u7c7b\u578b\u68c0\u67e5\u3002</li> </ul> <p>...\u5e76\u4e14 FastAPI \u8fd8\u4f1a\u7528\u8fd9\u4e9b\u7c7b\u578b\u58f0\u660e\u6765\uff1a</p> <ul> <li>\u5b9a\u4e49\u53c2\u6570\u8981\u6c42\uff1a\u58f0\u660e\u5bf9\u8bf7\u6c42\u8def\u5f84\u53c2\u6570\u3001\u67e5\u8be2\u53c2\u6570\u3001\u8bf7\u6c42\u5934\u3001\u8bf7\u6c42\u4f53\u3001\u4f9d\u8d56\u7b49\u7684\u8981\u6c42\u3002</li> <li>\u8f6c\u6362\u6570\u636e\uff1a\u5c06\u6765\u81ea\u8bf7\u6c42\u7684\u6570\u636e\u8f6c\u6362\u4e3a\u9700\u8981\u7684\u7c7b\u578b\u3002</li> <li>\u6821\u9a8c\u6570\u636e\uff1a \u5bf9\u4e8e\u6bcf\u4e00\u4e2a\u8bf7\u6c42\uff1a<ul> <li>\u5f53\u6570\u636e\u6821\u9a8c\u5931\u8d25\u65f6\u81ea\u52a8\u751f\u6210\u9519\u8bef\u4fe1\u606f\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002</li> </ul> </li> <li>\u4f7f\u7528 OpenAPI \u8bb0\u5f55 API\uff1a<ul> <li>\u7136\u540e\u7528\u4e8e\u81ea\u52a8\u751f\u6210\u4ea4\u4e92\u5f0f\u6587\u6863\u7684\u7528\u6237\u754c\u9762\u3002</li> </ul> </li> </ul> <p>\u542c\u4e0a\u53bb\u6709\u70b9\u62bd\u8c61\u3002\u4e0d\u8fc7\u4e0d\u7528\u62c5\u5fc3\u3002\u4f60\u5c06\u5728 \u6559\u7a0b - \u7528\u6237\u6307\u5357 \u4e2d\u770b\u5230\u6240\u6709\u7684\u5b9e\u6218\u3002</p> <p>\u6700\u91cd\u8981\u7684\u662f\uff0c\u901a\u8fc7\u4f7f\u7528\u6807\u51c6\u7684 Python \u7c7b\u578b\uff0c\u53ea\u9700\u8981\u5728\u4e00\u4e2a\u5730\u65b9\u58f0\u660e\uff08\u800c\u4e0d\u662f\u6dfb\u52a0\u66f4\u591a\u7684\u7c7b\u3001\u88c5\u9970\u5668\u7b49\uff09\uff0cFastAPI \u4f1a\u4e3a\u4f60\u5b8c\u6210\u5f88\u591a\u7684\u5de5\u4f5c\u3002</p> <p>Info</p> <p>\u5982\u679c\u4f60\u5df2\u7ecf\u9605\u8bfb\u4e86\u6240\u6709\u6559\u7a0b\uff0c\u56de\u8fc7\u5934\u6765\u60f3\u4e86\u89e3\u6709\u5173\u7c7b\u578b\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u6765\u81ea <code>mypy</code> \u7684\"\u901f\u67e5\u8868\"\u662f\u4e0d\u9519\u7684\u8d44\u6e90\u3002</p>"},{"location":"advanced/","title":"\u9ad8\u7ea7\u7528\u6237\u6307\u5357 - \u7b80\u4ecb","text":""},{"location":"advanced/#_1","title":"\u989d\u5916\u7279\u6027","text":"<p>\u4e3b\u8981\u7684\u6559\u7a0b \u6559\u7a0b - \u7528\u6237\u6307\u5357 \u5e94\u8be5\u8db3\u4ee5\u8ba9\u4f60\u4e86\u89e3 FastAPI \u7684\u6240\u6709\u4e3b\u8981\u7279\u6027\u3002</p> <p>\u4f60\u4f1a\u5728\u63a5\u4e0b\u6765\u7684\u7ae0\u8282\u4e2d\u4e86\u89e3\u5230\u5176\u4ed6\u7684\u9009\u9879\u3001\u914d\u7f6e\u4ee5\u53ca\u989d\u5916\u7684\u7279\u6027\u3002</p> <p>Tip</p> <p>\u63a5\u4e0b\u6765\u7684\u7ae0\u8282\u5e76\u4e0d\u4e00\u5b9a\u662f\u300c\u9ad8\u7ea7\u7684\u300d\u3002</p> <p>\u800c\u4e14\u5bf9\u4e8e\u4f60\u7684\u4f7f\u7528\u573a\u666f\u6765\u8bf4\uff0c\u89e3\u51b3\u65b9\u6848\u5f88\u53ef\u80fd\u5c31\u5728\u5176\u4e2d\u3002</p>"},{"location":"advanced/#_2","title":"\u5148\u9605\u8bfb\u6559\u7a0b","text":"<p>\u4f60\u53ef\u80fd\u4ecd\u4f1a\u7528\u5230 FastAPI \u4e3b\u6559\u7a0b \u6559\u7a0b - \u7528\u6237\u6307\u5357 \u4e2d\u7684\u5927\u591a\u6570\u7279\u6027\u3002</p> <p>\u63a5\u4e0b\u6765\u7684\u7ae0\u8282\u6211\u4eec\u8ba4\u4e3a\u4f60\u5df2\u7ecf\u8bfb\u8fc7 \u6559\u7a0b - \u7528\u6237\u6307\u5357\uff0c\u5e76\u4e14\u5047\u8bbe\u4f60\u5df2\u7ecf\u77e5\u6653\u5176\u4e2d\u4e3b\u8981\u601d\u60f3\u3002</p>"},{"location":"advanced/additional-status-codes/","title":"\u989d\u5916\u7684\u72b6\u6001\u7801","text":"<p>FastAPI \u9ed8\u8ba4\u4f7f\u7528 <code>JSONResponse</code> \u8fd4\u56de\u4e00\u4e2a\u54cd\u5e94\uff0c\u5c06\u4f60\u7684 \u8def\u5f84\u64cd\u4f5c \u4e2d\u7684\u8fd4\u56de\u5185\u5bb9\u653e\u5230\u8be5 <code>JSONResponse</code> \u4e2d\u3002</p> <p>FastAPI \u4f1a\u81ea\u52a8\u4f7f\u7528\u9ed8\u8ba4\u7684\u72b6\u6001\u7801\u6216\u8005\u4f7f\u7528\u4f60\u5728 \u8def\u5f84\u64cd\u4f5c \u4e2d\u8bbe\u7f6e\u7684\u72b6\u6001\u7801\u3002</p>"},{"location":"advanced/additional-status-codes/#_2","title":"\u989d\u5916\u7684\u72b6\u6001\u7801","text":"<p>\u5982\u679c\u4f60\u60f3\u8981\u8fd4\u56de\u4e3b\u8981\u72b6\u6001\u7801\u4e4b\u5916\u7684\u72b6\u6001\u7801\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a <code>Response</code> \u6765\u5b9e\u73b0\uff0c\u6bd4\u5982 <code>JSONResponse</code>\uff0c\u7136\u540e\u76f4\u63a5\u8bbe\u7f6e\u989d\u5916\u7684\u72b6\u6001\u7801\u3002</p> <p>\u4f8b\u5982\uff0c\u5047\u8bbe\u4f60\u60f3\u6709\u4e00\u4e2a \u8def\u5f84\u64cd\u4f5c \u80fd\u591f\u66f4\u65b0\u6761\u76ee\uff0c\u5e76\u4e14\u66f4\u65b0\u6210\u529f\u65f6\u8fd4\u56de 200 \u300c\u6210\u529f\u300d \u7684 HTTP \u72b6\u6001\u7801\u3002</p> <p>\u4f46\u662f\u4f60\u4e5f\u5e0c\u671b\u5b83\u80fd\u591f\u63a5\u53d7\u65b0\u7684\u6761\u76ee\u3002\u5e76\u4e14\u5f53\u8fd9\u4e9b\u6761\u76ee\u4e0d\u5b58\u5728\u65f6\uff0c\u4f1a\u81ea\u52a8\u521b\u5efa\u5e76\u8fd4\u56de 201 \u300c\u521b\u5efa\u300d\u7684 HTTP \u72b6\u6001\u7801\u3002</p> <p>\u8981\u5b9e\u73b0\u5b83\uff0c\u5bfc\u5165 <code>JSONResponse</code>\uff0c\u7136\u540e\u5728\u5176\u4e2d\u76f4\u63a5\u8fd4\u56de\u4f60\u7684\u5185\u5bb9\uff0c\u5e76\u5c06 <code>status_code</code> \u8bbe\u7f6e\u4e3a\u4e3a\u4f60\u8981\u7684\u503c\u3002</p> <pre><code>from typing import Union\n\nfrom fastapi import Body, FastAPI, status\nfrom fastapi.responses import JSONResponse\napp = FastAPI()\n\nitems = {\"foo\": {\"name\": \"Fighters\", \"size\": 6}, \"bar\": {\"name\": \"Tenders\", \"size\": 3}}\n\n\n@app.put(\"/items/{item_id}\")\nasync def upsert_item(\n    item_id: str,\n    name: Union[str, None] = Body(default=None),\n    size: Union[int, None] = Body(default=None),\n):\n    if item_id in items:\n        item = items[item_id]\n        item[\"name\"] = name\n        item[\"size\"] = size\n        return item\n    else:\n        item = {\"name\": name, \"size\": size}\n        items[item_id] = item\nreturn JSONResponse(status_code=status.HTTP_201_CREATED, content=item)\n</code></pre> <p>\u8b66\u544a</p> <p>\u5f53\u4f60\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a\u50cf\u4e0a\u9762\u4f8b\u5b50\u4e2d\u7684 <code>Response</code> \u5bf9\u8c61\u65f6\uff0c\u5b83\u4f1a\u76f4\u63a5\u8fd4\u56de\u3002</p> <p>FastAPI \u4e0d\u4f1a\u7528\u6a21\u578b\u7b49\u5bf9\u8be5\u54cd\u5e94\u8fdb\u884c\u5e8f\u5217\u5316\u3002</p> <p>\u786e\u4fdd\u5176\u4e2d\u6709\u4f60\u60f3\u8981\u7684\u6570\u636e\uff0c\u4e14\u8fd4\u56de\u7684\u503c\u4e3a\u5408\u6cd5\u7684 JSON\uff08\u5982\u679c\u4f60\u4f7f\u7528 <code>JSONResponse</code> \u7684\u8bdd\uff09\u3002</p> <p>\u6280\u672f\u7ec6\u8282</p> <p>\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 <code>from starlette.responses import JSONResponse</code>\u3002\u3000</p> <p>\u51fa\u4e8e\u65b9\u4fbf\uff0cFastAPI \u4e3a\u5f00\u53d1\u8005\u63d0\u4f9b\u540c <code>starlette.responses</code> \u4e00\u6837\u7684 <code>fastapi.responses</code>\u3002\u4f46\u662f\u5927\u591a\u6570\u53ef\u7528\u7684\u54cd\u5e94\u90fd\u662f\u76f4\u63a5\u6765\u81ea Starlette\u3002<code>status</code> \u4e5f\u662f\u4e00\u6837\u3002</p>"},{"location":"advanced/additional-status-codes/#openapi-api","title":"OpenAPI \u548c API \u6587\u6863","text":"<p>\u5982\u679c\u4f60\u76f4\u63a5\u8fd4\u56de\u989d\u5916\u7684\u72b6\u6001\u7801\u548c\u54cd\u5e94\uff0c\u5b83\u4eec\u4e0d\u4f1a\u5305\u542b\u5728 OpenAPI \u65b9\u6848\uff08API \u6587\u6863\uff09\u4e2d\uff0c\u56e0\u4e3a FastAPI \u6ca1\u529e\u6cd5\u9884\u5148\u77e5\u9053\u4f60\u8981\u8fd4\u56de\u4ec0\u4e48\u3002</p> <p>\u4f46\u662f\u4f60\u53ef\u4ee5\u4f7f\u7528 \u989d\u5916\u7684\u54cd\u5e94 \u5728\u4ee3\u7801\u4e2d\u8bb0\u5f55\u8fd9\u4e9b\u5185\u5bb9\u3002</p>"},{"location":"advanced/custom-response/","title":"\u81ea\u5b9a\u4e49\u54cd\u5e94 - HTML\uff0c\u6d41\uff0c\u6587\u4ef6\u548c\u5176\u4ed6","text":"<p>FastAPI \u9ed8\u8ba4\u4f1a\u4f7f\u7528 <code>JSONResponse</code> \u8fd4\u56de\u54cd\u5e94\u3002</p> <p>\u4f60\u53ef\u4ee5\u901a\u8fc7\u76f4\u63a5\u8fd4\u56de <code>Response</code> \u6765\u91cd\u8f7d\u5b83\uff0c\u53c2\u89c1 \u76f4\u63a5\u8fd4\u56de\u54cd\u5e94\u3002</p> <p>\u4f46\u5982\u679c\u4f60\u76f4\u63a5\u8fd4\u56de <code>Response</code>\uff0c\u8fd4\u56de\u6570\u636e\u4e0d\u4f1a\u81ea\u52a8\u8f6c\u6362\uff0c\u4e5f\u4e0d\u4f1a\u81ea\u52a8\u751f\u6210\u6587\u6863\uff08\u4f8b\u5982\uff0c\u5728 HTTP \u5934 <code>Content-Type</code> \u4e2d\u5305\u542b\u7279\u5b9a\u7684\u300c\u5a92\u4f53\u7c7b\u578b\u300d\u4f5c\u4e3a\u751f\u6210\u7684 OpenAPI \u7684\u4e00\u90e8\u5206\uff09\u3002</p> <p>\u4f60\u8fd8\u53ef\u4ee5\u5728 \u8def\u5f84\u64cd\u4f5c\u88c5\u9970\u5668 \u4e2d\u58f0\u660e\u4f60\u60f3\u7528\u7684 <code>Response</code>\u3002</p> <p>\u4f60\u4ece \u8def\u5f84\u64cd\u4f5c\u51fd\u6570 \u4e2d\u8fd4\u56de\u7684\u5185\u5bb9\u5c06\u88ab\u653e\u5728\u8be5 <code>Response</code> \u4e2d\u3002</p> <p>\u5e76\u4e14\u5982\u679c\u8be5 <code>Response</code> \u6709\u4e00\u4e2a JSON \u5a92\u4f53\u7c7b\u578b\uff08<code>application/json</code>\uff09\uff0c\u6bd4\u5982\u4f7f\u7528 <code>JSONResponse</code> \u6216\u8005 <code>UJSONResponse</code> \u7684\u65f6\u5019\uff0c\u8fd4\u56de\u7684\u6570\u636e\u5c06\u4f7f\u7528\u4f60\u5728\u8def\u5f84\u64cd\u4f5c\u88c5\u9970\u5668\u4e2d\u58f0\u660e\u7684\u4efb\u4f55 Pydantic \u7684 <code>response_model</code> \u81ea\u52a8\u8f6c\u6362\uff08\u548c\u8fc7\u6ee4\uff09\u3002</p> <p>\u8bf4\u660e</p> <p>\u5982\u679c\u4f60\u4f7f\u7528\u4e0d\u5e26\u6709\u4efb\u4f55\u5a92\u4f53\u7c7b\u578b\u7684\u54cd\u5e94\u7c7b\uff0cFastAPI \u8ba4\u4e3a\u4f60\u7684\u54cd\u5e94\u6ca1\u6709\u4efb\u4f55\u5185\u5bb9\uff0c\u6240\u4ee5\u4e0d\u4f1a\u5728\u751f\u6210\u7684OpenAPI\u6587\u6863\u4e2d\u8bb0\u5f55\u54cd\u5e94\u683c\u5f0f\u3002</p>"},{"location":"advanced/custom-response/#orjsonresponse","title":"\u4f7f\u7528 <code>ORJSONResponse</code>","text":"<p>\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u9700\u8981\u538b\u69a8\u6027\u80fd\uff0c\u4f60\u53ef\u4ee5\u5b89\u88c5\u5e76\u4f7f\u7528 <code>orjson</code> \u5e76\u5c06\u54cd\u5e94\u8bbe\u7f6e\u4e3a <code>ORJSONResponse</code>\u3002</p> <p>\u5bfc\u5165\u4f60\u60f3\u8981\u4f7f\u7528\u7684 <code>Response</code> \u7c7b\uff08\u5b50\u7c7b\uff09\u7136\u540e\u5728 \u8def\u5f84\u64cd\u4f5c\u88c5\u9970\u5668 \u4e2d\u58f0\u660e\u5b83\u3002</p> <pre><code>from fastapi import FastAPI\nfrom fastapi.responses import ORJSONResponse\napp = FastAPI()\n\n\n@app.get(\"/items/\", response_class=ORJSONResponse)\nasync def read_items():\n    return ORJSONResponse([{\"item_id\": \"Foo\"}])\n</code></pre> <p>\u63d0\u793a</p> <p>\u53c2\u6570 <code>response_class</code> \u4e5f\u4f1a\u7528\u6765\u5b9a\u4e49\u54cd\u5e94\u7684\u300c\u5a92\u4f53\u7c7b\u578b\u300d\u3002</p> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0cHTTP \u5934\u7684 <code>Content-Type</code> \u4f1a\u88ab\u8bbe\u7f6e\u6210 <code>application/json</code>\u3002</p> <p>\u5e76\u4e14\u5728 OpenAPI \u6587\u6863\u4e2d\u4e5f\u4f1a\u8fd9\u6837\u8bb0\u5f55\u3002</p> <p>\u5c0f\u8d34\u58eb</p> <p><code>ORJSONResponse</code> \u76ee\u524d\u53ea\u5728 FastAPI \u4e2d\u53ef\u7528\uff0c\u800c\u5728 Starlette \u4e2d\u4e0d\u53ef\u7528\u3002</p>"},{"location":"advanced/custom-response/#html","title":"HTML \u54cd\u5e94","text":"<p>\u4f7f\u7528 <code>HTMLResponse</code> \u6765\u4ece FastAPI \u4e2d\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a HTML \u54cd\u5e94\u3002</p> <ul> <li>\u5bfc\u5165 <code>HTMLResponse</code>\u3002</li> <li>\u5c06 <code>HTMLResponse</code> \u4f5c\u4e3a\u4f60\u7684 \u8def\u5f84\u64cd\u4f5c \u7684 <code>response_class</code> \u53c2\u6570\u4f20\u5165\u3002</li> </ul> <pre><code>from fastapi import FastAPI\nfrom fastapi.responses import HTMLResponse\napp = FastAPI()\n\n\n@app.get(\"/items/\", response_class=HTMLResponse)\nasync def read_items():\n    return \"\"\"\n    &lt;html&gt;\n        &lt;head&gt;\n            &lt;title&gt;Some HTML in here&lt;/title&gt;\n        &lt;/head&gt;\n        &lt;body&gt;\n            &lt;h1&gt;Look ma! HTML!&lt;/h1&gt;\n        &lt;/body&gt;\n    &lt;/html&gt;\n    \"\"\"\n</code></pre> <p>\u63d0\u793a</p> <p>\u53c2\u6570 <code>response_class</code> \u4e5f\u4f1a\u7528\u6765\u5b9a\u4e49\u54cd\u5e94\u7684\u300c\u5a92\u4f53\u7c7b\u578b\u300d\u3002</p> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0cHTTP \u5934\u7684 <code>Content-Type</code> \u4f1a\u88ab\u8bbe\u7f6e\u6210 <code>text/html</code>\u3002</p> <p>\u5e76\u4e14\u5728 OpenAPI \u6587\u6863\u4e2d\u4e5f\u4f1a\u8fd9\u6837\u8bb0\u5f55\u3002</p>"},{"location":"advanced/custom-response/#response","title":"\u8fd4\u56de\u4e00\u4e2a <code>Response</code>","text":"<p>\u6b63\u5982\u4f60\u5728 \u76f4\u63a5\u8fd4\u56de\u54cd\u5e94 \u4e2d\u4e86\u89e3\u5230\u7684\uff0c\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7\u76f4\u63a5\u8fd4\u56de\u54cd\u5e94\u5728 \u8def\u5f84\u64cd\u4f5c \u4e2d\u76f4\u63a5\u91cd\u8f7d\u54cd\u5e94\u3002</p> <p>\u548c\u4e0a\u9762\u4e00\u6837\u7684\u4f8b\u5b50\uff0c\u8fd4\u56de\u4e00\u4e2a <code>HTMLResponse</code> \u770b\u8d77\u6765\u53ef\u80fd\u662f\u8fd9\u6837\uff1a</p> <pre><code>from fastapi import FastAPI\nfrom fastapi.responses import HTMLResponse\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items():\n    html_content = \"\"\"\n    &lt;html&gt;\n        &lt;head&gt;\n            &lt;title&gt;Some HTML in here&lt;/title&gt;\n        &lt;/head&gt;\n        &lt;body&gt;\n            &lt;h1&gt;Look ma! HTML!&lt;/h1&gt;\n        &lt;/body&gt;\n    &lt;/html&gt;\n    \"\"\"\nreturn HTMLResponse(content=html_content, status_code=200)\n</code></pre> <p>\u8b66\u544a</p> <p>\u8def\u5f84\u64cd\u4f5c\u51fd\u6570 \u76f4\u63a5\u8fd4\u56de\u7684 <code>Response</code> \u4e0d\u4f1a\u88ab OpenAPI \u7684\u6587\u6863\u8bb0\u5f55\uff08\u6bd4\u5982\uff0c<code>Content-Type</code> \u4e0d\u4f1a\u88ab\u6587\u6863\u8bb0\u5f55\uff09\uff0c\u5e76\u4e14\u5728\u81ea\u52a8\u5316\u4ea4\u4e92\u6587\u6863\u4e2d\u4e5f\u662f\u4e0d\u53ef\u89c1\u7684\u3002</p> <p>\u63d0\u793a</p> <p>\u5f53\u7136\uff0c\u5b9e\u9645\u7684 <code>Content-Type</code> \u5934\uff0c\u72b6\u6001\u7801\u7b49\u7b49\uff0c\u5c06\u6765\u81ea\u4e8e\u4f60\u8fd4\u56de\u7684 <code>Response</code> \u5bf9\u8c61\u3002</p>"},{"location":"advanced/custom-response/#openapi-response","title":"OpenAPI \u4e2d\u7684\u6587\u6863\u548c\u91cd\u8f7d <code>Response</code>","text":"<p>\u5982\u679c\u4f60\u60f3\u8981\u5728\u51fd\u6570\u5185\u91cd\u8f7d\u54cd\u5e94\uff0c\u4f46\u662f\u540c\u65f6\u5728 OpenAPI \u4e2d\u6587\u6863\u5316\u300c\u5a92\u4f53\u7c7b\u578b\u300d\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 <code>response_class</code> \u53c2\u6570\u5e76\u8fd4\u56de\u4e00\u4e2a <code>Response</code> \u5bf9\u8c61\u3002</p> <p>\u63a5\u7740 <code>response_class</code> \u53c2\u6570\u53ea\u4f1a\u88ab\u7528\u6765\u6587\u6863\u5316 OpenAPI \u7684 \u8def\u5f84\u64cd\u4f5c\uff0c\u4f60\u7684 <code>Response</code> \u7528\u6765\u8fd4\u56de\u54cd\u5e94\u3002</p>"},{"location":"advanced/custom-response/#htmlresponse","title":"\u76f4\u63a5\u8fd4\u56de <code>HTMLResponse</code>","text":"<p>\u6bd4\u5982\u50cf\u8fd9\u6837\uff1a</p> <pre><code>from fastapi import FastAPI\nfrom fastapi.responses import HTMLResponse\n\napp = FastAPI()\n\n\ndef generate_html_response():\nhtml_content = \"\"\"\n    &lt;html&gt;\n        &lt;head&gt;\n            &lt;title&gt;Some HTML in here&lt;/title&gt;\n        &lt;/head&gt;\n        &lt;body&gt;\n            &lt;h1&gt;Look ma! HTML!&lt;/h1&gt;\n        &lt;/body&gt;\n    &lt;/html&gt;\n    \"\"\"\n    return HTMLResponse(content=html_content, status_code=200)\n\n\n@app.get(\"/items/\", response_class=HTMLResponse)\nasync def read_items():\nreturn generate_html_response()\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u51fd\u6570 <code>generate_html_response()</code> \u5df2\u7ecf\u751f\u6210\u5e76\u8fd4\u56de <code>Response</code> \u5bf9\u8c61\u800c\u4e0d\u662f\u5728 <code>str</code> \u4e2d\u8fd4\u56de HTML\u3002</p> <p>\u901a\u8fc7\u8fd4\u56de\u51fd\u6570 <code>generate_html_response()</code> \u7684\u8c03\u7528\u7ed3\u679c\uff0c\u4f60\u5df2\u7ecf\u8fd4\u56de\u4e00\u4e2a\u91cd\u8f7d FastAPI \u9ed8\u8ba4\u884c\u4e3a\u7684 <code>Response</code> \u5bf9\u8c61\uff0c</p> <p>\u4f46\u5982\u679c\u4f60\u5728 <code>response_class</code> \u4e2d\u4e5f\u4f20\u5165\u4e86 <code>HTMLResponse</code>\uff0cFastAPI \u4f1a\u77e5\u9053\u5982\u4f55\u5728 OpenAPI \u548c\u4ea4\u4e92\u5f0f\u6587\u6863\u4e2d\u4f7f\u7528 <code>text/html</code> \u5c06\u5176\u6587\u6863\u5316\u4e3a HTML\u3002</p> <p></p>"},{"location":"advanced/custom-response/#_1","title":"\u53ef\u7528\u54cd\u5e94","text":"<p>\u8fd9\u91cc\u6709\u4e00\u4e9b\u53ef\u7528\u7684\u54cd\u5e94\u3002</p> <p>\u8981\u8bb0\u5f97\u4f60\u53ef\u4ee5\u4f7f\u7528 <code>Response</code> \u6765\u8fd4\u56de\u4efb\u4f55\u5176\u4ed6\u4e1c\u897f\uff0c\u751a\u81f3\u521b\u5efa\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684\u5b50\u7c7b\u3002</p> <p>\u6280\u672f\u7ec6\u8282</p> <p>\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 <code>from starlette.responses import HTMLResponse</code>\u3002</p> <p>FastAPI \u63d0\u4f9b\u4e86\u540c <code>fastapi.responses</code> \u76f8\u540c\u7684 <code>starlette.responses</code> \u53ea\u662f\u4e3a\u4e86\u65b9\u4fbf\u5f00\u53d1\u8005\u3002\u4f46\u5927\u591a\u6570\u53ef\u7528\u7684\u54cd\u5e94\u90fd\u76f4\u63a5\u6765\u81ea Starlette\u3002</p>"},{"location":"advanced/custom-response/#response_1","title":"<code>Response</code>","text":"<p>\u5176\u4ed6\u5168\u90e8\u7684\u54cd\u5e94\u90fd\u7ee7\u627f\u81ea\u4e3b\u7c7b <code>Response</code>\u3002</p> <p>\u4f60\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56de\u5b83\u3002</p> <p><code>Response</code> \u7c7b\u63a5\u53d7\u5982\u4e0b\u53c2\u6570\uff1a</p> <ul> <li><code>content</code> - \u4e00\u4e2a <code>str</code> \u6216\u8005 <code>bytes</code>\u3002</li> <li><code>status_code</code> - \u4e00\u4e2a <code>int</code> \u7c7b\u578b\u7684 HTTP \u72b6\u6001\u7801\u3002</li> <li><code>headers</code> - \u4e00\u4e2a\u7531\u5b57\u7b26\u4e32\u7ec4\u6210\u7684 <code>dict</code>\u3002</li> <li><code>media_type</code> - \u4e00\u4e2a\u7ed9\u51fa\u5a92\u4f53\u7c7b\u578b\u7684 <code>str</code>\uff0c\u6bd4\u5982 <code>\"text/html\"</code>\u3002</li> </ul> <p>FastAPI\uff08\u5b9e\u9645\u4e0a\u662f Starlette\uff09\u5c06\u81ea\u52a8\u5305\u542b Content-Length \u7684\u5934\u3002\u5b83\u8fd8\u5c06\u5305\u542b\u4e00\u4e2a\u57fa\u4e8e media_type \u7684 Content-Type \u5934\uff0c\u5e76\u4e3a\u6587\u672c\u7c7b\u578b\u9644\u52a0\u4e00\u4e2a\u5b57\u7b26\u96c6\u3002</p> <pre><code>from fastapi import FastAPI, Response\napp = FastAPI()\n\n\n@app.get(\"/legacy/\")\ndef get_legacy_data():\n    data = \"\"\"&lt;?xml version=\"1.0\"?&gt;\n    &lt;shampoo&gt;\n    &lt;Header&gt;\n        Apply shampoo here.\n    &lt;/Header&gt;\n    &lt;Body&gt;\n        You'll have to use soap here.\n    &lt;/Body&gt;\n    &lt;/shampoo&gt;\n    \"\"\"\nreturn Response(content=data, media_type=\"application/xml\")\n</code></pre>"},{"location":"advanced/custom-response/#htmlresponse_1","title":"<code>HTMLResponse</code>","text":"<p>\u5982\u4e0a\u6587\u6240\u8ff0\uff0c\u63a5\u53d7\u6587\u672c\u6216\u5b57\u8282\u5e76\u8fd4\u56de HTML \u54cd\u5e94\u3002</p>"},{"location":"advanced/custom-response/#plaintextresponse","title":"<code>PlainTextResponse</code>","text":"<p>\u63a5\u53d7\u6587\u672c\u6216\u5b57\u8282\u5e76\u8fd4\u56de\u7eaf\u6587\u672c\u54cd\u5e94\u3002</p> <pre><code>from fastapi import FastAPI\nfrom fastapi.responses import PlainTextResponse\napp = FastAPI()\n\n\n@app.get(\"/\", response_class=PlainTextResponse)\nasync def main():\nreturn \"Hello World\"\n</code></pre>"},{"location":"advanced/custom-response/#jsonresponse","title":"<code>JSONResponse</code>","text":"<p>\u63a5\u53d7\u6570\u636e\u5e76\u8fd4\u56de\u4e00\u4e2a <code>application/json</code> \u7f16\u7801\u7684\u54cd\u5e94\u3002</p> <p>\u5982\u4e0a\u6587\u6240\u8ff0\uff0c\u8fd9\u662f FastAPI \u4e2d\u4f7f\u7528\u7684\u9ed8\u8ba4\u54cd\u5e94\u3002</p>"},{"location":"advanced/custom-response/#orjsonresponse_1","title":"<code>ORJSONResponse</code>","text":"<p>\u5982\u4e0a\u6587\u6240\u8ff0\uff0c<code>ORJSONResponse</code> \u662f\u4e00\u4e2a\u4f7f\u7528 <code>orjson</code> \u7684\u5feb\u901f\u7684\u53ef\u9009 JSON \u54cd\u5e94\u3002</p>"},{"location":"advanced/custom-response/#ujsonresponse","title":"<code>UJSONResponse</code>","text":"<p><code>UJSONResponse</code> \u662f\u4e00\u4e2a\u4f7f\u7528 <code>ujson</code> \u7684\u53ef\u9009 JSON \u54cd\u5e94\u3002</p> <p>\u8b66\u544a</p> <p>\u5728\u5904\u7406\u67d0\u4e9b\u8fb9\u7f18\u60c5\u51b5\u65f6\uff0c<code>ujson</code> \u4e0d\u5982 Python \u7684\u5185\u7f6e\u5b9e\u73b0\u90a3\u4e48\u8c28\u614e\u3002</p> <pre><code>from fastapi import FastAPI\nfrom fastapi.responses import UJSONResponse\napp = FastAPI()\n\n\n@app.get(\"/items/\", response_class=UJSONResponse)\nasync def read_items():\n    return [{\"item_id\": \"Foo\"}]\n</code></pre> <p>\u5c0f\u8d34\u58eb</p> <p><code>ORJSONResponse</code> \u53ef\u80fd\u662f\u4e00\u4e2a\u66f4\u5feb\u7684\u9009\u62e9\u3002</p>"},{"location":"advanced/custom-response/#redirectresponse","title":"<code>RedirectResponse</code>","text":"<p>\u8fd4\u56de HTTP \u91cd\u5b9a\u5411\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f7f\u7528 307 \u72b6\u6001\u4ee3\u7801\uff08\u4e34\u65f6\u91cd\u5b9a\u5411\uff09\u3002</p> <pre><code>from fastapi import FastAPI\nfrom fastapi.responses import RedirectResponse\napp = FastAPI()\n\n\n@app.get(\"/typer\")\nasync def redirect_typer():\nreturn RedirectResponse(\"https://typer.tiangolo.com\")\n</code></pre>"},{"location":"advanced/custom-response/#streamingresponse","title":"<code>StreamingResponse</code>","text":"<p>\u91c7\u7528\u5f02\u6b65\u751f\u6210\u5668\u6216\u666e\u901a\u751f\u6210\u5668/\u8fed\u4ee3\u5668\uff0c\u7136\u540e\u6d41\u5f0f\u4f20\u8f93\u54cd\u5e94\u4e3b\u4f53\u3002</p> <pre><code>from fastapi import FastAPI\nfrom fastapi.responses import StreamingResponse\napp = FastAPI()\n\n\nasync def fake_video_streamer():\n    for i in range(10):\n        yield b\"some fake video bytes\"\n\n\n@app.get(\"/\")\nasync def main():\nreturn StreamingResponse(fake_video_streamer())\n</code></pre>"},{"location":"advanced/custom-response/#streamingresponse_1","title":"\u5bf9\u7c7b\u4f3c\u6587\u4ef6\u7684\u5bf9\u8c61\u4f7f\u7528 <code>StreamingResponse</code>","text":"<p>\u5982\u679c\u60a8\u6709\u7c7b\u4f3c\u6587\u4ef6\u7684\u5bf9\u8c61\uff08\u4f8b\u5982\uff0c\u7531 <code>open()</code> \u8fd4\u56de\u7684\u5bf9\u8c61\uff09\uff0c\u5219\u53ef\u4ee5\u5728 <code>StreamingResponse</code> \u4e2d\u5c06\u5176\u8fd4\u56de\u3002</p> <p>\u5305\u62ec\u8bb8\u591a\u4e0e\u4e91\u5b58\u50a8\uff0c\u89c6\u9891\u5904\u7406\u7b49\u4ea4\u4e92\u7684\u5e93\u3002</p> <pre><code>from fastapi import FastAPI\nfrom fastapi.responses import StreamingResponse\nsome_file_path = \"large-video-file.mp4\"\napp = FastAPI()\n\n\n@app.get(\"/\")\ndef main():\ndef iterfile():  # (1)\nwith open(some_file_path, mode=\"rb\") as file_like:  # (2)\nyield from file_like  # (3)\nreturn StreamingResponse(iterfile(), media_type=\"video/mp4\")\n</code></pre> <p>\u5c0f\u8d34\u58eb</p> <p>\u6ce8\u610f\u5728\u8fd9\u91cc\uff0c\u56e0\u4e3a\u6211\u4eec\u4f7f\u7528\u7684\u662f\u4e0d\u652f\u6301 <code>async</code> \u548c <code>await</code> \u7684\u6807\u51c6 <code>open()</code>\uff0c\u6211\u4eec\u4f7f\u7528\u666e\u901a\u7684 <code>def</code> \u58f0\u660e\u4e86\u8def\u5f84\u64cd\u4f5c\u3002</p>"},{"location":"advanced/custom-response/#fileresponse","title":"<code>FileResponse</code>","text":"<p>\u5f02\u6b65\u4f20\u8f93\u6587\u4ef6\u4f5c\u4e3a\u54cd\u5e94\u3002</p> <p>\u4e0e\u5176\u4ed6\u54cd\u5e94\u7c7b\u578b\u76f8\u6bd4\uff0c\u63a5\u53d7\u4e0d\u540c\u7684\u53c2\u6570\u96c6\u8fdb\u884c\u5b9e\u4f8b\u5316\uff1a</p> <ul> <li><code>path</code> - \u8981\u6d41\u5f0f\u4f20\u8f93\u7684\u6587\u4ef6\u7684\u6587\u4ef6\u8def\u5f84\u3002</li> <li><code>headers</code> - \u4efb\u4f55\u81ea\u5b9a\u4e49\u54cd\u5e94\u5934\uff0c\u4f20\u5165\u5b57\u5178\u7c7b\u578b\u3002</li> <li><code>media_type</code> - \u7ed9\u51fa\u5a92\u4f53\u7c7b\u578b\u7684\u5b57\u7b26\u4e32\u3002\u5982\u679c\u672a\u8bbe\u7f6e\uff0c\u5219\u6587\u4ef6\u540d\u6216\u8def\u5f84\u5c06\u7528\u4e8e\u63a8\u65ad\u5a92\u4f53\u7c7b\u578b\u3002</li> <li><code>filename</code> - \u5982\u679c\u7ed9\u51fa\uff0c\u5b83\u5c06\u5305\u542b\u5728\u54cd\u5e94\u7684 <code>Content-Disposition</code> \u4e2d\u3002</li> </ul> <p>\u6587\u4ef6\u54cd\u5e94\u5c06\u5305\u542b\u9002\u5f53\u7684 <code>Content-Length</code>\uff0c<code>Last-Modified</code> \u548c <code>ETag</code> \u7684\u54cd\u5e94\u5934\u3002</p> <pre><code>from fastapi import FastAPI\nfrom fastapi.responses import FileResponse\nsome_file_path = \"large-video-file.mp4\"\napp = FastAPI()\n\n\n@app.get(\"/\")\nasync def main():\nreturn FileResponse(some_file_path)\n</code></pre>"},{"location":"advanced/custom-response/#_2","title":"\u989d\u5916\u6587\u6863","text":"<p>\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528 <code>response</code> \u5728 OpenAPI \u4e2d\u58f0\u660e\u5a92\u4f53\u7c7b\u578b\u548c\u8bb8\u591a\u5176\u4ed6\u8be6\u7ec6\u4fe1\u606f\uff1aOpenAPI \u4e2d\u7684\u989d\u5916\u6587\u6863\u3002</p>"},{"location":"advanced/path-operation-advanced-configuration/","title":"\u8def\u5f84\u64cd\u4f5c\u7684\u9ad8\u7ea7\u914d\u7f6e","text":""},{"location":"advanced/path-operation-advanced-configuration/#openapi-operationid","title":"OpenAPI \u7684 operationId","text":"<p>Warning</p> <p>\u5982\u679c\u4f60\u5e76\u975e OpenAPI \u7684\u300c\u4e13\u5bb6\u300d\uff0c\u4f60\u53ef\u80fd\u4e0d\u9700\u8981\u8fd9\u90e8\u5206\u5185\u5bb9\u3002</p> <p>\u4f60\u53ef\u4ee5\u5728\u8def\u5f84\u64cd\u4f5c\u4e2d\u901a\u8fc7\u53c2\u6570 <code>operation_id</code> \u8bbe\u7f6e\u8981\u4f7f\u7528\u7684 OpenAPI <code>operationId</code>\u3002</p> <p>\u52a1\u5fc5\u786e\u4fdd\u6bcf\u4e2a\u64cd\u4f5c\u8def\u5f84\u7684 <code>operation_id</code> \u90fd\u662f\u552f\u4e00\u7684\u3002</p> <pre><code>from fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/items/\", operation_id=\"some_specific_id_you_define\")\nasync def read_items():\n    return [{\"item_id\": \"Foo\"}]\n</code></pre>"},{"location":"advanced/path-operation-advanced-configuration/#operationid","title":"\u4f7f\u7528 \u8def\u5f84\u64cd\u4f5c\u51fd\u6570 \u7684\u51fd\u6570\u540d\u4f5c\u4e3a operationId","text":"<p>\u5982\u679c\u4f60\u60f3\u7528\u4f60\u7684 API \u7684\u51fd\u6570\u540d\u4f5c\u4e3a <code>operationId</code> \u7684\u540d\u5b57\uff0c\u4f60\u53ef\u4ee5\u904d\u5386\u4e00\u904d API \u7684\u51fd\u6570\u540d\uff0c\u7136\u540e\u4f7f\u7528\u4ed6\u4eec\u7684 <code>APIRoute.name</code> \u91cd\u5199\u6bcf\u4e2a \u8def\u5f84\u64cd\u4f5c \u7684 <code>operation_id</code>\u3002</p> <p>\u4f60\u5e94\u8be5\u5728\u6dfb\u52a0\u4e86\u6240\u6709 \u8def\u5f84\u64cd\u4f5c \u4e4b\u540e\u6267\u884c\u6b64\u64cd\u4f5c\u3002</p> <pre><code>from fastapi import FastAPI\nfrom fastapi.routing import APIRoute\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items():\n    return [{\"item_id\": \"Foo\"}]\n\n\ndef use_route_names_as_operation_ids(app: FastAPI) -&gt; None:\n\"\"\"\n    Simplify operation IDs so that generated API clients have simpler function\n    names.\n    Should be called only after all routes have been added.\n    \"\"\"\nfor route in app.routes:\nif isinstance(route, APIRoute):\nroute.operation_id = route.name  # in this case, 'read_items'\nuse_route_names_as_operation_ids(app)\n</code></pre> <p>Tip</p> <p>\u5982\u679c\u4f60\u624b\u52a8\u8c03\u7528 <code>app.openapi()</code>\uff0c\u4f60\u5e94\u8be5\u5728\u6b64\u4e4b\u524d\u66f4\u65b0 <code>operationId</code>\u3002</p> <p>Warning</p> <p>\u5982\u679c\u4f60\u8fd9\u6837\u505a\uff0c\u52a1\u5fc5\u786e\u4fdd\u4f60\u7684\u6bcf\u4e2a \u8def\u5f84\u64cd\u4f5c\u51fd\u6570 \u7684\u540d\u5b57\u552f\u4e00\u3002</p> <p>\u5373\u4f7f\u5b83\u4eec\u5728\u4e0d\u540c\u7684\u6a21\u5757\u4e2d\uff08Python \u6587\u4ef6\uff09\u3002</p>"},{"location":"advanced/path-operation-advanced-configuration/#openapi","title":"\u4ece OpenAPI \u4e2d\u6392\u9664","text":"<p>\u4f7f\u7528\u53c2\u6570 <code>include_in_schema</code> \u5e76\u5c06\u5176\u8bbe\u7f6e\u4e3a <code>False</code> \uff0c\u6765\u4ece\u751f\u6210\u7684 OpenAPI \u65b9\u6848\u4e2d\u6392\u9664\u4e00\u4e2a \u8def\u5f84\u64cd\u4f5c\uff08\u8fd9\u6837\u4e00\u6765\uff0c\u5c31\u4ece\u81ea\u52a8\u5316\u6587\u6863\u7cfb\u7edf\u4e2d\u6392\u9664\u6389\u4e86\uff09\u3002</p> <pre><code>from fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/items/\", include_in_schema=False)\nasync def read_items():\n    return [{\"item_id\": \"Foo\"}]\n</code></pre>"},{"location":"advanced/path-operation-advanced-configuration/#docstring","title":"docstring \u7684\u9ad8\u7ea7\u63cf\u8ff0","text":"<p>\u4f60\u53ef\u4ee5\u9650\u5236 \u8def\u5f84\u64cd\u4f5c\u51fd\u6570 \u7684 <code>docstring</code> \u4e2d\u7528\u4e8e OpenAPI \u7684\u884c\u6570\u3002</p> <p>\u6dfb\u52a0\u4e00\u4e2a <code>\\f</code> \uff08\u4e00\u4e2a\u300c\u6362\u9875\u300d\u7684\u8f6c\u4e49\u5b57\u7b26\uff09\u53ef\u4ee5\u4f7f FastAPI \u5728\u90a3\u4e00\u4f4d\u7f6e\u622a\u65ad\u7528\u4e8e OpenAPI \u7684\u8f93\u51fa\u3002</p> <p>\u5269\u4f59\u90e8\u5206\u4e0d\u4f1a\u51fa\u73b0\u5728\u6587\u6863\u4e2d\uff0c\u4f46\u662f\u5176\u4ed6\u5de5\u5177\uff08\u6bd4\u5982 Sphinx\uff09\u53ef\u4ee5\u4f7f\u7528\u5269\u4f59\u90e8\u5206\u3002</p> <pre><code>from typing import Set, Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n    tags: Set[str] = set()\n\n\n@app.post(\"/items/\", response_model=Item, summary=\"Create an item\")\nasync def create_item(item: Item):\n\"\"\"\n    Create an item with all the information:\n    - **name**: each item must have a name\n    - **description**: a long description\n    - **price**: required\n    - **tax**: if the item doesn't have tax, you can omit this\n    - **tags**: a set of unique tag strings for this item\n    \\f\n    :param item: User input.\n    \"\"\"\nreturn item\n</code></pre>"},{"location":"advanced/response-cookies/","title":"\u54cd\u5e94Cookies","text":""},{"location":"advanced/response-cookies/#response","title":"\u4f7f\u7528 <code>Response</code> \u53c2\u6570","text":"<p>\u4f60\u53ef\u4ee5\u5728 \u8def\u5f84\u51fd\u6570 \u4e2d\u5b9a\u4e49\u4e00\u4e2a\u7c7b\u578b\u4e3a <code>Response</code>\u7684\u53c2\u6570\uff0c\u8fd9\u6837\u4f60\u5c31\u53ef\u4ee5\u5728\u8fd9\u4e2a\u4e34\u65f6\u54cd\u5e94\u5bf9\u8c61\u4e2d\u8bbe\u7f6ecookie\u4e86\u3002</p> <pre><code>from fastapi import FastAPI, Response\napp = FastAPI()\n\n\n@app.post(\"/cookie-and-object/\")\ndef create_cookie(response: Response):\nresponse.set_cookie(key=\"fakesession\", value=\"fake-cookie-session-value\")\nreturn {\"message\": \"Come to the dark side, we have cookies\"}\n</code></pre> <p>\u800c\u4e14\u4f60\u8fd8\u53ef\u4ee5\u6839\u636e\u4f60\u7684\u9700\u8981\u54cd\u5e94\u4e0d\u540c\u7684\u5bf9\u8c61\uff0c\u6bd4\u5982\u5e38\u7528\u7684 <code>dict</code>\uff0c\u6570\u636e\u5e93model\u7b49\u3002</p> <p>\u5982\u679c\u4f60\u5b9a\u4e49\u4e86 <code>response_model</code>\uff0c\u7a0b\u5e8f\u4f1a\u81ea\u52a8\u6839\u636e<code>response_model</code>\u6765\u8fc7\u6ee4\u548c\u8f6c\u6362\u4f60\u54cd\u5e94\u7684\u5bf9\u8c61\u3002</p> <p>FastAPI \u4f1a\u4f7f\u7528\u8fd9\u4e2a \u4e34\u65f6 \u54cd\u5e94\u5bf9\u8c61\u53bb\u88c5\u5728\u8fd9\u4e9bcookies\u4fe1\u606f (\u540c\u6837\u8fd8\u6709headers\u548c\u72b6\u6001\u7801\u7b49\u4fe1\u606f), \u6700\u7ec8\u4f1a\u5c06\u8fd9\u4e9b\u4fe1\u606f\u548c\u901a\u8fc7<code>response_model</code>\u8f6c\u5316\u8fc7\u7684\u6570\u636e\u5408\u5e76\u5230\u6700\u7ec8\u7684\u54cd\u5e94\u91cc\u3002</p> <p>\u4f60\u4e5f\u53ef\u4ee5\u5728depend\u4e2d\u5b9a\u4e49<code>Response</code>\u53c2\u6570\uff0c\u5e76\u8bbe\u7f6ecookie\u548cheader\u3002</p>"},{"location":"advanced/response-cookies/#response_1","title":"\u76f4\u63a5\u54cd\u5e94 <code>Response</code>","text":"<p>\u4f60\u8fd8\u53ef\u4ee5\u5728\u76f4\u63a5\u54cd\u5e94<code>Response</code>\u65f6\u76f4\u63a5\u521b\u5efacookies\u3002</p> <p>\u4f60\u53ef\u4ee5\u53c2\u8003Return a Response Directly\u6765\u521b\u5efaresponse</p> <p>\u7136\u540e\u8bbe\u7f6eCookies\uff0c\u5e76\u8fd4\u56de\uff1a</p> <pre><code>from fastapi import FastAPI\nfrom fastapi.responses import JSONResponse\n\napp = FastAPI()\n\n\n@app.post(\"/cookie/\")\ndef create_cookie():\n    content = {\"message\": \"Come to the dark side, we have cookies\"}\nresponse = JSONResponse(content=content)\nresponse.set_cookie(key=\"fakesession\", value=\"fake-cookie-session-value\")\nreturn response\n</code></pre> <p>Tip</p> <p>\u9700\u8981\u6ce8\u610f\uff0c\u5982\u679c\u4f60\u76f4\u63a5\u53cd\u9988\u4e00\u4e2aresponse\u5bf9\u8c61\uff0c\u800c\u4e0d\u662f\u4f7f\u7528<code>Response</code>\u5165\u53c2\uff0cFastAPI\u5219\u4f1a\u76f4\u63a5\u53cd\u9988\u4f60\u5c01\u88c5\u7684response\u5bf9\u8c61\u3002</p> <p>\u6240\u4ee5\u4f60\u9700\u8981\u786e\u4fdd\u4f60\u54cd\u5e94\u6570\u636e\u7c7b\u578b\u7684\u6b63\u786e\u6027\uff0c\u5982\uff1a\u4f60\u53ef\u4ee5\u4f7f\u7528<code>JSONResponse</code>\u6765\u517c\u5bb9JSON\u7684\u573a\u666f\u3002</p> <p>\u540c\u65f6\uff0c\u4f60\u4e5f\u5e94\u5f53\u4ec5\u53cd\u9988\u901a\u8fc7<code>response_model</code>\u8fc7\u6ee4\u8fc7\u7684\u6570\u636e\u3002</p>"},{"location":"advanced/response-cookies/#_1","title":"\u66f4\u591a\u4fe1\u606f","text":"<p>\u6280\u672f\u7ec6\u8282</p> <p>\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528<code>from starlette.responses import Response</code> \u6216\u8005 <code>from starlette.responses import JSONResponse</code>\u3002</p> <p>\u4e3a\u4e86\u65b9\u4fbf\u5f00\u53d1\u8005\uff0cFastAPI \u5c01\u88c5\u4e86\u76f8\u540c\u6570\u636e\u7c7b\u578b\uff0c\u5982<code>starlette.responses</code> \u548c <code>fastapi.responses</code>\u3002\u4e0d\u8fc7\u5927\u90e8\u5206response\u5bf9\u8c61\u90fd\u662f\u76f4\u63a5\u5f15\u7528\u81eaStarlette\u3002</p> <p>\u56e0\u4e3a<code>Response</code>\u5bf9\u8c61\u53ef\u4ee5\u975e\u5e38\u4fbf\u6377\u7684\u8bbe\u7f6eheaders\u548ccookies\uff0c\u6240\u4ee5 FastAPI \u540c\u65f6\u4e5f\u5c01\u88c5\u4e86<code>fastapi.Response</code>\u3002</p> <p>\u5982\u679c\u4f60\u60f3\u67e5\u770b\u6240\u6709\u53ef\u7528\u7684\u53c2\u6570\u548c\u9009\u9879\uff0c\u53ef\u4ee5\u53c2\u8003 Starlette\u5e2e\u52a9\u6587\u6863</p>"},{"location":"advanced/response-directly/","title":"\u76f4\u63a5\u8fd4\u56de\u54cd\u5e94","text":"<p>\u5f53\u4f60\u521b\u5efa\u4e00\u4e2a FastAPI \u8def\u5f84\u64cd\u4f5c \u65f6\uff0c\u4f60\u53ef\u4ee5\u6b63\u5e38\u8fd4\u56de\u4ee5\u4e0b\u4efb\u610f\u4e00\u79cd\u6570\u636e\uff1a<code>dict</code>\uff0c<code>list</code>\uff0cPydantic \u6a21\u578b\uff0c\u6570\u636e\u5e93\u6a21\u578b\u7b49\u7b49\u3002</p> <p>FastAPI \u9ed8\u8ba4\u4f1a\u4f7f\u7528 <code>jsonable_encoder</code> \u5c06\u8fd9\u4e9b\u7c7b\u578b\u7684\u8fd4\u56de\u503c\u8f6c\u6362\u6210 JSON \u683c\u5f0f\uff0c<code>jsonable_encoder</code> \u5728 JSON \u517c\u5bb9\u7f16\u7801\u5668 \u4e2d\u6709\u9610\u8ff0\u3002</p> <p>\u7136\u540e\uff0cFastAPI \u4f1a\u5728\u540e\u53f0\u5c06\u8fd9\u4e9b\u517c\u5bb9 JSON \u7684\u6570\u636e\uff08\u6bd4\u5982\u5b57\u5178\uff09\u653e\u5230\u4e00\u4e2a <code>JSONResponse</code> \u4e2d\uff0c\u8be5 <code>JSONResponse</code> \u4f1a\u7528\u6765\u53d1\u9001\u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef\u3002</p> <p>\u4f46\u662f\u4f60\u53ef\u4ee5\u5728\u4f60\u7684 \u8def\u5f84\u64cd\u4f5c \u4e2d\u76f4\u63a5\u8fd4\u56de\u4e00\u4e2a <code>JSONResponse</code>\u3002</p> <p>\u76f4\u63a5\u8fd4\u56de\u54cd\u5e94\u53ef\u80fd\u4f1a\u6709\u7528\u5904\uff0c\u6bd4\u5982\u8fd4\u56de\u81ea\u5b9a\u4e49\u7684\u54cd\u5e94\u5934\u548c cookies\u3002</p>"},{"location":"advanced/response-directly/#response","title":"\u8fd4\u56de <code>Response</code>","text":"<p>\u4e8b\u5b9e\u4e0a\uff0c\u4f60\u53ef\u4ee5\u8fd4\u56de\u4efb\u610f <code>Response</code> \u6216\u8005\u4efb\u610f <code>Response</code> \u7684\u5b50\u7c7b\u3002</p> <p>\u5c0f\u8d34\u58eb</p> <p><code>JSONResponse</code> \u672c\u8eab\u662f\u4e00\u4e2a <code>Response</code> \u7684\u5b50\u7c7b\u3002</p> <p>\u5f53\u4f60\u8fd4\u56de\u4e00\u4e2a <code>Response</code> \u65f6\uff0cFastAPI \u4f1a\u76f4\u63a5\u4f20\u9012\u5b83\u3002</p> <p>FastAPI \u4e0d\u4f1a\u7528 Pydantic \u6a21\u578b\u505a\u4efb\u4f55\u6570\u636e\u8f6c\u6362\uff0c\u4e0d\u4f1a\u5c06\u54cd\u5e94\u5185\u5bb9\u8f6c\u6362\u6210\u4efb\u4f55\u7c7b\u578b\uff0c\u7b49\u7b49\u3002</p> <p>\u8fd9\u79cd\u7279\u6027\u7ed9\u4f60\u6781\u5927\u7684\u53ef\u6269\u5c55\u6027\u3002\u4f60\u53ef\u4ee5\u8fd4\u56de\u4efb\u4f55\u6570\u636e\u7c7b\u578b\uff0c\u91cd\u5199\u4efb\u4f55\u6570\u636e\u58f0\u660e\u6216\u8005\u6821\u9a8c\uff0c\u7b49\u7b49\u3002</p>"},{"location":"advanced/response-directly/#response-jsonable_encoder","title":"\u5728 <code>Response</code> \u4e2d\u4f7f\u7528 <code>jsonable_encoder</code>","text":"<p>\u7531\u4e8e FastAPI \u5e76\u672a\u5bf9\u4f60\u8fd4\u56de\u7684 <code>Response</code> \u505a\u4efb\u4f55\u6539\u53d8\uff0c\u4f60\u5fc5\u987b\u786e\u4fdd\u4f60\u5df2\u7ecf\u51c6\u5907\u597d\u54cd\u5e94\u5185\u5bb9\u3002</p> <p>\u4f8b\u5982\uff0c\u5982\u679c\u4e0d\u9996\u5148\u5c06 Pydantic \u6a21\u578b\u8f6c\u6362\u4e3a <code>dict</code>\uff0c\u5e76\u5c06\u6240\u6709\u6570\u636e\u7c7b\u578b\uff08\u5982 <code>datetime</code>\u3001<code>UUID</code> \u7b49\uff09\u8f6c\u6362\u4e3a\u517c\u5bb9 JSON \u7684\u7c7b\u578b\uff0c\u5219\u4e0d\u80fd\u5c06\u5176\u653e\u5165JSONResponse\u4e2d\u3002</p> <p>\u5bf9\u4e8e\u8fd9\u4e9b\u60c5\u51b5\uff0c\u5728\u5c06\u6570\u636e\u4f20\u9012\u7ed9\u54cd\u5e94\u4e4b\u524d\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 <code>jsonable_encoder</code> \u6765\u8f6c\u6362\u4f60\u7684\u6570\u636e\u3002</p> <pre><code>from datetime import datetime\nfrom typing import Union\n\nfrom fastapi import FastAPI\nfrom fastapi.encoders import jsonable_encoder\nfrom fastapi.responses import JSONResponse\nfrom pydantic import BaseModel\n\n\nclass Item(BaseModel):\n    title: str\n    timestamp: datetime\n    description: Union[str, None] = None\n\n\napp = FastAPI()\n\n\n@app.put(\"/items/{id}\")\ndef update_item(id: str, item: Item):\njson_compatible_item_data = jsonable_encoder(item)\nreturn JSONResponse(content=json_compatible_item_data)\n</code></pre> <p>\u6280\u672f\u7ec6\u8282</p> <p>\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 <code>from starlette.responses import JSONResponse</code>\u3002</p> <p>\u51fa\u4e8e\u65b9\u4fbf\uff0cFastAPI \u4f1a\u63d0\u4f9b\u4e0e <code>starlette.responses</code> \u76f8\u540c\u7684 <code>fastapi.responses</code> \u7ed9\u5f00\u53d1\u8005\u3002\u4f46\u662f\u5927\u591a\u6570\u53ef\u7528\u7684\u54cd\u5e94\u90fd\u76f4\u63a5\u6765\u81ea Starlette\u3002</p>"},{"location":"advanced/response-directly/#response_1","title":"\u8fd4\u56de\u81ea\u5b9a\u4e49 <code>Response</code>","text":"<p>\u4e0a\u9762\u7684\u4f8b\u5b50\u5c55\u793a\u4e86\u9700\u8981\u7684\u6240\u6709\u90e8\u5206\uff0c\u4f46\u8fd8\u4e0d\u591f\u5b9e\u7528\uff0c\u56e0\u4e3a\u4f60\u672c\u53ef\u4ee5\u53ea\u662f\u76f4\u63a5\u8fd4\u56de <code>item</code>\uff0c\u800cFastAPI \u9ed8\u8ba4\u5e2e\u4f60\u628a\u8fd9\u4e2a <code>item</code> \u653e\u5230 <code>JSONResponse</code> \u4e2d\uff0c\u53c8\u9ed8\u8ba4\u5c06\u5176\u8f6c\u6362\u6210\u4e86 <code>dict</code>\u7b49\u7b49\u3002</p> <p>\u73b0\u5728\uff0c\u8ba9\u6211\u4eec\u770b\u770b\u4f60\u5982\u4f55\u624d\u80fd\u8fd4\u56de\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684\u54cd\u5e94\u3002</p> <p>\u5047\u8bbe\u4f60\u60f3\u8981\u8fd4\u56de\u4e00\u4e2a XML \u54cd\u5e94\u3002</p> <p>\u4f60\u53ef\u4ee5\u628a\u4f60\u7684 XML \u5185\u5bb9\u653e\u5230\u4e00\u4e2a\u5b57\u7b26\u4e32\u4e2d\uff0c\u653e\u5230\u4e00\u4e2a <code>Response</code> \u4e2d\uff0c\u7136\u540e\u8fd4\u56de\u3002</p> <pre><code>from fastapi import FastAPI, Response\napp = FastAPI()\n\n\n@app.get(\"/legacy/\")\ndef get_legacy_data():\n    data = \"\"\"&lt;?xml version=\"1.0\"?&gt;\n    &lt;shampoo&gt;\n    &lt;Header&gt;\n        Apply shampoo here.\n    &lt;/Header&gt;\n    &lt;Body&gt;\n        You'll have to use soap here.\n    &lt;/Body&gt;\n    &lt;/shampoo&gt;\n    \"\"\"\nreturn Response(content=data, media_type=\"application/xml\")\n</code></pre>"},{"location":"advanced/response-directly/#_2","title":"\u8bf4\u660e","text":"<p>\u5f53\u4f60\u76f4\u63a5\u8fd4\u56de <code>Response</code> \u65f6\uff0c\u5b83\u7684\u6570\u636e\u65e2\u6ca1\u6709\u6821\u9a8c\uff0c\u53c8\u4e0d\u4f1a\u8fdb\u884c\u8f6c\u6362\uff08\u5e8f\u5217\u5316\uff09\uff0c\u4e5f\u4e0d\u4f1a\u81ea\u52a8\u751f\u6210\u6587\u6863\u3002</p> <p>\u4f46\u662f\u4f60\u4ecd\u53ef\u4ee5\u53c2\u8003 OpenApI \u4e2d\u7684\u989d\u5916\u54cd\u5e94 \u7ed9\u54cd\u5e94\u7f16\u5199\u6587\u6863\u3002</p> <p>\u5728\u540e\u7eed\u7684\u7ae0\u8282\u4e2d\u4f60\u53ef\u4ee5\u4e86\u89e3\u5230\u5982\u4f55\u4f7f\u7528/\u58f0\u660e\u8fd9\u4e9b\u81ea\u5b9a\u4e49\u7684 <code>Response</code> \u7684\u540c\u65f6\u8fd8\u4fdd\u7559\u81ea\u52a8\u5316\u7684\u6570\u636e\u8f6c\u6362\u548c\u6587\u6863\u7b49\u3002</p>"},{"location":"advanced/wsgi/","title":"\u5305\u542b WSGI - Flask\uff0cDjango\uff0c\u5176\u5b83","text":"<p>\u60a8\u53ef\u4ee5\u6302\u8f7d\u591a\u4e2a WSGI \u5e94\u7528\uff0c\u6b63\u5982\u60a8\u5728 Sub Applications - Mounts, Behind a Proxy \u4e2d\u6240\u770b\u5230\u7684\u90a3\u6837\u3002</p> <p>\u4e3a\u6b64, \u60a8\u53ef\u4ee5\u4f7f\u7528 <code>WSGIMiddleware</code> \u6765\u5305\u88c5\u4f60\u7684 WSGI \u5e94\u7528\uff0c\u5982\uff1aFlask\uff0cDjango\uff0c\u7b49\u7b49\u3002</p>"},{"location":"advanced/wsgi/#wsgimiddleware","title":"\u4f7f\u7528 <code>WSGIMiddleware</code>","text":"<p>\u60a8\u9700\u8981\u5bfc\u5165 <code>WSGIMiddleware</code>\u3002</p> <p>\u7136\u540e\u4f7f\u7528\u8be5\u4e2d\u95f4\u4ef6\u5305\u88c5 WSGI \u5e94\u7528\uff08\u4f8b\u5982 Flask\uff09\u3002</p> <p>\u4e4b\u540e\u5c06\u5176\u6302\u8f7d\u5230\u67d0\u4e00\u4e2a\u8def\u5f84\u4e0b\u3002</p> <pre><code>from fastapi import FastAPI\nfrom fastapi.middleware.wsgi import WSGIMiddleware\nfrom flask import Flask, request\nfrom markupsafe import escape\n\nflask_app = Flask(__name__)\n\n\n@flask_app.route(\"/\")\ndef flask_main():\n    name = request.args.get(\"name\", \"World\")\n    return f\"Hello, {escape(name)} from Flask!\"\n\n\napp = FastAPI()\n\n\n@app.get(\"/v2\")\ndef read_main():\n    return {\"message\": \"Hello World\"}\n\napp.mount(\"/v1\", WSGIMiddleware(flask_app))\n</code></pre>"},{"location":"advanced/wsgi/#_1","title":"\u68c0\u67e5","text":"<p>\u73b0\u5728\uff0c\u6240\u6709\u5b9a\u4e49\u5728 <code>/v1/</code> \u8def\u5f84\u4e0b\u7684\u8bf7\u6c42\u5c06\u4f1a\u88ab Flask \u5e94\u7528\u5904\u7406\u3002</p> <p>\u5176\u4f59\u7684\u8bf7\u6c42\u5219\u4f1a\u88ab FastAPI \u5904\u7406\u3002</p> <p>\u5982\u679c\u60a8\u4f7f\u7528 Uvicorn \u8fd0\u884c\u5e94\u7528\u5b9e\u4f8b\u5e76\u4e14\u8bbf\u95ee http://localhost:8000/v1/\uff0c\u60a8\u5c06\u4f1a\u770b\u5230\u7531 Flask \u8fd4\u56de\u7684\u54cd\u5e94\uff1a</p> <pre><code>Hello, World from Flask!\n</code></pre> <p>\u5e76\u4e14\u5982\u679c\u60a8\u8bbf\u95ee http://localhost:8000/v2\uff0c\u60a8\u5c06\u4f1a\u770b\u5230\u7531 FastAPI \u8fd4\u56de\u7684\u54cd\u5e94\uff1a</p> <pre><code>{\n\"message\": \"Hello World\"\n}\n</code></pre>"},{"location":"tutorial/","title":"\u6559\u7a0b - \u7528\u6237\u6307\u5357 - \u7b80\u4ecb","text":"<p>\u672c\u6559\u7a0b\u5c06\u4e00\u6b65\u6b65\u5411\u4f60\u5c55\u793a\u5982\u4f55\u4f7f\u7528 FastAPI \u7684\u7edd\u5927\u90e8\u5206\u7279\u6027\u3002</p> <p>\u5404\u4e2a\u7ae0\u8282\u7684\u5185\u5bb9\u5faa\u5e8f\u6e10\u8fdb\uff0c\u4f46\u662f\u53c8\u56f4\u7ed5\u7740\u5355\u72ec\u7684\u4e3b\u9898\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u76f4\u63a5\u8df3\u8f6c\u5230\u67d0\u4e2a\u7ae0\u8282\u4ee5\u89e3\u51b3\u4f60\u7684\u7279\u5b9a\u9700\u6c42\u3002</p> <p>\u672c\u6559\u7a0b\u540c\u6837\u53ef\u4ee5\u4f5c\u4e3a\u5c06\u6765\u7684\u53c2\u8003\u624b\u518c\u3002</p> <p>\u4f60\u53ef\u4ee5\u968f\u65f6\u56de\u5230\u672c\u6559\u7a0b\u5e76\u67e5\u9605\u4f60\u9700\u8981\u7684\u5185\u5bb9\u3002</p>"},{"location":"tutorial/#_1","title":"\u8fd0\u884c\u4ee3\u7801","text":"<p>\u6240\u6709\u4ee3\u7801\u7247\u6bb5\u90fd\u53ef\u4ee5\u590d\u5236\u540e\u76f4\u63a5\u4f7f\u7528\uff08\u5b83\u4eec\u5b9e\u9645\u4e0a\u662f\u7ecf\u8fc7\u6d4b\u8bd5\u7684 Python \u6587\u4ef6\uff09\u3002</p> <p>\u8981\u8fd0\u884c\u4efb\u4f55\u793a\u4f8b\uff0c\u8bf7\u5c06\u4ee3\u7801\u590d\u5236\u5230 <code>main.py</code> \u6587\u4ef6\u4e2d\uff0c\u7136\u540e\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\u542f\u52a8 <code>uvicorn</code>\uff1a</p> <pre><code>$ uvicorn main:app --reload\n\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Started reloader process [28720]\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Started server process [28722]\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Waiting for application startup.\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Application startup complete.\n</code></pre> <p>\u5f3a\u70c8\u5efa\u8bae\u4f60\u5728\u672c\u5730\u7f16\u5199\u6216\u590d\u5236\u4ee3\u7801\uff0c\u5bf9\u5176\u8fdb\u884c\u7f16\u8f91\u5e76\u8fd0\u884c\u3002</p> <p>\u5728\u7f16\u8f91\u5668\u4e2d\u4f7f\u7528 FastAPI \u4f1a\u771f\u6b63\u5730\u5c55\u73b0\u51fa\u5b83\u7684\u4f18\u52bf\uff1a\u53ea\u9700\u8981\u7f16\u5199\u5f88\u5c11\u7684\u4ee3\u7801\uff0c\u6240\u6709\u7684\u7c7b\u578b\u68c0\u67e5\uff0c\u4ee3\u7801\u8865\u5168\u7b49\u7b49\u3002</p>"},{"location":"tutorial/#fastapi","title":"\u5b89\u88c5 FastAPI","text":"<p>\u7b2c\u4e00\u4e2a\u6b65\u9aa4\u662f\u5b89\u88c5 FastAPI\u3002</p> <p>\u4e3a\u4e86\u4f7f\u7528\u672c\u6559\u7a0b\uff0c\u4f60\u53ef\u80fd\u9700\u8981\u5b89\u88c5\u6240\u6709\u7684\u53ef\u9009\u4f9d\u8d56\u53ca\u5bf9\u5e94\u529f\u80fd\uff1a</p> <pre><code>$ pip install \"fastapi[all]\"\n\n---&gt; 100%\n</code></pre> <p>......\u4ee5\u4e0a\u5b89\u88c5\u8fd8\u5305\u62ec\u4e86 <code>uvicorn</code>\uff0c\u4f60\u53ef\u4ee5\u5c06\u5176\u7528\u4f5c\u8fd0\u884c\u4ee3\u7801\u7684\u670d\u52a1\u5668\u3002</p> <p>Note</p> <p>\u4f60\u4e5f\u53ef\u4ee5\u5206\u5f00\u6765\u5b89\u88c5\u3002</p> <p>\u5047\u5982\u4f60\u60f3\u5c06\u5e94\u7528\u7a0b\u5e8f\u90e8\u7f72\u5230\u751f\u4ea7\u73af\u5883\uff0c\u4f60\u53ef\u80fd\u8981\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a</p> <pre><code>pip install fastapi\n</code></pre> <p>\u5e76\u4e14\u5b89\u88c5<code>uvicorn</code>\u6765\u4f5c\u4e3a\u670d\u52a1\u5668\uff1a</p> <pre><code>pip install \"uvicorn[standard]\"\n</code></pre> <p>\u7136\u540e\u5bf9\u4f60\u60f3\u4f7f\u7528\u7684\u6bcf\u4e2a\u53ef\u9009\u4f9d\u8d56\u9879\u4e5f\u6267\u884c\u76f8\u540c\u7684\u64cd\u4f5c\u3002</p>"},{"location":"tutorial/#_2","title":"\u8fdb\u9636\u7528\u6237\u6307\u5357","text":"<p>\u5728\u672c\u6559\u7a0b-\u7528\u6237\u6307\u5357\u4e4b\u540e\uff0c\u4f60\u53ef\u4ee5\u9605\u8bfb\u8fdb\u9636\u7528\u6237\u6307\u5357\u3002</p> <p>\u8fdb\u9636\u7528\u6237\u6307\u5357\u4ee5\u672c\u6559\u7a0b\u4e3a\u57fa\u7840\uff0c\u4f7f\u7528\u76f8\u540c\u7684\u6982\u5ff5\uff0c\u5e76\u6559\u6388\u4e00\u4e9b\u989d\u5916\u7684\u7279\u6027\u3002</p> <p>\u4f46\u662f\u4f60\u5e94\u8be5\u5148\u9605\u8bfb\u6559\u7a0b-\u7528\u6237\u6307\u5357\uff08\u5373\u4f60\u73b0\u5728\u6b63\u5728\u9605\u8bfb\u7684\u5185\u5bb9\uff09\u3002</p> <p>\u6559\u7a0b\u7ecf\u8fc7\u7cbe\u5fc3\u8bbe\u8ba1\uff0c\u4f7f\u4f60\u53ef\u4ee5\u4ec5\u901a\u8fc7\u6559\u7a0b-\u7528\u6237\u6307\u5357\u6765\u5f00\u53d1\u4e00\u4e2a\u5b8c\u6574\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u7136\u540e\u6839\u636e\u4f60\u7684\u9700\u8981\uff0c\u4f7f\u7528\u8fdb\u9636\u7528\u6237\u6307\u5357\u4e2d\u7684\u4e00\u4e9b\u5176\u4ed6\u6982\u5ff5\uff0c\u4ee5\u4e0d\u540c\u7684\u65b9\u5f0f\u6765\u6269\u5c55\u5b83\u3002</p>"},{"location":"tutorial/bigger-applications/","title":"\u66f4\u5927\u7684\u5e94\u7528 - \u591a\u4e2a\u6587\u4ef6","text":"<p>\u5982\u679c\u4f60\u6b63\u5728\u5f00\u53d1\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u6216 Web API\uff0c\u5f88\u5c11\u4f1a\u5c06\u6240\u6709\u7684\u5185\u5bb9\u90fd\u653e\u5728\u4e00\u4e2a\u6587\u4ef6\u4e2d\u3002</p> <p>FastAPI \u63d0\u4f9b\u4e86\u4e00\u4e2a\u65b9\u4fbf\u7684\u5de5\u5177\uff0c\u53ef\u4ee5\u5728\u4fdd\u6301\u6240\u6709\u7075\u6d3b\u6027\u7684\u540c\u65f6\u6784\u5efa\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>Info</p> <p>\u5982\u679c\u4f60\u6765\u81ea Flask\uff0c\u90a3\u8fd9\u5c06\u76f8\u5f53\u4e8e Flask \u7684 Blueprints\u3002</p>"},{"location":"tutorial/bigger-applications/#_1","title":"\u4e00\u4e2a\u6587\u4ef6\u7ed3\u6784\u793a\u4f8b","text":"<p>\u5047\u8bbe\u4f60\u7684\u6587\u4ef6\u7ed3\u6784\u5982\u4e0b\uff1a</p> <pre><code>.\n\u251c\u2500\u2500 app\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 __init__.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 main.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 dependencies.py\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 routers\n\u2502\u00a0\u00a0 \u2502   \u251c\u2500\u2500 __init__.py\n\u2502\u00a0\u00a0 \u2502   \u251c\u2500\u2500 items.py\n\u2502\u00a0\u00a0 \u2502   \u2514\u2500\u2500 users.py\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 internal\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 __init__.py\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 admin.py\n</code></pre> <p>Tip</p> <p>\u4e0a\u9762\u6709\u51e0\u4e2a <code>__init__.py</code> \u6587\u4ef6\uff1a\u6bcf\u4e2a\u76ee\u5f55\u6216\u5b50\u76ee\u5f55\u4e2d\u90fd\u6709\u4e00\u4e2a\u3002</p> <p>\u8fd9\u5c31\u662f\u80fd\u5c06\u4ee3\u7801\u4ece\u4e00\u4e2a\u6587\u4ef6\u5bfc\u5165\u5230\u53e6\u4e00\u4e2a\u6587\u4ef6\u7684\u539f\u56e0\u3002</p> <p>\u4f8b\u5982\uff0c\u5728 <code>app/main.py</code> \u4e2d\uff0c\u4f60\u53ef\u4ee5\u6709\u5982\u4e0b\u4e00\u884c\uff1a</p> <pre><code>from app.routers import items\n</code></pre> <ul> <li><code>app</code> \u76ee\u5f55\u5305\u542b\u4e86\u6240\u6709\u5185\u5bb9\u3002\u5e76\u4e14\u5b83\u6709\u4e00\u4e2a\u7a7a\u6587\u4ef6 <code>app/__init__.py</code>\uff0c\u56e0\u6b64\u5b83\u662f\u4e00\u4e2a\u300cPython \u5305\u300d\uff08\u300cPython \u6a21\u5757\u300d\u7684\u96c6\u5408\uff09\uff1a<code>app</code>\u3002</li> <li>\u5b83\u5305\u542b\u4e00\u4e2a <code>app/main.py</code> \u6587\u4ef6\u3002\u7531\u4e8e\u5b83\u4f4d\u4e8e\u4e00\u4e2a Python \u5305\uff08\u4e00\u4e2a\u5305\u542b <code>__init__.py</code> \u6587\u4ef6\u7684\u76ee\u5f55\uff09\u4e2d\uff0c\u56e0\u6b64\u5b83\u662f\u8be5\u5305\u7684\u4e00\u4e2a\u300c\u6a21\u5757\u300d\uff1a<code>app.main</code>\u3002</li> <li>\u8fd8\u6709\u4e00\u4e2a <code>app/dependencies.py</code> \u6587\u4ef6\uff0c\u5c31\u50cf <code>app/main.py</code> \u4e00\u6837\uff0c\u5b83\u662f\u4e00\u4e2a\u300c\u6a21\u5757\u300d\uff1a<code>app.dependencies</code>\u3002</li> <li>\u6709\u4e00\u4e2a\u5b50\u76ee\u5f55 <code>app/routers/</code> \u5305\u542b\u53e6\u4e00\u4e2a <code>__init__.py</code> \u6587\u4ef6\uff0c\u56e0\u6b64\u5b83\u662f\u4e00\u4e2a\u300cPython \u5b50\u5305\u300d\uff1a<code>app.routers</code>\u3002</li> <li>\u6587\u4ef6 <code>app/routers/items.py</code> \u4f4d\u4e8e <code>app/routers/</code> \u5305\u4e2d\uff0c\u56e0\u6b64\u5b83\u662f\u4e00\u4e2a\u5b50\u6a21\u5757\uff1a<code>app.routers.items</code>\u3002</li> <li>\u540c\u6837\u9002\u7528\u4e8e <code>app/routers/users.py</code>\uff0c\u5b83\u662f\u53e6\u4e00\u4e2a\u5b50\u6a21\u5757\uff1a<code>app.routers.users</code>\u3002</li> <li>\u8fd8\u6709\u4e00\u4e2a\u5b50\u76ee\u5f55 <code>app/internal/</code> \u5305\u542b\u53e6\u4e00\u4e2a <code>__init__.py</code> \u6587\u4ef6\uff0c\u56e0\u6b64\u5b83\u662f\u53c8\u4e00\u4e2a\u300cPython \u5b50\u5305\u300d\uff1a<code>app.internal</code>\u3002</li> <li><code>app/internal/admin.py</code> \u662f\u53e6\u4e00\u4e2a\u5b50\u6a21\u5757\uff1a<code>app.internal.admin</code>\u3002</li> </ul> <p></p> <p>\u5e26\u6709\u6ce8\u91ca\u7684\u540c\u4e00\u6587\u4ef6\u7ed3\u6784\uff1a</p> <pre><code>.\n\u251c\u2500\u2500 app                  # \u300capp\u300d\u662f\u4e00\u4e2a Python \u5305\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 __init__.py      # \u8fd9\u4e2a\u6587\u4ef6\u4f7f\u300capp\u300d\u6210\u4e3a\u4e00\u4e2a Python \u5305\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 main.py          # \u300cmain\u300d\u6a21\u5757\uff0c\u4f8b\u5982 import app.main\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 dependencies.py  # \u300cdependencies\u300d\u6a21\u5757\uff0c\u4f8b\u5982 import app.dependencies\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 routers          # \u300crouters\u300d\u662f\u4e00\u4e2a\u300cPython \u5b50\u5305\u300d\n\u2502\u00a0\u00a0 \u2502   \u251c\u2500\u2500 __init__.py  # \u4f7f\u300crouters\u300d\u6210\u4e3a\u4e00\u4e2a\u300cPython \u5b50\u5305\u300d\n\u2502\u00a0\u00a0 \u2502   \u251c\u2500\u2500 items.py     # \u300citems\u300d\u5b50\u6a21\u5757\uff0c\u4f8b\u5982 import app.routers.items\n\u2502\u00a0\u00a0 \u2502   \u2514\u2500\u2500 users.py     # \u300cusers\u300d\u5b50\u6a21\u5757\uff0c\u4f8b\u5982 import app.routers.users\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 internal         # \u300cinternal\u300d\u662f\u4e00\u4e2a\u300cPython \u5b50\u5305\u300d\n\u2502\u00a0\u00a0     \u251c\u2500\u2500 __init__.py  # \u4f7f\u300cinternal\u300d\u6210\u4e3a\u4e00\u4e2a\u300cPython \u5b50\u5305\u300d\n\u2502\u00a0\u00a0     \u2514\u2500\u2500 admin.py     # \u300cadmin\u300d\u5b50\u6a21\u5757\uff0c\u4f8b\u5982 import app.internal.admin\n</code></pre>"},{"location":"tutorial/bigger-applications/#apirouter","title":"<code>APIRouter</code>","text":"<p>\u5047\u8bbe\u4e13\u95e8\u7528\u4e8e\u5904\u7406\u7528\u6237\u903b\u8f91\u7684\u6587\u4ef6\u662f\u4f4d\u4e8e <code>/app/routers/users.py</code> \u7684\u5b50\u6a21\u5757\u3002</p> <p>\u4f60\u5e0c\u671b\u5c06\u4e0e\u7528\u6237\u76f8\u5173\u7684\u8def\u5f84\u64cd\u4f5c\u4e0e\u5176\u4ed6\u4ee3\u7801\u5206\u5f00\uff0c\u4ee5\u4f7f\u5176\u4e95\u4e95\u6709\u6761\u3002</p> <p>\u4f46\u5b83\u4ecd\u7136\u662f\u540c\u4e00 FastAPI \u5e94\u7528\u7a0b\u5e8f/web API \u7684\u4e00\u90e8\u5206\uff08\u5b83\u662f\u540c\u4e00\u300cPython \u5305\u300d\u7684\u4e00\u90e8\u5206\uff09\u3002</p> <p>\u4f60\u53ef\u4ee5\u4f7f\u7528 <code>APIRouter</code> \u4e3a\u8be5\u6a21\u5757\u521b\u5efa\u8def\u5f84\u64cd\u4f5c\u3002</p>"},{"location":"tutorial/bigger-applications/#apirouter_1","title":"\u5bfc\u5165 <code>APIRouter</code>","text":"<p>\u4f60\u53ef\u4ee5\u5bfc\u5165\u5b83\u5e76\u901a\u8fc7\u4e0e <code>FastAPI</code> \u7c7b\u76f8\u540c\u7684\u65b9\u5f0f\u521b\u5efa\u4e00\u4e2a\u300c\u5b9e\u4f8b\u300d\uff1a</p> <pre><code>from fastapi import APIRouter\nrouter = APIRouter()\n@router.get(\"/users/\", tags=[\"users\"])\nasync def read_users():\n    return [{\"username\": \"Rick\"}, {\"username\": \"Morty\"}]\n\n\n@router.get(\"/users/me\", tags=[\"users\"])\nasync def read_user_me():\n    return {\"username\": \"fakecurrentuser\"}\n\n\n@router.get(\"/users/{username}\", tags=[\"users\"])\nasync def read_user(username: str):\n    return {\"username\": username}\n</code></pre>"},{"location":"tutorial/bigger-applications/#apirouter_2","title":"\u4f7f\u7528 <code>APIRouter</code> \u7684\u8def\u5f84\u64cd\u4f5c","text":"<p>\u7136\u540e\u4f60\u53ef\u4ee5\u4f7f\u7528\u5b83\u6765\u58f0\u660e\u8def\u5f84\u64cd\u4f5c\u3002</p> <p>\u4f7f\u7528\u65b9\u5f0f\u4e0e <code>FastAPI</code> \u7c7b\u76f8\u540c\uff1a</p> <pre><code>from fastapi import APIRouter\n\nrouter = APIRouter()\n\n\n@router.get(\"/users/\", tags=[\"users\"])\nasync def read_users():\n    return [{\"username\": \"Rick\"}, {\"username\": \"Morty\"}]\n\n\n@router.get(\"/users/me\", tags=[\"users\"])\nasync def read_user_me():\n    return {\"username\": \"fakecurrentuser\"}\n\n\n@router.get(\"/users/{username}\", tags=[\"users\"])\nasync def read_user(username: str):\n    return {\"username\": username}\n</code></pre> <p>\u4f60\u53ef\u4ee5\u5c06 <code>APIRouter</code> \u89c6\u4e3a\u4e00\u4e2a\u300c\u8ff7\u4f60 <code>FastAPI</code>\u300d\u7c7b\u3002</p> <p>\u6240\u6709\u76f8\u540c\u7684\u9009\u9879\u90fd\u5f97\u5230\u652f\u6301\u3002</p> <p>\u6240\u6709\u76f8\u540c\u7684 <code>parameters</code>\u3001<code>responses</code>\u3001<code>dependencies</code>\u3001<code>tags</code> \u7b49\u7b49\u3002</p> <p>Tip</p> <p>\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u8be5\u53d8\u91cf\u88ab\u547d\u540d\u4e3a <code>router</code>\uff0c\u4f46\u4f60\u53ef\u4ee5\u6839\u636e\u4f60\u7684\u60f3\u6cd5\u81ea\u7531\u547d\u540d\u3002</p> <p>\u6211\u4eec\u5c06\u5728\u4e3b <code>FastAPI</code> \u5e94\u7528\u4e2d\u5305\u542b\u8be5 <code>APIRouter</code>\uff0c\u4f46\u9996\u5148\uff0c\u8ba9\u6211\u4eec\u6765\u770b\u770b\u4f9d\u8d56\u9879\u548c\u53e6\u4e00\u4e2a <code>APIRouter</code>\u3002</p>"},{"location":"tutorial/bigger-applications/#_2","title":"\u4f9d\u8d56\u9879","text":"<p>\u6211\u4eec\u4e86\u89e3\u5230\u6211\u4eec\u5c06\u9700\u8981\u4e00\u4e9b\u5728\u5e94\u7528\u7a0b\u5e8f\u7684\u597d\u51e0\u4e2a\u5730\u65b9\u6240\u4f7f\u7528\u7684\u4f9d\u8d56\u9879\u3002</p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u5c06\u5b83\u4eec\u653e\u5728\u5b83\u4eec\u81ea\u5df1\u7684 <code>dependencies</code> \u6a21\u5757\uff08<code>app/dependencies.py</code>\uff09\u4e2d\u3002</p> <p>\u73b0\u5728\u6211\u4eec\u5c06\u4f7f\u7528\u4e00\u4e2a\u7b80\u5355\u7684\u4f9d\u8d56\u9879\u6765\u8bfb\u53d6\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684 <code>X-Token</code> \u8bf7\u6c42\u9996\u90e8\uff1a</p> <pre><code>from fastapi import Header, HTTPException\nasync def get_token_header(x_token: str = Header()):\nif x_token != \"fake-super-secret-token\":\nraise HTTPException(status_code=400, detail=\"X-Token header invalid\")\nasync def get_query_token(token: str):\n    if token != \"jessica\":\n        raise HTTPException(status_code=400, detail=\"No Jessica token provided\")\n</code></pre> <p>Tip</p> <p>\u6211\u4eec\u6b63\u5728\u4f7f\u7528\u865a\u6784\u7684\u8bf7\u6c42\u9996\u90e8\u6765\u7b80\u5316\u6b64\u793a\u4f8b\u3002</p> <p>\u4f46\u5728\u5b9e\u9645\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528\u96c6\u6210\u7684\u5b89\u5168\u6027\u5b9e\u7528\u5de5\u5177\u4f1a\u5f97\u5230\u66f4\u597d\u7684\u6548\u679c\u3002</p>"},{"location":"tutorial/bigger-applications/#apirouter_3","title":"\u5176\u4ed6\u4f7f\u7528 <code>APIRouter</code> \u7684\u6a21\u5757","text":"<p>\u5047\u8bbe\u4f60\u5728\u4f4d\u4e8e <code>app/routers/items.py</code> \u7684\u6a21\u5757\u4e2d\u8fd8\u6709\u4e13\u95e8\u7528\u4e8e\u5904\u7406\u5e94\u7528\u7a0b\u5e8f\u4e2d\u300c\u9879\u76ee\u300d\u7684\u7aef\u70b9\u3002</p> <p>\u4f60\u5177\u6709\u4ee5\u4e0b\u8def\u5f84\u64cd\u4f5c\uff1a</p> <ul> <li><code>/items/</code></li> <li><code>/items/{item_id}</code></li> </ul> <p>\u8fd9\u548c <code>app/routers/users.py</code> \u7684\u7ed3\u6784\u5b8c\u5168\u76f8\u540c\u3002</p> <p>\u4f46\u662f\u6211\u4eec\u60f3\u53d8\u5f97\u66f4\u806a\u660e\u5e76\u7b80\u5316\u4e00\u4e9b\u4ee3\u7801\u3002</p> <p>\u6211\u4eec\u77e5\u9053\u6b64\u6a21\u5757\u4e2d\u7684\u6240\u6709\u8def\u5f84\u64cd\u4f5c\u90fd\u6709\u76f8\u540c\u7684\uff1a</p> <ul> <li>\u8def\u5f84 <code>prefix</code>\uff1a<code>/items</code>\u3002</li> <li><code>tags</code>\uff1a\uff08\u4ec5\u6709\u4e00\u4e2a <code>items</code> \u6807\u7b7e\uff09\u3002</li> <li>\u989d\u5916\u7684 <code>responses</code>\u3002</li> <li><code>dependencies</code>\uff1a\u5b83\u4eec\u90fd\u9700\u8981\u6211\u4eec\u521b\u5efa\u7684 <code>X-Token</code> \u4f9d\u8d56\u9879\u3002</li> </ul> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u6dfb\u52a0\u5230 <code>APIRouter</code> \u4e2d\uff0c\u800c\u4e0d\u662f\u5c06\u5176\u6dfb\u52a0\u5230\u6bcf\u4e2a\u8def\u5f84\u64cd\u4f5c\u4e2d\u3002</p> <pre><code>from fastapi import APIRouter, Depends, HTTPException\n\nfrom ..dependencies import get_token_header\n\nrouter = APIRouter(\nprefix=\"/items\",\ntags=[\"items\"],\ndependencies=[Depends(get_token_header)],\nresponses={404: {\"description\": \"Not found\"}},\n)\nfake_items_db = {\"plumbus\": {\"name\": \"Plumbus\"}, \"gun\": {\"name\": \"Portal Gun\"}}\n\n\n@router.get(\"/\")\nasync def read_items():\n    return fake_items_db\n\n\n@router.get(\"/{item_id}\")\nasync def read_item(item_id: str):\n    if item_id not in fake_items_db:\n        raise HTTPException(status_code=404, detail=\"Item not found\")\n    return {\"name\": fake_items_db[item_id][\"name\"], \"item_id\": item_id}\n\n\n@router.put(\n    \"/{item_id}\",\n    tags=[\"custom\"],\n    responses={403: {\"description\": \"Operation forbidden\"}},\n)\nasync def update_item(item_id: str):\n    if item_id != \"plumbus\":\n        raise HTTPException(\n            status_code=403, detail=\"You can only update the item: plumbus\"\n        )\n    return {\"item_id\": item_id, \"name\": \"The great Plumbus\"}\n</code></pre> <p>\u7531\u4e8e\u6bcf\u4e2a\u8def\u5f84\u64cd\u4f5c\u7684\u8def\u5f84\u90fd\u5fc5\u987b\u4ee5 <code>/</code> \u5f00\u5934\uff0c\u4f8b\u5982\uff1a</p> <pre><code>@router.get(\"/{item_id}\")\nasync def read_item(item_id: str):\n    ...\n</code></pre> <p>...\u524d\u7f00\u4e0d\u80fd\u4ee5 <code>/</code> \u4f5c\u4e3a\u7ed3\u5c3e\u3002</p> <p>\u56e0\u6b64\uff0c\u672c\u4f8b\u4e2d\u7684\u524d\u7f00\u4e3a <code>/items</code>\u3002</p> <p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a <code>tags</code> \u5217\u8868\u548c\u989d\u5916\u7684 <code>responses</code> \u5217\u8868\uff0c\u8fd9\u4e9b\u53c2\u6570\u5c06\u5e94\u7528\u4e8e\u6b64\u8def\u7531\u5668\u4e2d\u5305\u542b\u7684\u6240\u6709\u8def\u5f84\u64cd\u4f5c\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u6dfb\u52a0\u4e00\u4e2a <code>dependencies</code> \u5217\u8868\uff0c\u8fd9\u4e9b\u4f9d\u8d56\u9879\u5c06\u88ab\u6dfb\u52a0\u5230\u8def\u7531\u5668\u4e2d\u7684\u6240\u6709\u8def\u5f84\u64cd\u4f5c\u4e2d\uff0c\u5e76\u5c06\u9488\u5bf9\u5411\u5b83\u4eec\u53d1\u8d77\u7684\u6bcf\u4e2a\u8bf7\u6c42\u6267\u884c/\u89e3\u51b3\u3002</p> <p>Tip</p> <p>\u8bf7\u6ce8\u610f\uff0c\u548c\u8def\u5f84\u64cd\u4f5c\u88c5\u9970\u5668\u4e2d\u7684\u4f9d\u8d56\u9879\u5f88\u7c7b\u4f3c\uff0c\u6ca1\u6709\u503c\u4f1a\u88ab\u4f20\u9012\u7ed9\u4f60\u7684\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u3002</p> <p>\u6700\u7ec8\u7ed3\u679c\u662f\u9879\u76ee\u76f8\u5173\u7684\u8def\u5f84\u73b0\u5728\u4e3a\uff1a</p> <ul> <li><code>/items/</code></li> <li><code>/items/{item_id}</code></li> </ul> <p>...\u5982\u6211\u4eec\u6240\u613f\u3002</p> <ul> <li>\u5b83\u4eec\u5c06\u88ab\u6807\u8bb0\u4e3a\u4ec5\u5305\u542b\u5355\u4e2a\u5b57\u7b26\u4e32 <code>\"items\"</code> \u7684\u6807\u7b7e\u5217\u8868\u3002<ul> <li>\u8fd9\u4e9b\u300c\u6807\u7b7e\u300d\u5bf9\u4e8e\u81ea\u52a8\u5316\u4ea4\u4e92\u5f0f\u6587\u6863\u7cfb\u7edf\uff08\u4f7f\u7528 OpenAPI\uff09\u7279\u522b\u6709\u7528\u3002</li> </ul> </li> <li>\u6240\u6709\u7684\u8def\u5f84\u64cd\u4f5c\u90fd\u5c06\u5305\u542b\u9884\u5b9a\u4e49\u7684 <code>responses</code>\u3002</li> <li>\u6240\u6709\u7684\u8fd9\u4e9b\u8def\u5f84\u64cd\u4f5c\u90fd\u5c06\u5728\u81ea\u8eab\u4e4b\u524d\u8ba1\u7b97/\u6267\u884c <code>dependencies</code> \u5217\u8868\u3002<ul> <li>\u5982\u679c\u4f60\u8fd8\u5728\u4e00\u4e2a\u5177\u4f53\u7684\u8def\u5f84\u64cd\u4f5c\u4e2d\u58f0\u660e\u4e86\u4f9d\u8d56\u9879\uff0c\u5b83\u4eec\u4e5f\u4f1a\u88ab\u6267\u884c\u3002</li> <li>\u8def\u7531\u5668\u7684\u4f9d\u8d56\u9879\u6700\u5148\u6267\u884c\uff0c\u7136\u540e\u662f\u88c5\u9970\u5668\u4e2d\u7684 <code>dependencies</code>\uff0c\u518d\u7136\u540e\u662f\u666e\u901a\u7684\u53c2\u6570\u4f9d\u8d56\u9879\u3002</li> <li>\u4f60\u8fd8\u53ef\u4ee5\u6dfb\u52a0\u5177\u6709 <code>scopes</code> \u7684 <code>Security</code> \u4f9d\u8d56\u9879\u3002</li> </ul> </li> </ul> <p>Tip</p> <p>\u5728 <code>APIRouter</code>\u4e2d\u5177\u6709 <code>dependencies</code> \u53ef\u4ee5\u7528\u6765\uff0c\u4f8b\u5982\uff0c\u5bf9\u4e00\u6574\u7ec4\u7684\u8def\u5f84\u64cd\u4f5c\u8981\u6c42\u8eab\u4efd\u8ba4\u8bc1\u3002\u5373\u4f7f\u8fd9\u4e9b\u4f9d\u8d56\u9879\u5e76\u6ca1\u6709\u5206\u522b\u6dfb\u52a0\u5230\u6bcf\u4e2a\u8def\u5f84\u64cd\u4f5c\u4e2d\u3002</p> <p>Check</p> <p><code>prefix</code>\u3001<code>tags</code>\u3001<code>responses</code> \u4ee5\u53ca <code>dependencies</code> \u53c2\u6570\u53ea\u662f\uff08\u548c\u5176\u4ed6\u5f88\u591a\u60c5\u51b5\u4e00\u6837\uff09FastAPI \u7684\u4e00\u4e2a\u7528\u4e8e\u5e2e\u52a9\u4f60\u907f\u514d\u4ee3\u7801\u91cd\u590d\u7684\u529f\u80fd\u3002</p>"},{"location":"tutorial/bigger-applications/#_3","title":"\u5bfc\u5165\u4f9d\u8d56\u9879","text":"<p>\u8fd9\u4e9b\u4ee3\u7801\u4f4d\u4e8e <code>app.routers.items</code> \u6a21\u5757\uff0c<code>app/routers/items.py</code> \u6587\u4ef6\u4e2d\u3002</p> <p>\u6211\u4eec\u9700\u8981\u4ece <code>app.dependencies</code> \u6a21\u5757\u5373 <code>app/dependencies.py</code> \u6587\u4ef6\u4e2d\u83b7\u53d6\u4f9d\u8d56\u51fd\u6570\u3002</p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u901a\u8fc7 <code>..</code> \u5bf9\u4f9d\u8d56\u9879\u4f7f\u7528\u4e86\u76f8\u5bf9\u5bfc\u5165\uff1a</p> <pre><code>from fastapi import APIRouter, Depends, HTTPException\n\nfrom ..dependencies import get_token_header\nrouter = APIRouter(\n    prefix=\"/items\",\n    tags=[\"items\"],\n    dependencies=[Depends(get_token_header)],\n    responses={404: {\"description\": \"Not found\"}},\n)\n\n\nfake_items_db = {\"plumbus\": {\"name\": \"Plumbus\"}, \"gun\": {\"name\": \"Portal Gun\"}}\n\n\n@router.get(\"/\")\nasync def read_items():\n    return fake_items_db\n\n\n@router.get(\"/{item_id}\")\nasync def read_item(item_id: str):\n    if item_id not in fake_items_db:\n        raise HTTPException(status_code=404, detail=\"Item not found\")\n    return {\"name\": fake_items_db[item_id][\"name\"], \"item_id\": item_id}\n\n\n@router.put(\n    \"/{item_id}\",\n    tags=[\"custom\"],\n    responses={403: {\"description\": \"Operation forbidden\"}},\n)\nasync def update_item(item_id: str):\n    if item_id != \"plumbus\":\n        raise HTTPException(\n            status_code=403, detail=\"You can only update the item: plumbus\"\n        )\n    return {\"item_id\": item_id, \"name\": \"The great Plumbus\"}\n</code></pre>"},{"location":"tutorial/bigger-applications/#_4","title":"\u76f8\u5bf9\u5bfc\u5165\u5982\u4f55\u5de5\u4f5c","text":"<p>Tip</p> <p>\u5982\u679c\u4f60\u5b8c\u5168\u4e86\u89e3\u5bfc\u5165\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u8bf7\u4ece\u4e0b\u9762\u7684\u4e0b\u4e00\u90e8\u5206\u7ee7\u7eed\u3002</p> <p>\u4e00\u4e2a\u5355\u70b9 <code>.</code>\uff0c\u4f8b\u5982\uff1a</p> <pre><code>from .dependencies import get_token_header\n</code></pre> <p>\u8868\u793a\uff1a</p> <ul> <li>\u4ece\u8be5\u6a21\u5757\uff08<code>app/routers/items.py</code> \u6587\u4ef6\uff09\u6240\u5728\u7684\u540c\u4e00\u4e2a\u5305\uff08<code>app/routers/</code> \u76ee\u5f55\uff09\u5f00\u59cb...</li> <li>\u627e\u5230 <code>dependencies</code> \u6a21\u5757\uff08\u4e00\u4e2a\u4f4d\u4e8e <code>app/routers/dependencies.py</code> \u7684\u865a\u6784\u6587\u4ef6\uff09...</li> <li>\u7136\u540e\u4ece\u4e2d\u5bfc\u5165\u51fd\u6570 <code>get_token_header</code>\u3002</li> </ul> <p>\u4f46\u662f\u8be5\u6587\u4ef6\u5e76\u4e0d\u5b58\u5728\uff0c\u6211\u4eec\u7684\u4f9d\u8d56\u9879\u4f4d\u4e8e <code>app/dependencies.py</code> \u6587\u4ef6\u4e2d\u3002</p> <p>\u8bf7\u8bb0\u4f4f\u6211\u4eec\u7684\u7a0b\u5e8f/\u6587\u4ef6\u7ed3\u6784\u662f\u600e\u6837\u7684\uff1a</p> <p></p> <p>\u4e24\u4e2a\u70b9 <code>..</code>\uff0c\u4f8b\u5982\uff1a</p> <pre><code>from ..dependencies import get_token_header\n</code></pre> <p>\u8868\u793a\uff1a</p> <ul> <li>\u4ece\u8be5\u6a21\u5757\uff08<code>app/routers/items.py</code> \u6587\u4ef6\uff09\u6240\u5728\u7684\u540c\u4e00\u4e2a\u5305\uff08<code>app/routers/</code> \u76ee\u5f55\uff09\u5f00\u59cb...</li> <li>\u8df3\u8f6c\u5230\u5176\u7236\u5305\uff08<code>app/</code> \u76ee\u5f55\uff09...</li> <li>\u5728\u8be5\u7236\u5305\u4e2d\uff0c\u627e\u5230 <code>dependencies</code> \u6a21\u5757\uff08\u4f4d\u4e8e <code>app/dependencies.py</code> \u7684\u6587\u4ef6\uff09...</li> <li>\u7136\u540e\u4ece\u4e2d\u5bfc\u5165\u51fd\u6570 <code>get_token_header</code>\u3002</li> </ul> <p>\u6b63\u5e38\u5de5\u4f5c\u4e86\uff01\ud83c\udf89</p> <p>\u540c\u6837\uff0c\u5982\u679c\u6211\u4eec\u4f7f\u7528\u4e86\u4e09\u4e2a\u70b9 <code>...</code>\uff0c\u4f8b\u5982\uff1a</p> <pre><code>from ...dependencies import get_token_header\n</code></pre> <p>\u90a3\u5c06\u610f\u5473\u7740\uff1a</p> <ul> <li>\u4ece\u8be5\u6a21\u5757\uff08<code>app/routers/items.py</code> \u6587\u4ef6\uff09\u6240\u5728\u7684\u540c\u4e00\u4e2a\u5305\uff08<code>app/routers/</code> \u76ee\u5f55\uff09\u5f00\u59cb...</li> <li>\u8df3\u8f6c\u5230\u5176\u7236\u5305\uff08<code>app/</code> \u76ee\u5f55\uff09...</li> <li>\u7136\u540e\u8df3\u8f6c\u5230\u8be5\u5305\u7684\u7236\u5305\uff08\u8be5\u7236\u5305\u5e76\u4e0d\u5b58\u5728\uff0c<code>app</code> \u5df2\u7ecf\u662f\u6700\u9876\u5c42\u7684\u5305 \ud83d\ude31\uff09...</li> <li>\u5728\u8be5\u7236\u5305\u4e2d\uff0c\u627e\u5230 <code>dependencies</code> \u6a21\u5757\uff08\u4f4d\u4e8e <code>app/</code> \u66f4\u4e0a\u4e00\u7ea7\u76ee\u5f55\u4e2d\u7684 <code>dependencies.py</code> \u6587\u4ef6\uff09...</li> <li>\u7136\u540e\u4ece\u4e2d\u5bfc\u5165\u51fd\u6570 <code>get_token_header</code>\u3002</li> </ul> <p>\u8fd9\u5c06\u5f15\u7528 <code>app/</code> \u7684\u5f80\u4e0a\u4e00\u7ea7\uff0c\u5e26\u6709\u5176\u81ea\u5df1\u7684 <code>__init __.py</code> \u7b49\u6587\u4ef6\u7684\u67d0\u4e2a\u5305\u3002\u4f46\u662f\u6211\u4eec\u5e76\u6ca1\u6709\u8fd9\u4e2a\u5305\u3002\u56e0\u6b64\uff0c\u8fd9\u5c06\u5728\u6211\u4eec\u7684\u793a\u4f8b\u4e2d\u5f15\u53d1\u9519\u8bef\u3002\ud83d\udea8</p> <p>\u4f46\u662f\u73b0\u5728\u4f60\u77e5\u9053\u4e86\u5b83\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u56e0\u6b64\u65e0\u8bba\u5b83\u4eec\u591a\u4e48\u590d\u6742\uff0c\u4f60\u90fd\u53ef\u4ee5\u5728\u81ea\u5df1\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u76f8\u5bf9\u5bfc\u5165\u3002\ud83e\udd13</p>"},{"location":"tutorial/bigger-applications/#tagsresponses-dependencies","title":"\u6dfb\u52a0\u4e00\u4e9b\u81ea\u5b9a\u4e49\u7684 <code>tags</code>\u3001<code>responses</code> \u548c <code>dependencies</code>","text":"<p>\u6211\u4eec\u4e0d\u6253\u7b97\u5728\u6bcf\u4e2a\u8def\u5f84\u64cd\u4f5c\u4e2d\u6dfb\u52a0\u524d\u7f00 <code>/items</code> \u6216 <code>tags =[\"items\"]</code>\uff0c\u56e0\u4e3a\u6211\u4eec\u5c06\u5b83\u4eec\u6dfb\u52a0\u5230\u4e86 <code>APIRouter</code> \u4e2d\u3002</p> <p>\u4f46\u662f\u6211\u4eec\u4ecd\u7136\u53ef\u4ee5\u6dfb\u52a0\u66f4\u591a\u5c06\u4f1a\u5e94\u7528\u4e8e\u7279\u5b9a\u7684\u8def\u5f84\u64cd\u4f5c\u7684 <code>tags</code>\uff0c\u4ee5\u53ca\u4e00\u4e9b\u7279\u5b9a\u4e8e\u8be5\u8def\u5f84\u64cd\u4f5c\u7684\u989d\u5916 <code>responses</code>\uff1a</p> <pre><code>from fastapi import APIRouter, Depends, HTTPException\n\nfrom ..dependencies import get_token_header\n\nrouter = APIRouter(\n    prefix=\"/items\",\n    tags=[\"items\"],\n    dependencies=[Depends(get_token_header)],\n    responses={404: {\"description\": \"Not found\"}},\n)\n\n\nfake_items_db = {\"plumbus\": {\"name\": \"Plumbus\"}, \"gun\": {\"name\": \"Portal Gun\"}}\n\n\n@router.get(\"/\")\nasync def read_items():\n    return fake_items_db\n\n\n@router.get(\"/{item_id}\")\nasync def read_item(item_id: str):\n    if item_id not in fake_items_db:\n        raise HTTPException(status_code=404, detail=\"Item not found\")\n    return {\"name\": fake_items_db[item_id][\"name\"], \"item_id\": item_id}\n\n\n@router.put(\n    \"/{item_id}\",\ntags=[\"custom\"],\nresponses={403: {\"description\": \"Operation forbidden\"}},\n)\nasync def update_item(item_id: str):\n    if item_id != \"plumbus\":\n        raise HTTPException(\n            status_code=403, detail=\"You can only update the item: plumbus\"\n        )\n    return {\"item_id\": item_id, \"name\": \"The great Plumbus\"}\n</code></pre> <p>Tip</p> <p>\u6700\u540e\u7684\u8fd9\u4e2a\u8def\u5f84\u64cd\u4f5c\u5c06\u5305\u542b\u6807\u7b7e\u7684\u7ec4\u5408\uff1a<code>[\"items\"\uff0c\"custom\"]</code>\u3002</p> <p>\u5e76\u4e14\u5728\u6587\u6863\u4e2d\u4e5f\u4f1a\u6709\u4e24\u4e2a\u54cd\u5e94\uff0c\u4e00\u4e2a\u7528\u4e8e <code>404</code>\uff0c\u4e00\u4e2a\u7528\u4e8e <code>403</code>\u3002</p>"},{"location":"tutorial/bigger-applications/#fastapi","title":"<code>FastAPI</code> \u4e3b\u4f53","text":"<p>\u73b0\u5728\uff0c\u8ba9\u6211\u4eec\u6765\u770b\u770b\u4f4d\u4e8e <code>app/main.py</code> \u7684\u6a21\u5757\u3002</p> <p>\u5728\u8fd9\u91cc\u4f60\u5bfc\u5165\u5e76\u4f7f\u7528 <code>FastAPI</code> \u7c7b\u3002</p> <p>\u8fd9\u5c06\u662f\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\u5c06\u6240\u6709\u5185\u5bb9\u8054\u7ed3\u5728\u4e00\u8d77\u7684\u4e3b\u6587\u4ef6\u3002</p> <p>\u5e76\u4e14\u7531\u4e8e\u4f60\u7684\u5927\u90e8\u5206\u903b\u8f91\u73b0\u5728\u90fd\u5b58\u5728\u4e8e\u5176\u81ea\u5df1\u7684\u7279\u5b9a\u6a21\u5757\u4e2d\uff0c\u56e0\u6b64\u4e3b\u6587\u4ef6\u7684\u5185\u5bb9\u5c06\u975e\u5e38\u7b80\u5355\u3002</p>"},{"location":"tutorial/bigger-applications/#fastapi_1","title":"\u5bfc\u5165 <code>FastAPI</code>","text":"<p>\u4f60\u53ef\u4ee5\u50cf\u5e73\u5e38\u4e00\u6837\u5bfc\u5165\u5e76\u521b\u5efa\u4e00\u4e2a <code>FastAPI</code> \u7c7b\u3002</p> <p>\u6211\u4eec\u751a\u81f3\u53ef\u4ee5\u58f0\u660e\u5168\u5c40\u4f9d\u8d56\u9879\uff0c\u5b83\u4f1a\u548c\u6bcf\u4e2a <code>APIRouter</code> \u7684\u4f9d\u8d56\u9879\u7ec4\u5408\u5728\u4e00\u8d77\uff1a</p> <pre><code>from fastapi import Depends, FastAPI\nfrom .dependencies import get_query_token, get_token_header\nfrom .internal import admin\nfrom .routers import items, users\n\napp = FastAPI(dependencies=[Depends(get_query_token)])\napp.include_router(users.router)\napp.include_router(items.router)\napp.include_router(\n    admin.router,\n    prefix=\"/admin\",\n    tags=[\"admin\"],\n    dependencies=[Depends(get_token_header)],\n    responses={418: {\"description\": \"I'm a teapot\"}},\n)\n\n\n@app.get(\"/\")\nasync def root():\n    return {\"message\": \"Hello Bigger Applications!\"}\n</code></pre>"},{"location":"tutorial/bigger-applications/#apirouter_4","title":"\u5bfc\u5165 <code>APIRouter</code>","text":"<p>\u73b0\u5728\uff0c\u6211\u4eec\u5bfc\u5165\u5177\u6709 <code>APIRouter</code> \u7684\u5176\u4ed6\u5b50\u6a21\u5757\uff1a</p> <pre><code>from fastapi import Depends, FastAPI\n\nfrom .dependencies import get_query_token, get_token_header\nfrom .internal import admin\nfrom .routers import items, users\napp = FastAPI(dependencies=[Depends(get_query_token)])\n\n\napp.include_router(users.router)\napp.include_router(items.router)\napp.include_router(\n    admin.router,\n    prefix=\"/admin\",\n    tags=[\"admin\"],\n    dependencies=[Depends(get_token_header)],\n    responses={418: {\"description\": \"I'm a teapot\"}},\n)\n\n\n@app.get(\"/\")\nasync def root():\n    return {\"message\": \"Hello Bigger Applications!\"}\n</code></pre> <p>\u7531\u4e8e\u6587\u4ef6 <code>app/routers/users.py</code> \u548c <code>app/routers/items.py</code> \u662f\u540c\u4e00 Python \u5305 <code>app</code> \u4e00\u4e2a\u90e8\u5206\u7684\u5b50\u6a21\u5757\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5355\u4e2a\u70b9 <code>.</code> \u901a\u8fc7\u300c\u76f8\u5bf9\u5bfc\u5165\u300d\u6765\u5bfc\u5165\u5b83\u4eec\u3002</p>"},{"location":"tutorial/bigger-applications/#_5","title":"\u5bfc\u5165\u662f\u5982\u4f55\u5de5\u4f5c\u7684","text":"<p>\u8fd9\u6bb5\u4ee3\u7801\uff1a</p> <pre><code>from .routers import items, users\n</code></pre> <p>\u8868\u793a\uff1a</p> <ul> <li>\u4ece\u8be5\u6a21\u5757\uff08<code>app/main.py</code> \u6587\u4ef6\uff09\u6240\u5728\u7684\u540c\u4e00\u4e2a\u5305\uff08<code>app/</code> \u76ee\u5f55\uff09\u5f00\u59cb...</li> <li>\u5bfb\u627e <code>routers</code> \u5b50\u5305\uff08\u4f4d\u4e8e <code>app/routers/</code> \u7684\u76ee\u5f55\uff09...</li> <li>\u4ece\u8be5\u5305\u4e2d\uff0c\u5bfc\u5165\u5b50\u6a21\u5757 <code>items</code> (\u4f4d\u4e8e <code>app/routers/items.py</code> \u7684\u6587\u4ef6) \u4ee5\u53ca <code>users</code> (\u4f4d\u4e8e <code>app/routers/users.py</code> \u7684\u6587\u4ef6)...</li> </ul> <p><code>items</code> \u6a21\u5757\u5c06\u5177\u6709\u4e00\u4e2a <code>router</code> \u53d8\u91cf\uff08<code>items.router</code>\uff09\u3002\u8fd9\u4e0e\u6211\u4eec\u5728 <code>app/routers/items.py</code> \u6587\u4ef6\u4e2d\u521b\u5efa\u7684\u53d8\u91cf\u76f8\u540c\uff0c\u5b83\u662f\u4e00\u4e2a <code>APIRouter</code> \u5bf9\u8c61\u3002</p> <p>\u7136\u540e\u6211\u4eec\u5bf9 <code>users</code> \u6a21\u5757\u8fdb\u884c\u76f8\u540c\u7684\u64cd\u4f5c\u3002</p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u50cf\u8fd9\u6837\u5bfc\u5165\u5b83\u4eec\uff1a</p> <pre><code>from app.routers import items, users\n</code></pre> <p>Info</p> <p>\u7b2c\u4e00\u4e2a\u7248\u672c\u662f\u300c\u76f8\u5bf9\u5bfc\u5165\u300d\uff1a</p> <pre><code>from .routers import items, users\n</code></pre> <p>\u7b2c\u4e8c\u4e2a\u7248\u672c\u662f\u300c\u7edd\u5bf9\u5bfc\u5165\u300d\uff1a</p> <pre><code>from app.routers import items, users\n</code></pre> <p>\u8981\u4e86\u89e3\u6709\u5173 Python \u5305\u548c\u6a21\u5757\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u67e5\u9605\u5173\u4e8e Modules \u7684 Python \u5b98\u65b9\u6587\u6863\u3002</p>"},{"location":"tutorial/bigger-applications/#_6","title":"\u907f\u514d\u540d\u79f0\u51b2\u7a81","text":"<p>\u6211\u4eec\u5c06\u76f4\u63a5\u5bfc\u5165 <code>items</code> \u5b50\u6a21\u5757\uff0c\u800c\u4e0d\u662f\u4ec5\u5bfc\u5165\u5176 <code>router</code> \u53d8\u91cf\u3002</p> <p>\u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u5728 <code>users</code> \u5b50\u6a21\u5757\u4e2d\u4e5f\u6709\u53e6\u4e00\u4e2a\u540d\u4e3a <code>router</code> \u7684\u53d8\u91cf\u3002</p> <p>\u5982\u679c\u6211\u4eec\u4e00\u4e2a\u63a5\u4e00\u4e2a\u5730\u5bfc\u5165\uff0c\u4f8b\u5982\uff1a</p> <pre><code>from .routers.items import router\nfrom .routers.users import router\n</code></pre> <p>\u6765\u81ea <code>users</code> \u7684 <code>router</code> \u5c06\u8986\u76d6\u6765\u81ea <code>items</code> \u4e2d\u7684 <code>router</code>\uff0c\u6211\u4eec\u5c06\u65e0\u6cd5\u540c\u65f6\u4f7f\u7528\u5b83\u4eec\u3002</p> <p>\u56e0\u6b64\uff0c\u4e3a\u4e86\u80fd\u591f\u5728\u540c\u4e00\u4e2a\u6587\u4ef6\u4e2d\u4f7f\u7528\u5b83\u4eec\uff0c\u6211\u4eec\u76f4\u63a5\u5bfc\u5165\u5b50\u6a21\u5757\uff1a</p> <pre><code>from fastapi import Depends, FastAPI\n\nfrom .dependencies import get_query_token, get_token_header\nfrom .internal import admin\nfrom .routers import items, users\n\napp = FastAPI(dependencies=[Depends(get_query_token)])\n\n\napp.include_router(users.router)\napp.include_router(items.router)\napp.include_router(\n    admin.router,\n    prefix=\"/admin\",\n    tags=[\"admin\"],\n    dependencies=[Depends(get_token_header)],\n    responses={418: {\"description\": \"I'm a teapot\"}},\n)\n\n\n@app.get(\"/\")\nasync def root():\n    return {\"message\": \"Hello Bigger Applications!\"}\n</code></pre>"},{"location":"tutorial/bigger-applications/#users-items-apirouter","title":"\u5305\u542b <code>users</code> \u548c <code>items</code> \u7684 <code>APIRouter</code>","text":"<p>\u73b0\u5728\uff0c\u8ba9\u6211\u4eec\u6765\u5305\u542b\u6765\u81ea <code>users</code> \u548c <code>items</code> \u5b50\u6a21\u5757\u7684 <code>router</code>\u3002</p> <pre><code>from fastapi import Depends, FastAPI\n\nfrom .dependencies import get_query_token, get_token_header\nfrom .internal import admin\nfrom .routers import items, users\n\napp = FastAPI(dependencies=[Depends(get_query_token)])\n\n\napp.include_router(users.router)\napp.include_router(items.router)\napp.include_router(\n    admin.router,\n    prefix=\"/admin\",\n    tags=[\"admin\"],\n    dependencies=[Depends(get_token_header)],\n    responses={418: {\"description\": \"I'm a teapot\"}},\n)\n\n\n@app.get(\"/\")\nasync def root():\n    return {\"message\": \"Hello Bigger Applications!\"}\n</code></pre> <p>Info</p> <p><code>users.router</code> \u5305\u542b\u4e86 <code>app/routers/users.py</code> \u6587\u4ef6\u4e2d\u7684 <code>APIRouter</code>\u3002</p> <p><code>items.router</code> \u5305\u542b\u4e86 <code>app/routers/items.py</code> \u6587\u4ef6\u4e2d\u7684 <code>APIRouter</code>\u3002</p> <p>\u4f7f\u7528 <code>app.include_router()</code>\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u6bcf\u4e2a <code>APIRouter</code> \u6dfb\u52a0\u5230\u4e3b <code>FastAPI</code> \u5e94\u7528\u7a0b\u5e8f\u4e2d\u3002</p> <p>\u5b83\u5c06\u5305\u542b\u6765\u81ea\u8be5\u8def\u7531\u5668\u7684\u6240\u6709\u8def\u7531\u4f5c\u4e3a\u5176\u4e00\u90e8\u5206\u3002</p> <p>\u6280\u672f\u7ec6\u8282</p> <p>\u5b9e\u9645\u4e0a\uff0c\u5b83\u5c06\u5728\u5185\u90e8\u4e3a\u58f0\u660e\u5728 <code>APIRouter</code> \u4e2d\u7684\u6bcf\u4e2a\u8def\u5f84\u64cd\u4f5c\u521b\u5efa\u4e00\u4e2a\u8def\u5f84\u64cd\u4f5c\u3002</p> <p>\u6240\u4ee5\uff0c\u5728\u5e55\u540e\uff0c\u5b83\u5b9e\u9645\u4e0a\u4f1a\u50cf\u6240\u6709\u7684\u4e1c\u897f\u90fd\u662f\u540c\u4e00\u4e2a\u5e94\u7528\u7a0b\u5e8f\u4e00\u6837\u5de5\u4f5c\u3002</p> <p>Check</p> <p>\u5305\u542b\u8def\u7531\u5668\u65f6\uff0c\u4f60\u4e0d\u5fc5\u62c5\u5fc3\u6027\u80fd\u95ee\u9898\u3002</p> <p>\u8fd9\u5c06\u82b1\u8d39\u51e0\u5fae\u79d2\u65f6\u95f4\uff0c\u5e76\u4e14\u53ea\u4f1a\u5728\u542f\u52a8\u65f6\u53d1\u751f\u3002</p> <p>\u56e0\u6b64\uff0c\u5b83\u4e0d\u4f1a\u5f71\u54cd\u6027\u80fd\u3002\u26a1</p>"},{"location":"tutorial/bigger-applications/#prefixtagsresponses-dependencies-apirouter","title":"\u5305\u542b\u4e00\u4e2a\u6709\u81ea\u5b9a\u4e49 <code>prefix</code>\u3001<code>tags</code>\u3001<code>responses</code> \u548c <code>dependencies</code> \u7684 <code>APIRouter</code>","text":"<p>\u73b0\u5728\uff0c\u5047\u8bbe\u4f60\u7684\u7ec4\u7ec7\u4e3a\u4f60\u63d0\u4f9b\u4e86 <code>app/internal/admin.py</code> \u6587\u4ef6\u3002</p> <p>\u5b83\u5305\u542b\u4e00\u4e2a\u5e26\u6709\u4e00\u4e9b\u7531\u4f60\u7684\u7ec4\u7ec7\u5728\u591a\u4e2a\u9879\u76ee\u4e4b\u95f4\u5171\u4eab\u7684\u7ba1\u7406\u5458\u8def\u5f84\u64cd\u4f5c\u7684 <code>APIRouter</code>\u3002</p> <p>\u5bf9\u4e8e\u6b64\u793a\u4f8b\uff0c\u5b83\u5c06\u975e\u5e38\u7b80\u5355\u3002\u4f46\u662f\u5047\u8bbe\u7531\u4e8e\u5b83\u662f\u4e0e\u7ec4\u7ec7\u4e2d\u7684\u5176\u4ed6\u9879\u76ee\u6240\u5171\u4eab\u7684\uff0c\u56e0\u6b64\u6211\u4eec\u65e0\u6cd5\u5bf9\u5176\u8fdb\u884c\u4fee\u6539\uff0c\u4ee5\u53ca\u76f4\u63a5\u5728 <code>APIRouter</code> \u4e2d\u6dfb\u52a0 <code>prefix</code>\u3001<code>dependencies</code>\u3001<code>tags</code> \u7b49\uff1a</p> <pre><code>from fastapi import APIRouter\n\nrouter = APIRouter()\n@router.post(\"/\")\nasync def update_admin():\n    return {\"message\": \"Admin getting schwifty\"}\n</code></pre> <p>\u4f46\u662f\u6211\u4eec\u4ecd\u7136\u5e0c\u671b\u5728\u5305\u542b <code>APIRouter</code> \u65f6\u8bbe\u7f6e\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684 <code>prefix</code>\uff0c\u4ee5\u4fbf\u5176\u6240\u6709\u8def\u5f84\u64cd\u4f5c\u4ee5 <code>/admin</code> \u5f00\u5934\uff0c\u6211\u4eec\u5e0c\u671b\u4f7f\u7528\u672c\u9879\u76ee\u5df2\u7ecf\u6709\u7684 <code>dependencies</code> \u4fdd\u62a4\u5b83\uff0c\u5e76\u4e14\u6211\u4eec\u5e0c\u671b\u5b83\u5305\u542b\u81ea\u5b9a\u4e49\u7684 <code>tags</code> \u548c <code>responses</code>\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5c06\u8fd9\u4e9b\u53c2\u6570\u4f20\u9012\u7ed9 <code>app.include_router()</code> \u6765\u5b8c\u6210\u6240\u6709\u7684\u58f0\u660e\uff0c\u800c\u4e0d\u5fc5\u4fee\u6539\u539f\u59cb\u7684 <code>APIRouter</code>\uff1a</p> <pre><code>from fastapi import Depends, FastAPI\n\nfrom .dependencies import get_query_token, get_token_header\nfrom .internal import admin\nfrom .routers import items, users\n\napp = FastAPI(dependencies=[Depends(get_query_token)])\n\n\napp.include_router(users.router)\napp.include_router(items.router)\napp.include_router(\n    admin.router,\nprefix=\"/admin\",\ntags=[\"admin\"],\ndependencies=[Depends(get_token_header)],\nresponses={418: {\"description\": \"I'm a teapot\"}},\n)\n\n\n@app.get(\"/\")\nasync def root():\n    return {\"message\": \"Hello Bigger Applications!\"}\n</code></pre> <p>\u8fd9\u6837\uff0c\u539f\u59cb\u7684 <code>APIRouter</code> \u5c06\u4fdd\u6301\u4e0d\u53d8\uff0c\u56e0\u6b64\u6211\u4eec\u4ecd\u7136\u53ef\u4ee5\u4e0e\u7ec4\u7ec7\u4e2d\u7684\u5176\u4ed6\u9879\u76ee\u5171\u4eab\u76f8\u540c\u7684 <code>app/internal/admin.py</code> \u6587\u4ef6\u3002</p> <p>\u7ed3\u679c\u662f\u5728\u6211\u4eec\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u6765\u81ea <code>admin</code> \u6a21\u5757\u7684\u6bcf\u4e2a\u8def\u5f84\u64cd\u4f5c\u90fd\u5c06\u5177\u6709\uff1a</p> <ul> <li><code>/admin</code> \u524d\u7f00 \u3002</li> <li><code>admin</code> \u6807\u7b7e\u3002</li> <li><code>get_token_header</code> \u4f9d\u8d56\u9879\u3002</li> <li><code>418</code> \u54cd\u5e94\u3002 \ud83c\udf75</li> </ul> <p>\u4f46\u8fd9\u53ea\u4f1a\u5f71\u54cd\u6211\u4eec\u5e94\u7528\u4e2d\u7684 <code>APIRouter</code>\uff0c\u800c\u4e0d\u4f1a\u5f71\u54cd\u4f7f\u7528\u5b83\u7684\u4efb\u4f55\u5176\u4ed6\u4ee3\u7801\u3002</p> <p>\u56e0\u6b64\uff0c\u4e3e\u4f8b\u6765\u8bf4\uff0c\u5176\u4ed6\u9879\u76ee\u80fd\u591f\u4ee5\u4e0d\u540c\u7684\u8eab\u4efd\u8ba4\u8bc1\u65b9\u6cd5\u4f7f\u7528\u76f8\u540c\u7684 <code>APIRouter</code>\u3002</p>"},{"location":"tutorial/bigger-applications/#_7","title":"\u5305\u542b\u4e00\u4e2a\u8def\u5f84\u64cd\u4f5c","text":"<p>\u6211\u4eec\u8fd8\u53ef\u4ee5\u76f4\u63a5\u5c06\u8def\u5f84\u64cd\u4f5c\u6dfb\u52a0\u5230 <code>FastAPI</code> \u5e94\u7528\u4e2d\u3002</p> <p>\u8fd9\u91cc\u6211\u4eec\u8fd9\u6837\u505a\u4e86...\u53ea\u662f\u4e3a\u4e86\u8868\u660e\u6211\u4eec\u53ef\u4ee5\u505a\u5230\ud83e\udd37\uff1a</p> <pre><code>from fastapi import Depends, FastAPI\n\nfrom .dependencies import get_query_token, get_token_header\nfrom .internal import admin\nfrom .routers import items, users\n\napp = FastAPI(dependencies=[Depends(get_query_token)])\n\n\napp.include_router(users.router)\napp.include_router(items.router)\napp.include_router(\n    admin.router,\n    prefix=\"/admin\",\n    tags=[\"admin\"],\n    dependencies=[Depends(get_token_header)],\n    responses={418: {\"description\": \"I'm a teapot\"}},\n)\n\n\n@app.get(\"/\")\nasync def root():\nreturn {\"message\": \"Hello Bigger Applications!\"}\n</code></pre> <p>\u5b83\u5c06\u4e0e\u901a\u8fc7 <code>app.include_router()</code> \u6dfb\u52a0\u7684\u6240\u6709\u5176\u4ed6\u8def\u5f84\u64cd\u4f5c\u4e00\u8d77\u6b63\u5e38\u8fd0\u884c\u3002</p> <p>\u7279\u522b\u7684\u6280\u672f\u7ec6\u8282</p> <p>\u6ce8\u610f\uff1a\u8fd9\u662f\u4e00\u4e2a\u975e\u5e38\u6280\u672f\u6027\u7684\u7ec6\u8282\uff0c\u4f60\u4e5f\u8bb8\u53ef\u4ee5\u76f4\u63a5\u8df3\u8fc7\u3002</p> <p><code>APIRouter</code> \u6ca1\u6709\u88ab\u300c\u6302\u8f7d\u300d\uff0c\u5b83\u4eec\u4e0e\u5e94\u7528\u7a0b\u5e8f\u7684\u5176\u4f59\u90e8\u5206\u6ca1\u6709\u9694\u79bb\u3002</p> <p>\u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u60f3\u8981\u5728 OpenAPI \u6a21\u5f0f\u548c\u7528\u6237\u754c\u9762\u4e2d\u5305\u542b\u5b83\u4eec\u7684\u8def\u5f84\u64cd\u4f5c\u3002</p> <p>\u7531\u4e8e\u6211\u4eec\u4e0d\u80fd\u4ec5\u4ec5\u9694\u79bb\u5b83\u4eec\u5e76\u72ec\u7acb\u4e8e\u5176\u4f59\u90e8\u5206\u6765\u300c\u6302\u8f7d\u300d\u5b83\u4eec\uff0c\u56e0\u6b64\u8def\u5f84\u64cd\u4f5c\u662f\u88ab\u300c\u514b\u9686\u7684\u300d\uff08\u91cd\u65b0\u521b\u5efa\uff09\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u5305\u542b\u3002</p>"},{"location":"tutorial/bigger-applications/#api","title":"\u67e5\u770b\u81ea\u52a8\u5316\u7684 API \u6587\u6863","text":"<p>\u73b0\u5728\uff0c\u4f7f\u7528 <code>app.main</code> \u6a21\u5757\u548c <code>app</code> \u53d8\u91cf\u8fd0\u884c <code>uvicorn</code>\uff1a</p> <pre><code>$ uvicorn app.main:app --reload\n\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n</code></pre> <p>\u7136\u540e\u6253\u5f00\u4f4d\u4e8e http://127.0.0.1:8000/docs \u7684\u6587\u6863\u3002</p> <p>\u4f60\u5c06\u770b\u5230\u4f7f\u7528\u4e86\u6b63\u786e\u8def\u5f84\uff08\u548c\u524d\u7f00\uff09\u548c\u6b63\u786e\u6807\u7b7e\u7684\u81ea\u52a8\u5316 API \u6587\u6863\uff0c\u5305\u62ec\u4e86\u6765\u81ea\u6240\u6709\u5b50\u6a21\u5757\u7684\u8def\u5f84\uff1a</p> <p></p>"},{"location":"tutorial/bigger-applications/#prefix","title":"\u591a\u6b21\u4f7f\u7528\u4e0d\u540c\u7684 <code>prefix</code> \u5305\u542b\u540c\u4e00\u4e2a\u8def\u7531\u5668","text":"<p>\u4f60\u4e5f\u53ef\u4ee5\u5728\u540c\u4e00\u8def\u7531\u5668\u4e0a\u4f7f\u7528\u4e0d\u540c\u7684\u524d\u7f00\u6765\u591a\u6b21\u4f7f\u7528 <code>.include_router()</code>\u3002</p> <p>\u5728\u6709\u4e9b\u573a\u666f\u8fd9\u53ef\u80fd\u6709\u7528\uff0c\u4f8b\u5982\u4ee5\u4e0d\u540c\u7684\u524d\u7f00\u516c\u5f00\u540c\u4e00\u4e2a\u7684 API\uff0c\u6bd4\u65b9\u8bf4 <code>/api/v1</code> \u548c <code>/api/latest</code>\u3002</p> <p>\u8fd9\u662f\u4e00\u4e2a\u4f60\u53ef\u80fd\u5e76\u4e0d\u771f\u6b63\u9700\u8981\u7684\u9ad8\u7ea7\u7528\u6cd5\uff0c\u4f46\u4e07\u4e00\u4f60\u6709\u9700\u8981\u4e86\u5c31\u80fd\u591f\u7528\u4e0a\u3002</p>"},{"location":"tutorial/bigger-applications/#apirouter-apirouter","title":"\u5728\u53e6\u4e00\u4e2a <code>APIRouter</code> \u4e2d\u5305\u542b\u4e00\u4e2a <code>APIRouter</code>","text":"<p>\u4e0e\u5728 <code>FastAPI</code> \u5e94\u7528\u7a0b\u5e8f\u4e2d\u5305\u542b <code>APIRouter</code> \u7684\u65b9\u5f0f\u76f8\u540c\uff0c\u4f60\u4e5f\u53ef\u4ee5\u5728\u53e6\u4e00\u4e2a <code>APIRouter</code> \u4e2d\u5305\u542b <code>APIRouter</code>\uff0c\u901a\u8fc7\uff1a</p> <pre><code>router.include_router(other_router)\n</code></pre> <p>\u8bf7\u786e\u4fdd\u5728\u4f60\u5c06 <code>router</code> \u5305\u542b\u5230 <code>FastAPI</code> \u5e94\u7528\u7a0b\u5e8f\u4e4b\u524d\u8fdb\u884c\u6b64\u64cd\u4f5c\uff0c\u4ee5\u4fbf <code>other_router</code> \u4e2d\u7684<code>\u8def\u5f84\u64cd\u4f5c</code>\u4e5f\u80fd\u88ab\u5305\u542b\u8fdb\u6765\u3002</p>"},{"location":"tutorial/body-fields/","title":"\u8bf7\u6c42\u4f53 - \u5b57\u6bb5","text":"<p>\u4e0e\u4f7f\u7528 <code>Query</code>\u3001<code>Path</code> \u548c <code>Body</code> \u5728\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u4e2d\u58f0\u660e\u989d\u5916\u7684\u6821\u9a8c\u548c\u5143\u6570\u636e\u7684\u65b9\u5f0f\u76f8\u540c\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 Pydantic \u7684 <code>Field</code> \u5728 Pydantic \u6a21\u578b\u5185\u90e8\u58f0\u660e\u6821\u9a8c\u548c\u5143\u6570\u636e\u3002</p>"},{"location":"tutorial/body-fields/#field","title":"\u5bfc\u5165 <code>Field</code>","text":"<p>\u9996\u5148\uff0c\u4f60\u5fc5\u987b\u5bfc\u5165\u5b83\uff1a</p> <pre><code>from typing import Union\nfrom fastapi import Body, FastAPI\nfrom pydantic import BaseModel, Field\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = Field(\n        default=None, title=\"The description of the item\", max_length=300\n    )\n    price: float = Field(gt=0, description=\"The price must be greater than zero\")\n    tax: Union[float, None] = None\n\n\n@app.put(\"/items/{item_id}\")\nasync def update_item(item_id: int, item: Item = Body(embed=True)):\n    results = {\"item_id\": item_id, \"item\": item}\n    return results\n</code></pre> <p>Warning</p> <p>\u6ce8\u610f\uff0c<code>Field</code> \u662f\u76f4\u63a5\u4ece <code>pydantic</code> \u5bfc\u5165\u7684\uff0c\u800c\u4e0d\u662f\u50cf\u5176\u4ed6\u7684\uff08<code>Query</code>\uff0c<code>Path</code>\uff0c<code>Body</code> \u7b49\uff09\u90fd\u4ece <code>fastapi</code> \u5bfc\u5165\u3002</p>"},{"location":"tutorial/body-fields/#_1","title":"\u58f0\u660e\u6a21\u578b\u5c5e\u6027","text":"<p>\u7136\u540e\uff0c\u4f60\u53ef\u4ee5\u5bf9\u6a21\u578b\u5c5e\u6027\u4f7f\u7528 <code>Field</code>\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import Body, FastAPI\nfrom pydantic import BaseModel, Field\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\nname: str\ndescription: Union[str, None] = Field(\n        default=None, title=\"The description of the item\", max_length=300\n    )\n    price: float = Field(gt=0, description=\"The price must be greater than zero\")\n    tax: Union[float, None] = None\n\n\n@app.put(\"/items/{item_id}\")\nasync def update_item(item_id: int, item: Item = Body(embed=True)):\n    results = {\"item_id\": item_id, \"item\": item}\n    return results\n</code></pre> <p><code>Field</code> \u7684\u5de5\u4f5c\u65b9\u5f0f\u548c <code>Query</code>\u3001<code>Path</code> \u548c <code>Body</code> \u76f8\u540c\uff0c\u5305\u62ec\u5b83\u4eec\u7684\u53c2\u6570\u7b49\u7b49\u4e5f\u5b8c\u5168\u76f8\u540c\u3002</p> <p>\u6280\u672f\u7ec6\u8282</p> <p>\u5b9e\u9645\u4e0a\uff0c<code>Query</code>\u3001<code>Path</code> \u548c\u5176\u4ed6\u4f60\u5c06\u5728\u4e4b\u540e\u770b\u5230\u7684\u7c7b\uff0c\u521b\u5efa\u7684\u662f\u7531\u4e00\u4e2a\u5171\u540c\u7684 <code>Params</code> \u7c7b\u6d3e\u751f\u7684\u5b50\u7c7b\u7684\u5bf9\u8c61\uff0c\u8be5\u5171\u540c\u7c7b\u672c\u8eab\u53c8\u662f Pydantic \u7684 <code>FieldInfo</code> \u7c7b\u7684\u5b50\u7c7b\u3002</p> <p>Pydantic \u7684 <code>Field</code> \u4e5f\u4f1a\u8fd4\u56de\u4e00\u4e2a <code>FieldInfo</code> \u7684\u5b9e\u4f8b\u3002</p> <p><code>Body</code> \u4e5f\u76f4\u63a5\u8fd4\u56de <code>FieldInfo</code> \u7684\u4e00\u4e2a\u5b50\u7c7b\u7684\u5bf9\u8c61\u3002\u8fd8\u6709\u5176\u4ed6\u4e00\u4e9b\u4f60\u4e4b\u540e\u4f1a\u770b\u5230\u7684\u7c7b\u662f <code>Body</code> \u7c7b\u7684\u5b50\u7c7b\u3002</p> <p>\u8bf7\u8bb0\u4f4f\u5f53\u4f60\u4ece <code>fastapi</code> \u5bfc\u5165 <code>Query</code>\u3001<code>Path</code> \u7b49\u5bf9\u8c61\u65f6\uff0c\u4ed6\u4eec\u5b9e\u9645\u4e0a\u662f\u8fd4\u56de\u7279\u6b8a\u7c7b\u7684\u51fd\u6570\u3002</p> <p>Tip</p> <p>\u6ce8\u610f\u6bcf\u4e2a\u6a21\u578b\u5c5e\u6027\u5982\u4f55\u4f7f\u7528\u7c7b\u578b\u3001\u9ed8\u8ba4\u503c\u548c <code>Field</code> \u5728\u4ee3\u7801\u7ed3\u6784\u4e0a\u548c\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u7684\u53c2\u6570\u662f\u76f8\u540c\u7684\uff0c\u533a\u522b\u662f\u7528 <code>Field</code> \u66ff\u6362<code>Path</code>\u3001<code>Query</code> \u548c <code>Body</code>\u3002</p>"},{"location":"tutorial/body-fields/#_2","title":"\u6dfb\u52a0\u989d\u5916\u4fe1\u606f","text":"<p>\u4f60\u53ef\u4ee5\u5728 <code>Field</code>\u3001<code>Query</code>\u3001<code>Body</code> \u4e2d\u58f0\u660e\u989d\u5916\u7684\u4fe1\u606f\u3002\u8fd9\u4e9b\u4fe1\u606f\u5c06\u5305\u542b\u5728\u751f\u6210\u7684 JSON Schema \u4e2d\u3002</p> <p>\u4f60\u5c06\u5728\u6587\u6863\u7684\u540e\u9762\u90e8\u5206\u5b66\u4e60\u58f0\u660e\u793a\u4f8b\u65f6\uff0c\u4e86\u89e3\u5230\u66f4\u591a\u6709\u5173\u6dfb\u52a0\u989d\u5916\u4fe1\u606f\u7684\u77e5\u8bc6\u3002</p>"},{"location":"tutorial/body-fields/#_3","title":"\u603b\u7ed3","text":"<p>\u4f60\u53ef\u4ee5\u4f7f\u7528 Pydantic \u7684 <code>Field</code> \u4e3a\u6a21\u578b\u5c5e\u6027\u58f0\u660e\u989d\u5916\u7684\u6821\u9a8c\u548c\u5143\u6570\u636e\u3002</p> <p>\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528\u989d\u5916\u7684\u5173\u952e\u5b57\u53c2\u6570\u6765\u4f20\u9012\u989d\u5916\u7684 JSON Schema \u5143\u6570\u636e\u3002</p>"},{"location":"tutorial/body-multiple-params/","title":"\u8bf7\u6c42\u4f53 - \u591a\u4e2a\u53c2\u6570","text":"<p>\u65e2\u7136\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u4e86\u5982\u4f55\u4f7f\u7528 <code>Path</code> \u548c <code>Query</code>\uff0c\u4e0b\u9762\u8ba9\u6211\u4eec\u6765\u4e86\u89e3\u4e00\u4e0b\u8bf7\u6c42\u4f53\u58f0\u660e\u7684\u66f4\u9ad8\u7ea7\u7528\u6cd5\u3002</p>"},{"location":"tutorial/body-multiple-params/#pathquery","title":"\u6df7\u5408\u4f7f\u7528 <code>Path</code>\u3001<code>Query</code> \u548c\u8bf7\u6c42\u4f53\u53c2\u6570","text":"<p>\u9996\u5148\uff0c\u6beb\u65e0\u7591\u95ee\u5730\uff0c\u4f60\u53ef\u4ee5\u968f\u610f\u5730\u6df7\u5408\u4f7f\u7528 <code>Path</code>\u3001<code>Query</code> \u548c\u8bf7\u6c42\u4f53\u53c2\u6570\u58f0\u660e\uff0cFastAPI \u4f1a\u77e5\u9053\u8be5\u5982\u4f55\u5904\u7406\u3002</p> <p>\u4f60\u8fd8\u53ef\u4ee5\u901a\u8fc7\u5c06\u9ed8\u8ba4\u503c\u8bbe\u7f6e\u4e3a <code>None</code> \u6765\u5c06\u8bf7\u6c42\u4f53\u53c2\u6570\u58f0\u660e\u4e3a\u53ef\u9009\u53c2\u6570\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI, Path\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n\n\n@app.put(\"/items/{item_id}\")\nasync def update_item(\n*,\nitem_id: int = Path(title=\"The ID of the item to get\", ge=0, le=1000),\nq: Union[str, None] = None,\n    item: Union[Item, None] = None,\n):\n    results = {\"item_id\": item_id}\n    if q:\n        results.update({\"q\": q})\n    if item:\n        results.update({\"item\": item})\n    return results\n</code></pre> <p>Note</p> <p>\u8bf7\u6ce8\u610f\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5c06\u4ece\u8bf7\u6c42\u4f53\u83b7\u53d6\u7684 <code>item</code> \u662f\u53ef\u9009\u7684\u3002\u56e0\u4e3a\u5b83\u7684\u9ed8\u8ba4\u503c\u4e3a <code>None</code>\u3002</p>"},{"location":"tutorial/body-multiple-params/#_1","title":"\u591a\u4e2a\u8bf7\u6c42\u4f53\u53c2\u6570","text":"<p>\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u8def\u5f84\u64cd\u4f5c\u5c06\u671f\u671b\u4e00\u4e2a\u5177\u6709 <code>Item</code> \u7684\u5c5e\u6027\u7684 JSON \u8bf7\u6c42\u4f53\uff0c\u5c31\u50cf\uff1a</p> <pre><code>{\n\"name\": \"Foo\",\n\"description\": \"The pretender\",\n\"price\": 42.0,\n\"tax\": 3.2\n}\n</code></pre> <p>\u4f46\u662f\u4f60\u4e5f\u53ef\u4ee5\u58f0\u660e\u591a\u4e2a\u8bf7\u6c42\u4f53\u53c2\u6570\uff0c\u4f8b\u5982 <code>item</code> \u548c <code>user</code>\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n\n\nclass User(BaseModel):\n    username: str\n    full_name: Union[str, None] = None\n\n@app.put(\"/items/{item_id}\")\nasync def update_item(item_id: int, item: Item, user: User):\n    results = {\"item_id\": item_id, \"item\": item, \"user\": user}\n    return results\n</code></pre> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cFastAPI \u5c06\u6ce8\u610f\u5230\u8be5\u51fd\u6570\u4e2d\u6709\u591a\u4e2a\u8bf7\u6c42\u4f53\u53c2\u6570\uff08\u4e24\u4e2a Pydantic \u6a21\u578b\u53c2\u6570\uff09\u3002</p> <p>\u56e0\u6b64\uff0c\u5b83\u5c06\u4f7f\u7528\u53c2\u6570\u540d\u79f0\u4f5c\u4e3a\u8bf7\u6c42\u4f53\u4e2d\u7684\u952e\uff08\u5b57\u6bb5\u540d\u79f0\uff09\uff0c\u5e76\u671f\u671b\u4e00\u4e2a\u7c7b\u4f3c\u4e8e\u4ee5\u4e0b\u5185\u5bb9\u7684\u8bf7\u6c42\u4f53\uff1a</p> <pre><code>{\n\"item\": {\n\"name\": \"Foo\",\n\"description\": \"The pretender\",\n\"price\": 42.0,\n\"tax\": 3.2\n},\n\"user\": {\n\"username\": \"dave\",\n\"full_name\": \"Dave Grohl\"\n}\n}\n</code></pre> <p>Note</p> <p>\u8bf7\u6ce8\u610f\uff0c\u5373\u4f7f <code>item</code> \u7684\u58f0\u660e\u65b9\u5f0f\u4e0e\u4e4b\u524d\u76f8\u540c\uff0c\u4f46\u73b0\u5728\u5b83\u88ab\u671f\u671b\u901a\u8fc7 <code>item</code> \u952e\u5185\u5d4c\u5728\u8bf7\u6c42\u4f53\u4e2d\u3002</p> <p>FastAPI \u5c06\u81ea\u52a8\u5bf9\u8bf7\u6c42\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u8f6c\u6362\uff0c\u56e0\u6b64 <code>item</code> \u53c2\u6570\u5c06\u63a5\u6536\u6307\u5b9a\u7684\u5185\u5bb9\uff0c<code>user</code> \u53c2\u6570\u4e5f\u662f\u5982\u6b64\u3002</p> <p>\u5b83\u5c06\u6267\u884c\u5bf9\u590d\u5408\u6570\u636e\u7684\u6821\u9a8c\uff0c\u5e76\u4e14\u50cf\u73b0\u5728\u8fd9\u6837\u4e3a OpenAPI \u6a21\u5f0f\u548c\u81ea\u52a8\u5316\u6587\u6863\u5bf9\u5176\u8fdb\u884c\u8bb0\u5f55\u3002</p>"},{"location":"tutorial/body-multiple-params/#_2","title":"\u8bf7\u6c42\u4f53\u4e2d\u7684\u5355\u4e00\u503c","text":"<p>\u4e0e\u4f7f\u7528 <code>Query</code> \u548c <code>Path</code> \u4e3a\u67e5\u8be2\u53c2\u6570\u548c\u8def\u5f84\u53c2\u6570\u5b9a\u4e49\u989d\u5916\u6570\u636e\u7684\u65b9\u5f0f\u76f8\u540c\uff0cFastAPI \u63d0\u4f9b\u4e86\u4e00\u4e2a\u540c\u7b49\u7684 <code>Body</code>\u3002</p> <p>\u4f8b\u5982\uff0c\u4e3a\u4e86\u6269\u5c55\u5148\u524d\u7684\u6a21\u578b\uff0c\u4f60\u53ef\u80fd\u51b3\u5b9a\u9664\u4e86 <code>item</code> \u548c <code>user</code> \u4e4b\u5916\uff0c\u8fd8\u60f3\u5728\u540c\u4e00\u8bf7\u6c42\u4f53\u4e2d\u5177\u6709\u53e6\u4e00\u4e2a\u952e <code>importance</code>\u3002</p> <p>\u5982\u679c\u4f60\u5c31\u6309\u539f\u6837\u58f0\u660e\u5b83\uff0c\u56e0\u4e3a\u5b83\u662f\u4e00\u4e2a\u5355\u4e00\u503c\uff0cFastAPI \u5c06\u5047\u5b9a\u5b83\u662f\u4e00\u4e2a\u67e5\u8be2\u53c2\u6570\u3002</p> <p>\u4f46\u662f\u4f60\u53ef\u4ee5\u4f7f\u7528 <code>Body</code> \u6307\u793a FastAPI \u5c06\u5176\u4f5c\u4e3a\u8bf7\u6c42\u4f53\u7684\u53e6\u4e00\u4e2a\u952e\u8fdb\u884c\u5904\u7406\u3002</p> <pre><code>from typing import Union\n\nfrom fastapi import Body, FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n\n\nclass User(BaseModel):\n    username: str\n    full_name: Union[str, None] = None\n\n\n@app.put(\"/items/{item_id}\")\nasync def update_item(item_id: int, item: Item, user: User, importance: int = Body()):\nresults = {\"item_id\": item_id, \"item\": item, \"user\": user, \"importance\": importance}\n    return results\n</code></pre> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cFastAPI \u5c06\u671f\u671b\u50cf\u8fd9\u6837\u7684\u8bf7\u6c42\u4f53\uff1a</p> <pre><code>{\n\"item\": {\n\"name\": \"Foo\",\n\"description\": \"The pretender\",\n\"price\": 42.0,\n\"tax\": 3.2\n},\n\"user\": {\n\"username\": \"dave\",\n\"full_name\": \"Dave Grohl\"\n},\n\"importance\": 5\n}\n</code></pre> <p>\u540c\u6837\u7684\uff0c\u5b83\u5c06\u8f6c\u6362\u6570\u636e\u7c7b\u578b\uff0c\u6821\u9a8c\uff0c\u751f\u6210\u6587\u6863\u7b49\u3002</p>"},{"location":"tutorial/body-multiple-params/#_3","title":"\u591a\u4e2a\u8bf7\u6c42\u4f53\u53c2\u6570\u548c\u67e5\u8be2\u53c2\u6570","text":"<p>\u5f53\u7136\uff0c\u9664\u4e86\u8bf7\u6c42\u4f53\u53c2\u6570\u5916\uff0c\u4f60\u8fd8\u53ef\u4ee5\u5728\u4efb\u4f55\u9700\u8981\u7684\u65f6\u5019\u58f0\u660e\u989d\u5916\u7684\u67e5\u8be2\u53c2\u6570\u3002</p> <p>\u7531\u4e8e\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5355\u4e00\u503c\u88ab\u89e3\u91ca\u4e3a\u67e5\u8be2\u53c2\u6570\uff0c\u56e0\u6b64\u4f60\u4e0d\u5fc5\u663e\u5f0f\u5730\u6dfb\u52a0 <code>Query</code>\uff0c\u4f60\u53ef\u4ee5\u4ec5\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff1a</p> <pre><code>q: str = None\n</code></pre> <p>\u6bd4\u5982\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import Body, FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n\n\nclass User(BaseModel):\n    username: str\n    full_name: Union[str, None] = None\n\n\n@app.put(\"/items/{item_id}\")\nasync def update_item(\n    *,\n    item_id: int,\nitem: Item,\nuser: User,\n    importance: int = Body(gt=0),\n    q: Union[str, None] = None,\n):\n    results = {\"item_id\": item_id, \"item\": item, \"user\": user, \"importance\": importance}\n    if q:\n        results.update({\"q\": q})\n    return results\n</code></pre> <p>Info</p> <p><code>Body</code> \u540c\u6837\u5177\u6709\u4e0e <code>Query</code>\u3001<code>Path</code> \u4ee5\u53ca\u5176\u4ed6\u540e\u9762\u5c06\u770b\u5230\u7684\u7c7b\u5b8c\u5168\u76f8\u540c\u7684\u989d\u5916\u6821\u9a8c\u548c\u5143\u6570\u636e\u53c2\u6570\u3002</p>"},{"location":"tutorial/body-multiple-params/#_4","title":"\u5d4c\u5165\u5355\u4e2a\u8bf7\u6c42\u4f53\u53c2\u6570","text":"<p>\u5047\u8bbe\u4f60\u53ea\u6709\u4e00\u4e2a\u6765\u81ea Pydantic \u6a21\u578b <code>Item</code> \u7684\u8bf7\u6c42\u4f53\u53c2\u6570 <code>item</code>\u3002</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cFastAPI \u5c06\u76f4\u63a5\u671f\u671b\u8fd9\u6837\u7684\u8bf7\u6c42\u4f53\u3002</p> <p>\u4f46\u662f\uff0c\u5982\u679c\u4f60\u5e0c\u671b\u5b83\u671f\u671b\u4e00\u4e2a\u62e5\u6709 <code>item</code> \u952e\u5e76\u5728\u503c\u4e2d\u5305\u542b\u6a21\u578b\u5185\u5bb9\u7684 JSON\uff0c\u5c31\u50cf\u5728\u58f0\u660e\u989d\u5916\u7684\u8bf7\u6c42\u4f53\u53c2\u6570\u65f6\u6240\u505a\u7684\u90a3\u6837\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u7279\u6b8a\u7684 <code>Body</code> \u53c2\u6570 <code>embed</code>\uff1a</p> <pre><code>item: Item = Body(embed=True)\n</code></pre> <p>\u6bd4\u5982\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import Body, FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n\n@app.put(\"/items/{item_id}\")\nasync def update_item(item_id: int, item: Item = Body(embed=True)):\n    results = {\"item_id\": item_id, \"item\": item}\n    return results\n</code></pre> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cFastAPI \u5c06\u671f\u671b\u50cf\u8fd9\u6837\u7684\u8bf7\u6c42\u4f53\uff1a</p> <pre><code>{\n\"item\": {\n\"name\": \"Foo\",\n\"description\": \"The pretender\",\n\"price\": 42.0,\n\"tax\": 3.2\n}\n}\n</code></pre> <p>\u800c\u4e0d\u662f\uff1a</p> <pre><code>{\n\"name\": \"Foo\",\n\"description\": \"The pretender\",\n\"price\": 42.0,\n\"tax\": 3.2\n}\n</code></pre>"},{"location":"tutorial/body-multiple-params/#_5","title":"\u603b\u7ed3","text":"<p>\u4f60\u53ef\u4ee5\u6dfb\u52a0\u591a\u4e2a\u8bf7\u6c42\u4f53\u53c2\u6570\u5230\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u4e2d\uff0c\u5373\u4f7f\u4e00\u4e2a\u8bf7\u6c42\u53ea\u80fd\u6709\u4e00\u4e2a\u8bf7\u6c42\u4f53\u3002</p> <p>\u4f46\u662f FastAPI \u4f1a\u5904\u7406\u5b83\uff0c\u5728\u51fd\u6570\u4e2d\u4e3a\u4f60\u63d0\u4f9b\u6b63\u786e\u7684\u6570\u636e\uff0c\u5e76\u5728\u8def\u5f84\u64cd\u4f5c\u4e2d\u6821\u9a8c\u5e76\u8bb0\u5f55\u6b63\u786e\u7684\u6a21\u5f0f\u3002</p> <p>\u4f60\u8fd8\u53ef\u4ee5\u58f0\u660e\u5c06\u4f5c\u4e3a\u8bf7\u6c42\u4f53\u7684\u4e00\u90e8\u5206\u6240\u63a5\u6536\u7684\u5355\u4e00\u503c\u3002</p> <p>\u4f60\u8fd8\u53ef\u4ee5\u6307\u793a FastAPI \u5728\u4ec5\u58f0\u660e\u4e86\u4e00\u4e2a\u8bf7\u6c42\u4f53\u53c2\u6570\u7684\u60c5\u51b5\u4e0b\uff0c\u5c06\u539f\u672c\u7684\u8bf7\u6c42\u4f53\u5d4c\u5165\u5230\u4e00\u4e2a\u952e\u4e2d\u3002</p>"},{"location":"tutorial/body-nested-models/","title":"\u8bf7\u6c42\u4f53 - \u5d4c\u5957\u6a21\u578b","text":"<p>\u4f7f\u7528 FastAPI\uff0c\u4f60\u53ef\u4ee5\u5b9a\u4e49\u3001\u6821\u9a8c\u3001\u8bb0\u5f55\u6587\u6863\u5e76\u4f7f\u7528\u4efb\u610f\u6df1\u5ea6\u5d4c\u5957\u7684\u6a21\u578b\uff08\u5f52\u529f\u4e8ePydantic\uff09\u3002</p>"},{"location":"tutorial/body-nested-models/#list","title":"List \u5b57\u6bb5","text":"<p>\u4f60\u53ef\u4ee5\u5c06\u4e00\u4e2a\u5c5e\u6027\u5b9a\u4e49\u4e3a\u62e5\u6709\u5b50\u5143\u7d20\u7684\u7c7b\u578b\u3002\u4f8b\u5982 Python <code>list</code>\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\nprice: float\ntax: Union[float, None] = None\n    tags: list = []\n\n\n@app.put(\"/items/{item_id}\")\nasync def update_item(item_id: int, item: Item):\n    results = {\"item_id\": item_id, \"item\": item}\n    return results\n</code></pre> <p>\u8fd9\u5c06\u4f7f <code>tags</code> \u6210\u4e3a\u4e00\u4e2a\u7531\u5143\u7d20\u7ec4\u6210\u7684\u5217\u8868\u3002\u4e0d\u8fc7\u5b83\u6ca1\u6709\u58f0\u660e\u6bcf\u4e2a\u5143\u7d20\u7684\u7c7b\u578b\u3002</p>"},{"location":"tutorial/body-nested-models/#list_1","title":"\u5177\u6709\u5b50\u7c7b\u578b\u7684 List \u5b57\u6bb5","text":"<p>\u4f46\u662f Python \u6709\u4e00\u79cd\u7279\u5b9a\u7684\u65b9\u6cd5\u6765\u58f0\u660e\u5177\u6709\u5b50\u7c7b\u578b\u7684\u5217\u8868\uff1a</p>"},{"location":"tutorial/body-nested-models/#typing-list","title":"\u4ece typing \u5bfc\u5165 <code>List</code>","text":"<p>\u9996\u5148\uff0c\u4ece Python \u7684\u6807\u51c6\u5e93 <code>typing</code> \u6a21\u5757\u4e2d\u5bfc\u5165 <code>List</code>\uff1a</p> <pre><code>from typing import List, Union\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n    tags: List[str] = []\n\n\n@app.put(\"/items/{item_id}\")\nasync def update_item(item_id: int, item: Item):\n    results = {\"item_id\": item_id, \"item\": item}\n    return results\n</code></pre>"},{"location":"tutorial/body-nested-models/#list_2","title":"\u58f0\u660e\u5177\u6709\u5b50\u7c7b\u578b\u7684 List","text":"<p>\u8981\u58f0\u660e\u5177\u6709\u5b50\u7c7b\u578b\u7684\u7c7b\u578b\uff0c\u4f8b\u5982 <code>list</code>\u3001<code>dict</code>\u3001<code>tuple</code>\uff1a</p> <ul> <li>\u4ece <code>typing</code> \u6a21\u5757\u5bfc\u5165\u5b83\u4eec</li> <li>\u4f7f\u7528\u65b9\u62ec\u53f7 <code>[</code> \u548c <code>]</code> \u5c06\u5b50\u7c7b\u578b\u4f5c\u4e3a\u300c\u7c7b\u578b\u53c2\u6570\u300d\u4f20\u5165</li> </ul> <pre><code>from typing import List\n\nmy_list: List[str]\n</code></pre> <p>\u8fd9\u5b8c\u5168\u662f\u7528\u4e8e\u7c7b\u578b\u58f0\u660e\u7684\u6807\u51c6 Python \u8bed\u6cd5\u3002</p> <p>\u5bf9\u5177\u6709\u5b50\u7c7b\u578b\u7684\u6a21\u578b\u5c5e\u6027\u4e5f\u4f7f\u7528\u76f8\u540c\u7684\u6807\u51c6\u8bed\u6cd5\u3002</p> <p>\u56e0\u6b64\uff0c\u5728\u6211\u4eec\u7684\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06 <code>tags</code> \u660e\u786e\u5730\u6307\u5b9a\u4e3a\u4e00\u4e2a\u300c\u5b57\u7b26\u4e32\u5217\u8868\u300d\uff1a</p> <pre><code>from typing import List, Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\ntags: List[str] = []\n@app.put(\"/items/{item_id}\")\nasync def update_item(item_id: int, item: Item):\n    results = {\"item_id\": item_id, \"item\": item}\n    return results\n</code></pre>"},{"location":"tutorial/body-nested-models/#set","title":"Set \u7c7b\u578b","text":"<p>\u4f46\u662f\u968f\u540e\u6211\u4eec\u8003\u8651\u4e86\u4e00\u4e0b\uff0c\u610f\u8bc6\u5230\u6807\u7b7e\u4e0d\u5e94\u8be5\u91cd\u590d\uff0c\u5b83\u4eec\u5f88\u5927\u53ef\u80fd\u4f1a\u662f\u552f\u4e00\u7684\u5b57\u7b26\u4e32\u3002</p> <p>Python \u5177\u6709\u4e00\u79cd\u7279\u6b8a\u7684\u6570\u636e\u7c7b\u578b\u6765\u4fdd\u5b58\u4e00\u7ec4\u552f\u4e00\u7684\u5143\u7d20\uff0c\u5373 <code>set</code>\u3002</p> <p>\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u5bfc\u5165 <code>Set</code> \u5e76\u5c06 <code>tag</code> \u58f0\u660e\u4e3a\u4e00\u4e2a\u7531 <code>str</code> \u7ec4\u6210\u7684 <code>set</code>\uff1a</p> <pre><code>from typing import Set, Union\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\ntags: Set[str] = set()\n@app.put(\"/items/{item_id}\")\nasync def update_item(item_id: int, item: Item):\n    results = {\"item_id\": item_id, \"item\": item}\n    return results\n</code></pre> <p>\u8fd9\u6837\uff0c\u5373\u4f7f\u4f60\u6536\u5230\u5e26\u6709\u91cd\u590d\u6570\u636e\u7684\u8bf7\u6c42\uff0c\u8fd9\u4e9b\u6570\u636e\u4e5f\u4f1a\u88ab\u8f6c\u6362\u4e3a\u4e00\u7ec4\u552f\u4e00\u9879\u3002</p> <p>\u800c\u4e14\uff0c\u6bcf\u5f53\u4f60\u8f93\u51fa\u8be5\u6570\u636e\u65f6\uff0c\u5373\u4f7f\u6e90\u6570\u636e\u6709\u91cd\u590d\uff0c\u5b83\u4eec\u4e5f\u5c06\u4f5c\u4e3a\u4e00\u7ec4\u552f\u4e00\u9879\u8f93\u51fa\u3002</p> <p>\u5e76\u4e14\u8fd8\u4f1a\u88ab\u76f8\u5e94\u5730\u6807\u6ce8 / \u8bb0\u5f55\u6587\u6863\u3002</p>"},{"location":"tutorial/body-nested-models/#_1","title":"\u5d4c\u5957\u6a21\u578b","text":"<p>Pydantic \u6a21\u578b\u7684\u6bcf\u4e2a\u5c5e\u6027\u90fd\u5177\u6709\u7c7b\u578b\u3002</p> <p>\u4f46\u662f\u8fd9\u4e2a\u7c7b\u578b\u672c\u8eab\u53ef\u4ee5\u662f\u53e6\u4e00\u4e2a Pydantic \u6a21\u578b\u3002</p> <p>\u56e0\u6b64\uff0c\u4f60\u53ef\u4ee5\u58f0\u660e\u62e5\u6709\u7279\u5b9a\u5c5e\u6027\u540d\u79f0\u3001\u7c7b\u578b\u548c\u6821\u9a8c\u7684\u6df1\u5ea6\u5d4c\u5957\u7684 JSON \u5bf9\u8c61\u3002</p> <p>\u4e0a\u8ff0\u8fd9\u4e9b\u90fd\u53ef\u4ee5\u4efb\u610f\u7684\u5d4c\u5957\u3002</p>"},{"location":"tutorial/body-nested-models/#_2","title":"\u5b9a\u4e49\u5b50\u6a21\u578b","text":"<p>\u4f8b\u5982\uff0c\u6211\u4eec\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a <code>Image</code> \u6a21\u578b\uff1a</p> <pre><code>from typing import Set, Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Image(BaseModel):\nurl: str\nname: str\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n    tags: Set[str] = set()\n    image: Union[Image, None] = None\n\n\n@app.put(\"/items/{item_id}\")\nasync def update_item(item_id: int, item: Item):\n    results = {\"item_id\": item_id, \"item\": item}\n    return results\n</code></pre>"},{"location":"tutorial/body-nested-models/#_3","title":"\u5c06\u5b50\u6a21\u578b\u7528\u4f5c\u7c7b\u578b","text":"<p>\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u5c06\u5176\u7528\u4f5c\u4e00\u4e2a\u5c5e\u6027\u7684\u7c7b\u578b\uff1a</p> <pre><code>from typing import Set, Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Image(BaseModel):\n    url: str\n    name: str\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n    tags: Set[str] = set()\nimage: Union[Image, None] = None\n@app.put(\"/items/{item_id}\")\nasync def update_item(item_id: int, item: Item):\n    results = {\"item_id\": item_id, \"item\": item}\n    return results\n</code></pre> <p>\u8fd9\u610f\u5473\u7740 FastAPI \u5c06\u671f\u671b\u7c7b\u4f3c\u4e8e\u4ee5\u4e0b\u5185\u5bb9\u7684\u8bf7\u6c42\u4f53\uff1a</p> <pre><code>{\n\"name\": \"Foo\",\n\"description\": \"The pretender\",\n\"price\": 42.0,\n\"tax\": 3.2,\n\"tags\": [\"rock\", \"metal\", \"bar\"],\n\"image\": {\n\"url\": \"http://example.com/baz.jpg\",\n\"name\": \"The Foo live\"\n}\n}\n</code></pre> <p>\u518d\u4e00\u6b21\uff0c\u4ec5\u4ec5\u8fdb\u884c\u8fd9\u6837\u7684\u58f0\u660e\uff0c\u4f60\u5c06\u901a\u8fc7 FastAPI \u83b7\u5f97\uff1a</p> <ul> <li>\u5bf9\u88ab\u5d4c\u5165\u7684\u6a21\u578b\u4e5f\u9002\u7528\u7684\u7f16\u8f91\u5668\u652f\u6301\uff08\u81ea\u52a8\u8865\u5168\u7b49\uff09</li> <li>\u6570\u636e\u8f6c\u6362</li> <li>\u6570\u636e\u6821\u9a8c</li> <li>\u81ea\u52a8\u751f\u6210\u6587\u6863</li> </ul>"},{"location":"tutorial/body-nested-models/#_4","title":"\u7279\u6b8a\u7684\u7c7b\u578b\u548c\u6821\u9a8c","text":"<p>\u9664\u4e86\u666e\u901a\u7684\u5355\u4e00\u503c\u7c7b\u578b\uff08\u5982 <code>str</code>\u3001<code>int</code>\u3001<code>float</code> \u7b49\uff09\u5916\uff0c\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528\u4ece <code>str</code> \u7ee7\u627f\u7684\u66f4\u590d\u6742\u7684\u5355\u4e00\u503c\u7c7b\u578b\u3002</p> <p>\u8981\u4e86\u89e3\u6240\u6709\u7684\u53ef\u7528\u9009\u9879\uff0c\u8bf7\u67e5\u770b\u5173\u4e8e \u6765\u81ea Pydantic \u7684\u5916\u90e8\u7c7b\u578b \u7684\u6587\u6863\u3002\u4f60\u5c06\u5728\u4e0b\u4e00\u7ae0\u8282\u4e2d\u770b\u5230\u4e00\u4e9b\u793a\u4f8b\u3002</p> <p>\u4f8b\u5982\uff0c\u5728 <code>Image</code> \u6a21\u578b\u4e2d\u6211\u4eec\u6709\u4e00\u4e2a <code>url</code> \u5b57\u6bb5\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u58f0\u660e\u4e3a Pydantic \u7684 <code>HttpUrl</code>\uff0c\u800c\u4e0d\u662f <code>str</code>\uff1a</p> <pre><code>from typing import Set, Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel, HttpUrl\napp = FastAPI()\n\n\nclass Image(BaseModel):\nurl: HttpUrl\nname: str\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n    tags: Set[str] = set()\n    image: Union[Image, None] = None\n\n\n@app.put(\"/items/{item_id}\")\nasync def update_item(item_id: int, item: Item):\n    results = {\"item_id\": item_id, \"item\": item}\n    return results\n</code></pre> <p>\u8be5\u5b57\u7b26\u4e32\u5c06\u88ab\u68c0\u67e5\u662f\u5426\u4e3a\u6709\u6548\u7684 URL\uff0c\u5e76\u5728 JSON Schema / OpenAPI \u6587\u6863\u4e2d\u8fdb\u884c\u8bb0\u5f55\u3002</p>"},{"location":"tutorial/body-nested-models/#_5","title":"\u5e26\u6709\u4e00\u7ec4\u5b50\u6a21\u578b\u7684\u5c5e\u6027","text":"<p>\u4f60\u8fd8\u53ef\u4ee5\u5c06 Pydantic \u6a21\u578b\u7528\u4f5c <code>list</code>\u3001<code>set</code> \u7b49\u7684\u5b50\u7c7b\u578b\uff1a</p> <pre><code>from typing import List, Set, Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel, HttpUrl\n\napp = FastAPI()\n\n\nclass Image(BaseModel):\n    url: HttpUrl\n    name: str\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n    tags: Set[str] = set()\nimages: Union[List[Image], None] = None\n@app.put(\"/items/{item_id}\")\nasync def update_item(item_id: int, item: Item):\n    results = {\"item_id\": item_id, \"item\": item}\n    return results\n</code></pre> <p>\u8fd9\u5c06\u671f\u671b\uff08\u8f6c\u6362\uff0c\u6821\u9a8c\uff0c\u8bb0\u5f55\u6587\u6863\u7b49\uff09\u4e0b\u9762\u8fd9\u6837\u7684 JSON \u8bf7\u6c42\u4f53\uff1a</p> <pre><code>{\n\"name\": \"Foo\",\n\"description\": \"The pretender\",\n\"price\": 42.0,\n\"tax\": 3.2,\n\"tags\": [\n\"rock\",\n\"metal\",\n\"bar\"\n],\n\"images\": [\n{\n\"url\": \"http://example.com/baz.jpg\",\n\"name\": \"The Foo live\"\n},\n{\n\"url\": \"http://example.com/dave.jpg\",\n\"name\": \"The Baz\"\n}\n]\n}\n</code></pre> <p>Info</p> <p>\u8bf7\u6ce8\u610f <code>images</code> \u952e\u73b0\u5728\u5177\u6709\u4e00\u7ec4 image \u5bf9\u8c61\u662f\u5982\u4f55\u53d1\u751f\u7684\u3002</p>"},{"location":"tutorial/body-nested-models/#_6","title":"\u6df1\u5ea6\u5d4c\u5957\u6a21\u578b","text":"<p>\u4f60\u53ef\u4ee5\u5b9a\u4e49\u4efb\u610f\u6df1\u5ea6\u7684\u5d4c\u5957\u6a21\u578b\uff1a</p> <pre><code>from typing import List, Set, Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel, HttpUrl\n\napp = FastAPI()\n\n\nclass Image(BaseModel):\nurl: HttpUrl\n    name: str\n\n\nclass Item(BaseModel):\nname: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n    tags: Set[str] = set()\nimages: Union[List[Image], None] = None\nclass Offer(BaseModel):\nname: str\n    description: Union[str, None] = None\n    price: float\nitems: List[Item]\n@app.post(\"/offers/\")\nasync def create_offer(offer: Offer):\n    return offer\n</code></pre> <p>Info</p> <p>\u8bf7\u6ce8\u610f <code>Offer</code> \u62e5\u6709\u4e00\u7ec4 <code>Item</code> \u800c\u53cd\u8fc7\u6765 <code>Item</code> \u53c8\u662f\u4e00\u4e2a\u53ef\u9009\u7684 <code>Image</code> \u5217\u8868\u662f\u5982\u4f55\u53d1\u751f\u7684\u3002</p>"},{"location":"tutorial/body-nested-models/#_7","title":"\u7eaf\u5217\u8868\u8bf7\u6c42\u4f53","text":"<p>\u5982\u679c\u4f60\u671f\u671b\u7684 JSON \u8bf7\u6c42\u4f53\u7684\u6700\u5916\u5c42\u662f\u4e00\u4e2a JSON <code>array</code>\uff08\u5373 Python <code>list</code>\uff09\uff0c\u5219\u53ef\u4ee5\u5728\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u7684\u53c2\u6570\u4e2d\u58f0\u660e\u6b64\u7c7b\u578b\uff0c\u5c31\u50cf\u58f0\u660e Pydantic \u6a21\u578b\u4e00\u6837\uff1a</p> <pre><code>images: List[Image]\n</code></pre> <p>\u4f8b\u5982\uff1a</p> <pre><code>from typing import List\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel, HttpUrl\n\napp = FastAPI()\n\n\nclass Image(BaseModel):\n    url: HttpUrl\n    name: str\n\n\n@app.post(\"/images/multiple/\")\nasync def create_multiple_images(images: List[Image]):\nreturn images\n</code></pre>"},{"location":"tutorial/body-nested-models/#_8","title":"\u65e0\u5904\u4e0d\u5728\u7684\u7f16\u8f91\u5668\u652f\u6301","text":"<p>\u4f60\u53ef\u4ee5\u968f\u5904\u83b7\u5f97\u7f16\u8f91\u5668\u652f\u6301\u3002</p> <p>\u5373\u4f7f\u662f\u5217\u8868\u4e2d\u7684\u5143\u7d20\uff1a</p> <p></p> <p>\u5982\u679c\u4f60\u76f4\u63a5\u4f7f\u7528 <code>dict</code> \u800c\u4e0d\u662f Pydantic \u6a21\u578b\uff0c\u90a3\u4f60\u5c06\u65e0\u6cd5\u83b7\u5f97\u8fd9\u79cd\u7f16\u8f91\u5668\u652f\u6301\u3002</p> <p>\u4f46\u662f\u4f60\u6839\u672c\u4e0d\u5fc5\u62c5\u5fc3\u8fd9\u4e24\u8005\uff0c\u4f20\u5165\u7684\u5b57\u5178\u4f1a\u81ea\u52a8\u88ab\u8f6c\u6362\uff0c\u4f60\u7684\u8f93\u51fa\u4e5f\u4f1a\u81ea\u52a8\u88ab\u8f6c\u6362\u4e3a JSON\u3002</p>"},{"location":"tutorial/body-nested-models/#dict","title":"\u4efb\u610f <code>dict</code> \u6784\u6210\u7684\u8bf7\u6c42\u4f53","text":"<p>\u4f60\u4e5f\u53ef\u4ee5\u5c06\u8bf7\u6c42\u4f53\u58f0\u660e\u4e3a\u4f7f\u7528\u67d0\u7c7b\u578b\u7684\u952e\u548c\u5176\u4ed6\u7c7b\u578b\u503c\u7684 <code>dict</code>\u3002</p> <p>\u65e0\u9700\u4e8b\u5148\u77e5\u9053\u6709\u6548\u7684\u5b57\u6bb5/\u5c5e\u6027\uff08\u5728\u4f7f\u7528 Pydantic \u6a21\u578b\u7684\u573a\u666f\uff09\u540d\u79f0\u662f\u4ec0\u4e48\u3002</p> <p>\u5982\u679c\u4f60\u60f3\u63a5\u6536\u4e00\u4e9b\u5c1a\u4e14\u672a\u77e5\u7684\u952e\uff0c\u8fd9\u5c06\u5f88\u6709\u7528\u3002</p> <p>\u5176\u4ed6\u6709\u7528\u7684\u573a\u666f\u662f\u5f53\u4f60\u60f3\u8981\u63a5\u6536\u5176\u4ed6\u7c7b\u578b\u7684\u952e\u65f6\uff0c\u4f8b\u5982 <code>int</code>\u3002</p> <p>\u8fd9\u4e5f\u662f\u6211\u4eec\u5728\u63a5\u4e0b\u6765\u5c06\u770b\u5230\u7684\u3002</p> <p>\u5728\u4e0b\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u4f60\u5c06\u63a5\u53d7\u4efb\u610f\u952e\u4e3a <code>int</code> \u7c7b\u578b\u5e76\u4e14\u503c\u4e3a <code>float</code> \u7c7b\u578b\u7684 <code>dict</code>\uff1a</p> <pre><code>from typing import Dict\n\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.post(\"/index-weights/\")\nasync def create_index_weights(weights: Dict[int, float]):\n    return weights\n</code></pre> <p>Tip</p> <p>\u8bf7\u8bb0\u4f4f JSON \u4ec5\u652f\u6301\u5c06 <code>str</code> \u4f5c\u4e3a\u952e\u3002</p> <p>\u4f46\u662f Pydantic \u5177\u6709\u81ea\u52a8\u8f6c\u6362\u6570\u636e\u7684\u529f\u80fd\u3002</p> <p>\u8fd9\u610f\u5473\u7740\uff0c\u5373\u4f7f\u4f60\u7684 API \u5ba2\u6237\u7aef\u53ea\u80fd\u5c06\u5b57\u7b26\u4e32\u4f5c\u4e3a\u952e\u53d1\u9001\uff0c\u53ea\u8981\u8fd9\u4e9b\u5b57\u7b26\u4e32\u5185\u5bb9\u4ec5\u5305\u542b\u6574\u6570\uff0cPydantic \u5c31\u4f1a\u5bf9\u5176\u8fdb\u884c\u8f6c\u6362\u5e76\u6821\u9a8c\u3002</p> <p>\u7136\u540e\u4f60\u63a5\u6536\u7684\u540d\u4e3a <code>weights</code> \u7684 <code>dict</code> \u5b9e\u9645\u4e0a\u5c06\u5177\u6709 <code>int</code> \u7c7b\u578b\u7684\u952e\u548c <code>float</code> \u7c7b\u578b\u7684\u503c\u3002</p>"},{"location":"tutorial/body-nested-models/#_9","title":"\u603b\u7ed3","text":"<p>\u4f7f\u7528 FastAPI \u4f60\u53ef\u4ee5\u62e5\u6709 Pydantic \u6a21\u578b\u63d0\u4f9b\u7684\u6781\u9ad8\u7075\u6d3b\u6027\uff0c\u540c\u65f6\u4fdd\u6301\u4ee3\u7801\u7684\u7b80\u5355\u3001\u7b80\u77ed\u548c\u4f18\u96c5\u3002</p> <p>\u800c\u4e14\u8fd8\u5177\u6709\u4e0b\u5217\u597d\u5904\uff1a</p> <ul> <li>\u7f16\u8f91\u5668\u652f\u6301\uff08\u5904\u5904\u7686\u53ef\u81ea\u52a8\u8865\u5168\uff01\uff09</li> <li>\u6570\u636e\u8f6c\u6362\uff08\u4e5f\u88ab\u79f0\u4e3a\u89e3\u6790/\u5e8f\u5217\u5316\uff09</li> <li>\u6570\u636e\u6821\u9a8c</li> <li>\u6a21\u5f0f\u6587\u6863</li> <li>\u81ea\u52a8\u751f\u6210\u7684\u6587\u6863</li> </ul>"},{"location":"tutorial/body-updates/","title":"\u8bf7\u6c42\u4f53 - \u66f4\u65b0\u6570\u636e","text":""},{"location":"tutorial/body-updates/#put","title":"\u7528 <code>PUT</code> \u66f4\u65b0\u6570\u636e","text":"<p>\u66f4\u65b0\u6570\u636e\u8bf7\u7528 HTTP <code>PUT</code> \u64cd\u4f5c\u3002</p> <p>\u628a\u8f93\u5165\u6570\u636e\u8f6c\u6362\u4e3a\u4ee5 JSON \u683c\u5f0f\u5b58\u50a8\u7684\u6570\u636e\uff08\u6bd4\u5982\uff0c\u4f7f\u7528 NoSQL \u6570\u636e\u5e93\u65f6\uff09\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>jsonable_encoder</code>\u3002\u4f8b\u5982\uff0c\u628a <code>datetime</code> \u8f6c\u6362\u4e3a <code>str</code>\u3002</p> <pre><code>from typing import List, Union\n\nfrom fastapi import FastAPI\nfrom fastapi.encoders import jsonable_encoder\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: Union[str, None] = None\n    description: Union[str, None] = None\n    price: Union[float, None] = None\n    tax: float = 10.5\n    tags: List[str] = []\n\n\nitems = {\n    \"foo\": {\"name\": \"Foo\", \"price\": 50.2},\n    \"bar\": {\"name\": \"Bar\", \"description\": \"The bartenders\", \"price\": 62, \"tax\": 20.2},\n    \"baz\": {\"name\": \"Baz\", \"description\": None, \"price\": 50.2, \"tax\": 10.5, \"tags\": []},\n}\n\n\n@app.get(\"/items/{item_id}\", response_model=Item)\nasync def read_item(item_id: str):\n    return items[item_id]\n\n\n@app.put(\"/items/{item_id}\", response_model=Item)\nasync def update_item(item_id: str, item: Item):\nupdate_item_encoded = jsonable_encoder(item)\nitems[item_id] = update_item_encoded\nreturn update_item_encoded\n</code></pre> <p><code>PUT</code> \u7528\u4e8e\u63a5\u6536\u66ff\u6362\u73b0\u6709\u6570\u636e\u7684\u6570\u636e\u3002</p>"},{"location":"tutorial/body-updates/#_1","title":"\u5173\u4e8e\u66f4\u65b0\u6570\u636e\u7684\u8b66\u544a","text":"<p>\u7528 <code>PUT</code> \u628a\u6570\u636e\u9879 <code>bar</code> \u66f4\u65b0\u4e3a\u4ee5\u4e0b\u5185\u5bb9\u65f6\uff1a</p> <pre><code>{\n    \"name\": \"Barz\",\n    \"price\": 3,\n    \"description\": None,\n}\n</code></pre> <p>\u56e0\u4e3a\u4e0a\u8ff0\u6570\u636e\u672a\u5305\u542b\u5df2\u5b58\u50a8\u7684\u5c5e\u6027 <code>\"tax\": 20.2</code>\uff0c\u65b0\u7684\u8f93\u5165\u6a21\u578b\u4f1a\u628a <code>\"tax\": 10.5</code> \u4f5c\u4e3a\u9ed8\u8ba4\u503c\u3002</p> <p>\u56e0\u6b64\uff0c\u672c\u6b21\u64cd\u4f5c\u628a <code>tax</code> \u7684\u503c\u300c\u66f4\u65b0\u300d\u4e3a <code>10.5</code>\u3002</p>"},{"location":"tutorial/body-updates/#patch","title":"\u7528 <code>PATCH</code> \u8fdb\u884c\u90e8\u5206\u66f4\u65b0","text":"<p>HTTP <code>PATCH</code> \u64cd\u4f5c\u7528\u4e8e\u66f4\u65b0 \u90e8\u5206 \u6570\u636e\u3002</p> <p>\u5373\uff0c\u53ea\u53d1\u9001\u8981\u66f4\u65b0\u7684\u6570\u636e\uff0c\u5176\u4f59\u6570\u636e\u4fdd\u6301\u4e0d\u53d8\u3002</p> <p>\u7b14\u8bb0</p> <p><code>PATCH</code> \u6ca1\u6709 <code>PUT</code> \u77e5\u540d\uff0c\u4e5f\u600e\u4e48\u4e0d\u5e38\u7528\u3002</p> <p>\u5f88\u591a\u4eba\u751a\u81f3\u53ea\u7528 <code>PUT</code> \u5b9e\u73b0\u90e8\u5206\u66f4\u65b0\u3002</p> <p>FastAPI \u5bf9\u6b64\u6ca1\u6709\u4efb\u4f55\u9650\u5236\uff0c\u53ef\u4ee5\u968f\u610f\u4e92\u6362\u4f7f\u7528\u8fd9\u4e24\u79cd\u64cd\u4f5c\u3002</p> <p>\u4f46\u672c\u6307\u5357\u4e5f\u4f1a\u5206\u522b\u4ecb\u7ecd\u8fd9\u4e24\u79cd\u64cd\u4f5c\u5404\u81ea\u7684\u7528\u9014\u3002</p>"},{"location":"tutorial/body-updates/#pydantic-exclude_unset","title":"\u4f7f\u7528 Pydantic \u7684 <code>exclude_unset</code> \u53c2\u6570","text":"<p>\u66f4\u65b0\u90e8\u5206\u6570\u636e\u65f6\uff0c\u53ef\u4ee5\u5728 Pydantic \u6a21\u578b\u7684 <code>.dict()</code> \u4e2d\u4f7f\u7528 <code>exclude_unset</code> \u53c2\u6570\u3002</p> <p>\u6bd4\u5982\uff0c<code>item.dict(exclude_unset=True)</code>\u3002</p> <p>\u8fd9\u6bb5\u4ee3\u7801\u751f\u6210\u7684 <code>dict</code> \u53ea\u5305\u542b\u521b\u5efa <code>item</code> \u6a21\u578b\u65f6\u663e\u5f0f\u8bbe\u7f6e\u7684\u6570\u636e\uff0c\u800c\u4e0d\u5305\u62ec\u9ed8\u8ba4\u503c\u3002</p> <p>\u7136\u540e\u518d\u7528\u5b83\u751f\u6210\u4e00\u4e2a\u53ea\u542b\u5df2\u8bbe\u7f6e\uff08\u5728\u8bf7\u6c42\u4e2d\u6240\u53d1\u9001\uff09\u6570\u636e\uff0c\u4e14\u7701\u7565\u4e86\u9ed8\u8ba4\u503c\u7684 <code>dict</code>\uff1a</p> <pre><code>from typing import List, Union\n\nfrom fastapi import FastAPI\nfrom fastapi.encoders import jsonable_encoder\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: Union[str, None] = None\n    description: Union[str, None] = None\n    price: Union[float, None] = None\n    tax: float = 10.5\n    tags: List[str] = []\n\n\nitems = {\n    \"foo\": {\"name\": \"Foo\", \"price\": 50.2},\n    \"bar\": {\"name\": \"Bar\", \"description\": \"The bartenders\", \"price\": 62, \"tax\": 20.2},\n    \"baz\": {\"name\": \"Baz\", \"description\": None, \"price\": 50.2, \"tax\": 10.5, \"tags\": []},\n}\n\n\n@app.get(\"/items/{item_id}\", response_model=Item)\nasync def read_item(item_id: str):\n    return items[item_id]\n\n\n@app.patch(\"/items/{item_id}\", response_model=Item)\nasync def update_item(item_id: str, item: Item):\n    stored_item_data = items[item_id]\n    stored_item_model = Item(**stored_item_data)\nupdate_data = item.dict(exclude_unset=True)\nupdated_item = stored_item_model.copy(update=update_data)\n    items[item_id] = jsonable_encoder(updated_item)\n    return updated_item\n</code></pre>"},{"location":"tutorial/body-updates/#pydantic-update","title":"\u4f7f\u7528 Pydantic \u7684 <code>update</code> \u53c2\u6570","text":"<p>\u63a5\u4e0b\u6765\uff0c\u7528 <code>.copy()</code> \u4e3a\u5df2\u6709\u6a21\u578b\u521b\u5efa\u8c03\u7528 <code>update</code> \u53c2\u6570\u7684\u526f\u672c\uff0c\u8be5\u53c2\u6570\u4e3a\u5305\u542b\u66f4\u65b0\u6570\u636e\u7684 <code>dict</code>\u3002</p> <p>\u4f8b\u5982\uff0c<code>stored_item_model.copy(update=update_data)</code>\uff1a</p> <pre><code>from typing import List, Union\n\nfrom fastapi import FastAPI\nfrom fastapi.encoders import jsonable_encoder\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: Union[str, None] = None\n    description: Union[str, None] = None\n    price: Union[float, None] = None\n    tax: float = 10.5\n    tags: List[str] = []\n\n\nitems = {\n    \"foo\": {\"name\": \"Foo\", \"price\": 50.2},\n    \"bar\": {\"name\": \"Bar\", \"description\": \"The bartenders\", \"price\": 62, \"tax\": 20.2},\n    \"baz\": {\"name\": \"Baz\", \"description\": None, \"price\": 50.2, \"tax\": 10.5, \"tags\": []},\n}\n\n\n@app.get(\"/items/{item_id}\", response_model=Item)\nasync def read_item(item_id: str):\n    return items[item_id]\n\n\n@app.patch(\"/items/{item_id}\", response_model=Item)\nasync def update_item(item_id: str, item: Item):\n    stored_item_data = items[item_id]\n    stored_item_model = Item(**stored_item_data)\n    update_data = item.dict(exclude_unset=True)\nupdated_item = stored_item_model.copy(update=update_data)\nitems[item_id] = jsonable_encoder(updated_item)\n    return updated_item\n</code></pre>"},{"location":"tutorial/body-updates/#_2","title":"\u66f4\u65b0\u90e8\u5206\u6570\u636e\u5c0f\u7ed3","text":"<p>\u7b80\u800c\u8a00\u4e4b\uff0c\u66f4\u65b0\u90e8\u5206\u6570\u636e\u5e94\uff1a</p> <ul> <li>\u4f7f\u7528 <code>PATCH</code> \u800c\u4e0d\u662f <code>PUT</code> \uff08\u53ef\u9009\uff0c\u4e5f\u53ef\u4ee5\u7528 <code>PUT</code>\uff09\uff1b</li> <li>\u63d0\u53d6\u5b58\u50a8\u7684\u6570\u636e\uff1b</li> <li>\u628a\u6570\u636e\u653e\u5165 Pydantic \u6a21\u578b\uff1b</li> <li>\u751f\u6210\u4e0d\u542b\u8f93\u5165\u6a21\u578b\u9ed8\u8ba4\u503c\u7684 <code>dict</code> \uff08\u4f7f\u7528 <code>exclude_unset</code> \u53c2\u6570\uff09\uff1b<ul> <li>\u53ea\u66f4\u65b0\u7528\u6237\u8bbe\u7f6e\u8fc7\u7684\u503c\uff0c\u4e0d\u7528\u6a21\u578b\u4e2d\u7684\u9ed8\u8ba4\u503c\u8986\u76d6\u5df2\u5b58\u50a8\u8fc7\u7684\u503c\u3002</li> </ul> </li> <li>\u4e3a\u5df2\u5b58\u50a8\u7684\u6a21\u578b\u521b\u5efa\u526f\u672c\uff0c\u7528\u63a5\u6536\u7684\u6570\u636e\u66f4\u65b0\u5176\u5c5e\u6027 \uff08\u4f7f\u7528 <code>update</code> \u53c2\u6570\uff09\u3002</li> <li>\u628a\u6a21\u578b\u526f\u672c\u8f6c\u6362\u4e3a\u53ef\u5b58\u5165\u6570\u636e\u5e93\u7684\u5f62\u5f0f\uff08\u6bd4\u5982\uff0c\u4f7f\u7528 <code>jsonable_encoder</code>\uff09\u3002<ul> <li>\u8fd9\u79cd\u65b9\u5f0f\u4e0e Pydantic \u6a21\u578b\u7684 <code>.dict()</code> \u65b9\u6cd5\u7c7b\u4f3c\uff0c\u4f46\u80fd\u786e\u4fdd\u628a\u503c\u8f6c\u6362\u4e3a\u9002\u914d JSON \u7684\u6570\u636e\u7c7b\u578b\uff0c\u4f8b\u5982\uff0c \u628a <code>datetime</code> \u8f6c\u6362\u4e3a <code>str</code> \u3002</li> </ul> </li> <li>\u628a\u6570\u636e\u4fdd\u5b58\u81f3\u6570\u636e\u5e93\uff1b</li> <li>\u8fd4\u56de\u66f4\u65b0\u540e\u7684\u6a21\u578b\u3002</li> </ul> <pre><code>from typing import List, Union\n\nfrom fastapi import FastAPI\nfrom fastapi.encoders import jsonable_encoder\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: Union[str, None] = None\n    description: Union[str, None] = None\n    price: Union[float, None] = None\n    tax: float = 10.5\n    tags: List[str] = []\n\n\nitems = {\n    \"foo\": {\"name\": \"Foo\", \"price\": 50.2},\n    \"bar\": {\"name\": \"Bar\", \"description\": \"The bartenders\", \"price\": 62, \"tax\": 20.2},\n    \"baz\": {\"name\": \"Baz\", \"description\": None, \"price\": 50.2, \"tax\": 10.5, \"tags\": []},\n}\n\n\n@app.get(\"/items/{item_id}\", response_model=Item)\nasync def read_item(item_id: str):\n    return items[item_id]\n\n\n@app.patch(\"/items/{item_id}\", response_model=Item)\nasync def update_item(item_id: str, item: Item):\nstored_item_data = items[item_id]\nstored_item_model = Item(**stored_item_data)\nupdate_data = item.dict(exclude_unset=True)\nupdated_item = stored_item_model.copy(update=update_data)\nitems[item_id] = jsonable_encoder(updated_item)\nreturn updated_item\n</code></pre> <p>\u63d0\u793a</p> <p>\u5b9e\u9645\u4e0a\uff0cHTTP <code>PUT</code> \u4e5f\u53ef\u4ee5\u5b8c\u6210\u76f8\u540c\u7684\u64cd\u4f5c\u3002 \u4f46\u672c\u8282\u4ee5 <code>PATCH</code> \u4e3a\u4f8b\u7684\u539f\u56e0\u662f\uff0c\u8be5\u64cd\u4f5c\u5c31\u662f\u4e3a\u4e86\u8fd9\u79cd\u7528\u4f8b\u521b\u5efa\u7684\u3002</p> <p>\u7b14\u8bb0</p> <p>\u6ce8\u610f\uff0c\u8f93\u5165\u6a21\u578b\u4ecd\u9700\u9a8c\u8bc1\u3002</p> <p>\u56e0\u6b64\uff0c\u5982\u679c\u5e0c\u671b\u63a5\u6536\u7684\u90e8\u5206\u66f4\u65b0\u6570\u636e\u53ef\u4ee5\u7701\u7565\u5176\u4ed6\u6240\u6709\u5c5e\u6027\uff0c\u5219\u8981\u628a\u6a21\u578b\u4e2d\u6240\u6709\u7684\u5c5e\u6027\u6807\u8bb0\u4e3a\u53ef\u9009\uff08\u4f7f\u7528\u9ed8\u8ba4\u503c\u6216 <code>None</code>\uff09\u3002</p> <p>\u4e3a\u4e86\u533a\u5206\u7528\u4e8e\u66f4\u65b0\u6240\u6709\u53ef\u9009\u503c\u7684\u6a21\u578b\u4e0e\u7528\u4e8e\u521b\u5efa\u5305\u542b\u5fc5\u9009\u503c\u7684\u6a21\u578b\uff0c\u8bf7\u53c2\u7167\u66f4\u591a\u6a21\u578b \u4e00\u8282\u4e2d\u7684\u601d\u8def\u3002</p>"},{"location":"tutorial/body/","title":"\u8bf7\u6c42\u4f53","text":"<p>\u5f53\u4f60\u9700\u8981\u5c06\u6570\u636e\u4ece\u5ba2\u6237\u7aef\uff08\u4f8b\u5982\u6d4f\u89c8\u5668\uff09\u53d1\u9001\u7ed9 API \u65f6\uff0c\u4f60\u5c06\u5176\u4f5c\u4e3a\u300c\u8bf7\u6c42\u4f53\u300d\u53d1\u9001\u3002</p> <p>\u8bf7\u6c42\u4f53\u662f\u5ba2\u6237\u7aef\u53d1\u9001\u7ed9 API \u7684\u6570\u636e\u3002\u54cd\u5e94\u4f53\u662f API \u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u7684\u6570\u636e\u3002</p> <p>\u4f60\u7684 API \u51e0\u4e4e\u603b\u662f\u8981\u53d1\u9001\u54cd\u5e94\u4f53\u3002\u4f46\u662f\u5ba2\u6237\u7aef\u5e76\u4e0d\u603b\u662f\u9700\u8981\u53d1\u9001\u8bf7\u6c42\u4f53\u3002</p> <p>\u6211\u4eec\u4f7f\u7528 Pydantic \u6a21\u578b\u6765\u58f0\u660e\u8bf7\u6c42\u4f53\uff0c\u5e76\u80fd\u591f\u83b7\u5f97\u5b83\u4eec\u6240\u5177\u6709\u7684\u6240\u6709\u80fd\u529b\u548c\u4f18\u70b9\u3002</p> <p>Info</p> <p>\u4f60\u4e0d\u80fd\u4f7f\u7528 <code>GET</code> \u64cd\u4f5c\uff08HTTP \u65b9\u6cd5\uff09\u53d1\u9001\u8bf7\u6c42\u4f53\u3002</p> <p>\u8981\u53d1\u9001\u6570\u636e\uff0c\u4f60\u5fc5\u987b\u4f7f\u7528\u4e0b\u5217\u65b9\u6cd5\u4e4b\u4e00\uff1a<code>POST</code>\uff08\u8f83\u5e38\u89c1\uff09\u3001<code>PUT</code>\u3001<code>DELETE</code> \u6216 <code>PATCH</code>\u3002</p>"},{"location":"tutorial/body/#pydantic-basemodel","title":"\u5bfc\u5165 Pydantic \u7684 <code>BaseModel</code>","text":"<p>\u9996\u5148\uff0c\u4f60\u9700\u8981\u4ece <code>pydantic</code> \u4e2d\u5bfc\u5165 <code>BaseModel</code>\uff1a</p> <pre><code>from typing import Union\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n\n\napp = FastAPI()\n\n\n@app.post(\"/items/\")\nasync def create_item(item: Item):\n    return item\n</code></pre>"},{"location":"tutorial/body/#_2","title":"\u521b\u5efa\u6570\u636e\u6a21\u578b","text":"<p>\u7136\u540e\uff0c\u5c06\u4f60\u7684\u6570\u636e\u6a21\u578b\u58f0\u660e\u4e3a\u7ee7\u627f\u81ea <code>BaseModel</code> \u7684\u7c7b\u3002</p> <p>\u4f7f\u7528\u6807\u51c6\u7684 Python \u7c7b\u578b\u6765\u58f0\u660e\u6240\u6709\u5c5e\u6027\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\nclass Item(BaseModel):\nname: str\ndescription: Union[str, None] = None\nprice: float\n    tax: Union[float, None] = None\n\n\napp = FastAPI()\n\n\n@app.post(\"/items/\")\nasync def create_item(item: Item):\n    return item\n</code></pre> <p>\u548c\u58f0\u660e\u67e5\u8be2\u53c2\u6570\u65f6\u4e00\u6837\uff0c\u5f53\u4e00\u4e2a\u6a21\u578b\u5c5e\u6027\u5177\u6709\u9ed8\u8ba4\u503c\u65f6\uff0c\u5b83\u4e0d\u662f\u5fc5\u9700\u7684\u3002\u5426\u5219\u5b83\u662f\u4e00\u4e2a\u5fc5\u9700\u5c5e\u6027\u3002\u5c06\u9ed8\u8ba4\u503c\u8bbe\u4e3a <code>None</code> \u53ef\u4f7f\u5176\u6210\u4e3a\u53ef\u9009\u5c5e\u6027\u3002</p> <p>\u4f8b\u5982\uff0c\u4e0a\u9762\u7684\u6a21\u578b\u58f0\u660e\u4e86\u4e00\u4e2a\u8fd9\u6837\u7684 JSON\u300c<code>object</code>\u300d\uff08\u6216 Python <code>dict</code>\uff09\uff1a</p> <pre><code>{\n\"name\": \"Foo\",\n\"description\": \"An optional description\",\n\"price\": 45.2,\n\"tax\": 3.5\n}\n</code></pre> <p>...\u7531\u4e8e <code>description</code> \u548c <code>tax</code> \u662f\u53ef\u9009\u7684\uff08\u5b83\u4eec\u7684\u9ed8\u8ba4\u503c\u4e3a <code>None</code>\uff09\uff0c\u4e0b\u9762\u7684 JSON\u300c<code>object</code>\u300d\u4e5f\u5c06\u662f\u6709\u6548\u7684\uff1a</p> <pre><code>{\n\"name\": \"Foo\",\n\"price\": 45.2\n}\n</code></pre>"},{"location":"tutorial/body/#_3","title":"\u58f0\u660e\u4e3a\u53c2\u6570","text":"<p>\u4f7f\u7528\u4e0e\u58f0\u660e\u8def\u5f84\u548c\u67e5\u8be2\u53c2\u6570\u7684\u76f8\u540c\u65b9\u5f0f\u58f0\u660e\u8bf7\u6c42\u4f53\uff0c\u5373\u53ef\u5c06\u5176\u6dfb\u52a0\u5230\u300c\u8def\u5f84\u64cd\u4f5c\u300d\u4e2d\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n\n\napp = FastAPI()\n\n@app.post(\"/items/\")\nasync def create_item(item: Item):\n    return item\n</code></pre> <p>...\u5e76\u4e14\u5c06\u5b83\u7684\u7c7b\u578b\u58f0\u660e\u4e3a\u4f60\u521b\u5efa\u7684 <code>Item</code> \u6a21\u578b\u3002</p>"},{"location":"tutorial/body/#_4","title":"\u7ed3\u679c","text":"<p>\u4ec5\u4ec5\u4f7f\u7528\u4e86 Python \u7c7b\u578b\u58f0\u660e\uff0cFastAPI \u5c06\u4f1a\uff1a</p> <ul> <li>\u5c06\u8bf7\u6c42\u4f53\u4f5c\u4e3a JSON \u8bfb\u53d6\u3002</li> <li>\u8f6c\u6362\u4e3a\u76f8\u5e94\u7684\u7c7b\u578b\uff08\u5728\u9700\u8981\u65f6\uff09\u3002</li> <li>\u6821\u9a8c\u6570\u636e\u3002<ul> <li>\u5982\u679c\u6570\u636e\u65e0\u6548\uff0c\u5c06\u8fd4\u56de\u4e00\u6761\u6e05\u6670\u6613\u8bfb\u7684\u9519\u8bef\u4fe1\u606f\uff0c\u6307\u51fa\u4e0d\u6b63\u786e\u6570\u636e\u7684\u786e\u5207\u4f4d\u7f6e\u548c\u5185\u5bb9\u3002</li> </ul> </li> <li>\u5c06\u63a5\u6536\u7684\u6570\u636e\u8d4b\u503c\u5230\u53c2\u6570 <code>item</code> \u4e2d\u3002<ul> <li>\u7531\u4e8e\u4f60\u5df2\u7ecf\u5728\u51fd\u6570\u4e2d\u5c06\u5b83\u58f0\u660e\u4e3a <code>Item</code> \u7c7b\u578b\uff0c\u4f60\u8fd8\u5c06\u83b7\u5f97\u5bf9\u4e8e\u6240\u6709\u5c5e\u6027\u53ca\u5176\u7c7b\u578b\u7684\u4e00\u5207\u7f16\u8f91\u5668\u652f\u6301\uff08\u4ee3\u7801\u8865\u5168\u7b49\uff09\u3002</li> </ul> </li> <li>\u4e3a\u4f60\u7684\u6a21\u578b\u751f\u6210 JSON \u6a21\u5f0f \u5b9a\u4e49\uff0c\u4f60\u8fd8\u53ef\u4ee5\u5728\u5176\u4ed6\u4efb\u4f55\u5bf9\u4f60\u7684\u9879\u76ee\u6709\u610f\u4e49\u7684\u5730\u65b9\u4f7f\u7528\u5b83\u4eec\u3002</li> <li>\u8fd9\u4e9b\u6a21\u5f0f\u5c06\u6210\u4e3a\u751f\u6210\u7684 OpenAPI \u6a21\u5f0f\u7684\u4e00\u90e8\u5206\uff0c\u5e76\u4e14\u88ab\u81ea\u52a8\u5316\u6587\u6863 UI \u6240\u4f7f\u7528\u3002</li> </ul>"},{"location":"tutorial/body/#_5","title":"\u81ea\u52a8\u5316\u6587\u6863","text":"<p>\u4f60\u6240\u5b9a\u4e49\u6a21\u578b\u7684 JSON \u6a21\u5f0f\u5c06\u6210\u4e3a\u751f\u6210\u7684 OpenAPI \u6a21\u5f0f\u7684\u4e00\u90e8\u5206\uff0c\u5e76\u4e14\u5728\u4ea4\u4e92\u5f0f API \u6587\u6863\u4e2d\u5c55\u793a\uff1a</p> <p></p> <p>\u800c\u4e14\u8fd8\u5c06\u5728\u6bcf\u4e00\u4e2a\u9700\u8981\u5b83\u4eec\u7684\u8def\u5f84\u64cd\u4f5c\u7684 API \u6587\u6863\u4e2d\u4f7f\u7528\uff1a</p> <p></p>"},{"location":"tutorial/body/#_6","title":"\u7f16\u8f91\u5668\u652f\u6301","text":"<p>\u5728\u4f60\u7684\u7f16\u8f91\u5668\u4e2d\uff0c\u4f60\u4f1a\u5728\u51fd\u6570\u5185\u90e8\u7684\u4efb\u610f\u5730\u65b9\u5f97\u5230\u7c7b\u578b\u63d0\u793a\u548c\u4ee3\u7801\u8865\u5168\uff08\u5982\u679c\u4f60\u63a5\u6536\u7684\u662f\u4e00\u4e2a <code>dict</code> \u800c\u4e0d\u662f Pydantic \u6a21\u578b\uff0c\u5219\u4e0d\u4f1a\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\uff09\uff1a</p> <p></p> <p>\u4f60\u8fd8\u4f1a\u83b7\u5f97\u5bf9\u4e0d\u6b63\u786e\u7684\u7c7b\u578b\u64cd\u4f5c\u7684\u9519\u8bef\u68c0\u67e5\uff1a</p> <p></p> <p>\u8fd9\u5e76\u975e\u5076\u7136\uff0c\u6574\u4e2a\u6846\u67b6\u90fd\u662f\u56f4\u7ed5\u8be5\u8bbe\u8ba1\u800c\u6784\u5efa\u3002</p> <p>\u5e76\u4e14\u5728\u8fdb\u884c\u4efb\u4f55\u5b9e\u73b0\u4e4b\u524d\uff0c\u5df2\u7ecf\u5728\u8bbe\u8ba1\u9636\u6bb5\u7ecf\u8fc7\u4e86\u5168\u9762\u6d4b\u8bd5\uff0c\u4ee5\u786e\u4fdd\u5b83\u53ef\u4ee5\u5728\u6240\u6709\u7684\u7f16\u8f91\u5668\u4e2d\u751f\u6548\u3002</p> <p>Pydantic \u672c\u8eab\u751a\u81f3\u4e5f\u8fdb\u884c\u4e86\u4e00\u4e9b\u66f4\u6539\u4ee5\u652f\u6301\u6b64\u529f\u80fd\u3002</p> <p>\u4e0a\u9762\u7684\u622a\u56fe\u53d6\u81ea Visual Studio Code\u3002</p> <p>\u4f46\u662f\u5728 PyCharm \u548c\u7edd\u5927\u591a\u6570\u5176\u4ed6 Python \u7f16\u8f91\u5668\u4e2d\u4f60\u4e5f\u4f1a\u83b7\u5f97\u540c\u6837\u7684\u7f16\u8f91\u5668\u652f\u6301\uff1a</p> <p></p>"},{"location":"tutorial/body/#_7","title":"\u4f7f\u7528\u6a21\u578b","text":"<p>\u5728\u51fd\u6570\u5185\u90e8\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u6a21\u578b\u5bf9\u8c61\u7684\u6240\u6709\u5c5e\u6027\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n\n\napp = FastAPI()\n\n\n@app.post(\"/items/\")\nasync def create_item(item: Item):\nitem_dict = item.dict()\nif item.tax:\n        price_with_tax = item.price + item.tax\n        item_dict.update({\"price_with_tax\": price_with_tax})\n    return item_dict\n</code></pre>"},{"location":"tutorial/body/#_8","title":"\u8bf7\u6c42\u4f53 + \u8def\u5f84\u53c2\u6570","text":"<p>\u4f60\u53ef\u4ee5\u540c\u65f6\u58f0\u660e\u8def\u5f84\u53c2\u6570\u548c\u8bf7\u6c42\u4f53\u3002</p> <p>FastAPI \u5c06\u8bc6\u522b\u51fa\u4e0e\u8def\u5f84\u53c2\u6570\u5339\u914d\u7684\u51fd\u6570\u53c2\u6570\u5e94\u4ece\u8def\u5f84\u4e2d\u83b7\u53d6\uff0c\u800c\u58f0\u660e\u4e3a Pydantic \u6a21\u578b\u7684\u51fd\u6570\u53c2\u6570\u5e94\u4ece\u8bf7\u6c42\u4f53\u4e2d\u83b7\u53d6\u3002</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n\n\napp = FastAPI()\n@app.put(\"/items/{item_id}\")\nasync def create_item(item_id: int, item: Item):\n    return {\"item_id\": item_id, **item.dict()}\n</code></pre>"},{"location":"tutorial/body/#_9","title":"\u8bf7\u6c42\u4f53 + \u8def\u5f84\u53c2\u6570 + \u67e5\u8be2\u53c2\u6570","text":"<p>\u4f60\u8fd8\u53ef\u4ee5\u540c\u65f6\u58f0\u660e\u8bf7\u6c42\u4f53\u3001\u8def\u5f84\u53c2\u6570\u548c\u67e5\u8be2\u53c2\u6570\u3002</p> <p>FastAPI \u4f1a\u8bc6\u522b\u5b83\u4eec\u4e2d\u7684\u6bcf\u4e00\u4e2a\uff0c\u5e76\u4ece\u6b63\u786e\u7684\u4f4d\u7f6e\u83b7\u53d6\u6570\u636e\u3002</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n\n\napp = FastAPI()\n\n@app.put(\"/items/{item_id}\")\nasync def create_item(item_id: int, item: Item, q: Union[str, None] = None):\n    result = {\"item_id\": item_id, **item.dict()}\n    if q:\n        result.update({\"q\": q})\n    return result\n</code></pre> <p>\u51fd\u6570\u53c2\u6570\u5c06\u4f9d\u6b21\u6309\u5982\u4e0b\u89c4\u5219\u8fdb\u884c\u8bc6\u522b\uff1a</p> <ul> <li>\u5982\u679c\u5728\u8def\u5f84\u4e2d\u4e5f\u58f0\u660e\u4e86\u8be5\u53c2\u6570\uff0c\u5b83\u5c06\u88ab\u7528\u4f5c\u8def\u5f84\u53c2\u6570\u3002</li> <li>\u5982\u679c\u53c2\u6570\u5c5e\u4e8e\u5355\u4e00\u7c7b\u578b\uff08\u6bd4\u5982 <code>int</code>\u3001<code>float</code>\u3001<code>str</code>\u3001<code>bool</code> \u7b49\uff09\u5b83\u5c06\u88ab\u89e3\u91ca\u4e3a\u67e5\u8be2\u53c2\u6570\u3002</li> <li>\u5982\u679c\u53c2\u6570\u7684\u7c7b\u578b\u88ab\u58f0\u660e\u4e3a\u4e00\u4e2a Pydantic \u6a21\u578b\uff0c\u5b83\u5c06\u88ab\u89e3\u91ca\u4e3a\u8bf7\u6c42\u4f53\u3002</li> </ul>"},{"location":"tutorial/body/#pydantic","title":"\u4e0d\u4f7f\u7528 Pydantic","text":"<p>\u5982\u679c\u4f60\u4e0d\u60f3\u4f7f\u7528 Pydantic \u6a21\u578b\uff0c\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528 Body \u53c2\u6570\u3002\u8bf7\u53c2\u9605\u6587\u6863 \u8bf7\u6c42\u4f53 - \u591a\u4e2a\u53c2\u6570\uff1a\u8bf7\u6c42\u4f53\u4e2d\u7684\u5355\u4e00\u503c\u3002</p>"},{"location":"tutorial/cookie-params/","title":"Cookie \u53c2\u6570","text":"<p>\u4f60\u53ef\u4ee5\u50cf\u5b9a\u4e49 <code>Query</code> \u53c2\u6570\u548c <code>Path</code> \u53c2\u6570\u4e00\u6837\u6765\u5b9a\u4e49 <code>Cookie</code> \u53c2\u6570\u3002</p>"},{"location":"tutorial/cookie-params/#cookie_1","title":"\u5bfc\u5165 <code>Cookie</code>","text":"<p>\u9996\u5148\uff0c\u5bfc\u5165 <code>Cookie</code>:</p> <pre><code>from typing import Union\n\nfrom fastapi import Cookie, FastAPI\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items(ads_id: Union[str, None] = Cookie(default=None)):\n    return {\"ads_id\": ads_id}\n</code></pre>"},{"location":"tutorial/cookie-params/#cookie_2","title":"\u58f0\u660e <code>Cookie</code> \u53c2\u6570","text":"<p>\u58f0\u660e <code>Cookie</code> \u53c2\u6570\u7684\u7ed3\u6784\u4e0e\u58f0\u660e <code>Query</code> \u53c2\u6570\u548c <code>Path</code> \u53c2\u6570\u65f6\u76f8\u540c\u3002</p> <p>\u7b2c\u4e00\u4e2a\u503c\u662f\u53c2\u6570\u7684\u9ed8\u8ba4\u503c\uff0c\u540c\u65f6\u4e5f\u53ef\u4ee5\u4f20\u9012\u6240\u6709\u9a8c\u8bc1\u53c2\u6570\u6216\u6ce8\u91ca\u53c2\u6570\uff0c\u6765\u6821\u9a8c\u53c2\u6570\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import Cookie, FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items(ads_id: Union[str, None] = Cookie(default=None)):\nreturn {\"ads_id\": ads_id}\n</code></pre> <p>\u6280\u672f\u7ec6\u8282</p> <p><code>Cookie</code> \u3001<code>Path</code> \u3001<code>Query</code>\u662f\u5144\u5f1f\u7c7b\uff0c\u5b83\u4eec\u90fd\u7ee7\u627f\u81ea\u516c\u5171\u7684 <code>Param</code> \u7c7b</p> <p>\u4f46\u8bf7\u8bb0\u4f4f\uff0c\u5f53\u4f60\u4ece <code>fastapi</code> \u5bfc\u5165\u7684 <code>Query</code>\u3001<code>Path</code>\u3001<code>Cookie</code> \u6216\u5176\u4ed6\u53c2\u6570\u58f0\u660e\u51fd\u6570\uff0c\u8fd9\u4e9b\u5b9e\u9645\u4e0a\u662f\u8fd4\u56de\u7279\u6b8a\u7c7b\u7684\u51fd\u6570\u3002</p> <p>Info</p> <p>\u4f60\u9700\u8981\u4f7f\u7528 <code>Cookie</code> \u6765\u58f0\u660e cookie \u53c2\u6570\uff0c\u5426\u5219\u53c2\u6570\u5c06\u4f1a\u88ab\u89e3\u91ca\u4e3a\u67e5\u8be2\u53c2\u6570\u3002</p>"},{"location":"tutorial/cookie-params/#_1","title":"\u603b\u7ed3","text":"<p>\u4f7f\u7528 <code>Cookie</code> \u58f0\u660e cookie \u53c2\u6570\uff0c\u4f7f\u7528\u65b9\u5f0f\u4e0e <code>Query</code> \u548c <code>Path</code> \u7c7b\u4f3c\u3002</p>"},{"location":"tutorial/cors/","title":"CORS\uff08\u8de8\u57df\u8d44\u6e90\u5171\u4eab\uff09","text":"<p>CORS \u6216\u8005\u300c\u8de8\u57df\u8d44\u6e90\u5171\u4eab\u300d \u6307\u6d4f\u89c8\u5668\u4e2d\u8fd0\u884c\u7684\u524d\u7aef\u62e5\u6709\u4e0e\u540e\u7aef\u901a\u4fe1\u7684 JavaScript \u4ee3\u7801\uff0c\u800c\u540e\u7aef\u5904\u4e8e\u4e0e\u524d\u7aef\u4e0d\u540c\u7684\u300c\u6e90\u300d\u7684\u60c5\u51b5\u3002</p>"},{"location":"tutorial/cors/#_1","title":"\u6e90","text":"<p>\u6e90\u662f\u534f\u8bae\uff08<code>http</code>\uff0c<code>https</code>\uff09\u3001\u57df\uff08<code>myapp.com</code>\uff0c<code>localhost</code>\uff0c<code>localhost.tiangolo.com</code>\uff09\u4ee5\u53ca\u7aef\u53e3\uff08<code>80</code>\u3001<code>443</code>\u3001<code>8080</code>\uff09\u7684\u7ec4\u5408\u3002</p> <p>\u56e0\u6b64\uff0c\u8fd9\u4e9b\u90fd\u662f\u4e0d\u540c\u7684\u6e90\uff1a</p> <ul> <li><code>http://localhost</code></li> <li><code>https://localhost</code></li> <li><code>http://localhost:8080</code></li> </ul> <p>\u5373\u4f7f\u5b83\u4eec\u90fd\u5728 <code>localhost</code> \u4e2d\uff0c\u4f46\u662f\u5b83\u4eec\u4f7f\u7528\u4e0d\u540c\u7684\u534f\u8bae\u6216\u8005\u7aef\u53e3\uff0c\u6240\u4ee5\u5b83\u4eec\u90fd\u662f\u4e0d\u540c\u7684\u300c\u6e90\u300d\u3002</p>"},{"location":"tutorial/cors/#_2","title":"\u6b65\u9aa4","text":"<p>\u5047\u8bbe\u4f60\u7684\u6d4f\u89c8\u5668\u4e2d\u6709\u4e00\u4e2a\u524d\u7aef\u8fd0\u884c\u5728 <code>http://localhost:8080</code>\uff0c\u5e76\u4e14\u5b83\u7684 JavaScript \u6b63\u5728\u5c1d\u8bd5\u4e0e\u8fd0\u884c\u5728 <code>http://localhost</code> \u7684\u540e\u7aef\u901a\u4fe1\uff08\u56e0\u4e3a\u6211\u4eec\u6ca1\u6709\u6307\u5b9a\u7aef\u53e3\uff0c\u6d4f\u89c8\u5668\u4f1a\u91c7\u7528\u9ed8\u8ba4\u7684\u7aef\u53e3 <code>80</code>\uff09\u3002</p> <p>\u7136\u540e\uff0c\u6d4f\u89c8\u5668\u4f1a\u5411\u540e\u7aef\u53d1\u9001\u4e00\u4e2a HTTP <code>OPTIONS</code> \u8bf7\u6c42\uff0c\u5982\u679c\u540e\u7aef\u53d1\u9001\u9002\u5f53\u7684 headers \u6765\u6388\u6743\u6765\u81ea\u8fd9\u4e2a\u4e0d\u540c\u6e90\uff08<code>http://localhost:8080</code>\uff09\u7684\u901a\u4fe1\uff0c\u6d4f\u89c8\u5668\u5c06\u5141\u8bb8\u524d\u7aef\u7684 JavaScript \u5411\u540e\u7aef\u53d1\u9001\u8bf7\u6c42\u3002</p> <p>\u4e3a\u6b64\uff0c\u540e\u7aef\u5fc5\u987b\u6709\u4e00\u4e2a\u300c\u5141\u8bb8\u7684\u6e90\u300d\u5217\u8868\u3002</p> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5b83\u5fc5\u987b\u5305\u542b <code>http://localhost:8080</code>\uff0c\u524d\u7aef\u624d\u80fd\u6b63\u5e38\u5de5\u4f5c\u3002</p>"},{"location":"tutorial/cors/#_3","title":"\u901a\u914d\u7b26","text":"<p>\u4e5f\u53ef\u4ee5\u4f7f\u7528 <code>\"*\"</code>\uff08\u4e00\u4e2a\u300c\u901a\u914d\u7b26\u300d\uff09\u58f0\u660e\u8fd9\u4e2a\u5217\u8868\uff0c\u8868\u793a\u5168\u90e8\u90fd\u662f\u5141\u8bb8\u7684\u3002</p> <p>\u4f46\u8fd9\u4ec5\u5141\u8bb8\u67d0\u4e9b\u7c7b\u578b\u7684\u901a\u4fe1\uff0c\u4e0d\u5305\u62ec\u6240\u6709\u6d89\u53ca\u51ed\u636e\u7684\u5185\u5bb9\uff1a\u50cf Cookies \u4ee5\u53ca\u90a3\u4e9b\u4f7f\u7528 Bearer \u4ee4\u724c\u7684\u6388\u6743 headers \u7b49\u3002</p> <p>\u56e0\u6b64\uff0c\u4e3a\u4e86\u4e00\u5207\u90fd\u80fd\u6b63\u5e38\u5de5\u4f5c\uff0c\u6700\u597d\u663e\u5f0f\u5730\u6307\u5b9a\u5141\u8bb8\u7684\u6e90\u3002</p>"},{"location":"tutorial/cors/#corsmiddleware","title":"\u4f7f\u7528 <code>CORSMiddleware</code>","text":"<p>\u4f60\u53ef\u4ee5\u5728 FastAPI \u5e94\u7528\u4e2d\u4f7f\u7528 <code>CORSMiddleware</code> \u6765\u914d\u7f6e\u5b83\u3002</p> <ul> <li>\u5bfc\u5165 <code>CORSMiddleware</code>\u3002</li> <li>\u521b\u5efa\u4e00\u4e2a\u5141\u8bb8\u7684\u6e90\u5217\u8868\uff08\u7531\u5b57\u7b26\u4e32\u7ec4\u6210\uff09\u3002</li> <li>\u5c06\u5176\u4f5c\u4e3a\u300c\u4e2d\u95f4\u4ef6\u300d\u6dfb\u52a0\u5230\u4f60\u7684 FastAPI \u5e94\u7528\u4e2d\u3002</li> </ul> <p>\u4f60\u4e5f\u53ef\u4ee5\u6307\u5b9a\u540e\u7aef\u662f\u5426\u5141\u8bb8\uff1a</p> <ul> <li>\u51ed\u8bc1\uff08\u6388\u6743 headers\uff0cCookies \u7b49\uff09\u3002</li> <li>\u7279\u5b9a\u7684 HTTP \u65b9\u6cd5\uff08<code>POST</code>\uff0c<code>PUT</code>\uff09\u6216\u8005\u4f7f\u7528\u901a\u914d\u7b26 <code>\"*\"</code> \u5141\u8bb8\u6240\u6709\u65b9\u6cd5\u3002</li> <li>\u7279\u5b9a\u7684 HTTP headers \u6216\u8005\u4f7f\u7528\u901a\u914d\u7b26 <code>\"*\"</code> \u5141\u8bb8\u6240\u6709 headers\u3002</li> </ul> <pre><code>from fastapi import FastAPI\nfrom fastapi.middleware.cors import CORSMiddleware\napp = FastAPI()\n\norigins = [\n\"http://localhost.tiangolo.com\",\n\"https://localhost.tiangolo.com\",\n\"http://localhost\",\n\"http://localhost:8080\",\n]\napp.add_middleware(\nCORSMiddleware,\nallow_origins=origins,\nallow_credentials=True,\nallow_methods=[\"*\"],\nallow_headers=[\"*\"],\n)\n@app.get(\"/\")\nasync def main():\n    return {\"message\": \"Hello World\"}\n</code></pre> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u8fd9\u4e2a <code>CORSMiddleware</code> \u5b9e\u73b0\u6240\u4f7f\u7528\u7684\u9ed8\u8ba4\u53c2\u6570\u8f83\u4e3a\u4fdd\u5b88\uff0c\u6240\u4ee5\u4f60\u9700\u8981\u663e\u5f0f\u5730\u542f\u7528\u7279\u5b9a\u7684\u6e90\u3001\u65b9\u6cd5\u6216\u8005 headers\uff0c\u4ee5\u4fbf\u6d4f\u89c8\u5668\u80fd\u591f\u5728\u8de8\u57df\u4e0a\u4e0b\u6587\u4e2d\u4f7f\u7528\u5b83\u4eec\u3002</p> <p>\u652f\u6301\u4ee5\u4e0b\u53c2\u6570\uff1a</p> <ul> <li><code>allow_origins</code> - \u4e00\u4e2a\u5141\u8bb8\u8de8\u57df\u8bf7\u6c42\u7684\u6e90\u5217\u8868\u3002\u4f8b\u5982 <code>['https://example.org', 'https://www.example.org']</code>\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528 <code>['*']</code> \u5141\u8bb8\u4efb\u4f55\u6e90\u3002</li> <li><code>allow_origin_regex</code> - \u4e00\u4e2a\u6b63\u5219\u8868\u8fbe\u5f0f\u5b57\u7b26\u4e32\uff0c\u5339\u914d\u7684\u6e90\u5141\u8bb8\u8de8\u57df\u8bf7\u6c42\u3002\u4f8b\u5982 <code>'https://.*\\.example\\.org'</code>\u3002</li> <li><code>allow_methods</code> - \u4e00\u4e2a\u5141\u8bb8\u8de8\u57df\u8bf7\u6c42\u7684 HTTP \u65b9\u6cd5\u5217\u8868\u3002\u9ed8\u8ba4\u4e3a <code>['GET']</code>\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528 <code>['*']</code> \u6765\u5141\u8bb8\u6240\u6709\u6807\u51c6\u65b9\u6cd5\u3002</li> <li><code>allow_headers</code> - \u4e00\u4e2a\u5141\u8bb8\u8de8\u57df\u8bf7\u6c42\u7684 HTTP \u8bf7\u6c42\u5934\u5217\u8868\u3002\u9ed8\u8ba4\u4e3a <code>[]</code>\u3002\u4f60\u53ef\u4ee5\u4f7f\u7528 <code>['*']</code> \u5141\u8bb8\u6240\u6709\u7684\u8bf7\u6c42\u5934\u3002<code>Accept</code>\u3001<code>Accept-Language</code>\u3001<code>Content-Language</code> \u4ee5\u53ca <code>Content-Type</code> \u8bf7\u6c42\u5934\u603b\u662f\u5141\u8bb8 CORS \u8bf7\u6c42\u3002</li> <li><code>allow_credentials</code> - \u6307\u793a\u8de8\u57df\u8bf7\u6c42\u652f\u6301 cookies\u3002\u9ed8\u8ba4\u662f <code>False</code>\u3002\u53e6\u5916\uff0c\u5141\u8bb8\u51ed\u8bc1\u65f6 <code>allow_origins</code> \u4e0d\u80fd\u8bbe\u5b9a\u4e3a <code>['*']</code>\uff0c\u5fc5\u987b\u6307\u5b9a\u6e90\u3002</li> <li><code>expose_headers</code> - \u6307\u793a\u53ef\u4ee5\u88ab\u6d4f\u89c8\u5668\u8bbf\u95ee\u7684\u54cd\u5e94\u5934\u3002\u9ed8\u8ba4\u4e3a <code>[]</code>\u3002</li> <li><code>max_age</code> - \u8bbe\u5b9a\u6d4f\u89c8\u5668\u7f13\u5b58 CORS \u54cd\u5e94\u7684\u6700\u957f\u65f6\u95f4\uff0c\u5355\u4f4d\u662f\u79d2\u3002\u9ed8\u8ba4\u4e3a <code>600</code>\u3002</li> </ul> <p>\u4e2d\u95f4\u4ef6\u54cd\u5e94\u4e24\u79cd\u7279\u5b9a\u7c7b\u578b\u7684 HTTP \u8bf7\u6c42\u2026\u2026</p>"},{"location":"tutorial/cors/#cors_1","title":"CORS \u9884\u68c0\u8bf7\u6c42","text":"<p>\u8fd9\u662f\u4e9b\u5e26\u6709 <code>Origin</code> \u548c <code>Access-Control-Request-Method</code> \u8bf7\u6c42\u5934\u7684 <code>OPTIONS</code> \u8bf7\u6c42\u3002</p> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4e2d\u95f4\u4ef6\u5c06\u62e6\u622a\u4f20\u5165\u7684\u8bf7\u6c42\u5e76\u8fdb\u884c\u54cd\u5e94\uff0c\u51fa\u4e8e\u63d0\u4f9b\u4fe1\u606f\u7684\u76ee\u7684\u8fd4\u56de\u4e00\u4e2a\u4f7f\u7528\u4e86\u9002\u5f53\u7684 CORS headers \u7684 <code>200</code> \u6216 <code>400</code> \u54cd\u5e94\u3002</p>"},{"location":"tutorial/cors/#_4","title":"\u7b80\u5355\u8bf7\u6c42","text":"<p>\u4efb\u4f55\u5e26\u6709 <code>Origin</code> \u8bf7\u6c42\u5934\u7684\u8bf7\u6c42\u3002\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4e2d\u95f4\u4ef6\u5c06\u50cf\u5e73\u5e38\u4e00\u6837\u4f20\u9012\u8bf7\u6c42\uff0c\u4f46\u662f\u5728\u54cd\u5e94\u4e2d\u5305\u542b\u9002\u5f53\u7684 CORS headers\u3002</p>"},{"location":"tutorial/cors/#_5","title":"\u66f4\u591a\u4fe1\u606f","text":"<p>\u66f4\u591a\u5173\u4e8e CORS \u7684\u4fe1\u606f\uff0c\u8bf7\u67e5\u770b Mozilla CORS \u6587\u6863\u3002</p> <p>\u6280\u672f\u7ec6\u8282</p> <p>\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 <code>from starlette.middleware.cors import CORSMiddleware</code>\u3002</p> <p>\u51fa\u4e8e\u65b9\u4fbf\uff0cFastAPI \u5728 <code>fastapi.middleware</code> \u4e2d\u4e3a\u5f00\u53d1\u8005\u63d0\u4f9b\u4e86\u51e0\u4e2a\u4e2d\u95f4\u4ef6\u3002\u4f46\u662f\u5927\u591a\u6570\u53ef\u7528\u7684\u4e2d\u95f4\u4ef6\u90fd\u662f\u76f4\u63a5\u6765\u81ea Starlette\u3002</p>"},{"location":"tutorial/debugging/","title":"\u8c03\u8bd5","text":"<p>\u4f60\u53ef\u4ee5\u5728\u7f16\u8f91\u5668\u4e2d\u8fde\u63a5\u8c03\u8bd5\u5668\uff0c\u4f8b\u5982\u4f7f\u7528 Visual Studio Code \u6216 PyCharm\u3002</p>"},{"location":"tutorial/debugging/#uvicorn","title":"\u8c03\u7528 <code>uvicorn</code>","text":"<p>\u5728\u4f60\u7684 FastAPI \u5e94\u7528\u4e2d\u76f4\u63a5\u5bfc\u5165 <code>uvicorn</code> \u5e76\u8fd0\u884c\uff1a</p> <pre><code>import uvicorn\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/\")\ndef root():\n    a = \"a\"\n    b = \"b\" + a\n    return {\"hello world\": b}\n\n\nif __name__ == \"__main__\":\nuvicorn.run(app, host=\"0.0.0.0\", port=8000)\n</code></pre>"},{"location":"tutorial/debugging/#__name__-__main__","title":"\u5173\u4e8e <code>__name__ == \"__main__\"</code>","text":"<p><code>__name__ == \"__main__\"</code> \u7684\u4e3b\u8981\u76ee\u7684\u662f\u4f7f\u7528\u4ee5\u4e0b\u4ee3\u7801\u8c03\u7528\u6587\u4ef6\u65f6\u6267\u884c\u4e00\u4e9b\u4ee3\u7801\uff1a</p> <pre><code>$ python myapp.py\n</code></pre> <p>\u800c\u5f53\u5176\u5b83\u6587\u4ef6\u5bfc\u5165\u5b83\u65f6\u5e76\u4e0d\u4f1a\u88ab\u8c03\u7528\uff0c\u50cf\u8fd9\u6837\uff1a</p> <pre><code>from myapp import app\n</code></pre>"},{"location":"tutorial/debugging/#_2","title":"\u66f4\u591a\u7ec6\u8282","text":"<p>\u5047\u8bbe\u4f60\u7684\u6587\u4ef6\u547d\u540d\u4e3a <code>myapp.py</code>\u3002</p> <p>\u5982\u679c\u4f60\u8fd9\u6837\u8fd0\u884c\uff1a</p> <pre><code>$ python myapp.py\n</code></pre> <p>\u90a3\u4e48\u6587\u4ef6\u4e2d\u7531 Python \u81ea\u52a8\u521b\u5efa\u7684\u5185\u90e8\u53d8\u91cf <code>__name__</code>\uff0c\u4f1a\u5c06\u5b57\u7b26\u4e32 <code>\"__main__\"</code> \u4f5c\u4e3a\u503c\u3002</p> <p>\u6240\u4ee5\uff0c\u4e0b\u9762\u8fd9\u90e8\u5206\u4ee3\u7801\u624d\u4f1a\u8fd0\u884c\uff1a</p> <pre><code>    uvicorn.run(app, host=\"0.0.0.0\", port=8000)\n</code></pre> <p>\u5982\u679c\u4f60\u662f\u5bfc\u5165\u8fd9\u4e2a\u6a21\u5757\uff08\u6587\u4ef6\uff09\u5c31\u4e0d\u4f1a\u8fd9\u6837\u3002</p> <p>\u56e0\u6b64\uff0c\u5982\u679c\u4f60\u7684\u53e6\u4e00\u4e2a\u6587\u4ef6 <code>importer.py</code> \u50cf\u8fd9\u6837\uff1a</p> <pre><code>from myapp import app\n\n# Some more code\n</code></pre> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c<code>myapp.py</code> \u5185\u90e8\u7684\u81ea\u52a8\u53d8\u91cf\u4e0d\u4f1a\u6709\u503c\u4e3a <code>\"__main__\"</code> \u7684\u53d8\u91cf <code>__name__</code>\u3002</p> <p>\u6240\u4ee5\uff0c\u4e0b\u9762\u8fd9\u4e00\u884c\u4e0d\u4f1a\u88ab\u6267\u884c\uff1a</p> <pre><code>    uvicorn.run(app, host=\"0.0.0.0\", port=8000)\n</code></pre> <p>Info</p> <p>\u66f4\u591a\u4fe1\u606f\u8bf7\u68c0\u67e5 Python \u5b98\u65b9\u6587\u6863.</p>"},{"location":"tutorial/debugging/#_3","title":"\u4f7f\u7528\u4f60\u7684\u8c03\u8bd5\u5668\u8fd0\u884c\u4ee3\u7801","text":"<p>\u7531\u4e8e\u662f\u4ece\u4ee3\u7801\u76f4\u63a5\u8fd0\u884c\u7684 Uvicorn \u670d\u52a1\u5668\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u4ece\u8c03\u8bd5\u5668\u76f4\u63a5\u8c03\u7528 Python \u7a0b\u5e8f\uff08\u4f60\u7684 FastAPI \u5e94\u7528\uff09\u3002</p> <p>\u4f8b\u5982\uff0c\u4f60\u53ef\u4ee5\u5728 Visual Studio Code \u4e2d\uff1a</p> <ul> <li>\u8fdb\u5165\u5230\u300c\u8c03\u8bd5\u300d\u9762\u677f\u3002</li> <li>\u300c\u6dfb\u52a0\u914d\u7f6e...\u300d\u3002</li> <li>\u9009\u4e2d\u300cPython\u300d</li> <li>\u8fd0\u884c\u300cPython\uff1a\u5f53\u524d\u6587\u4ef6\uff08\u96c6\u6210\u7ec8\u7aef\uff09\u300d\u9009\u9879\u7684\u8c03\u8bd5\u5668\u3002</li> </ul> <p>\u7136\u540e\u5b83\u4f1a\u4f7f\u7528\u4f60\u7684 FastAPI \u4ee3\u7801\u5f00\u542f\u670d\u52a1\u5668\uff0c\u505c\u5728\u65ad\u70b9\u5904\uff0c\u7b49\u7b49\u3002</p> <p>\u770b\u8d77\u6765\u53ef\u80fd\u662f\u8fd9\u6837\uff1a</p> <p></p> <p>\u5982\u679c\u4f7f\u7528 Pycharm\uff0c\u4f60\u53ef\u4ee5\uff1a</p> <ul> <li>\u6253\u5f00\u300c\u8fd0\u884c\u300d\u83dc\u5355\u3002</li> <li>\u9009\u4e2d\u300c\u8c03\u8bd5...\u300d\u3002</li> <li>\u7136\u540e\u51fa\u73b0\u4e00\u4e2a\u4e0a\u4e0b\u6587\u83dc\u5355\u3002</li> <li>\u9009\u62e9\u8981\u8c03\u8bd5\u7684\u6587\u4ef6\uff08\u672c\u4f8b\u4e2d\u7684 <code>main.py</code>\uff09\u3002</li> </ul> <p>\u7136\u540e\u5b83\u4f1a\u4f7f\u7528\u4f60\u7684 FastAPI \u4ee3\u7801\u5f00\u542f\u670d\u52a1\u5668\uff0c\u505c\u5728\u65ad\u70b9\u5904\uff0c\u7b49\u7b49\u3002</p> <p>\u770b\u8d77\u6765\u53ef\u80fd\u662f\u8fd9\u6837\uff1a</p> <p></p>"},{"location":"tutorial/encoder/","title":"JSON \u517c\u5bb9\u7f16\u7801\u5668","text":"<p>\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u5c06\u6570\u636e\u7c7b\u578b\uff08\u5982Pydantic\u6a21\u578b\uff09\u8f6c\u6362\u4e3a\u4e0eJSON\u517c\u5bb9\u7684\u6570\u636e\u7c7b\u578b\uff08\u5982<code>dict</code>\u3001<code>list</code>\u7b49\uff09\u3002</p> <p>\u6bd4\u5982\uff0c\u5982\u679c\u60a8\u9700\u8981\u5c06\u5176\u5b58\u50a8\u5728\u6570\u636e\u5e93\u4e2d\u3002</p> <p>\u5bf9\u4e8e\u8fd9\u79cd\u8981\u6c42\uff0c FastAPI\u63d0\u4f9b\u4e86<code>jsonable_encoder()</code>\u51fd\u6570\u3002</p>"},{"location":"tutorial/encoder/#jsonable_encoder","title":"\u4f7f\u7528<code>jsonable_encoder</code>","text":"<p>\u8ba9\u6211\u4eec\u5047\u8bbe\u4f60\u6709\u4e00\u4e2a\u6570\u636e\u5e93\u540d\u4e3a<code>fake_db</code>\uff0c\u5b83\u53ea\u80fd\u63a5\u6536\u4e0eJSON\u517c\u5bb9\u7684\u6570\u636e\u3002</p> <p>\u4f8b\u5982\uff0c\u5b83\u4e0d\u63a5\u6536<code>datetime</code>\u8fd9\u7c7b\u7684\u5bf9\u8c61\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u5bf9\u8c61\u4e0eJSON\u4e0d\u517c\u5bb9\u3002</p> <p>\u56e0\u6b64\uff0c<code>datetime</code>\u5bf9\u8c61\u5fc5\u987b\u5c06\u8f6c\u6362\u4e3a\u5305\u542bISO\u683c\u5f0f\u5316\u7684<code>str</code>\u7c7b\u578b\u5bf9\u8c61\u3002</p> <p>\u540c\u6837\uff0c\u8fd9\u4e2a\u6570\u636e\u5e93\u4e5f\u4e0d\u4f1a\u63a5\u6536Pydantic\u6a21\u578b\uff08\u5e26\u6709\u5c5e\u6027\u7684\u5bf9\u8c61\uff09\uff0c\u800c\u53ea\u63a5\u6536<code>dict</code>\u3002</p> <p>\u5bf9\u6b64\u4f60\u53ef\u4ee5\u4f7f\u7528<code>jsonable_encoder</code>\u3002</p> <p>\u5b83\u63a5\u6536\u4e00\u4e2a\u5bf9\u8c61\uff0c\u6bd4\u5982Pydantic\u6a21\u578b\uff0c\u5e76\u4f1a\u8fd4\u56de\u4e00\u4e2aJSON\u517c\u5bb9\u7684\u7248\u672c\uff1a</p> Python 3.10+Python 3.6+ <pre><code>from datetime import datetime\n\nfrom fastapi import FastAPI\nfrom fastapi.encoders import jsonable_encoder\nfrom pydantic import BaseModel\n\nfake_db = {}\n\n\nclass Item(BaseModel):\n    title: str\n    timestamp: datetime\n    description: str | None = None\n\n\napp = FastAPI()\n\n\n@app.put(\"/items/{id}\")\ndef update_item(id: str, item: Item):\njson_compatible_item_data = jsonable_encoder(item)\nfake_db[id] = json_compatible_item_data\n</code></pre> <pre><code>from datetime import datetime\nfrom typing import Union\n\nfrom fastapi import FastAPI\nfrom fastapi.encoders import jsonable_encoder\nfrom pydantic import BaseModel\n\nfake_db = {}\n\n\nclass Item(BaseModel):\n    title: str\n    timestamp: datetime\n    description: Union[str, None] = None\n\n\napp = FastAPI()\n\n\n@app.put(\"/items/{id}\")\ndef update_item(id: str, item: Item):\njson_compatible_item_data = jsonable_encoder(item)\nfake_db[id] = json_compatible_item_data\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u5b83\u5c06Pydantic\u6a21\u578b\u8f6c\u6362\u4e3a<code>dict</code>\uff0c\u5e76\u5c06<code>datetime</code>\u8f6c\u6362\u4e3a<code>str</code>\u3002</p> <p>\u8c03\u7528\u5b83\u7684\u7ed3\u679c\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528Python\u6807\u51c6\u7f16\u7801\u4e2d\u7684<code>json.dumps()</code>\u3002</p> <p>\u8fd9\u4e2a\u64cd\u4f5c\u4e0d\u4f1a\u8fd4\u56de\u4e00\u4e2a\u5305\u542bJSON\u683c\u5f0f\uff08\u4f5c\u4e3a\u5b57\u7b26\u4e32\uff09\u6570\u636e\u7684\u5e9e\u5927\u7684<code>str</code>\u3002\u5b83\u5c06\u8fd4\u56de\u4e00\u4e2aPython\u6807\u51c6\u6570\u636e\u7ed3\u6784\uff08\u4f8b\u5982<code>dict</code>\uff09\uff0c\u5176\u503c\u548c\u5b50\u503c\u90fd\u4e0eJSON\u517c\u5bb9\u3002</p> <p>Note</p> <p><code>jsonable_encoder</code>\u5b9e\u9645\u4e0a\u662fFastAPI\u5185\u90e8\u7528\u6765\u8f6c\u6362\u6570\u636e\u7684\u3002\u4f46\u662f\u5b83\u5728\u8bb8\u591a\u5176\u4ed6\u573a\u666f\u4e2d\u4e5f\u5f88\u6709\u7528\u3002</p>"},{"location":"tutorial/extra-data-types/","title":"\u989d\u5916\u6570\u636e\u7c7b\u578b","text":"<p>\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u60a8\u4e00\u76f4\u5728\u4f7f\u7528\u5e38\u89c1\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5982:</p> <ul> <li><code>int</code></li> <li><code>float</code></li> <li><code>str</code></li> <li><code>bool</code></li> </ul> <p>\u4f46\u662f\u60a8\u4e5f\u53ef\u4ee5\u4f7f\u7528\u66f4\u590d\u6742\u7684\u6570\u636e\u7c7b\u578b\u3002</p> <p>\u60a8\u4ecd\u7136\u4f1a\u62e5\u6709\u73b0\u5728\u5df2\u7ecf\u770b\u5230\u7684\u76f8\u540c\u7684\u7279\u6027:</p> <ul> <li>\u5f88\u68d2\u7684\u7f16\u8f91\u5668\u652f\u6301\u3002</li> <li>\u4f20\u5165\u8bf7\u6c42\u7684\u6570\u636e\u8f6c\u6362\u3002</li> <li>\u54cd\u5e94\u6570\u636e\u8f6c\u6362\u3002</li> <li>\u6570\u636e\u9a8c\u8bc1\u3002</li> <li>\u81ea\u52a8\u8865\u5168\u548c\u6587\u6863\u3002</li> </ul>"},{"location":"tutorial/extra-data-types/#_2","title":"\u5176\u4ed6\u6570\u636e\u7c7b\u578b","text":"<p>\u4e0b\u9762\u662f\u4e00\u4e9b\u4f60\u53ef\u4ee5\u4f7f\u7528\u7684\u5176\u4ed6\u6570\u636e\u7c7b\u578b:</p> <ul> <li><code>UUID</code>:<ul> <li>\u4e00\u79cd\u6807\u51c6\u7684 \"\u901a\u7528\u552f\u4e00\u6807\u8bc6\u7b26\" \uff0c\u5728\u8bb8\u591a\u6570\u636e\u5e93\u548c\u7cfb\u7edf\u4e2d\u7528\u4f5cID\u3002</li> <li>\u5728\u8bf7\u6c42\u548c\u54cd\u5e94\u4e2d\u5c06\u4ee5 <code>str</code> \u8868\u793a\u3002</li> </ul> </li> <li><code>datetime.datetime</code>:<ul> <li>\u4e00\u4e2a Python <code>datetime.datetime</code>.</li> <li>\u5728\u8bf7\u6c42\u548c\u54cd\u5e94\u4e2d\u5c06\u8868\u793a\u4e3a ISO 8601 \u683c\u5f0f\u7684 <code>str</code> \uff0c\u6bd4\u5982: <code>2008-09-15T15:53:00+05:00</code>.</li> </ul> </li> <li><code>datetime.date</code>:<ul> <li>Python <code>datetime.date</code>.</li> <li>\u5728\u8bf7\u6c42\u548c\u54cd\u5e94\u4e2d\u5c06\u8868\u793a\u4e3a ISO 8601 \u683c\u5f0f\u7684 <code>str</code> \uff0c\u6bd4\u5982: <code>2008-09-15</code>.</li> </ul> </li> <li><code>datetime.time</code>:<ul> <li>\u4e00\u4e2a Python <code>datetime.time</code>.</li> <li>\u5728\u8bf7\u6c42\u548c\u54cd\u5e94\u4e2d\u5c06\u8868\u793a\u4e3a ISO 8601 \u683c\u5f0f\u7684 <code>str</code> \uff0c\u6bd4\u5982:  <code>14:23:55.003</code>.</li> </ul> </li> <li><code>datetime.timedelta</code>:<ul> <li>\u4e00\u4e2a Python <code>datetime.timedelta</code>.</li> <li>\u5728\u8bf7\u6c42\u548c\u54cd\u5e94\u4e2d\u5c06\u8868\u793a\u4e3a <code>float</code> \u4ee3\u8868\u603b\u79d2\u6570\u3002</li> <li>Pydantic \u4e5f\u5141\u8bb8\u5c06\u5176\u8868\u793a\u4e3a \"ISO 8601 \u65f6\u95f4\u5dee\u5f02\u7f16\u7801\", \u67e5\u770b\u6587\u6863\u4e86\u89e3\u66f4\u591a\u4fe1\u606f\u3002</li> </ul> </li> <li><code>frozenset</code>:<ul> <li>\u5728\u8bf7\u6c42\u548c\u54cd\u5e94\u4e2d\uff0c\u4f5c\u4e3a <code>set</code> \u5bf9\u5f85\uff1a<ul> <li>\u5728\u8bf7\u6c42\u4e2d\uff0c\u5217\u8868\u5c06\u88ab\u8bfb\u53d6\uff0c\u6d88\u9664\u91cd\u590d\uff0c\u5e76\u5c06\u5176\u8f6c\u6362\u4e3a\u4e00\u4e2a <code>set</code>\u3002</li> <li>\u5728\u54cd\u5e94\u4e2d <code>set</code> \u5c06\u88ab\u8f6c\u6362\u4e3a <code>list</code> \u3002</li> <li>\u4ea7\u751f\u7684\u6a21\u5f0f\u5c06\u6307\u5b9a\u90a3\u4e9b <code>set</code> \u7684\u503c\u662f\u552f\u4e00\u7684 (\u4f7f\u7528 JSON \u6a21\u5f0f\u7684 <code>uniqueItems</code>)\u3002</li> </ul> </li> </ul> </li> <li><code>bytes</code>:<ul> <li>\u6807\u51c6\u7684 Python <code>bytes</code>\u3002</li> <li>\u5728\u8bf7\u6c42\u548c\u76f8\u5e94\u4e2d\u88ab\u5f53\u4f5c <code>str</code> \u5904\u7406\u3002</li> <li>\u751f\u6210\u7684\u6a21\u5f0f\u5c06\u6307\u5b9a\u8fd9\u4e2a <code>str</code> \u662f <code>binary</code> \"\u683c\u5f0f\"\u3002</li> </ul> </li> <li><code>Decimal</code>:<ul> <li>\u6807\u51c6\u7684 Python <code>Decimal</code>\u3002</li> <li>\u5728\u8bf7\u6c42\u548c\u76f8\u5e94\u4e2d\u88ab\u5f53\u505a <code>float</code> \u4e00\u6837\u5904\u7406\u3002</li> </ul> </li> <li>\u60a8\u53ef\u4ee5\u5728\u8fd9\u91cc\u68c0\u67e5\u6240\u6709\u6709\u6548\u7684pydantic\u6570\u636e\u7c7b\u578b: Pydantic data types.</li> </ul>"},{"location":"tutorial/extra-data-types/#_3","title":"\u4f8b\u5b50","text":"<p>\u4e0b\u9762\u662f\u4e00\u4e2a\u8def\u5f84\u64cd\u4f5c\u7684\u793a\u4f8b\uff0c\u5176\u4e2d\u7684\u53c2\u6570\u4f7f\u7528\u4e86\u4e0a\u9762\u7684\u4e00\u4e9b\u7c7b\u578b\u3002</p> <pre><code>from datetime import datetime, time, timedelta\nfrom typing import Union\nfrom uuid import UUID\nfrom fastapi import Body, FastAPI\n\napp = FastAPI()\n\n\n@app.put(\"/items/{item_id}\")\nasync def read_items(\nitem_id: UUID,\nstart_datetime: Union[datetime, None] = Body(default=None),\nend_datetime: Union[datetime, None] = Body(default=None),\nrepeat_at: Union[time, None] = Body(default=None),\nprocess_after: Union[timedelta, None] = Body(default=None),\n):\n    start_process = start_datetime + process_after\n    duration = end_datetime - start_process\n    return {\n        \"item_id\": item_id,\n        \"start_datetime\": start_datetime,\n        \"end_datetime\": end_datetime,\n        \"repeat_at\": repeat_at,\n        \"process_after\": process_after,\n        \"start_process\": start_process,\n        \"duration\": duration,\n    }\n</code></pre> <p>\u6ce8\u610f\uff0c\u51fd\u6570\u5185\u7684\u53c2\u6570\u6709\u539f\u751f\u7684\u6570\u636e\u7c7b\u578b\uff0c\u4f60\u53ef\u4ee5\uff0c\u4f8b\u5982\uff0c\u6267\u884c\u6b63\u5e38\u7684\u65e5\u671f\u64cd\u4f5c\uff0c\u5982:</p> <pre><code>from datetime import datetime, time, timedelta\nfrom typing import Union\nfrom uuid import UUID\n\nfrom fastapi import Body, FastAPI\n\napp = FastAPI()\n\n\n@app.put(\"/items/{item_id}\")\nasync def read_items(\n    item_id: UUID,\n    start_datetime: Union[datetime, None] = Body(default=None),\n    end_datetime: Union[datetime, None] = Body(default=None),\n    repeat_at: Union[time, None] = Body(default=None),\n    process_after: Union[timedelta, None] = Body(default=None),\n):\nstart_process = start_datetime + process_after\nduration = end_datetime - start_process\nreturn {\n        \"item_id\": item_id,\n        \"start_datetime\": start_datetime,\n        \"end_datetime\": end_datetime,\n        \"repeat_at\": repeat_at,\n        \"process_after\": process_after,\n        \"start_process\": start_process,\n        \"duration\": duration,\n    }\n</code></pre>"},{"location":"tutorial/extra-models/","title":"\u989d\u5916\u7684\u6a21\u578b","text":"<p>\u6211\u4eec\u4ece\u524d\u9762\u7684\u793a\u4f8b\u7ee7\u7eed\uff0c\u62e5\u6709\u591a\u4e2a\u76f8\u5173\u7684\u6a21\u578b\u662f\u5f88\u5e38\u89c1\u7684\u3002</p> <p>\u5bf9\u7528\u6237\u6a21\u578b\u6765\u8bf4\u5c24\u5176\u5982\u6b64\uff0c\u56e0\u4e3a\uff1a</p> <ul> <li>\u8f93\u5165\u6a21\u578b\u9700\u8981\u62e5\u6709\u5bc6\u7801\u5c5e\u6027\u3002</li> <li>\u8f93\u51fa\u6a21\u578b\u4e0d\u5e94\u8be5\u5305\u542b\u5bc6\u7801\u3002</li> <li>\u6570\u636e\u5e93\u6a21\u578b\u5f88\u53ef\u80fd\u9700\u8981\u4fdd\u5b58\u5bc6\u7801\u7684\u54c8\u5e0c\u503c\u3002</li> </ul> <p>Danger</p> <p>\u6c38\u8fdc\u4e0d\u8981\u5b58\u50a8\u7528\u6237\u7684\u660e\u6587\u5bc6\u7801\u3002\u59cb\u7ec8\u5b58\u50a8\u4e00\u4e2a\u53ef\u4ee5\u7528\u4e8e\u9a8c\u8bc1\u7684\u300c\u5b89\u5168\u54c8\u5e0c\u503c\u300d\u3002</p> <p>\u5982\u679c\u4f60\u5c1a\u672a\u4e86\u89e3\u8be5\u77e5\u8bc6\uff0c\u4f60\u53ef\u4ee5\u5728\u5b89\u5168\u7ae0\u8282\u4e2d\u5b66\u4e60\u4f55\u4e3a\u300c\u5bc6\u7801\u54c8\u5e0c\u503c\u300d\u3002</p>"},{"location":"tutorial/extra-models/#_2","title":"\u591a\u4e2a\u6a21\u578b","text":"<p>\u4e0b\u9762\u662f\u5e94\u8be5\u5982\u4f55\u6839\u636e\u5b83\u4eec\u7684\u5bc6\u7801\u5b57\u6bb5\u4ee5\u53ca\u4f7f\u7528\u4f4d\u7f6e\u53bb\u5b9a\u4e49\u6a21\u578b\u7684\u5927\u6982\u601d\u8def\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel, EmailStr\n\napp = FastAPI()\n\n\nclass UserIn(BaseModel):\nusername: str\npassword: str\nemail: EmailStr\n    full_name: Union[str, None] = None\n\n\nclass UserOut(BaseModel):\nusername: str\n    email: EmailStr\n    full_name: Union[str, None] = None\n\n\nclass UserInDB(BaseModel):\nusername: str\nhashed_password: str\nemail: EmailStr\n    full_name: Union[str, None] = None\n\n\ndef fake_password_hasher(raw_password: str):\nreturn \"supersecret\" + raw_password\ndef fake_save_user(user_in: UserIn):\nhashed_password = fake_password_hasher(user_in.password)\nuser_in_db = UserInDB(**user_in.dict(), hashed_password=hashed_password)\nprint(\"User saved! ..not really\")\n    return user_in_db\n\n\n@app.post(\"/user/\", response_model=UserOut)\nasync def create_user(user_in: UserIn):\nuser_saved = fake_save_user(user_in)\n    return user_saved\n</code></pre>"},{"location":"tutorial/extra-models/#user_indict","title":"\u5173\u4e8e <code>**user_in.dict()</code>","text":""},{"location":"tutorial/extra-models/#pydantic-dict","title":"Pydantic \u7684 <code>.dict()</code>","text":"<p><code>user_in</code> \u662f\u4e00\u4e2a <code>UserIn</code> \u7c7b\u7684 Pydantic \u6a21\u578b.</p> <p>Pydantic \u6a21\u578b\u5177\u6709 <code>.dict\uff08\uff09</code> \u65b9\u6cd5\uff0c\u8be5\u65b9\u6cd5\u8fd4\u56de\u4e00\u4e2a\u62e5\u6709\u6a21\u578b\u6570\u636e\u7684 <code>dict</code>\u3002</p> <p>\u56e0\u6b64\uff0c\u5982\u679c\u6211\u4eec\u50cf\u4e0b\u9762\u8fd9\u6837\u521b\u5efa\u4e00\u4e2a Pydantic \u5bf9\u8c61 <code>user_in</code>\uff1a</p> <pre><code>user_in = UserIn(username=\"john\", password=\"secret\", email=\"john.doe@example.com\")\n</code></pre> <p>\u7136\u540e\u6211\u4eec\u8c03\u7528\uff1a</p> <pre><code>user_dict = user_in.dict()\n</code></pre> <p>\u73b0\u5728\u6211\u4eec\u6709\u4e86\u4e00\u4e2a\u6570\u636e\u4f4d\u4e8e\u53d8\u91cf <code>user_dict</code> \u4e2d\u7684 <code>dict</code>\uff08\u5b83\u662f\u4e00\u4e2a <code>dict</code> \u800c\u4e0d\u662f Pydantic \u6a21\u578b\u5bf9\u8c61\uff09\u3002</p> <p>\u5982\u679c\u6211\u4eec\u8c03\u7528\uff1a</p> <pre><code>print(user_dict)\n</code></pre> <p>\u6211\u4eec\u5c06\u83b7\u5f97\u4e00\u4e2a\u8fd9\u6837\u7684 Python <code>dict</code>\uff1a</p> <pre><code>{\n    'username': 'john',\n    'password': 'secret',\n    'email': 'john.doe@example.com',\n    'full_name': None,\n}\n</code></pre>"},{"location":"tutorial/extra-models/#dict","title":"\u89e3\u5305 <code>dict</code>","text":"<p>\u5982\u679c\u6211\u4eec\u5c06 <code>user_dict</code> \u8fd9\u6837\u7684 <code>dict</code> \u4ee5 <code>**user_dict</code> \u5f62\u5f0f\u4f20\u9012\u7ed9\u4e00\u4e2a\u51fd\u6570\uff08\u6216\u7c7b\uff09\uff0cPython\u5c06\u5bf9\u5176\u8fdb\u884c\u300c\u89e3\u5305\u300d\u3002\u5b83\u4f1a\u5c06 <code>user_dict</code> \u7684\u952e\u548c\u503c\u4f5c\u4e3a\u5173\u952e\u5b57\u53c2\u6570\u76f4\u63a5\u4f20\u9012\u3002</p> <p>\u56e0\u6b64\uff0c\u4ece\u4e0a\u9762\u7684 <code>user_dict</code> \u7ee7\u7eed\uff0c\u7f16\u5199\uff1a</p> <pre><code>UserInDB(**user_dict)\n</code></pre> <p>\u4f1a\u4ea7\u751f\u7c7b\u4f3c\u4e8e\u4ee5\u4e0b\u7684\u7ed3\u679c\uff1a</p> <pre><code>UserInDB(\n    username=\"john\",\n    password=\"secret\",\n    email=\"john.doe@example.com\",\n    full_name=None,\n)\n</code></pre> <p>\u6216\u8005\u66f4\u786e\u5207\u5730\uff0c\u76f4\u63a5\u4f7f\u7528 <code>user_dict</code> \u6765\u8868\u793a\u5c06\u6765\u53ef\u80fd\u5305\u542b\u7684\u4efb\u4f55\u5185\u5bb9\uff1a</p> <pre><code>UserInDB(\n    username = user_dict[\"username\"],\n    password = user_dict[\"password\"],\n    email = user_dict[\"email\"],\n    full_name = user_dict[\"full_name\"],\n)\n</code></pre>"},{"location":"tutorial/extra-models/#pydantic","title":"\u6765\u81ea\u4e8e\u5176\u4ed6\u6a21\u578b\u5185\u5bb9\u7684 Pydantic \u6a21\u578b","text":"<p>\u5982\u4e0a\u4f8b\u6240\u793a\uff0c\u6211\u4eec\u4ece <code>user_in.dict\uff08\uff09</code> \u4e2d\u83b7\u5f97\u4e86 <code>user_dict</code>\uff0c\u6b64\u4ee3\u7801\uff1a</p> <pre><code>user_dict = user_in.dict()\nUserInDB(**user_dict)\n</code></pre> <p>\u7b49\u540c\u4e8e\uff1a</p> <pre><code>UserInDB(**user_in.dict())\n</code></pre> <p>...\u56e0\u4e3a <code>user_in.dict()</code> \u662f\u4e00\u4e2a <code>dict</code>\uff0c\u7136\u540e\u6211\u4eec\u901a\u8fc7\u4ee5<code>**</code>\u5f00\u5934\u4f20\u9012\u7ed9 <code>UserInDB</code> \u6765\u4f7f Python\u300c\u89e3\u5305\u300d\u5b83\u3002</p> <p>\u8fd9\u6837\uff0c\u6211\u4eec\u83b7\u5f97\u4e86\u4e00\u4e2a\u6765\u81ea\u4e8e\u5176\u4ed6 Pydantic \u6a21\u578b\u4e2d\u7684\u6570\u636e\u7684 Pydantic \u6a21\u578b\u3002</p>"},{"location":"tutorial/extra-models/#dict_1","title":"\u89e3\u5305 <code>dict</code> \u548c\u989d\u5916\u5173\u952e\u5b57","text":"<p>\u7136\u540e\u6dfb\u52a0\u989d\u5916\u7684\u5173\u952e\u5b57\u53c2\u6570 <code>hashed_password=hashed_password</code>\uff0c\u4f8b\u5982\uff1a</p> <pre><code>UserInDB(**user_in.dict(), hashed_password=hashed_password)\n</code></pre> <p>...\u6700\u7ec8\u7684\u7ed3\u679c\u5982\u4e0b\uff1a</p> <pre><code>UserInDB(\n    username = user_dict[\"username\"],\n    password = user_dict[\"password\"],\n    email = user_dict[\"email\"],\n    full_name = user_dict[\"full_name\"],\n    hashed_password = hashed_password,\n)\n</code></pre> <p>Warning</p> <p>\u8f85\u52a9\u6027\u7684\u989d\u5916\u51fd\u6570\u53ea\u662f\u4e3a\u4e86\u6f14\u793a\u53ef\u80fd\u7684\u6570\u636e\u6d41\uff0c\u4f46\u5b83\u4eec\u663e\u7136\u4e0d\u80fd\u63d0\u4f9b\u4efb\u4f55\u771f\u6b63\u7684\u5b89\u5168\u6027\u3002</p>"},{"location":"tutorial/extra-models/#_3","title":"\u51cf\u5c11\u91cd\u590d","text":"<p>\u51cf\u5c11\u4ee3\u7801\u91cd\u590d\u662f FastAPI \u7684\u6838\u5fc3\u601d\u60f3\u4e4b\u4e00\u3002</p> <p>\u56e0\u4e3a\u4ee3\u7801\u91cd\u590d\u4f1a\u589e\u52a0\u51fa\u73b0 bug\u3001\u5b89\u5168\u6027\u95ee\u9898\u3001\u4ee3\u7801\u5931\u6b65\u95ee\u9898\uff08\u5f53\u4f60\u5728\u4e00\u4e2a\u4f4d\u7f6e\u66f4\u65b0\u4e86\u4ee3\u7801\u4f46\u6ca1\u6709\u5728\u5176\u4ed6\u4f4d\u7f6e\u66f4\u65b0\uff09\u7b49\u7684\u53ef\u80fd\u6027\u3002</p> <p>\u4e0a\u9762\u7684\u8fd9\u4e9b\u6a21\u578b\u90fd\u5171\u4eab\u4e86\u5927\u91cf\u6570\u636e\uff0c\u5e76\u62e5\u6709\u91cd\u590d\u7684\u5c5e\u6027\u540d\u79f0\u548c\u7c7b\u578b\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u505a\u5f97\u66f4\u597d\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u58f0\u660e\u4e00\u4e2a <code>UserBase</code> \u6a21\u578b\u4f5c\u4e3a\u5176\u4ed6\u6a21\u578b\u7684\u57fa\u7c7b\u3002\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u521b\u5efa\u7ee7\u627f\u8be5\u6a21\u578b\u5c5e\u6027\uff08\u7c7b\u578b\u58f0\u660e\uff0c\u6821\u9a8c\u7b49\uff09\u7684\u5b50\u7c7b\u3002</p> <p>\u6240\u6709\u7684\u6570\u636e\u8f6c\u6362\u3001\u6821\u9a8c\u3001\u6587\u6863\u751f\u6210\u7b49\u4ecd\u5c06\u6b63\u5e38\u8fd0\u884c\u3002</p> <p>\u8fd9\u6837\uff0c\u6211\u4eec\u53ef\u4ee5\u4ec5\u58f0\u660e\u6a21\u578b\u4e4b\u95f4\u7684\u5dee\u5f02\u90e8\u5206\uff08\u5177\u6709\u660e\u6587\u7684 <code>password</code>\u3001\u5177\u6709 <code>hashed_password</code> \u4ee5\u53ca\u4e0d\u5305\u62ec\u5bc6\u7801\uff09\u3002</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel, EmailStr\n\napp = FastAPI()\n\n\nclass UserBase(BaseModel):\nusername: str\n    email: EmailStr\n    full_name: Union[str, None] = None\n\n\nclass UserIn(UserBase):\npassword: str\nclass UserOut(UserBase):\npass\nclass UserInDB(UserBase):\nhashed_password: str\ndef fake_password_hasher(raw_password: str):\n    return \"supersecret\" + raw_password\n\n\ndef fake_save_user(user_in: UserIn):\n    hashed_password = fake_password_hasher(user_in.password)\n    user_in_db = UserInDB(**user_in.dict(), hashed_password=hashed_password)\n    print(\"User saved! ..not really\")\n    return user_in_db\n\n\n@app.post(\"/user/\", response_model=UserOut)\nasync def create_user(user_in: UserIn):\n    user_saved = fake_save_user(user_in)\n    return user_saved\n</code></pre>"},{"location":"tutorial/extra-models/#union-anyof","title":"<code>Union</code> \u6216\u8005 <code>anyOf</code>","text":"<p>\u4f60\u53ef\u4ee5\u5c06\u4e00\u4e2a\u54cd\u5e94\u58f0\u660e\u4e3a\u4e24\u79cd\u7c7b\u578b\u7684 <code>Union</code>\uff0c\u8fd9\u610f\u5473\u7740\u8be5\u54cd\u5e94\u5c06\u662f\u4e24\u79cd\u7c7b\u578b\u4e2d\u7684\u4efb\u4f55\u4e00\u79cd\u3002</p> <p>\u8fd9\u5c06\u5728 OpenAPI \u4e2d\u4f7f\u7528 <code>anyOf</code> \u8fdb\u884c\u5b9a\u4e49\u3002</p> <p>\u4e3a\u6b64\uff0c\u8bf7\u4f7f\u7528\u6807\u51c6\u7684 Python \u7c7b\u578b\u63d0\u793a <code>typing.Union</code>\uff1a</p> <p>Note</p> <p>\u5b9a\u4e49\u4e00\u4e2a <code>Union</code> \u7c7b\u578b\u65f6\uff0c\u9996\u5148\u5305\u62ec\u6700\u8be6\u7ec6\u7684\u7c7b\u578b\uff0c\u7136\u540e\u662f\u4e0d\u592a\u8be6\u7ec6\u7684\u7c7b\u578b\u3002\u5728\u4e0b\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u66f4\u8be6\u7ec6\u7684 <code>PlaneItem</code> \u4f4d\u4e8e <code>Union[PlaneItem\uff0cCarItem]</code> \u4e2d\u7684 <code>CarItem</code> \u4e4b\u524d\u3002</p> <pre><code>from typing import Union\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass BaseItem(BaseModel):\n    description: str\n    type: str\n\n\nclass CarItem(BaseItem):\ntype = \"car\"\nclass PlaneItem(BaseItem):\ntype = \"plane\"\nsize: int\nitems = {\n    \"item1\": {\"description\": \"All my friends drive a low rider\", \"type\": \"car\"},\n    \"item2\": {\n        \"description\": \"Music is my aeroplane, it's my aeroplane\",\n        \"type\": \"plane\",\n        \"size\": 5,\n    },\n}\n\n\n@app.get(\"/items/{item_id}\", response_model=Union[PlaneItem, CarItem])\nasync def read_item(item_id: str):\n    return items[item_id]\n</code></pre>"},{"location":"tutorial/extra-models/#_4","title":"\u6a21\u578b\u5217\u8868","text":"<p>\u4f60\u53ef\u4ee5\u7528\u540c\u6837\u7684\u65b9\u5f0f\u58f0\u660e\u7531\u5bf9\u8c61\u5217\u8868\u6784\u6210\u7684\u54cd\u5e94\u3002</p> <p>\u4e3a\u6b64\uff0c\u8bf7\u4f7f\u7528\u6807\u51c6\u7684 Python <code>typing.List</code>\uff1a</p> <pre><code>from typing import List\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: str\n\n\nitems = [\n    {\"name\": \"Foo\", \"description\": \"There comes my hero\"},\n    {\"name\": \"Red\", \"description\": \"It's my aeroplane\"},\n]\n\n\n@app.get(\"/items/\", response_model=List[Item])\nasync def read_items():\n    return items\n</code></pre>"},{"location":"tutorial/extra-models/#dict_2","title":"\u4efb\u610f <code>dict</code> \u6784\u6210\u7684\u54cd\u5e94","text":"<p>\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a\u4efb\u610f\u7684\u666e\u901a <code>dict</code> \u58f0\u660e\u54cd\u5e94\uff0c\u4ec5\u58f0\u660e\u952e\u548c\u503c\u7684\u7c7b\u578b\uff0c\u800c\u4e0d\u4f7f\u7528 Pydantic \u6a21\u578b\u3002</p> <p>\u5982\u679c\u4f60\u4e8b\u5148\u4e0d\u77e5\u9053\u6709\u6548\u7684\u5b57\u6bb5/\u5c5e\u6027\u540d\u79f0\uff08\u5bf9\u4e8e Pydantic \u6a21\u578b\u662f\u5fc5\u9700\u7684\uff09\uff0c\u8fd9\u5c06\u5f88\u6709\u7528\u3002</p> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 <code>typing.Dict</code>\uff1a</p> <pre><code>from typing import Dict\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/keyword-weights/\", response_model=Dict[str, float])\nasync def read_keyword_weights():\n    return {\"foo\": 2.3, \"bar\": 3.4}\n</code></pre>"},{"location":"tutorial/extra-models/#_5","title":"\u603b\u7ed3","text":"<p>\u4f7f\u7528\u591a\u4e2a Pydantic \u6a21\u578b\uff0c\u5e76\u9488\u5bf9\u4e0d\u540c\u573a\u666f\u81ea\u7531\u5730\u7ee7\u627f\u3002</p> <p>\u5982\u679c\u4e00\u4e2a\u5b9e\u4f53\u5fc5\u987b\u80fd\u591f\u5177\u6709\u4e0d\u540c\u7684\u300c\u72b6\u6001\u300d\uff0c\u4f60\u65e0\u9700\u4e3a\u6bcf\u4e2a\u72b6\u6001\u7684\u5b9e\u4f53\u5b9a\u4e49\u5355\u72ec\u7684\u6570\u636e\u6a21\u578b\u3002\u4ee5\u7528\u6237\u300c\u5b9e\u4f53\u300d\u4e3a\u4f8b\uff0c\u5176\u72b6\u6001\u6709\u5305\u542b <code>password</code>\u3001\u5305\u542b <code>password_hash</code> \u4ee5\u53ca\u4e0d\u542b\u5bc6\u7801\u3002</p>"},{"location":"tutorial/first-steps/","title":"\u7b2c\u4e00\u6b65","text":"<p>\u6700\u7b80\u5355\u7684 FastAPI \u6587\u4ef6\u53ef\u80fd\u50cf\u4e0b\u9762\u8fd9\u6837\uff1a</p> <pre><code>from fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/\")\nasync def root():\n    return {\"message\": \"Hello World\"}\n</code></pre> <p>\u5c06\u5176\u590d\u5236\u5230 <code>main.py</code> \u6587\u4ef6\u4e2d\u3002</p> <p>\u8fd0\u884c\u5b9e\u65f6\u670d\u52a1\u5668\uff1a</p> <pre><code>$ uvicorn main:app --reload\n\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Started reloader process [28720]\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Started server process [28722]\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Waiting for application startup.\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Application startup complete.\n</code></pre> <p>Note</p> <p><code>uvicorn main:app</code> \u547d\u4ee4\u542b\u4e49\u5982\u4e0b:</p> <ul> <li><code>main</code>\uff1a<code>main.py</code> \u6587\u4ef6\uff08\u4e00\u4e2a Python\u300c\u6a21\u5757\u300d\uff09\u3002</li> <li><code>app</code>\uff1a\u5728 <code>main.py</code> \u6587\u4ef6\u4e2d\u901a\u8fc7 <code>app = FastAPI()</code> \u521b\u5efa\u7684\u5bf9\u8c61\u3002</li> <li><code>--reload</code>\uff1a\u8ba9\u670d\u52a1\u5668\u5728\u66f4\u65b0\u4ee3\u7801\u540e\u91cd\u65b0\u542f\u52a8\u3002\u4ec5\u5728\u5f00\u53d1\u65f6\u4f7f\u7528\u8be5\u9009\u9879\u3002</li> </ul> <p>\u5728\u8f93\u51fa\u4e2d\uff0c\u4f1a\u6709\u4e00\u884c\u4fe1\u606f\u50cf\u4e0b\u9762\u8fd9\u6837\uff1a</p> <pre><code>INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n</code></pre> <p>\u8be5\u884c\u663e\u793a\u4e86\u4f60\u7684\u5e94\u7528\u5728\u672c\u673a\u6240\u63d0\u4f9b\u670d\u52a1\u7684 URL \u5730\u5740\u3002</p>"},{"location":"tutorial/first-steps/#_2","title":"\u67e5\u770b","text":"<p>\u6253\u5f00\u6d4f\u89c8\u5668\u8bbf\u95ee http://127.0.0.1:8000\u3002</p> <p>\u4f60\u5c06\u770b\u5230\u5982\u4e0b\u7684 JSON \u54cd\u5e94\uff1a</p> <pre><code>{\"message\": \"Hello World\"}\n</code></pre>"},{"location":"tutorial/first-steps/#api","title":"\u4ea4\u4e92\u5f0f API \u6587\u6863","text":"<p>\u8df3\u8f6c\u5230 http://127.0.0.1:8000/docs\u3002</p> <p>\u4f60\u5c06\u4f1a\u770b\u5230\u81ea\u52a8\u751f\u6210\u7684\u4ea4\u4e92\u5f0f API \u6587\u6863\uff08\u7531 Swagger UI \u63d0\u4f9b\uff09\uff1a</p> <p></p>"},{"location":"tutorial/first-steps/#api_1","title":"\u53ef\u9009\u7684 API \u6587\u6863","text":"<p>\u524d\u5f80 http://127.0.0.1:8000/redoc\u3002</p> <p>\u4f60\u5c06\u4f1a\u770b\u5230\u53ef\u9009\u7684\u81ea\u52a8\u751f\u6210\u6587\u6863 \uff08\u7531 ReDoc \u63d0\u4f9b)\uff1a</p> <p></p>"},{"location":"tutorial/first-steps/#openapi","title":"OpenAPI","text":"<p>FastAPI \u4f7f\u7528\u5b9a\u4e49 API \u7684 OpenAPI \u6807\u51c6\u5c06\u4f60\u7684\u6240\u6709 API \u8f6c\u6362\u6210\u300c\u6a21\u5f0f\u300d\u3002</p>"},{"location":"tutorial/first-steps/#_3","title":"\u300c\u6a21\u5f0f\u300d","text":"<p>\u300c\u6a21\u5f0f\u300d\u662f\u5bf9\u4e8b\u7269\u7684\u4e00\u79cd\u5b9a\u4e49\u6216\u63cf\u8ff0\u3002\u5b83\u5e76\u975e\u5177\u4f53\u7684\u5b9e\u73b0\u4ee3\u7801\uff0c\u800c\u53ea\u662f\u62bd\u8c61\u7684\u63cf\u8ff0\u3002</p>"},{"location":"tutorial/first-steps/#api_2","title":"API\u300c\u6a21\u5f0f\u300d","text":"<p>\u5728\u8fd9\u79cd\u573a\u666f\u4e0b\uff0cOpenAPI \u662f\u4e00\u79cd\u89c4\u5b9a\u5982\u4f55\u5b9a\u4e49 API \u6a21\u5f0f\u7684\u89c4\u8303\u3002</p> <p>\u5b9a\u4e49\u7684 OpenAPI \u6a21\u5f0f\u5c06\u5305\u62ec\u4f60\u7684 API \u8def\u5f84\uff0c\u4ee5\u53ca\u5b83\u4eec\u53ef\u80fd\u4f7f\u7528\u7684\u53c2\u6570\u7b49\u7b49\u3002</p>"},{"location":"tutorial/first-steps/#_4","title":"\u6570\u636e\u300c\u6a21\u5f0f\u300d","text":"<p>\u300c\u6a21\u5f0f\u300d\u8fd9\u4e2a\u672f\u8bed\u4e5f\u53ef\u80fd\u6307\u7684\u662f\u67d0\u4e9b\u6570\u636e\u6bd4\u5982 JSON \u7684\u7ed3\u6784\u3002</p> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5b83\u53ef\u4ee5\u8868\u793a JSON \u7684\u5c5e\u6027\u53ca\u5176\u5177\u6709\u7684\u6570\u636e\u7c7b\u578b\uff0c\u7b49\u7b49\u3002</p>"},{"location":"tutorial/first-steps/#openapi-json-schema","title":"OpenAPI \u548c JSON Schema","text":"<p>OpenAPI \u4e3a\u4f60\u7684 API \u5b9a\u4e49 API \u6a21\u5f0f\u3002\u8be5\u6a21\u5f0f\u4e2d\u5305\u542b\u4e86\u4f60\u7684 API \u53d1\u9001\u548c\u63a5\u6536\u7684\u6570\u636e\u7684\u5b9a\u4e49\uff08\u6216\u79f0\u4e3a\u300c\u6a21\u5f0f\u300d\uff09\uff0c\u8fd9\u4e9b\u5b9a\u4e49\u901a\u8fc7 JSON \u6570\u636e\u6a21\u5f0f\u6807\u51c6 JSON Schema \u6240\u751f\u6210\u3002</p>"},{"location":"tutorial/first-steps/#openapijson","title":"\u67e5\u770b <code>openapi.json</code>","text":"<p>\u5982\u679c\u4f60\u5bf9\u539f\u59cb\u7684 OpenAPI \u6a21\u5f0f\u957f\u4ec0\u4e48\u6837\u5b50\u611f\u5230\u597d\u5947\uff0c\u5176\u5b9e\u5b83\u53ea\u662f\u4e00\u4e2a\u81ea\u52a8\u751f\u6210\u7684\u5305\u542b\u4e86\u6240\u6709 API \u63cf\u8ff0\u7684 JSON\u3002</p> <p>\u4f60\u53ef\u4ee5\u76f4\u63a5\u5728\uff1ahttp://127.0.0.1:8000/openapi.json \u770b\u5230\u5b83\u3002</p> <p>\u5b83\u5c06\u663e\u793a\u4ee5\u5982\u4e0b\u5185\u5bb9\u5f00\u5934\u7684 JSON\uff1a</p> <pre><code>{\n\"openapi\": \"3.0.2\",\n\"info\": {\n\"title\": \"FastAPI\",\n\"version\": \"0.1.0\"\n},\n\"paths\": {\n\"/items/\": {\n\"get\": {\n\"responses\": {\n\"200\": {\n\"description\": \"Successful Response\",\n\"content\": {\n\"application/json\": {\n\n\n\n...\n</code></pre>"},{"location":"tutorial/first-steps/#openapi_1","title":"OpenAPI \u7684\u7528\u9014","text":"<p>\u9a71\u52a8 FastAPI \u5185\u7f6e\u7684 2 \u4e2a\u4ea4\u4e92\u5f0f\u6587\u6863\u7cfb\u7edf\u7684\u6b63\u662f OpenAPI \u6a21\u5f0f\u3002</p> <p>\u5e76\u4e14\u8fd8\u6709\u6570\u5341\u79cd\u66ff\u4ee3\u65b9\u6848\uff0c\u5b83\u4eec\u5168\u90e8\u90fd\u57fa\u4e8e OpenAPI\u3002\u4f60\u53ef\u4ee5\u8f7b\u677e\u5730\u5c06\u8fd9\u4e9b\u66ff\u4ee3\u65b9\u6848\u4e2d\u7684\u4efb\u4f55\u4e00\u79cd\u6dfb\u52a0\u5230\u4f7f\u7528 FastAPI \u6784\u5efa\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\u3002</p> <p>\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528\u5b83\u81ea\u52a8\u751f\u6210\u4e0e\u4f60\u7684 API \u8fdb\u884c\u901a\u4fe1\u7684\u5ba2\u6237\u7aef\u4ee3\u7801\u3002\u4f8b\u5982 web \u524d\u7aef\uff0c\u79fb\u52a8\u7aef\u6216\u7269\u8054\u7f51\u5d4c\u5165\u7a0b\u5e8f\u3002</p>"},{"location":"tutorial/first-steps/#_5","title":"\u5206\u6b65\u6982\u62ec","text":""},{"location":"tutorial/first-steps/#1-fastapi","title":"\u6b65\u9aa4 1\uff1a\u5bfc\u5165 <code>FastAPI</code>","text":"<pre><code>from fastapi import FastAPI\napp = FastAPI()\n\n\n@app.get(\"/\")\nasync def root():\n    return {\"message\": \"Hello World\"}\n</code></pre> <p><code>FastAPI</code> \u662f\u4e00\u4e2a\u4e3a\u4f60\u7684 API \u63d0\u4f9b\u4e86\u6240\u6709\u529f\u80fd\u7684 Python \u7c7b\u3002</p> <p>\u6280\u672f\u7ec6\u8282</p> <p><code>FastAPI</code> \u662f\u76f4\u63a5\u4ece <code>Starlette</code> \u7ee7\u627f\u7684\u7c7b\u3002</p> <p>\u4f60\u53ef\u4ee5\u901a\u8fc7 <code>FastAPI</code> \u4f7f\u7528\u6240\u6709\u7684 Starlette \u7684\u529f\u80fd\u3002</p>"},{"location":"tutorial/first-steps/#2-fastapi","title":"\u6b65\u9aa4 2\uff1a\u521b\u5efa\u4e00\u4e2a <code>FastAPI</code>\u300c\u5b9e\u4f8b\u300d","text":"<pre><code>from fastapi import FastAPI\n\napp = FastAPI()\n@app.get(\"/\")\nasync def root():\n    return {\"message\": \"Hello World\"}\n</code></pre> <p>\u8fd9\u91cc\u7684\u53d8\u91cf <code>app</code> \u4f1a\u662f <code>FastAPI</code> \u7c7b\u7684\u4e00\u4e2a\u300c\u5b9e\u4f8b\u300d\u3002</p> <p>\u8fd9\u4e2a\u5b9e\u4f8b\u5c06\u662f\u521b\u5efa\u4f60\u6240\u6709 API \u7684\u4e3b\u8981\u4ea4\u4e92\u5bf9\u8c61\u3002</p> <p>\u8fd9\u4e2a <code>app</code> \u540c\u6837\u5728\u5982\u4e0b\u547d\u4ee4\u4e2d\u88ab <code>uvicorn</code> \u6240\u5f15\u7528\uff1a</p> <pre><code>$ uvicorn main:app --reload\n\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n</code></pre> <p>\u5982\u679c\u4f60\u50cf\u4e0b\u9762\u8fd9\u6837\u521b\u5efa\u5e94\u7528\uff1a</p> <pre><code>from fastapi import FastAPI\n\nmy_awesome_api = FastAPI()\n@my_awesome_api.get(\"/\")\nasync def root():\n    return {\"message\": \"Hello World\"}\n</code></pre> <p>\u5c06\u4ee3\u7801\u653e\u5165 <code>main.py</code> \u6587\u4ef6\u4e2d\uff0c\u7136\u540e\u4f60\u53ef\u4ee5\u50cf\u4e0b\u9762\u8fd9\u6837\u8fd0\u884c <code>uvicorn</code>\uff1a</p> <pre><code>$ uvicorn main:my_awesome_api --reload\n\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n</code></pre>"},{"location":"tutorial/first-steps/#3","title":"\u6b65\u9aa4 3\uff1a\u521b\u5efa\u4e00\u4e2a\u8def\u5f84\u64cd\u4f5c","text":""},{"location":"tutorial/first-steps/#_6","title":"\u8def\u5f84","text":"<p>\u8fd9\u91cc\u7684\u300c\u8def\u5f84\u300d\u6307\u7684\u662f URL \u4e2d\u4ece\u7b2c\u4e00\u4e2a <code>/</code> \u8d77\u7684\u540e\u534a\u90e8\u5206\u3002</p> <p>\u6240\u4ee5\uff0c\u5728\u4e00\u4e2a\u8fd9\u6837\u7684 URL \u4e2d\uff1a</p> <pre><code>https://example.com/items/foo\n</code></pre> <p>...\u8def\u5f84\u4f1a\u662f\uff1a</p> <pre><code>/items/foo\n</code></pre> <p>Info</p> <p>\u300c\u8def\u5f84\u300d\u4e5f\u901a\u5e38\u88ab\u79f0\u4e3a\u300c\u7aef\u70b9\u300d\u6216\u300c\u8def\u7531\u300d\u3002</p> <p>\u5f00\u53d1 API \u65f6\uff0c\u300c\u8def\u5f84\u300d\u662f\u7528\u6765\u5206\u79bb\u300c\u5173\u6ce8\u70b9\u300d\u548c\u300c\u8d44\u6e90\u300d\u7684\u4e3b\u8981\u624b\u6bb5\u3002</p>"},{"location":"tutorial/first-steps/#_7","title":"\u64cd\u4f5c","text":"<p>\u8fd9\u91cc\u7684\u300c\u64cd\u4f5c\u300d\u6307\u7684\u662f\u4e00\u79cd HTTP\u300c\u65b9\u6cd5\u300d\u3002</p> <p>\u4e0b\u5217\u4e4b\u4e00\uff1a</p> <ul> <li><code>POST</code></li> <li><code>GET</code></li> <li><code>PUT</code></li> <li><code>DELETE</code></li> </ul> <p>...\u4ee5\u53ca\u66f4\u5c11\u89c1\u7684\u51e0\u79cd\uff1a</p> <ul> <li><code>OPTIONS</code></li> <li><code>HEAD</code></li> <li><code>PATCH</code></li> <li><code>TRACE</code></li> </ul> <p>\u5728 HTTP \u534f\u8bae\u4e2d\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4ee5\u4e0a\u7684\u5176\u4e2d\u4e00\u79cd\uff08\u6216\u591a\u79cd\uff09\u300c\u65b9\u6cd5\u300d\u4e0e\u6bcf\u4e2a\u8def\u5f84\u8fdb\u884c\u901a\u4fe1\u3002</p> <p>\u5728\u5f00\u53d1 API \u65f6\uff0c\u4f60\u901a\u5e38\u4f7f\u7528\u7279\u5b9a\u7684 HTTP \u65b9\u6cd5\u53bb\u6267\u884c\u7279\u5b9a\u7684\u884c\u4e3a\u3002</p> <p>\u901a\u5e38\u4f7f\u7528\uff1a</p> <ul> <li><code>POST</code>\uff1a\u521b\u5efa\u6570\u636e\u3002</li> <li><code>GET</code>\uff1a\u8bfb\u53d6\u6570\u636e\u3002</li> <li><code>PUT</code>\uff1a\u66f4\u65b0\u6570\u636e\u3002</li> <li><code>DELETE</code>\uff1a\u5220\u9664\u6570\u636e\u3002</li> </ul> <p>\u56e0\u6b64\uff0c\u5728 OpenAPI \u4e2d\uff0c\u6bcf\u4e00\u4e2a HTTP \u65b9\u6cd5\u90fd\u88ab\u79f0\u4e3a\u300c\u64cd\u4f5c\u300d\u3002</p> <p>\u6211\u4eec\u4e5f\u6253\u7b97\u79f0\u547c\u5b83\u4eec\u4e3a\u300c\u64cd\u4f5c\u300d\u3002</p>"},{"location":"tutorial/first-steps/#_8","title":"\u5b9a\u4e49\u4e00\u4e2a\u8def\u5f84\u64cd\u4f5c\u88c5\u9970\u5668","text":"<pre><code>from fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/\")\nasync def root():\n    return {\"message\": \"Hello World\"}\n</code></pre> <p><code>@app.get(\"/\")</code> \u544a\u8bc9 FastAPI \u5728\u5b83\u4e0b\u65b9\u7684\u51fd\u6570\u8d1f\u8d23\u5904\u7406\u5982\u4e0b\u8bbf\u95ee\u8bf7\u6c42\uff1a</p> <ul> <li>\u8bf7\u6c42\u8def\u5f84\u4e3a <code>/</code></li> <li>\u4f7f\u7528 <code>get</code> \u64cd\u4f5c</li> </ul> <p><code>@decorator</code> Info</p> <p><code>@something</code> \u8bed\u6cd5\u5728 Python \u4e2d\u88ab\u79f0\u4e3a\u300c\u88c5\u9970\u5668\u300d\u3002</p> <p>\u50cf\u4e00\u9876\u6f02\u4eae\u7684\u88c5\u9970\u5e3d\u4e00\u6837\uff0c\u5c06\u5b83\u653e\u5728\u4e00\u4e2a\u51fd\u6570\u7684\u4e0a\u65b9\uff08\u6211\u731c\u6d4b\u8fd9\u4e2a\u672f\u8bed\u7684\u547d\u540d\u5c31\u662f\u8fd9\u4e48\u6765\u7684\uff09\u3002</p> <p>\u88c5\u9970\u5668\u63a5\u6536\u4f4d\u4e8e\u5176\u4e0b\u65b9\u7684\u51fd\u6570\u5e76\u4e14\u7528\u5b83\u5b8c\u6210\u4e00\u4e9b\u5de5\u4f5c\u3002</p> <p>\u5728\u6211\u4eec\u7684\u4f8b\u5b50\u4e2d\uff0c\u8fd9\u4e2a\u88c5\u9970\u5668\u544a\u8bc9 FastAPI \u4f4d\u4e8e\u5176\u4e0b\u65b9\u7684\u51fd\u6570\u5bf9\u5e94\u7740\u8def\u5f84 <code>/</code> \u52a0\u4e0a <code>get</code> \u64cd\u4f5c\u3002</p> <p>\u5b83\u662f\u4e00\u4e2a\u300c\u8def\u5f84\u64cd\u4f5c\u88c5\u9970\u5668\u300d\u3002</p> <p>\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5176\u4ed6\u7684\u64cd\u4f5c\uff1a</p> <ul> <li><code>@app.post()</code></li> <li><code>@app.put()</code></li> <li><code>@app.delete()</code></li> </ul> <p>\u4ee5\u53ca\u66f4\u5c11\u89c1\u7684\uff1a</p> <ul> <li><code>@app.options()</code></li> <li><code>@app.head()</code></li> <li><code>@app.patch()</code></li> <li><code>@app.trace()</code></li> </ul> <p>Tip</p> <p>\u60a8\u53ef\u4ee5\u968f\u610f\u4f7f\u7528\u4efb\u4f55\u4e00\u4e2a\u64cd\u4f5c\uff08HTTP\u65b9\u6cd5\uff09\u3002</p> <p>FastAPI \u6ca1\u6709\u5f3a\u5236\u8981\u6c42\u64cd\u4f5c\u6709\u4efb\u4f55\u7279\u5b9a\u7684\u542b\u4e49\u3002</p> <p>\u6b64\u5904\u63d0\u4f9b\u7684\u4fe1\u606f\u4ec5\u4f5c\u4e3a\u6307\u5bfc\uff0c\u800c\u4e0d\u662f\u8981\u6c42\u3002</p> <p>\u6bd4\u5982\uff0c\u5f53\u4f7f\u7528 GraphQL \u65f6\u901a\u5e38\u4f60\u6240\u6709\u7684\u52a8\u4f5c\u90fd\u901a\u8fc7 <code>post</code> \u4e00\u79cd\u65b9\u6cd5\u6267\u884c\u3002</p>"},{"location":"tutorial/first-steps/#4","title":"\u6b65\u9aa4 4\uff1a\u5b9a\u4e49\u8def\u5f84\u64cd\u4f5c\u51fd\u6570","text":"<p>\u8fd9\u662f\u6211\u4eec\u7684\u300c\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u300d\uff1a</p> <ul> <li>\u8def\u5f84\uff1a\u662f <code>/</code>\u3002</li> <li>\u64cd\u4f5c\uff1a\u662f <code>get</code>\u3002</li> <li>\u51fd\u6570\uff1a\u662f\u4f4d\u4e8e\u300c\u88c5\u9970\u5668\u300d\u4e0b\u65b9\u7684\u51fd\u6570\uff08\u4f4d\u4e8e <code>@app.get(\"/\")</code> \u4e0b\u65b9\uff09\u3002</li> </ul> <pre><code>from fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/\")\nasync def root():\nreturn {\"message\": \"Hello World\"}\n</code></pre> <p>\u8fd9\u662f\u4e00\u4e2a Python \u51fd\u6570\u3002</p> <p>\u6bcf\u5f53 FastAPI \u63a5\u6536\u4e00\u4e2a\u4f7f\u7528 <code>GET</code> \u65b9\u6cd5\u8bbf\u95ee URL\u300c<code>/</code>\u300d\u7684\u8bf7\u6c42\u65f6\u8fd9\u4e2a\u51fd\u6570\u4f1a\u88ab\u8c03\u7528\u3002</p> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u5b83\u662f\u4e00\u4e2a <code>async</code> \u51fd\u6570\u3002</p> <p>\u4f60\u4e5f\u53ef\u4ee5\u5c06\u5176\u5b9a\u4e49\u4e3a\u5e38\u89c4\u51fd\u6570\u800c\u4e0d\u4f7f\u7528 <code>async def</code>:</p> <pre><code>from fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/\")\ndef root():\nreturn {\"message\": \"Hello World\"}\n</code></pre> <p>Note</p> <p>\u5982\u679c\u4f60\u4e0d\u77e5\u9053\u4e24\u8005\u7684\u533a\u522b\uff0c\u8bf7\u67e5\u9605 Async: \"In a hurry?\"\u3002</p>"},{"location":"tutorial/first-steps/#5","title":"\u6b65\u9aa4 5\uff1a\u8fd4\u56de\u5185\u5bb9","text":"<pre><code>from fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/\")\nasync def root():\nreturn {\"message\": \"Hello World\"}\n</code></pre> <p>\u4f60\u53ef\u4ee5\u8fd4\u56de\u4e00\u4e2a <code>dict</code>\u3001<code>list</code>\uff0c\u50cf <code>str</code>\u3001<code>int</code> \u4e00\u6837\u7684\u5355\u4e2a\u503c\uff0c\u7b49\u7b49\u3002</p> <p>\u4f60\u8fd8\u53ef\u4ee5\u8fd4\u56de Pydantic \u6a21\u578b\uff08\u7a0d\u540e\u4f60\u5c06\u4e86\u89e3\u66f4\u591a\uff09\u3002</p> <p>\u8fd8\u6709\u8bb8\u591a\u5176\u4ed6\u5c06\u4f1a\u81ea\u52a8\u8f6c\u6362\u4e3a JSON \u7684\u5bf9\u8c61\u548c\u6a21\u578b\uff08\u5305\u62ec ORM \u5bf9\u8c61\u7b49\uff09\u3002\u5c1d\u8bd5\u4e0b\u4f7f\u7528\u4f60\u6700\u559c\u6b22\u7684\u4e00\u79cd\uff0c\u5b83\u5f88\u6709\u53ef\u80fd\u5df2\u7ecf\u88ab\u652f\u6301\u3002</p>"},{"location":"tutorial/first-steps/#_9","title":"\u603b\u7ed3","text":"<ul> <li>\u5bfc\u5165 <code>FastAPI</code>\u3002</li> <li>\u521b\u5efa\u4e00\u4e2a <code>app</code> \u5b9e\u4f8b\u3002</li> <li>\u7f16\u5199\u4e00\u4e2a\u8def\u5f84\u64cd\u4f5c\u88c5\u9970\u5668\uff08\u5982 <code>@app.get(\"/\")</code>\uff09\u3002</li> <li>\u7f16\u5199\u4e00\u4e2a\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\uff08\u5982\u4e0a\u9762\u7684 <code>def root(): ...</code>\uff09\u3002</li> <li>\u8fd0\u884c\u5f00\u53d1\u670d\u52a1\u5668\uff08\u5982 <code>uvicorn main:app --reload</code>\uff09\u3002</li> </ul>"},{"location":"tutorial/handling-errors/","title":"\u5904\u7406\u9519\u8bef","text":"<p>\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u9700\u8981\u5411\u5ba2\u6237\u7aef\u8fd4\u56de\u9519\u8bef\u63d0\u793a\u3002</p> <p>\u8fd9\u91cc\u6240\u8c13\u7684\u5ba2\u6237\u7aef\u5305\u62ec\u524d\u7aef\u6d4f\u89c8\u5668\u3001\u5176\u4ed6\u5e94\u7528\u7a0b\u5e8f\u3001\u7269\u8054\u7f51\u8bbe\u5907\u7b49\u3002</p> <p>\u9700\u8981\u5411\u5ba2\u6237\u7aef\u8fd4\u56de\u9519\u8bef\u63d0\u793a\u7684\u573a\u666f\u4e3b\u8981\u5982\u4e0b\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u6ca1\u6709\u6267\u884c\u64cd\u4f5c\u7684\u6743\u9650</li> <li>\u5ba2\u6237\u7aef\u6ca1\u6709\u8bbf\u95ee\u8d44\u6e90\u7684\u6743\u9650</li> <li>\u5ba2\u6237\u7aef\u8981\u8bbf\u95ee\u7684\u9879\u76ee\u4e0d\u5b58\u5728</li> <li>\u7b49\u7b49 ...</li> </ul> <p>\u9047\u5230\u8fd9\u4e9b\u60c5\u51b5\u65f6\uff0c\u901a\u5e38\u8981\u8fd4\u56de 4XX\uff08400 \u81f3 499\uff09HTTP \u72b6\u6001\u7801\u3002</p> <p>4XX \u72b6\u6001\u7801\u4e0e\u8868\u793a\u8bf7\u6c42\u6210\u529f\u7684 2XX\uff08200 \u81f3 299\uff09 HTTP \u72b6\u6001\u7801\u7c7b\u4f3c\u3002</p> <p>\u53ea\u4e0d\u8fc7\uff0c4XX \u72b6\u6001\u7801\u8868\u793a\u5ba2\u6237\u7aef\u53d1\u751f\u7684\u9519\u8bef\u3002</p> <p>\u5927\u5bb6\u90fd\u77e5\u9053\u300c404 Not Found\u300d\u9519\u8bef\uff0c\u8fd8\u6709\u8c03\u4f83\u8fd9\u4e2a\u9519\u8bef\u7684\u7b11\u8bdd\u5427\uff1f</p>"},{"location":"tutorial/handling-errors/#httpexception","title":"\u4f7f\u7528 <code>HTTPException</code>","text":"<p>\u5411\u5ba2\u6237\u7aef\u8fd4\u56de HTTP \u9519\u8bef\u54cd\u5e94\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>HTTPException</code>\u3002</p>"},{"location":"tutorial/handling-errors/#httpexception_1","title":"\u5bfc\u5165 <code>HTTPException</code>","text":"<pre><code>from fastapi import FastAPI, HTTPException\napp = FastAPI()\n\nitems = {\"foo\": \"The Foo Wrestlers\"}\n\n\n@app.get(\"/items/{item_id}\")\nasync def read_item(item_id: str):\n    if item_id not in items:\n        raise HTTPException(status_code=404, detail=\"Item not found\")\n    return {\"item\": items[item_id]}\n</code></pre>"},{"location":"tutorial/handling-errors/#httpexception_2","title":"\u89e6\u53d1 <code>HTTPException</code>","text":"<p><code>HTTPException</code> \u662f\u989d\u5916\u5305\u542b\u4e86\u548c API \u6709\u5173\u6570\u636e\u7684\u5e38\u89c4 Python \u5f02\u5e38\u3002</p> <p>\u56e0\u4e3a\u662f Python \u5f02\u5e38\uff0c\u6240\u4ee5\u4e0d\u80fd <code>return</code>\uff0c\u53ea\u80fd <code>raise</code>\u3002</p> <p>\u5982\u5728\u8c03\u7528\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u91cc\u7684\u5de5\u5177\u51fd\u6570\u65f6\uff0c\u89e6\u53d1\u4e86 <code>HTTPException</code>\uff0cFastAPI \u5c31\u4e0d\u518d\u7ee7\u7eed\u6267\u884c\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u4e2d\u7684\u540e\u7eed\u4ee3\u7801\uff0c\u800c\u662f\u7acb\u5373\u7ec8\u6b62\u8bf7\u6c42\uff0c\u5e76\u628a <code>HTTPException</code> \u7684 HTTP \u9519\u8bef\u53d1\u9001\u81f3\u5ba2\u6237\u7aef\u3002</p> <p>\u5728\u4ecb\u7ecd\u4f9d\u8d56\u9879\u4e0e\u5b89\u5168\u7684\u7ae0\u8282\u4e2d\uff0c\u60a8\u53ef\u4ee5\u4e86\u89e3\u66f4\u591a\u7528 <code>raise</code> \u5f02\u5e38\u4ee3\u66ff <code>return</code> \u503c\u7684\u4f18\u52bf\u3002</p> <p>\u672c\u4f8b\u4e2d\uff0c\u5ba2\u6237\u7aef\u7528 <code>ID</code> \u8bf7\u6c42\u7684 <code>item</code> \u4e0d\u5b58\u5728\u65f6\uff0c\u89e6\u53d1\u72b6\u6001\u7801\u4e3a <code>404</code> \u7684\u5f02\u5e38\uff1a</p> <pre><code>from fastapi import FastAPI, HTTPException\n\napp = FastAPI()\n\nitems = {\"foo\": \"The Foo Wrestlers\"}\n\n\n@app.get(\"/items/{item_id}\")\nasync def read_item(item_id: str):\n    if item_id not in items:\nraise HTTPException(status_code=404, detail=\"Item not found\")\nreturn {\"item\": items[item_id]}\n</code></pre>"},{"location":"tutorial/handling-errors/#_2","title":"\u54cd\u5e94\u7ed3\u679c","text":"<p>\u8bf7\u6c42\u4e3a <code>http://example.com/items/foo</code>\uff08<code>item_id</code> \u4e3a <code>\u300cfoo\u300d</code>\uff09\u65f6\uff0c\u5ba2\u6237\u7aef\u4f1a\u63a5\u6536\u5230 HTTP \u72b6\u6001\u7801 - 200 \u53ca\u5982\u4e0b JSON \u54cd\u5e94\u7ed3\u679c\uff1a</p> <pre><code>{\n\"item\": \"The Foo Wrestlers\"\n}\n</code></pre> <p>\u4f46\u5982\u679c\u5ba2\u6237\u7aef\u8bf7\u6c42 <code>http://example.com/items/bar</code>\uff08<code>item_id</code> <code>\u300cbar\u300d</code> \u4e0d\u5b58\u5728\u65f6\uff09\uff0c\u5219\u4f1a\u63a5\u6536\u5230 HTTP \u72b6\u6001\u7801 - 404\uff08\u300c\u672a\u627e\u5230\u300d\u9519\u8bef\uff09\u53ca\u5982\u4e0b JSON \u54cd\u5e94\u7ed3\u679c\uff1a</p> <pre><code>{\n\"detail\": \"Item not found\"\n}\n</code></pre> <p>\u63d0\u793a</p> <p>\u89e6\u53d1 <code>HTTPException</code> \u65f6\uff0c\u53ef\u4ee5\u7528\u53c2\u6570 <code>detail</code> \u4f20\u9012\u4efb\u4f55\u80fd\u8f6c\u6362\u4e3a JSON \u7684\u503c\uff0c\u4e0d\u4ec5\u9650\u4e8e <code>str</code>\u3002</p> <p>\u8fd8\u652f\u6301\u4f20\u9012 <code>dict</code>\u3001<code>list</code> \u7b49\u6570\u636e\u7ed3\u6784\u3002</p> <p>FastAPI \u80fd\u81ea\u52a8\u5904\u7406\u8fd9\u4e9b\u6570\u636e\uff0c\u5e76\u5c06\u4e4b\u8f6c\u6362\u4e3a JSON\u3002</p>"},{"location":"tutorial/handling-errors/#_3","title":"\u6dfb\u52a0\u81ea\u5b9a\u4e49\u54cd\u5e94\u5934","text":"<p>\u6709\u4e9b\u573a\u666f\u4e0b\u8981\u4e3a HTTP \u9519\u8bef\u6dfb\u52a0\u81ea\u5b9a\u4e49\u54cd\u5e94\u5934\u3002\u4f8b\u5982\uff0c\u51fa\u4e8e\u67d0\u4e9b\u65b9\u9762\u7684\u5b89\u5168\u9700\u8981\u3002</p> <p>\u4e00\u822c\u60c5\u51b5\u4e0b\u53ef\u80fd\u4e0d\u4f1a\u9700\u8981\u5728\u4ee3\u7801\u4e2d\u76f4\u63a5\u4f7f\u7528\u54cd\u5e94\u5934\u3002</p> <p>\u4f46\u5bf9\u4e8e\u67d0\u4e9b\u9ad8\u7ea7\u5e94\u7528\u573a\u666f\uff0c\u8fd8\u662f\u9700\u8981\u6dfb\u52a0\u81ea\u5b9a\u4e49\u54cd\u5e94\u5934\uff1a</p> <pre><code>from fastapi import FastAPI, HTTPException\n\napp = FastAPI()\n\nitems = {\"foo\": \"The Foo Wrestlers\"}\n\n\n@app.get(\"/items-header/{item_id}\")\nasync def read_item_header(item_id: str):\n    if item_id not in items:\n        raise HTTPException(\n            status_code=404,\n            detail=\"Item not found\",\nheaders={\"X-Error\": \"There goes my error\"},\n)\n    return {\"item\": items[item_id]}\n</code></pre>"},{"location":"tutorial/handling-errors/#_4","title":"\u5b89\u88c5\u81ea\u5b9a\u4e49\u5f02\u5e38\u5904\u7406\u5668","text":"<p>\u6dfb\u52a0\u81ea\u5b9a\u4e49\u5904\u7406\u5668\uff0c\u8981\u4f7f\u7528 Starlette \u7684\u5f02\u5e38\u5de5\u5177\u3002</p> <p>\u5047\u8bbe\u8981\u89e6\u53d1\u7684\u81ea\u5b9a\u4e49\u5f02\u5e38\u53eb\u4f5c <code>UnicornException</code>\u3002</p> <p>\u4e14\u9700\u8981 FastAPI \u5b9e\u73b0\u5168\u5c40\u5904\u7406\u8be5\u5f02\u5e38\u3002</p> <p>\u6b64\u65f6\uff0c\u53ef\u4ee5\u7528 <code>@app.exception_handler()</code> \u6dfb\u52a0\u81ea\u5b9a\u4e49\u5f02\u5e38\u63a7\u5236\u5668\uff1a</p> <pre><code>from fastapi import FastAPI, Request\nfrom fastapi.responses import JSONResponse\n\n\nclass UnicornException(Exception):\ndef __init__(self, name: str):\nself.name = name\napp = FastAPI()\n\n\n@app.exception_handler(UnicornException)\nasync def unicorn_exception_handler(request: Request, exc: UnicornException):\nreturn JSONResponse(\nstatus_code=418,\ncontent={\"message\": f\"Oops! {exc.name} did something. There goes a rainbow...\"},\n)\n@app.get(\"/unicorns/{name}\")\nasync def read_unicorn(name: str):\n    if name == \"yolo\":\nraise UnicornException(name=name)\nreturn {\"unicorn_name\": name}\n</code></pre> <p>\u8bf7\u6c42 <code>/unicorns/yolo</code> \u65f6\uff0c\u8def\u5f84\u64cd\u4f5c\u4f1a\u89e6\u53d1 <code>UnicornException</code>\u3002</p> <p>\u4f46\u8be5\u5f02\u5e38\u5c06\u4f1a\u88ab <code>unicorn_exception_handler</code> \u5904\u7406\u3002</p> <p>\u63a5\u6536\u5230\u7684\u9519\u8bef\u4fe1\u606f\u6e05\u6670\u660e\u4e86\uff0cHTTP \u72b6\u6001\u7801\u4e3a <code>418</code>\uff0cJSON \u5185\u5bb9\u5982\u4e0b\uff1a</p> <pre><code>{\"message\": \"Oops! yolo did something. There goes a rainbow...\"}\n</code></pre> <p>\u6280\u672f\u7ec6\u8282</p> <p><code>from starlette.requests import Request</code> \u548c <code>from starlette.responses import JSONResponse</code> \u4e5f\u53ef\u4ee5\u7528\u4e8e\u5bfc\u5165 <code>Request</code> \u548c <code>JSONResponse</code>\u3002</p> <p>FastAPI \u63d0\u4f9b\u4e86\u4e0e <code>starlette.responses</code> \u76f8\u540c\u7684 <code>fastapi.responses</code> \u4f5c\u4e3a\u5feb\u6377\u65b9\u5f0f\uff0c\u4f46\u5927\u90e8\u5206\u54cd\u5e94\u64cd\u4f5c\u90fd\u53ef\u4ee5\u76f4\u63a5\u4ece Starlette \u5bfc\u5165\u3002\u540c\u7406\uff0c<code>Request</code> \u4e5f\u662f\u5982\u6b64\u3002</p>"},{"location":"tutorial/handling-errors/#_5","title":"\u8986\u76d6\u9ed8\u8ba4\u5f02\u5e38\u5904\u7406\u5668","text":"<p>FastAPI \u81ea\u5e26\u4e86\u4e00\u4e9b\u9ed8\u8ba4\u5f02\u5e38\u5904\u7406\u5668\u3002</p> <p>\u89e6\u53d1 <code>HTTPException</code> \u6216\u8bf7\u6c42\u65e0\u6548\u6570\u636e\u65f6\uff0c\u8fd9\u4e9b\u5904\u7406\u5668\u8fd4\u56de\u9ed8\u8ba4\u7684 JSON \u54cd\u5e94\u7ed3\u679c\u3002</p> <p>\u4e0d\u8fc7\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u81ea\u5b9a\u4e49\u5904\u7406\u5668\u8986\u76d6\u9ed8\u8ba4\u5f02\u5e38\u5904\u7406\u5668\u3002</p>"},{"location":"tutorial/handling-errors/#_6","title":"\u8986\u76d6\u8bf7\u6c42\u9a8c\u8bc1\u5f02\u5e38","text":"<p>\u8bf7\u6c42\u4e2d\u5305\u542b\u65e0\u6548\u6570\u636e\u65f6\uff0cFastAPI \u5185\u90e8\u4f1a\u89e6\u53d1 <code>RequestValidationError</code>\u3002</p> <p>\u8be5\u5f02\u5e38\u4e5f\u5185\u7f6e\u4e86\u9ed8\u8ba4\u5f02\u5e38\u5904\u7406\u5668\u3002</p> <p>\u8986\u76d6\u9ed8\u8ba4\u5f02\u5e38\u5904\u7406\u5668\u65f6\u9700\u8981\u5bfc\u5165 <code>RequestValidationError</code>\uff0c\u5e76\u7528 <code>@app.excption_handler(RequestValidationError)</code> \u88c5\u9970\u5f02\u5e38\u5904\u7406\u5668\u3002</p> <p>\u8fd9\u6837\uff0c\u5f02\u5e38\u5904\u7406\u5668\u5c31\u53ef\u4ee5\u63a5\u6536 <code>Request</code> \u4e0e\u5f02\u5e38\u3002</p> <pre><code>from fastapi import FastAPI, HTTPException\nfrom fastapi.exceptions import RequestValidationError\nfrom fastapi.responses import PlainTextResponse\nfrom starlette.exceptions import HTTPException as StarletteHTTPException\n\napp = FastAPI()\n\n\n@app.exception_handler(StarletteHTTPException)\nasync def http_exception_handler(request, exc):\n    return PlainTextResponse(str(exc.detail), status_code=exc.status_code)\n\n\n@app.exception_handler(RequestValidationError)\nasync def validation_exception_handler(request, exc):\nreturn PlainTextResponse(str(exc), status_code=400)\n@app.get(\"/items/{item_id}\")\nasync def read_item(item_id: int):\n    if item_id == 3:\n        raise HTTPException(status_code=418, detail=\"Nope! I don't like 3.\")\n    return {\"item_id\": item_id}\n</code></pre> <p>\u8bbf\u95ee <code>/items/foo</code>\uff0c\u53ef\u4ee5\u770b\u5230\u4ee5\u4e0b\u5185\u5bb9\u66ff\u6362\u4e86\u9ed8\u8ba4 JSON \u9519\u8bef\u4fe1\u606f\uff1a</p> <pre><code>{\n\"detail\": [\n{\n\"loc\": [\n\"path\",\n\"item_id\"\n],\n\"msg\": \"value is not a valid integer\",\n\"type\": \"type_error.integer\"\n}\n]\n}\n</code></pre> <p>\u4ee5\u4e0b\u662f\u6587\u672c\u683c\u5f0f\u7684\u9519\u8bef\u4fe1\u606f\uff1a</p> <pre><code>1 validation error\npath -&gt; item_id\n  value is not a valid integer (type=type_error.integer)\n</code></pre>"},{"location":"tutorial/handling-errors/#requestvalidationerror-vs-validationerror","title":"<code>RequestValidationError</code> vs <code>ValidationError</code>","text":"<p>\u8b66\u544a</p> <p>\u5982\u679c\u60a8\u89c9\u5f97\u73b0\u5728\u8fd8\u7528\u4e0d\u5230\u4ee5\u4e0b\u6280\u672f\u7ec6\u8282\uff0c\u53ef\u4ee5\u5148\u8df3\u8fc7\u4e0b\u9762\u7684\u5185\u5bb9\u3002</p> <p><code>RequestValidationError</code> \u662f Pydantic \u7684 <code>ValidationError</code> \u7684\u5b50\u7c7b\u3002</p> <p>FastAPI \u8c03\u7528\u7684\u5c31\u662f <code>RequestValidationError</code> \u7c7b\uff0c\u56e0\u6b64\uff0c\u5982\u679c\u5728 <code>response_model</code> \u4e2d\u4f7f\u7528 Pydantic \u6a21\u578b\uff0c\u4e14\u6570\u636e\u6709\u9519\u8bef\u65f6\uff0c\u5728\u65e5\u5fd7\u4e2d\u5c31\u4f1a\u770b\u5230\u8fd9\u4e2a\u9519\u8bef\u3002</p> <p>\u4f46\u5ba2\u6237\u7aef\u6216\u7528\u6237\u770b\u4e0d\u5230\u8fd9\u4e2a\u9519\u8bef\u3002\u53cd\u4e4b\uff0c\u5ba2\u6237\u7aef\u63a5\u6536\u5230\u7684\u662f HTTP \u72b6\u6001\u7801\u4e3a <code>500</code> \u7684\u300c\u5185\u90e8\u670d\u52a1\u5668\u9519\u8bef\u300d\u3002</p> <p>\u8fd9\u662f\u56e0\u4e3a\u5728\u54cd\u5e94\u6216\u4ee3\u7801\uff08\u4e0d\u662f\u5728\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u91cc\uff09\u4e2d\u51fa\u73b0\u7684 Pydantic <code>ValidationError</code> \u662f\u4ee3\u7801\u7684 bug\u3002</p> <p>\u4fee\u590d\u9519\u8bef\u65f6\uff0c\u5ba2\u6237\u7aef\u6216\u7528\u6237\u4e0d\u80fd\u8bbf\u95ee\u9519\u8bef\u7684\u5185\u90e8\u4fe1\u606f\uff0c\u5426\u5219\u4f1a\u9020\u6210\u5b89\u5168\u9690\u60a3\u3002</p>"},{"location":"tutorial/handling-errors/#httpexception_3","title":"\u8986\u76d6 <code>HTTPException</code> \u9519\u8bef\u5904\u7406\u5668","text":"<p>\u540c\u7406\uff0c\u4e5f\u53ef\u4ee5\u8986\u76d6 <code>HTTPException</code> \u5904\u7406\u5668\u3002</p> <p>\u4f8b\u5982\uff0c\u53ea\u4e3a\u9519\u8bef\u8fd4\u56de\u7eaf\u6587\u672c\u54cd\u5e94\uff0c\u800c\u4e0d\u662f\u8fd4\u56de JSON \u683c\u5f0f\u7684\u5185\u5bb9\uff1a</p> <pre><code>from fastapi import FastAPI, HTTPException\nfrom fastapi.exceptions import RequestValidationError\nfrom fastapi.responses import PlainTextResponse\nfrom starlette.exceptions import HTTPException as StarletteHTTPException\napp = FastAPI()\n\n\n@app.exception_handler(StarletteHTTPException)\nasync def http_exception_handler(request, exc):\nreturn PlainTextResponse(str(exc.detail), status_code=exc.status_code)\n@app.exception_handler(RequestValidationError)\nasync def validation_exception_handler(request, exc):\n    return PlainTextResponse(str(exc), status_code=400)\n\n\n@app.get(\"/items/{item_id}\")\nasync def read_item(item_id: int):\n    if item_id == 3:\nraise HTTPException(status_code=418, detail=\"Nope! I don't like 3.\")\nreturn {\"item_id\": item_id}\n</code></pre> <p>\u6280\u672f\u7ec6\u8282</p> <p>\u8fd8\u53ef\u4ee5\u4f7f\u7528 <code>from starlette.responses import PlainTextResponse</code>\u3002</p> <p>FastAPI \u63d0\u4f9b\u4e86\u4e0e <code>starlette.responses</code> \u76f8\u540c\u7684 <code>fastapi.responses</code> \u4f5c\u4e3a\u5feb\u6377\u65b9\u5f0f\uff0c\u4f46\u5927\u90e8\u5206\u54cd\u5e94\u90fd\u53ef\u4ee5\u76f4\u63a5\u4ece Starlette \u5bfc\u5165\u3002</p>"},{"location":"tutorial/handling-errors/#requestvalidationerror","title":"\u4f7f\u7528 <code>RequestValidationError</code> \u7684\u8bf7\u6c42\u4f53","text":"<p><code>RequestValidationError</code> \u5305\u542b\u5176\u63a5\u6536\u5230\u7684\u65e0\u6548\u6570\u636e\u8bf7\u6c42\u7684 <code>body</code> \u3002</p> <p>\u5f00\u53d1\u65f6\uff0c\u53ef\u4ee5\u7528\u8fd9\u4e2a\u8bf7\u6c42\u4f53\u751f\u6210\u65e5\u5fd7\u3001\u8c03\u8bd5\u9519\u8bef\uff0c\u5e76\u8fd4\u56de\u7ed9\u7528\u6237\u3002</p> <pre><code>from fastapi import FastAPI, Request, status\nfrom fastapi.encoders import jsonable_encoder\nfrom fastapi.exceptions import RequestValidationError\nfrom fastapi.responses import JSONResponse\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\n@app.exception_handler(RequestValidationError)\nasync def validation_exception_handler(request: Request, exc: RequestValidationError):\n    return JSONResponse(\n        status_code=status.HTTP_422_UNPROCESSABLE_ENTITY,\ncontent=jsonable_encoder({\"detail\": exc.errors(), \"body\": exc.body}),\n)\n\n\nclass Item(BaseModel):\n    title: str\n    size: int\n\n\n@app.post(\"/items/\")\nasync def create_item(item: Item):\n    return item\n</code></pre> <p>\u73b0\u5728\u8bd5\u7740\u53d1\u9001\u4e00\u4e2a\u65e0\u6548\u7684 <code>item</code>\uff0c\u4f8b\u5982\uff1a</p> <pre><code>{\n\"title\": \"towel\",\n\"size\": \"XL\"\n}\n</code></pre> <p>\u6536\u5230\u7684\u54cd\u5e94\u5305\u542b <code>body</code> \u4fe1\u606f\uff0c\u5e76\u8bf4\u660e\u6570\u636e\u662f\u65e0\u6548\u7684\uff1a</p> <pre><code>{\n\"detail\": [\n{\n\"loc\": [\n\"body\",\n\"size\"\n],\n\"msg\": \"value is not a valid integer\",\n\"type\": \"type_error.integer\"\n}\n],\n\"body\": {\n\"title\": \"towel\",\n\"size\": \"XL\"\n}\n}\n</code></pre>"},{"location":"tutorial/handling-errors/#fastapi-httpexception-vs-starlette-httpexception","title":"FastAPI <code>HTTPException</code> vs Starlette <code>HTTPException</code>","text":"<p>FastAPI \u4e5f\u63d0\u4f9b\u4e86\u81ea\u6709\u7684 <code>HTTPException</code>\u3002</p> <p>FastAPI \u7684 <code>HTTPException</code> \u7ee7\u627f\u81ea Starlette \u7684 <code>HTTPException</code> \u9519\u8bef\u7c7b\u3002</p> <p>\u5b83\u4eec\u4e4b\u95f4\u7684\u552f\u4e00\u533a\u522b\u662f\uff0cFastAPI \u7684 <code>HTTPException</code> \u53ef\u4ee5\u5728\u54cd\u5e94\u4e2d\u6dfb\u52a0\u54cd\u5e94\u5934\u3002</p> <p>OAuth 2.0 \u7b49\u5b89\u5168\u5de5\u5177\u9700\u8981\u5728\u5185\u90e8\u8c03\u7528\u8fd9\u4e9b\u54cd\u5e94\u5934\u3002</p> <p>\u56e0\u6b64\u4f60\u53ef\u4ee5\u7ee7\u7eed\u50cf\u5e73\u5e38\u4e00\u6837\u5728\u4ee3\u7801\u4e2d\u89e6\u53d1 FastAPI \u7684 <code>HTTPException</code> \u3002</p> <p>\u4f46\u6ce8\u518c\u5f02\u5e38\u5904\u7406\u5668\u65f6\uff0c\u5e94\u8be5\u6ce8\u518c\u5230\u6765\u81ea Starlette \u7684 <code>HTTPException</code>\u3002</p> <p>\u8fd9\u6837\u505a\u662f\u4e3a\u4e86\uff0c\u5f53 Starlette \u7684\u5185\u90e8\u4ee3\u7801\u3001\u6269\u5c55\u6216\u63d2\u4ef6\u89e6\u53d1 Starlette <code>HTTPException</code> \u65f6\uff0c\u5904\u7406\u7a0b\u5e8f\u80fd\u591f\u6355\u83b7\u3001\u5e76\u5904\u7406\u6b64\u5f02\u5e38\u3002</p> <p>\u6ce8\u610f\uff0c\u672c\u4f8b\u4ee3\u7801\u4e2d\u540c\u65f6\u4f7f\u7528\u4e86\u8fd9\u4e24\u4e2a <code>HTTPException</code>\uff0c\u6b64\u65f6\uff0c\u8981\u628a Starlette \u7684 <code>HTTPException</code> \u547d\u540d\u4e3a <code>StarletteHTTPException</code>\uff1a</p> <pre><code>from starlette.exceptions import HTTPException as StarletteHTTPException\n</code></pre>"},{"location":"tutorial/handling-errors/#fastapi","title":"\u590d\u7528 FastAPI \u5f02\u5e38\u5904\u7406\u5668","text":"<p>FastAPI \u652f\u6301\u5148\u5bf9\u5f02\u5e38\u8fdb\u884c\u67d0\u4e9b\u5904\u7406\uff0c\u7136\u540e\u518d\u4f7f\u7528 FastAPI \u4e2d\u5904\u7406\u8be5\u5f02\u5e38\u7684\u9ed8\u8ba4\u5f02\u5e38\u5904\u7406\u5668\u3002</p> <p>\u4ece <code>fastapi.exception_handlers</code> \u4e2d\u5bfc\u5165\u8981\u590d\u7528\u7684\u9ed8\u8ba4\u5f02\u5e38\u5904\u7406\u5668\uff1a</p> <pre><code>from fastapi import FastAPI, HTTPException\nfrom fastapi.exception_handlers import (\nhttp_exception_handler,\nrequest_validation_exception_handler,\n)\nfrom fastapi.exceptions import RequestValidationError\nfrom starlette.exceptions import HTTPException as StarletteHTTPException\n\napp = FastAPI()\n\n\n@app.exception_handler(StarletteHTTPException)\nasync def custom_http_exception_handler(request, exc):\n    print(f\"OMG! An HTTP error!: {repr(exc)}\")\nreturn await http_exception_handler(request, exc)\n@app.exception_handler(RequestValidationError)\nasync def validation_exception_handler(request, exc):\n    print(f\"OMG! The client sent invalid data!: {exc}\")\nreturn await request_validation_exception_handler(request, exc)\n@app.get(\"/items/{item_id}\")\nasync def read_item(item_id: int):\n    if item_id == 3:\n        raise HTTPException(status_code=418, detail=\"Nope! I don't like 3.\")\n    return {\"item_id\": item_id}\n</code></pre> <p>\u867d\u7136\uff0c\u672c\u4f8b\u53ea\u662f\u8f93\u51fa\u4e86\u5938\u5927\u5176\u8bcd\u7684\u9519\u8bef\u4fe1\u606f\u3002</p> <p>\u4f46\u4e5f\u8db3\u4ee5\u8bf4\u660e\uff0c\u53ef\u4ee5\u5728\u5904\u7406\u5f02\u5e38\u4e4b\u540e\u518d\u590d\u7528\u9ed8\u8ba4\u7684\u5f02\u5e38\u5904\u7406\u5668\u3002</p>"},{"location":"tutorial/header-params/","title":"Header \u53c2\u6570","text":"<p>\u4f60\u53ef\u4ee5\u4f7f\u7528\u5b9a\u4e49 <code>Query</code>, <code>Path</code> \u548c <code>Cookie</code> \u53c2\u6570\u4e00\u6837\u7684\u65b9\u6cd5\u5b9a\u4e49 Header \u53c2\u6570\u3002</p>"},{"location":"tutorial/header-params/#header_1","title":"\u5bfc\u5165 <code>Header</code>","text":"<p>\u9996\u5148\u5bfc\u5165 <code>Header</code>:</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI, Header\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items(user_agent: Union[str, None] = Header(default=None)):\n    return {\"User-Agent\": user_agent}\n</code></pre>"},{"location":"tutorial/header-params/#header_2","title":"\u58f0\u660e <code>Header</code> \u53c2\u6570","text":"<p>\u7136\u540e\u4f7f\u7528\u548c<code>Path</code>, <code>Query</code> and <code>Cookie</code> \u4e00\u6837\u7684\u7ed3\u6784\u5b9a\u4e49 header \u53c2\u6570</p> <p>\u7b2c\u4e00\u4e2a\u503c\u662f\u9ed8\u8ba4\u503c\uff0c\u4f60\u53ef\u4ee5\u4f20\u9012\u6240\u6709\u7684\u989d\u5916\u9a8c\u8bc1\u6216\u6ce8\u91ca\u53c2\u6570\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI, Header\n\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items(user_agent: Union[str, None] = Header(default=None)):\nreturn {\"User-Agent\": user_agent}\n</code></pre> <p>\u6280\u672f\u7ec6\u8282</p> <p><code>Header</code> \u662f <code>Path</code>, <code>Query</code> \u548c <code>Cookie</code> \u7684\u5144\u5f1f\u7c7b\u578b\u3002\u5b83\u4e5f\u7ee7\u627f\u81ea\u901a\u7528\u7684 <code>Param</code> \u7c7b.</p> <p>\u4f46\u662f\u8bf7\u8bb0\u5f97\uff0c\u5f53\u4f60\u4ece<code>fastapi</code>\u5bfc\u5165 <code>Query</code>, <code>Path</code>, <code>Header</code>, \u6216\u5176\u4ed6\u65f6\uff0c\u5b9e\u9645\u4e0a\u5bfc\u5165\u7684\u662f\u8fd4\u56de\u7279\u5b9a\u7c7b\u578b\u7684\u51fd\u6570\u3002</p> <p>Info</p> <p>\u4e3a\u4e86\u58f0\u660eheaders\uff0c \u4f60\u9700\u8981\u4f7f\u7528<code>Header</code>, \u56e0\u4e3a\u5426\u5219\u53c2\u6570\u5c06\u88ab\u89e3\u91ca\u4e3a\u67e5\u8be2\u53c2\u6570\u3002</p>"},{"location":"tutorial/header-params/#_1","title":"\u81ea\u52a8\u8f6c\u6362","text":"<p><code>Header</code> \u5728 <code>Path</code>, <code>Query</code> \u548c <code>Cookie</code> \u63d0\u4f9b\u7684\u529f\u80fd\u4e4b\u4e0a\u6709\u4e00\u70b9\u989d\u5916\u7684\u529f\u80fd\u3002</p> <p>\u5927\u591a\u6570\u6807\u51c6\u7684headers\u7528 \"\u8fde\u5b57\u7b26\" \u5206\u9694\uff0c\u4e5f\u79f0\u4e3a \"\u51cf\u53f7\" (<code>-</code>)\u3002</p> <p>\u4f46\u662f\u50cf <code>user-agent</code> \u8fd9\u6837\u7684\u53d8\u91cf\u5728Python\u4e2d\u662f\u65e0\u6548\u7684\u3002</p> <p>\u56e0\u6b64, \u9ed8\u8ba4\u60c5\u51b5\u4e0b, <code>Header</code> \u5c06\u628a\u53c2\u6570\u540d\u79f0\u7684\u5b57\u7b26\u4ece\u4e0b\u5212\u7ebf (<code>_</code>) \u8f6c\u6362\u4e3a\u8fde\u5b57\u7b26 (<code>-</code>) \u6765\u63d0\u53d6\u5e76\u8bb0\u5f55 headers.</p> <p>\u540c\u65f6\uff0cHTTP headers \u662f\u5927\u5c0f\u5199\u4e0d\u654f\u611f\u7684\uff0c\u56e0\u6b64\uff0c\u56e0\u6b64\u53ef\u4ee5\u4f7f\u7528\u6807\u51c6Python\u6837\u5f0f(\u4e5f\u79f0\u4e3a \"snake_case\")\u58f0\u660e\u5b83\u4eec\u3002</p> <p>\u56e0\u6b64\uff0c\u60a8\u53ef\u4ee5\u50cf\u901a\u5e38\u5728Python\u4ee3\u7801\u4e2d\u90a3\u6837\u4f7f\u7528 <code>user_agent</code> \uff0c\u800c\u4e0d\u9700\u8981\u5c06\u9996\u5b57\u6bcd\u5927\u5199\u4e3a <code>User_Agent</code> \u6216\u7c7b\u4f3c\u7684\u4e1c\u897f\u3002</p> <p>\u5982\u679c\u51fa\u4e8e\u67d0\u4e9b\u539f\u56e0\uff0c\u4f60\u9700\u8981\u7981\u7528\u4e0b\u5212\u7ebf\u5230\u8fde\u5b57\u7b26\u7684\u81ea\u52a8\u8f6c\u6362\uff0c\u8bbe\u7f6e<code>Header</code>\u7684\u53c2\u6570 <code>convert_underscores</code> \u4e3a <code>False</code>:</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI, Header\n\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items(\nstrange_header: Union[str, None] = Header(default=None, convert_underscores=False)\n):\n    return {\"strange_header\": strange_header}\n</code></pre> <p>Warning</p> <p>\u5728\u8bbe\u7f6e <code>convert_underscores</code> \u4e3a <code>False</code> \u4e4b\u524d\uff0c\u8bf7\u8bb0\u4f4f\uff0c\u4e00\u4e9bHTTP\u4ee3\u7406\u548c\u670d\u52a1\u5668\u4e0d\u5141\u8bb8\u4f7f\u7528\u5e26\u6709\u4e0b\u5212\u7ebf\u7684headers\u3002</p>"},{"location":"tutorial/header-params/#headers","title":"\u91cd\u590d\u7684 headers","text":"<p>\u6709\u53ef\u80fd\u6536\u5230\u91cd\u590d\u7684headers\u3002\u8fd9\u610f\u5473\u7740\uff0c\u76f8\u540c\u7684header\u5177\u6709\u591a\u4e2a\u503c\u3002</p> <p>\u60a8\u53ef\u4ee5\u5728\u7c7b\u578b\u58f0\u660e\u4e2d\u4f7f\u7528\u4e00\u4e2alist\u6765\u5b9a\u4e49\u8fd9\u4e9b\u60c5\u51b5\u3002</p> <p>\u4f60\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2aPython <code>list</code> \u7684\u5f62\u5f0f\u83b7\u5f97\u91cd\u590dheader\u7684\u6240\u6709\u503c\u3002</p> <p>\u6bd4\u5982, \u4e3a\u4e86\u58f0\u660e\u4e00\u4e2a <code>X-Token</code> header \u53ef\u4ee5\u51fa\u73b0\u591a\u6b21\uff0c\u4f60\u53ef\u4ee5\u8fd9\u6837\u5199\uff1a</p> <pre><code>from typing import List, Union\n\nfrom fastapi import FastAPI, Header\n\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items(x_token: Union[List[str], None] = Header(default=None)):\nreturn {\"X-Token values\": x_token}\n</code></pre> <p>\u5982\u679c\u4f60\u4e0e\u8def\u5f84\u64cd\u4f5c\u901a\u4fe1\u65f6\u53d1\u9001\u4e24\u4e2aHTTP headers\uff0c\u5c31\u50cf\uff1a</p> <pre><code>X-Token: foo\nX-Token: bar\n</code></pre> <p>\u54cd\u5e94\u4f1a\u662f:</p> <pre><code>{\n\"X-Token values\": [\n\"bar\",\n\"foo\"\n]\n}\n</code></pre>"},{"location":"tutorial/header-params/#_2","title":"\u56de\u987e","text":"<p>\u4f7f\u7528 <code>Header</code> \u6765\u58f0\u660e header , \u4f7f\u7528\u548c <code>Query</code>, <code>Path</code> \u4e0e <code>Cookie</code> \u76f8\u540c\u7684\u6a21\u5f0f\u3002</p> <p>\u4e0d\u7528\u62c5\u5fc3\u53d8\u91cf\u4e2d\u7684\u4e0b\u5212\u7ebf\uff0cFastAPI \u4f1a\u8d1f\u8d23\u8f6c\u6362\u5b83\u4eec\u3002</p>"},{"location":"tutorial/metadata/","title":"\u5143\u6570\u636e\u548c\u6587\u6863 URL","text":"<p>\u4f60\u53ef\u4ee5\u5728 FastAPI \u5e94\u7528\u4e2d\u81ea\u5b9a\u4e49\u51e0\u4e2a\u5143\u6570\u636e\u914d\u7f6e\u3002</p>"},{"location":"tutorial/metadata/#_1","title":"\u6807\u9898\u3001\u63cf\u8ff0\u548c\u7248\u672c","text":"<p>\u4f60\u53ef\u4ee5\u8bbe\u5b9a\uff1a</p> <ul> <li>Title\uff1a\u5728 OpenAPI \u548c\u81ea\u52a8 API \u6587\u6863\u7528\u6237\u754c\u9762\u4e2d\u4f5c\u4e3a API \u7684\u6807\u9898/\u540d\u79f0\u4f7f\u7528\u3002</li> <li>Description\uff1a\u5728 OpenAPI \u548c\u81ea\u52a8 API \u6587\u6863\u7528\u6237\u754c\u9762\u4e2d\u7528\u4f5c API \u7684\u63cf\u8ff0\u3002</li> <li>Version\uff1aAPI \u7248\u672c\uff0c\u4f8b\u5982 <code>v2</code> \u6216\u8005 <code>2.5.0</code>\u3002<ul> <li>\u5982\u679c\u4f60\u4e4b\u524d\u7684\u5e94\u7528\u7a0b\u5e8f\u7248\u672c\u4e5f\u4f7f\u7528 OpenAPI \u4f1a\u5f88\u6709\u7528\u3002</li> </ul> </li> </ul> <p>\u4f7f\u7528 <code>title</code>\u3001<code>description</code> \u548c <code>version</code> \u6765\u8bbe\u7f6e\u5b83\u4eec\uff1a</p> <pre><code>from fastapi import FastAPI\n\ndescription = \"\"\"\nChimichangApp API helps you do awesome stuff. \ud83d\ude80\n## Items\nYou can **read items**.\n\n## Users\n\nYou will be able to:\n\n* **Create users** (_not implemented_).\n* **Read users** (_not implemented_).\n\"\"\"\n\napp = FastAPI(\n    title=\"ChimichangApp\",\n    description=description,\n    version=\"0.0.1\",\n    terms_of_service=\"http://example.com/terms/\",\n    contact={\n        \"name\": \"Deadpoolio the Amazing\",\n        \"url\": \"http://x-force.example.com/contact/\",\n        \"email\": \"dp@x-force.example.com\",\n    },\n    license_info={\n        \"name\": \"Apache 2.0\",\n        \"url\": \"https://www.apache.org/licenses/LICENSE-2.0.html\",\n    },\n)\n\n\n@app.get(\"/items/\")\nasync def read_items():\n    return [{\"name\": \"Katana\"}]\n</code></pre> <p>\u901a\u8fc7\u8fd9\u6837\u8bbe\u7f6e\uff0c\u81ea\u52a8 API \u6587\u6863\u770b\u8d77\u6765\u4f1a\u50cf\uff1a</p> <p></p>"},{"location":"tutorial/metadata/#_2","title":"\u6807\u7b7e\u5143\u6570\u636e","text":"<p>\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528\u53c2\u6570 <code>openapi_tags</code>\uff0c\u4e3a\u7528\u4e8e\u5206\u7ec4\u8def\u5f84\u64cd\u4f5c\u7684\u4e0d\u540c\u6807\u7b7e\u6dfb\u52a0\u989d\u5916\u7684\u5143\u6570\u636e\u3002</p> <p>\u5b83\u63a5\u53d7\u4e00\u4e2a\u5217\u8868\uff0c\u8fd9\u4e2a\u5217\u8868\u5305\u542b\u6bcf\u4e2a\u6807\u7b7e\u5bf9\u5e94\u7684\u4e00\u4e2a\u5b57\u5178\u3002</p> <p>\u6bcf\u4e2a\u5b57\u5178\u53ef\u4ee5\u5305\u542b\uff1a</p> <ul> <li><code>name</code>\uff08\u5fc5\u8981\uff09\uff1a\u4e00\u4e2a <code>str</code>\uff0c\u5b83\u4e0e\u8def\u5f84\u64cd\u4f5c\u548c <code>APIRouter</code> \u4e2d\u4f7f\u7528\u7684 <code>tags</code> \u53c2\u6570\u6709\u76f8\u540c\u7684\u6807\u7b7e\u540d\u3002</li> <li><code>description</code>\uff1a\u4e00\u4e2a\u7528\u4e8e\u7b80\u77ed\u63cf\u8ff0\u6807\u7b7e\u7684 <code>str</code>\u3002\u5b83\u652f\u6301 Markdown \u5e76\u4e14\u4f1a\u5728\u6587\u6863\u7528\u6237\u754c\u9762\u4e2d\u663e\u793a\u3002</li> <li><code>externalDocs</code>\uff1a\u4e00\u4e2a\u63cf\u8ff0\u5916\u90e8\u6587\u6863\u7684 <code>dict</code>\uff1a<ul> <li><code>description</code>\uff1a\u7528\u4e8e\u7b80\u77ed\u63cf\u8ff0\u5916\u90e8\u6587\u6863\u7684 <code>str</code>\u3002</li> <li><code>url</code>\uff08\u5fc5\u8981\uff09\uff1a\u5916\u90e8\u6587\u6863\u7684 URL <code>str</code>\u3002</li> </ul> </li> </ul>"},{"location":"tutorial/metadata/#_3","title":"\u521b\u5efa\u6807\u7b7e\u5143\u6570\u636e","text":"<p>\u8ba9\u6211\u4eec\u5728\u5e26\u6709\u6807\u7b7e\u7684\u793a\u4f8b\u4e2d\u4e3a <code>users</code> \u548c <code>items</code> \u8bd5\u4e00\u4e0b\u3002</p> <p>\u521b\u5efa\u6807\u7b7e\u5143\u6570\u636e\u5e76\u628a\u5b83\u4f20\u9012\u7ed9 <code>openapi_tags</code> \u53c2\u6570\uff1a</p> <pre><code>from fastapi import FastAPI\n\ntags_metadata = [\n{\n\"name\": \"users\",\n\"description\": \"Operations with users. The **login** logic is also here.\",\n},\n{\n\"name\": \"items\",\n\"description\": \"Manage items. So _fancy_ they have their own docs.\",\n\"externalDocs\": {\n\"description\": \"Items external docs\",\n\"url\": \"https://fastapi.tiangolo.com/\",\n},\n},\n]\napp = FastAPI(openapi_tags=tags_metadata)\n@app.get(\"/users/\", tags=[\"users\"])\nasync def get_users():\n    return [{\"name\": \"Harry\"}, {\"name\": \"Ron\"}]\n\n\n@app.get(\"/items/\", tags=[\"items\"])\nasync def get_items():\n    return [{\"name\": \"wand\"}, {\"name\": \"flying broom\"}]\n</code></pre> <p>\u6ce8\u610f\u4f60\u53ef\u4ee5\u5728\u63cf\u8ff0\u5185\u4f7f\u7528 Markdown\uff0c\u4f8b\u5982\u300clogin\u300d\u4f1a\u663e\u793a\u4e3a\u7c97\u4f53\uff08login\uff09\u4ee5\u53ca\u300cfancy\u300d\u4f1a\u663e\u793a\u4e3a\u659c\u4f53\uff08fancy\uff09\u3002</p> <p>\u63d0\u793a</p> <p>\u4e0d\u5fc5\u4e3a\u4f60\u4f7f\u7528\u7684\u6240\u6709\u6807\u7b7e\u90fd\u6dfb\u52a0\u5143\u6570\u636e\u3002</p>"},{"location":"tutorial/metadata/#_4","title":"\u4f7f\u7528\u4f60\u7684\u6807\u7b7e","text":"<p>\u5c06 <code>tags</code> \u53c2\u6570\u548c\u8def\u5f84\u64cd\u4f5c\uff08\u4ee5\u53ca <code>APIRouter</code>\uff09\u4e00\u8d77\u4f7f\u7528\uff0c\u5c06\u5176\u5206\u914d\u7ed9\u4e0d\u540c\u7684\u6807\u7b7e\uff1a</p> <pre><code>from fastapi import FastAPI\n\ntags_metadata = [\n    {\n        \"name\": \"users\",\n        \"description\": \"Operations with users. The **login** logic is also here.\",\n    },\n    {\n        \"name\": \"items\",\n        \"description\": \"Manage items. So _fancy_ they have their own docs.\",\n        \"externalDocs\": {\n            \"description\": \"Items external docs\",\n            \"url\": \"https://fastapi.tiangolo.com/\",\n        },\n    },\n]\n\napp = FastAPI(openapi_tags=tags_metadata)\n\n\n@app.get(\"/users/\", tags=[\"users\"])\nasync def get_users():\n    return [{\"name\": \"Harry\"}, {\"name\": \"Ron\"}]\n\n\n@app.get(\"/items/\", tags=[\"items\"])\nasync def get_items():\n    return [{\"name\": \"wand\"}, {\"name\": \"flying broom\"}]\n</code></pre> <p>\u4fe1\u606f</p> <p>\u9605\u8bfb\u66f4\u591a\u5173\u4e8e\u6807\u7b7e\u7684\u4fe1\u606f\u8def\u5f84\u64cd\u4f5c\u914d\u7f6e\u3002</p>"},{"location":"tutorial/metadata/#_5","title":"\u67e5\u770b\u6587\u6863","text":"<p>\u5982\u679c\u4f60\u73b0\u5728\u67e5\u770b\u6587\u6863\uff0c\u5b83\u4eec\u4f1a\u663e\u793a\u6240\u6709\u9644\u52a0\u7684\u5143\u6570\u636e\uff1a</p> <p></p>"},{"location":"tutorial/metadata/#_6","title":"\u6807\u7b7e\u987a\u5e8f","text":"<p>\u6bcf\u4e2a\u6807\u7b7e\u5143\u6570\u636e\u5b57\u5178\u7684\u987a\u5e8f\u4e5f\u5b9a\u4e49\u4e86\u5728\u6587\u6863\u7528\u6237\u754c\u9762\u663e\u793a\u7684\u987a\u5e8f\u3002</p> <p>\u4f8b\u5982\u6309\u7167\u5b57\u6bcd\u987a\u5e8f\uff0c\u5373\u4f7f <code>users</code> \u6392\u5728 <code>items</code> \u4e4b\u540e\uff0c\u5b83\u4e5f\u4f1a\u663e\u793a\u5728\u524d\u9762\uff0c\u56e0\u4e3a\u6211\u4eec\u5c06\u5b83\u7684\u5143\u6570\u636e\u6dfb\u52a0\u4e3a\u5217\u8868\u5185\u7684\u7b2c\u4e00\u4e2a\u5b57\u5178\u3002</p>"},{"location":"tutorial/metadata/#openapi-url","title":"OpenAPI URL","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cOpenAPI \u6a21\u5f0f\u670d\u52a1\u4e8e <code>/openapi.json</code>\u3002</p> <p>\u4f46\u662f\u4f60\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570 <code>openapi_url</code> \u5bf9\u5176\u8fdb\u884c\u914d\u7f6e\u3002</p> <p>\u4f8b\u5982\uff0c\u5c06\u5176\u8bbe\u7f6e\u4e3a\u670d\u52a1\u4e8e <code>/api/v1/openapi.json</code>\uff1a</p> <pre><code>from fastapi import FastAPI\n\napp = FastAPI(openapi_url=\"/api/v1/openapi.json\")\n@app.get(\"/items/\")\nasync def read_items():\n    return [{\"name\": \"Foo\"}]\n</code></pre> <p>\u5982\u679c\u4f60\u60f3\u5b8c\u5168\u7981\u7528 OpenAPI \u6a21\u5f0f\uff0c\u53ef\u4ee5\u5c06\u5176\u8bbe\u7f6e\u4e3a <code>openapi_url=None</code>\uff0c\u8fd9\u6837\u4e5f\u4f1a\u7981\u7528\u4f7f\u7528\u5b83\u7684\u6587\u6863\u7528\u6237\u754c\u9762\u3002</p>"},{"location":"tutorial/metadata/#urls","title":"\u6587\u6863 URLs","text":"<p>\u4f60\u53ef\u4ee5\u914d\u7f6e\u4e24\u4e2a\u6587\u6863\u7528\u6237\u754c\u9762\uff0c\u5305\u62ec\uff1a</p> <ul> <li>Swagger UI\uff1a\u670d\u52a1\u4e8e <code>/docs</code>\u3002<ul> <li>\u53ef\u4ee5\u4f7f\u7528\u53c2\u6570 <code>docs_url</code> \u8bbe\u7f6e\u5b83\u7684 URL\u3002</li> <li>\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e <code>docs_url=None</code> \u7981\u7528\u5b83\u3002</li> </ul> </li> <li>ReDoc\uff1a\u670d\u52a1\u4e8e <code>/redoc</code>\u3002<ul> <li>\u53ef\u4ee5\u4f7f\u7528\u53c2\u6570 <code>redoc_url</code> \u8bbe\u7f6e\u5b83\u7684 URL\u3002</li> <li>\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e <code>redoc_url=None</code> \u7981\u7528\u5b83\u3002</li> </ul> </li> </ul> <p>\u4f8b\u5982\uff0c\u8bbe\u7f6e Swagger UI \u670d\u52a1\u4e8e <code>/documentation</code> \u5e76\u7981\u7528 ReDoc\uff1a</p> <pre><code>from fastapi import FastAPI\n\napp = FastAPI(docs_url=\"/documentation\", redoc_url=None)\n@app.get(\"/items/\")\nasync def read_items():\n    return [{\"name\": \"Foo\"}]\n</code></pre>"},{"location":"tutorial/middleware/","title":"\u4e2d\u95f4\u4ef6","text":"<p>\u4f60\u53ef\u4ee5\u5411 FastAPI \u5e94\u7528\u6dfb\u52a0\u4e2d\u95f4\u4ef6.</p> <p>\"\u4e2d\u95f4\u4ef6\"\u662f\u4e00\u4e2a\u51fd\u6570,\u5b83\u5728\u6bcf\u4e2a\u8bf7\u6c42\u88ab\u7279\u5b9a\u7684\u8def\u5f84\u64cd\u4f5c\u5904\u7406\u4e4b\u524d,\u4ee5\u53ca\u5728\u6bcf\u4e2a\u54cd\u5e94\u8fd4\u56de\u4e4b\u524d\u5de5\u4f5c.</p> <ul> <li>\u5b83\u63a5\u6536\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u6bcf\u4e00\u4e2a\u8bf7\u6c42.</li> <li>\u7136\u540e\u5b83\u53ef\u4ee5\u5bf9\u8fd9\u4e2a\u8bf7\u6c42\u505a\u4e00\u4e9b\u4e8b\u60c5\u6216\u8005\u6267\u884c\u4efb\u4f55\u9700\u8981\u7684\u4ee3\u7801.</li> <li>\u7136\u540e\u5b83\u5c06\u8bf7\u6c42\u4f20\u9012\u7ed9\u5e94\u7528\u7a0b\u5e8f\u7684\u5176\u4ed6\u90e8\u5206 (\u901a\u8fc7\u67d0\u79cd\u8def\u5f84\u64cd\u4f5c).</li> <li>\u7136\u540e\u5b83\u83b7\u53d6\u5e94\u7528\u7a0b\u5e8f\u751f\u4ea7\u7684\u54cd\u5e94 (\u901a\u8fc7\u67d0\u79cd\u8def\u5f84\u64cd\u4f5c).</li> <li>\u5b83\u53ef\u4ee5\u5bf9\u8be5\u54cd\u5e94\u505a\u4e9b\u4ec0\u4e48\u6216\u8005\u6267\u884c\u4efb\u4f55\u9700\u8981\u7684\u4ee3\u7801.</li> <li>\u7136\u540e\u5b83\u8fd4\u56de\u8fd9\u4e2a \u54cd\u5e94.</li> </ul> <p>\u6280\u672f\u7ec6\u8282</p> <p>\u5982\u679c\u4f60\u4f7f\u7528\u4e86 <code>yield</code> \u5173\u952e\u5b57\u4f9d\u8d56, \u4f9d\u8d56\u4e2d\u7684\u9000\u51fa\u4ee3\u7801\u5c06\u5728\u6267\u884c\u4e2d\u95f4\u4ef6\u540e\u6267\u884c.</p> <p>\u5982\u679c\u6709\u4efb\u4f55\u540e\u53f0\u4efb\u52a1(\u7a0d\u540e\u8bb0\u5f55), \u5b83\u4eec\u5c06\u5728\u6267\u884c\u4e2d\u95f4\u4ef6\u540e\u8fd0\u884c.</p>"},{"location":"tutorial/middleware/#_2","title":"\u521b\u5efa\u4e2d\u95f4\u4ef6","text":"<p>\u8981\u521b\u5efa\u4e2d\u95f4\u4ef6\u4f60\u53ef\u4ee5\u5728\u51fd\u6570\u7684\u9876\u90e8\u4f7f\u7528\u88c5\u9970\u5668 <code>@app.middleware(\"http\")</code>.</p> <p>\u4e2d\u95f4\u4ef6\u53c2\u6570\u63a5\u6536\u5982\u4e0b\u53c2\u6570:</p> <ul> <li><code>request</code>.</li> <li>\u4e00\u4e2a\u51fd\u6570 <code>call_next</code> \u5b83\u5c06\u63a5\u6536 <code>request</code> \u4f5c\u4e3a\u53c2\u6570.<ul> <li>\u8fd9\u4e2a\u51fd\u6570\u5c06 <code>request</code> \u4f20\u9012\u7ed9\u76f8\u5e94\u7684 \u8def\u5f84\u64cd\u4f5c.</li> <li>\u7136\u540e\u5b83\u5c06\u8fd4\u56de\u7531\u76f8\u5e94\u7684\u8def\u5f84\u64cd\u4f5c\u751f\u6210\u7684 <code>response</code>.</li> </ul> </li> <li>\u7136\u540e\u4f60\u53ef\u4ee5\u5728\u8fd4\u56de <code>response</code> \u524d\u8fdb\u4e00\u6b65\u4fee\u6539\u5b83.</li> </ul> <pre><code>import time\n\nfrom fastapi import FastAPI, Request\n\napp = FastAPI()\n\n\n@app.middleware(\"http\")\nasync def add_process_time_header(request: Request, call_next):\nstart_time = time.time()\nresponse = await call_next(request)\nprocess_time = time.time() - start_time\n    response.headers[\"X-Process-Time\"] = str(process_time)\nreturn response\n</code></pre> <p>Tip</p> <p>\u8bf7\u8bb0\u4f4f\u53ef\u4ee5 \u7528'X-' \u524d\u7f00\u6dfb\u52a0\u4e13\u6709\u81ea\u5b9a\u4e49\u8bf7\u6c42\u5934.</p> <p>\u4f46\u662f\u5982\u679c\u4f60\u60f3\u8ba9\u6d4f\u89c8\u5668\u4e2d\u7684\u5ba2\u6237\u7aef\u770b\u5230\u4f60\u7684\u81ea\u5b9a\u4e49\u8bf7\u6c42\u5934, \u4f60\u9700\u8981\u628a\u5b83\u4eec\u52a0\u5230 CORS \u914d\u7f6e (CORS (Cross-Origin Resource Sharing)) \u7684 <code>expose_headers</code> \u53c2\u6570\u4e2d,\u5728 Starlette's CORS docs\u6587\u6863\u4e2d.</p> <p>\u6280\u672f\u7ec6\u8282</p> <p>\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 <code>from starlette.requests import Request</code>.</p> <p>FastAPI \u4e3a\u4e86\u5f00\u53d1\u8005\u65b9\u4fbf\u63d0\u4f9b\u4e86\u8be5\u5bf9\u8c61. \u4f46\u5176\u5b9e\u5b83\u76f4\u63a5\u6765\u81ea\u4e8e Starlette.</p>"},{"location":"tutorial/middleware/#response","title":"\u5728 <code>response</code> \u7684\u524d\u548c\u540e","text":"<p>\u5728\u4efb\u4f55\u8def\u5f84\u64cd\u4f5c\u6536\u5230<code>request</code>\u524d,\u53ef\u4ee5\u6dfb\u52a0\u8981\u548c\u8bf7\u6c42\u4e00\u8d77\u8fd0\u884c\u7684\u4ee3\u7801.</p> <p>\u4e5f\u53ef\u4ee5\u5728\u54cd\u5e94\u751f\u6210\u4f46\u662f\u8fd4\u56de\u4e4b\u524d\u6dfb\u52a0\u4ee3\u7801.</p> <p>\u4f8b\u5982\u4f60\u53ef\u4ee5\u6dfb\u52a0\u81ea\u5b9a\u4e49\u8bf7\u6c42\u5934 <code>X-Process-Time</code> \u5305\u542b\u4ee5\u79d2\u4e3a\u5355\u4f4d\u7684\u63a5\u6536\u8bf7\u6c42\u548c\u751f\u6210\u54cd\u5e94\u7684\u65f6\u95f4:</p> <pre><code>import time\n\nfrom fastapi import FastAPI, Request\n\napp = FastAPI()\n\n\n@app.middleware(\"http\")\nasync def add_process_time_header(request: Request, call_next):\nstart_time = time.time()\nresponse = await call_next(request)\nprocess_time = time.time() - start_time\nresponse.headers[\"X-Process-Time\"] = str(process_time)\nreturn response\n</code></pre>"},{"location":"tutorial/middleware/#_3","title":"\u5176\u4ed6\u4e2d\u95f4\u4ef6","text":"<p>\u4f60\u53ef\u4ee5\u7a0d\u540e\u5728 Advanced User Guide: Advanced Middleware\u9605\u8bfb\u66f4\u591a\u5173\u4e8e\u4e2d\u95f4\u4ef6\u7684\u6559\u7a0b.</p> <p>\u4f60\u5c06\u5728\u4e0b\u4e00\u8282\u4e2d\u5b66\u4e60\u5982\u4f55\u4f7f\u7528\u4e2d\u95f4\u4ef6\u5904\u7406 CORS .</p>"},{"location":"tutorial/path-operation-configuration/","title":"\u8def\u5f84\u64cd\u4f5c\u914d\u7f6e","text":"<p>\u8def\u5f84\u64cd\u4f5c\u88c5\u9970\u5668\u652f\u6301\u591a\u79cd\u914d\u7f6e\u53c2\u6570\u3002</p> <p>\u8b66\u544a</p> <p>\u6ce8\u610f\uff1a\u4ee5\u4e0b\u53c2\u6570\u5e94\u76f4\u63a5\u4f20\u9012\u7ed9\u8def\u5f84\u64cd\u4f5c\u88c5\u9970\u5668\uff0c\u4e0d\u80fd\u4f20\u9012\u7ed9\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u3002</p>"},{"location":"tutorial/path-operation-configuration/#status_code","title":"<code>status_code</code> \u72b6\u6001\u7801","text":"<p><code>status_code</code> \u7528\u4e8e\u5b9a\u4e49\u8def\u5f84\u64cd\u4f5c\u54cd\u5e94\u4e2d\u7684 HTTP \u72b6\u6001\u7801\u3002</p> <p>\u53ef\u4ee5\u76f4\u63a5\u4f20\u9012 <code>int</code> \u4ee3\u7801\uff0c \u6bd4\u5982 <code>404</code>\u3002</p> <p>\u5982\u679c\u8bb0\u4e0d\u4f4f\u6570\u5b57\u7801\u7684\u6db5\u4e49\uff0c\u4e5f\u53ef\u4ee5\u7528 <code>status</code> \u7684\u5feb\u6377\u5e38\u91cf\uff1a</p> <pre><code>from typing import Set, Union\n\nfrom fastapi import FastAPI, status\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n    tags: Set[str] = set()\n\n\n@app.post(\"/items/\", response_model=Item, status_code=status.HTTP_201_CREATED)\nasync def create_item(item: Item):\n    return item\n</code></pre> <p>\u72b6\u6001\u7801\u5728\u54cd\u5e94\u4e2d\u4f7f\u7528\uff0c\u5e76\u4f1a\u88ab\u6dfb\u52a0\u5230 OpenAPI \u6982\u56fe\u3002</p> <p>\u6280\u672f\u7ec6\u8282</p> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528 <code>from starlette import status</code> \u5bfc\u5165\u72b6\u6001\u7801\u3002</p> <p>FastAPI \u7684<code>fastapi.status</code> \u548c <code>starlette.status</code> \u4e00\u6837\uff0c\u53ea\u662f\u5feb\u6377\u65b9\u5f0f\u3002\u5b9e\u9645\u4e0a\uff0c<code>fastapi.status</code> \u76f4\u63a5\u7ee7\u627f\u81ea Starlette\u3002</p>"},{"location":"tutorial/path-operation-configuration/#tags","title":"<code>tags</code> \u53c2\u6570","text":"<p><code>tags</code> \u53c2\u6570\u7684\u503c\u662f\u7531 <code>str</code> \u7ec4\u6210\u7684 <code>list</code> \uff08\u4e00\u822c\u53ea\u6709\u4e00\u4e2a <code>str</code> \uff09\uff0c<code>tags</code> \u7528\u4e8e\u4e3a\u8def\u5f84\u64cd\u4f5c\u6dfb\u52a0\u6807\u7b7e\uff1a</p> <pre><code>from typing import Set, Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n    tags: Set[str] = set()\n\n\n@app.post(\"/items/\", response_model=Item, tags=[\"items\"])\nasync def create_item(item: Item):\n    return item\n\n\n@app.get(\"/items/\", tags=[\"items\"])\nasync def read_items():\n    return [{\"name\": \"Foo\", \"price\": 42}]\n\n\n@app.get(\"/users/\", tags=[\"users\"])\nasync def read_users():\n    return [{\"username\": \"johndoe\"}]\n</code></pre> <p>OpenAPI \u6982\u56fe\u4f1a\u81ea\u52a8\u6dfb\u52a0\u6807\u7b7e\uff0c\u4f9b API \u6587\u6863\u63a5\u53e3\u4f7f\u7528\uff1a</p> <p></p>"},{"location":"tutorial/path-operation-configuration/#summary-description","title":"<code>summary</code> \u548c <code>description</code> \u53c2\u6570","text":"<p>\u8def\u5f84\u88c5\u9970\u5668\u8fd8\u652f\u6301 <code>summary</code> \u548c <code>description</code> \u8fd9\u4e24\u4e2a\u53c2\u6570\uff1a</p> <pre><code>from typing import Set, Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n    tags: Set[str] = set()\n\n\n@app.post(\n    \"/items/\",\n    response_model=Item,\nsummary=\"Create an item\",\ndescription=\"Create an item with all the information, name, description, price, tax and a set of unique tags\",\n)\nasync def create_item(item: Item):\n    return item\n</code></pre>"},{"location":"tutorial/path-operation-configuration/#docstring","title":"\u6587\u6863\u5b57\u7b26\u4e32\uff08<code>docstring</code>\uff09","text":"<p>\u63cf\u8ff0\u5185\u5bb9\u6bd4\u8f83\u957f\u4e14\u5360\u7528\u591a\u884c\u65f6\uff0c\u53ef\u4ee5\u5728\u51fd\u6570\u7684 docstring \u4e2d\u58f0\u660e\u8def\u5f84\u64cd\u4f5c\u7684\u63cf\u8ff0\uff0cFastAPI \u652f\u6301\u4ece\u6587\u6863\u5b57\u7b26\u4e32\u4e2d\u8bfb\u53d6\u63cf\u8ff0\u5185\u5bb9\u3002</p> <p>\u6587\u6863\u5b57\u7b26\u4e32\u652f\u6301 Markdown\uff0c\u80fd\u6b63\u786e\u89e3\u6790\u548c\u663e\u793a Markdown \u7684\u5185\u5bb9\uff0c\u4f46\u8981\u6ce8\u610f\u6587\u6863\u5b57\u7b26\u4e32\u7684\u7f29\u8fdb\u3002</p> <pre><code>from typing import Set, Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n    tags: Set[str] = set()\n\n\n@app.post(\"/items/\", response_model=Item, summary=\"Create an item\")\nasync def create_item(item: Item):\n\"\"\"\n    Create an item with all the information:\n    - **name**: each item must have a name\n    - **description**: a long description\n    - **price**: required\n    - **tax**: if the item doesn't have tax, you can omit this\n    - **tags**: a set of unique tag strings for this item\n    \"\"\"\nreturn item\n</code></pre> <p>\u4e0b\u56fe\u4e3a Markdown \u6587\u672c\u5728 API \u6587\u6863\u4e2d\u7684\u663e\u793a\u6548\u679c\uff1a</p> <p></p>"},{"location":"tutorial/path-operation-configuration/#_2","title":"\u54cd\u5e94\u63cf\u8ff0","text":"<p><code>response_description</code> \u53c2\u6570\u7528\u4e8e\u5b9a\u4e49\u54cd\u5e94\u7684\u63cf\u8ff0\u8bf4\u660e\uff1a</p> <pre><code>from typing import Set, Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n    tags: Set[str] = set()\n\n\n@app.post(\n    \"/items/\",\n    response_model=Item,\n    summary=\"Create an item\",\nresponse_description=\"The created item\",\n)\nasync def create_item(item: Item):\n\"\"\"\n    Create an item with all the information:\n\n    - **name**: each item must have a name\n    - **description**: a long description\n    - **price**: required\n    - **tax**: if the item doesn't have tax, you can omit this\n    - **tags**: a set of unique tag strings for this item\n    \"\"\"\n    return item\n</code></pre> <p>\u8bf4\u660e</p> <p>\u6ce8\u610f\uff0c<code>response_description</code> \u53ea\u7528\u4e8e\u63cf\u8ff0\u54cd\u5e94\uff0c<code>description</code> \u4e00\u822c\u5219\u7528\u4e8e\u63cf\u8ff0\u8def\u5f84\u64cd\u4f5c\u3002</p> <p>\u68c0\u67e5</p> <p>OpenAPI \u89c4\u5b9a\u6bcf\u4e2a\u8def\u5f84\u64cd\u4f5c\u90fd\u8981\u6709\u54cd\u5e94\u63cf\u8ff0\u3002</p> <p>\u5982\u679c\u6ca1\u6709\u5b9a\u4e49\u54cd\u5e94\u63cf\u8ff0\uff0cFastAPI \u5219\u81ea\u52a8\u751f\u6210\u5185\u5bb9\u4e3a \"Successful response\" \u7684\u54cd\u5e94\u63cf\u8ff0\u3002</p> <p></p>"},{"location":"tutorial/path-operation-configuration/#_3","title":"\u5f03\u7528\u8def\u5f84\u64cd\u4f5c","text":"<p><code>deprecated</code> \u53c2\u6570\u53ef\u4ee5\u628a\u8def\u5f84\u64cd\u4f5c\u6807\u8bb0\u4e3a\u5f03\u7528\uff0c\u65e0\u9700\u76f4\u63a5\u5220\u9664\uff1a</p> <pre><code>from fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/items/\", tags=[\"items\"])\nasync def read_items():\n    return [{\"name\": \"Foo\", \"price\": 42}]\n\n\n@app.get(\"/users/\", tags=[\"users\"])\nasync def read_users():\n    return [{\"username\": \"johndoe\"}]\n\n\n@app.get(\"/elements/\", tags=[\"items\"], deprecated=True)\nasync def read_elements():\n    return [{\"item_id\": \"Foo\"}]\n</code></pre> <p>API \u6587\u6863\u4f1a\u628a\u8be5\u8def\u5f84\u64cd\u4f5c\u6807\u8bb0\u4e3a\u5f03\u7528\uff1a</p> <p></p> <p>\u4e0b\u56fe\u663e\u793a\u4e86\u6b63\u5e38\u8def\u5f84\u64cd\u4f5c\u4e0e\u5f03\u7528\u8def\u5f84\u64cd\u4f5c \u7684\u533a\u522b\uff1a</p> <p></p>"},{"location":"tutorial/path-operation-configuration/#_4","title":"\u5c0f\u7ed3","text":"<p>\u901a\u8fc7\u4f20\u9012\u53c2\u6570\u7ed9\u8def\u5f84\u64cd\u4f5c\u88c5\u9970\u5668 \uff0c\u5373\u53ef\u8f7b\u677e\u5730\u914d\u7f6e\u8def\u5f84\u64cd\u4f5c\u3001\u6dfb\u52a0\u5143\u6570\u636e\u3002</p>"},{"location":"tutorial/path-params-numeric-validations/","title":"\u8def\u5f84\u53c2\u6570\u548c\u6570\u503c\u6821\u9a8c","text":"<p>\u4e0e\u4f7f\u7528 <code>Query</code> \u4e3a\u67e5\u8be2\u53c2\u6570\u58f0\u660e\u66f4\u591a\u7684\u6821\u9a8c\u548c\u5143\u6570\u636e\u7684\u65b9\u5f0f\u76f8\u540c\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 <code>Path</code> \u4e3a\u8def\u5f84\u53c2\u6570\u58f0\u660e\u76f8\u540c\u7c7b\u578b\u7684\u6821\u9a8c\u548c\u5143\u6570\u636e\u3002</p>"},{"location":"tutorial/path-params-numeric-validations/#path","title":"\u5bfc\u5165 Path","text":"<p>\u9996\u5148\uff0c\u4ece <code>fastapi</code> \u5bfc\u5165 <code>Path</code>\uff1a</p> <pre><code>from typing import Union\nfrom fastapi import FastAPI, Path, Query\n\napp = FastAPI()\n\n\n@app.get(\"/items/{item_id}\")\nasync def read_items(\n    item_id: int = Path(title=\"The ID of the item to get\"),\n    q: Union[str, None] = Query(default=None, alias=\"item-query\"),\n):\n    results = {\"item_id\": item_id}\n    if q:\n        results.update({\"q\": q})\n    return results\n</code></pre>"},{"location":"tutorial/path-params-numeric-validations/#_2","title":"\u58f0\u660e\u5143\u6570\u636e","text":"<p>\u4f60\u53ef\u4ee5\u58f0\u660e\u4e0e <code>Query</code> \u76f8\u540c\u7684\u6240\u6709\u53c2\u6570\u3002</p> <p>\u4f8b\u5982\uff0c\u8981\u58f0\u660e\u8def\u5f84\u53c2\u6570 <code>item_id</code>\u7684 <code>title</code> \u5143\u6570\u636e\u503c\uff0c\u4f60\u53ef\u4ee5\u8f93\u5165\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI, Path, Query\n\napp = FastAPI()\n\n\n@app.get(\"/items/{item_id}\")\nasync def read_items(\n    item_id: int = Path(title=\"The ID of the item to get\"),\n    q: Union[str, None] = Query(default=None, alias=\"item-query\"),\n):\n    results = {\"item_id\": item_id}\n    if q:\n        results.update({\"q\": q})\n    return results\n</code></pre> <p>Note</p> <p>\u8def\u5f84\u53c2\u6570\u603b\u662f\u5fc5\u9700\u7684\uff0c\u56e0\u4e3a\u5b83\u5fc5\u987b\u662f\u8def\u5f84\u7684\u4e00\u90e8\u5206\u3002</p> <p>\u6240\u4ee5\uff0c\u4f60\u5e94\u8be5\u5728\u58f0\u660e\u65f6\u4f7f\u7528 <code>...</code> \u5c06\u5176\u6807\u8bb0\u4e3a\u5fc5\u9700\u53c2\u6570\u3002</p> <p>\u7136\u800c\uff0c\u5373\u4f7f\u4f60\u4f7f\u7528 <code>None</code> \u58f0\u660e\u8def\u5f84\u53c2\u6570\u6216\u8bbe\u7f6e\u4e00\u4e2a\u5176\u4ed6\u9ed8\u8ba4\u503c\u4e5f\u4e0d\u4f1a\u6709\u4efb\u4f55\u5f71\u54cd\uff0c\u5b83\u4f9d\u7136\u4f1a\u662f\u5fc5\u9700\u53c2\u6570\u3002</p>"},{"location":"tutorial/path-params-numeric-validations/#_3","title":"\u6309\u9700\u5bf9\u53c2\u6570\u6392\u5e8f","text":"<p>\u5047\u8bbe\u4f60\u60f3\u8981\u58f0\u660e\u4e00\u4e2a\u5fc5\u9700\u7684 <code>str</code> \u7c7b\u578b\u67e5\u8be2\u53c2\u6570 <code>q</code>\u3002</p> <p>\u800c\u4e14\u4f60\u4e0d\u9700\u8981\u4e3a\u8be5\u53c2\u6570\u58f0\u660e\u4efb\u4f55\u5176\u4ed6\u5185\u5bb9\uff0c\u6240\u4ee5\u5b9e\u9645\u4e0a\u4f60\u5e76\u4e0d\u9700\u8981\u4f7f\u7528 <code>Query</code>\u3002</p> <p>\u4f46\u662f\u4f60\u4ecd\u7136\u9700\u8981\u4f7f\u7528 <code>Path</code> \u6765\u58f0\u660e\u8def\u5f84\u53c2\u6570 <code>item_id</code>\u3002</p> <p>\u5982\u679c\u4f60\u5c06\u5e26\u6709\u300c\u9ed8\u8ba4\u503c\u300d\u7684\u53c2\u6570\u653e\u5728\u6ca1\u6709\u300c\u9ed8\u8ba4\u503c\u300d\u7684\u53c2\u6570\u4e4b\u524d\uff0cPython \u5c06\u4f1a\u62a5\u9519\u3002</p> <p>\u4f46\u662f\u4f60\u53ef\u4ee5\u5bf9\u5176\u91cd\u65b0\u6392\u5e8f\uff0c\u5e76\u5c06\u4e0d\u5e26\u9ed8\u8ba4\u503c\u7684\u503c\uff08\u67e5\u8be2\u53c2\u6570 <code>q</code>\uff09\u653e\u5230\u6700\u524d\u9762\u3002</p> <p>\u5bf9 FastAPI \u6765\u8bf4\u8fd9\u65e0\u5173\u7d27\u8981\u3002\u5b83\u5c06\u901a\u8fc7\u53c2\u6570\u7684\u540d\u79f0\u3001\u7c7b\u578b\u548c\u9ed8\u8ba4\u503c\u58f0\u660e\uff08<code>Query</code>\u3001<code>Path</code> \u7b49\uff09\u6765\u68c0\u6d4b\u53c2\u6570\uff0c\u800c\u4e0d\u5728\u4e4e\u53c2\u6570\u7684\u987a\u5e8f\u3002</p> <p>\u56e0\u6b64\uff0c\u4f60\u53ef\u4ee5\u5c06\u51fd\u6570\u58f0\u660e\u4e3a\uff1a</p> <pre><code>from fastapi import FastAPI, Path\n\napp = FastAPI()\n\n\n@app.get(\"/items/{item_id}\")\nasync def read_items(q: str, item_id: int = Path(title=\"The ID of the item to get\")):\nresults = {\"item_id\": item_id}\n    if q:\n        results.update({\"q\": q})\n    return results\n</code></pre>"},{"location":"tutorial/path-params-numeric-validations/#_4","title":"\u6309\u9700\u5bf9\u53c2\u6570\u6392\u5e8f\u7684\u6280\u5de7","text":"<p>\u5982\u679c\u4f60\u60f3\u4e0d\u4f7f\u7528 <code>Query</code> \u58f0\u660e\u6ca1\u6709\u9ed8\u8ba4\u503c\u7684\u67e5\u8be2\u53c2\u6570 <code>q</code>\uff0c\u540c\u65f6\u4f7f\u7528 <code>Path</code> \u58f0\u660e\u8def\u5f84\u53c2\u6570 <code>item_id</code>\uff0c\u5e76\u4f7f\u5b83\u4eec\u7684\u987a\u5e8f\u4e0e\u4e0a\u9762\u4e0d\u540c\uff0cPython \u5bf9\u6b64\u6709\u4e00\u4e9b\u7279\u6b8a\u7684\u8bed\u6cd5\u3002</p> <p>\u4f20\u9012 <code>*</code> \u4f5c\u4e3a\u51fd\u6570\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u3002</p> <p>Python \u4e0d\u4f1a\u5bf9\u8be5 <code>*</code> \u505a\u4efb\u4f55\u4e8b\u60c5\uff0c\u4f46\u662f\u5b83\u5c06\u77e5\u9053\u4e4b\u540e\u7684\u6240\u6709\u53c2\u6570\u90fd\u5e94\u4f5c\u4e3a\u5173\u952e\u5b57\u53c2\u6570\uff08\u952e\u503c\u5bf9\uff09\uff0c\u4e5f\u88ab\u79f0\u4e3a <code>kwargs</code>\uff0c\u6765\u8c03\u7528\u3002\u5373\u4f7f\u5b83\u4eec\u6ca1\u6709\u9ed8\u8ba4\u503c\u3002</p> <pre><code>from fastapi import FastAPI, Path\n\napp = FastAPI()\n\n\n@app.get(\"/items/{item_id}\")\nasync def read_items(*, item_id: int = Path(title=\"The ID of the item to get\"), q: str):\nresults = {\"item_id\": item_id}\n    if q:\n        results.update({\"q\": q})\n    return results\n</code></pre>"},{"location":"tutorial/path-params-numeric-validations/#_5","title":"\u6570\u503c\u6821\u9a8c\uff1a\u5927\u4e8e\u7b49\u4e8e","text":"<p>\u4f7f\u7528 <code>Query</code> \u548c <code>Path</code>\uff08\u4ee5\u53ca\u4f60\u5c06\u5728\u540e\u9762\u770b\u5230\u7684\u5176\u4ed6\u7c7b\uff09\u53ef\u4ee5\u58f0\u660e\u5b57\u7b26\u4e32\u7ea6\u675f\uff0c\u4f46\u4e5f\u53ef\u4ee5\u58f0\u660e\u6570\u503c\u7ea6\u675f\u3002</p> <p>\u50cf\u4e0b\u9762\u8fd9\u6837\uff0c\u6dfb\u52a0 <code>ge=1</code> \u540e\uff0c<code>item_id</code> \u5c06\u5fc5\u987b\u662f\u4e00\u4e2a\u5927\u4e8e\uff08<code>g</code>reater than\uff09\u6216\u7b49\u4e8e\uff08<code>e</code>qual\uff09<code>1</code> \u7684\u6574\u6570\u3002</p> <pre><code>from fastapi import FastAPI, Path\n\napp = FastAPI()\n\n\n@app.get(\"/items/{item_id}\")\nasync def read_items(\n*, item_id: int = Path(title=\"The ID of the item to get\", ge=1), q: str\n):\n    results = {\"item_id\": item_id}\n    if q:\n        results.update({\"q\": q})\n    return results\n</code></pre>"},{"location":"tutorial/path-params-numeric-validations/#_6","title":"\u6570\u503c\u6821\u9a8c\uff1a\u5927\u4e8e\u548c\u5c0f\u4e8e\u7b49\u4e8e","text":"<p>\u540c\u6837\u7684\u89c4\u5219\u9002\u7528\u4e8e\uff1a</p> <ul> <li><code>gt</code>\uff1a\u5927\u4e8e\uff08<code>g</code>reater <code>t</code>han\uff09</li> <li><code>le</code>\uff1a\u5c0f\u4e8e\u7b49\u4e8e\uff08<code>l</code>ess than or <code>e</code>qual\uff09</li> </ul> <pre><code>from fastapi import FastAPI, Path\n\napp = FastAPI()\n\n\n@app.get(\"/items/{item_id}\")\nasync def read_items(\n    *,\nitem_id: int = Path(title=\"The ID of the item to get\", gt=0, le=1000),\nq: str,\n):\n    results = {\"item_id\": item_id}\n    if q:\n        results.update({\"q\": q})\n    return results\n</code></pre>"},{"location":"tutorial/path-params-numeric-validations/#_7","title":"\u6570\u503c\u6821\u9a8c\uff1a\u6d6e\u70b9\u6570\u3001\u5927\u4e8e\u548c\u5c0f\u4e8e","text":"<p>\u6570\u503c\u6821\u9a8c\u540c\u6837\u9002\u7528\u4e8e <code>float</code> \u503c\u3002</p> <p>\u80fd\u591f\u58f0\u660e <code>gt</code> \u800c\u4e0d\u4ec5\u4ec5\u662f <code>ge</code> \u5728\u8fd9\u4e2a\u524d\u63d0\u4e0b\u53d8\u5f97\u91cd\u8981\u8d77\u6765\u3002\u4f8b\u5982\uff0c\u4f60\u53ef\u4ee5\u8981\u6c42\u4e00\u4e2a\u503c\u5fc5\u987b\u5927\u4e8e <code>0</code>\uff0c\u5373\u4f7f\u5b83\u5c0f\u4e8e <code>1</code>\u3002</p> <p>\u56e0\u6b64\uff0c<code>0.5</code> \u5c06\u662f\u6709\u6548\u503c\u3002\u4f46\u662f <code>0.0</code>\u6216 <code>0</code> \u4e0d\u662f\u3002</p> <p>\u5bf9\u4e8e <code>lt</code> \u4e5f\u662f\u4e00\u6837\u7684\u3002</p> <pre><code>from fastapi import FastAPI, Path, Query\n\napp = FastAPI()\n\n\n@app.get(\"/items/{item_id}\")\nasync def read_items(\n    *,\n    item_id: int = Path(title=\"The ID of the item to get\", ge=0, le=1000),\n    q: str,\nsize: float = Query(gt=0, lt=10.5),\n):\n    results = {\"item_id\": item_id}\n    if q:\n        results.update({\"q\": q})\n    return results\n</code></pre>"},{"location":"tutorial/path-params-numeric-validations/#_8","title":"\u603b\u7ed3","text":"<p>\u4f60\u80fd\u591f\u4ee5\u4e0e \u67e5\u8be2\u53c2\u6570\u548c\u5b57\u7b26\u4e32\u6821\u9a8c \u76f8\u540c\u7684\u65b9\u5f0f\u4f7f\u7528 <code>Query</code>\u3001<code>Path</code>\uff08\u4ee5\u53ca\u5176\u4ed6\u4f60\u8fd8\u6ca1\u89c1\u8fc7\u7684\u7c7b\uff09\u58f0\u660e\u5143\u6570\u636e\u548c\u5b57\u7b26\u4e32\u6821\u9a8c\u3002</p> <p>\u800c\u4e14\u4f60\u8fd8\u53ef\u4ee5\u58f0\u660e\u6570\u503c\u6821\u9a8c\uff1a</p> <ul> <li><code>gt</code>\uff1a\u5927\u4e8e\uff08<code>g</code>reater <code>t</code>han\uff09</li> <li><code>ge</code>\uff1a\u5927\u4e8e\u7b49\u4e8e\uff08<code>g</code>reater than or <code>e</code>qual\uff09</li> <li><code>lt</code>\uff1a\u5c0f\u4e8e\uff08<code>l</code>ess <code>t</code>han\uff09</li> <li><code>le</code>\uff1a\u5c0f\u4e8e\u7b49\u4e8e\uff08<code>l</code>ess than or <code>e</code>qual\uff09</li> </ul> <p>Info</p> <p><code>Query</code>\u3001<code>Path</code> \u4ee5\u53ca\u4f60\u540e\u9762\u4f1a\u770b\u5230\u7684\u5176\u4ed6\u7c7b\u7ee7\u627f\u81ea\u4e00\u4e2a\u5171\u540c\u7684 <code>Param</code> \u7c7b\uff08\u4e0d\u9700\u8981\u76f4\u63a5\u4f7f\u7528\u5b83\uff09\u3002</p> <p>\u800c\u4e14\u5b83\u4eec\u90fd\u5171\u4eab\u76f8\u540c\u7684\u6240\u6709\u4f60\u5df2\u770b\u5230\u5e76\u7528\u4e8e\u6dfb\u52a0\u989d\u5916\u6821\u9a8c\u548c\u5143\u6570\u636e\u7684\u53c2\u6570\u3002</p> <p>\u6280\u672f\u7ec6\u8282</p> <p>\u5f53\u4f60\u4ece <code>fastapi</code> \u5bfc\u5165 <code>Query</code>\u3001<code>Path</code> \u548c\u5176\u4ed6\u540c\u7c7b\u5bf9\u8c61\u65f6\uff0c\u5b83\u4eec\u5b9e\u9645\u4e0a\u662f\u51fd\u6570\u3002</p> <p>\u5f53\u88ab\u8c03\u7528\u65f6\uff0c\u5b83\u4eec\u8fd4\u56de\u540c\u540d\u7c7b\u7684\u5b9e\u4f8b\u3002</p> <p>\u5982\u6b64\uff0c\u4f60\u5bfc\u5165 <code>Query</code> \u8fd9\u4e2a\u51fd\u6570\u3002\u5f53\u4f60\u8c03\u7528\u5b83\u65f6\uff0c\u5b83\u5c06\u8fd4\u56de\u4e00\u4e2a\u540c\u6837\u547d\u540d\u4e3a <code>Query</code> \u7684\u7c7b\u7684\u5b9e\u4f8b\u3002</p> <p>\u56e0\u4e3a\u4f7f\u7528\u4e86\u8fd9\u4e9b\u51fd\u6570\uff08\u800c\u4e0d\u662f\u76f4\u63a5\u4f7f\u7528\u7c7b\uff09\uff0c\u6240\u4ee5\u4f60\u7684\u7f16\u8f91\u5668\u4e0d\u4f1a\u6807\u8bb0\u6709\u5173\u5176\u7c7b\u578b\u7684\u9519\u8bef\u3002</p> <p>\u8fd9\u6837\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u5e38\u89c4\u7684\u7f16\u8f91\u5668\u548c\u7f16\u7801\u5de5\u5177\uff0c\u800c\u4e0d\u5fc5\u6dfb\u52a0\u81ea\u5b9a\u4e49\u914d\u7f6e\u6765\u5ffd\u7565\u8fd9\u4e9b\u9519\u8bef\u3002</p>"},{"location":"tutorial/path-params/","title":"\u8def\u5f84\u53c2\u6570","text":"<p>\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e0e Python \u683c\u5f0f\u5316\u5b57\u7b26\u4e32\u76f8\u540c\u7684\u8bed\u6cd5\u6765\u58f0\u660e\u8def\u5f84\"\u53c2\u6570\"\u6216\"\u53d8\u91cf\"\uff1a</p> <pre><code>from fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/items/{item_id}\")\nasync def read_item(item_id):\nreturn {\"item_id\": item_id}\n</code></pre> <p>\u8def\u5f84\u53c2\u6570 <code>item_id</code> \u7684\u503c\u5c06\u4f5c\u4e3a\u53c2\u6570 <code>item_id</code> \u4f20\u9012\u7ed9\u4f60\u7684\u51fd\u6570\u3002</p> <p>\u6240\u4ee5\uff0c\u5982\u679c\u4f60\u8fd0\u884c\u793a\u4f8b\u5e76\u8bbf\u95ee http://127.0.0.1:8000/items/foo\uff0c\u5c06\u4f1a\u770b\u5230\u5982\u4e0b\u54cd\u5e94\uff1a</p> <pre><code>{\"item_id\":\"foo\"}\n</code></pre>"},{"location":"tutorial/path-params/#_2","title":"\u6709\u7c7b\u578b\u7684\u8def\u5f84\u53c2\u6570","text":"<p>\u4f60\u53ef\u4ee5\u4f7f\u7528\u6807\u51c6\u7684 Python \u7c7b\u578b\u6807\u6ce8\u4e3a\u51fd\u6570\u4e2d\u7684\u8def\u5f84\u53c2\u6570\u58f0\u660e\u7c7b\u578b\u3002</p> <pre><code>from fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/items/{item_id}\")\nasync def read_item(item_id: int):\nreturn {\"item_id\": item_id}\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c<code>item_id</code> \u88ab\u58f0\u660e\u4e3a <code>int</code> \u7c7b\u578b\u3002</p> <p>Check</p> <p>\u8fd9\u5c06\u4e3a\u4f60\u7684\u51fd\u6570\u63d0\u4f9b\u7f16\u8f91\u5668\u652f\u6301\uff0c\u5305\u62ec\u9519\u8bef\u68c0\u67e5\u3001\u4ee3\u7801\u8865\u5168\u7b49\u7b49\u3002</p>"},{"location":"tutorial/path-params/#_3","title":"\u6570\u636e\u8f6c\u6362","text":"<p>\u5982\u679c\u4f60\u8fd0\u884c\u793a\u4f8b\u5e76\u6253\u5f00\u6d4f\u89c8\u5668\u8bbf\u95ee http://127.0.0.1:8000/items/3\uff0c\u5c06\u5f97\u5230\u5982\u4e0b\u54cd\u5e94\uff1a</p> <pre><code>{\"item_id\":3}\n</code></pre> <p>Check</p> <p>\u6ce8\u610f\u51fd\u6570\u63a5\u6536\uff08\u5e76\u8fd4\u56de\uff09\u7684\u503c\u4e3a 3\uff0c\u662f\u4e00\u4e2a Python <code>int</code> \u503c\uff0c\u800c\u4e0d\u662f\u5b57\u7b26\u4e32 <code>\"3\"</code>\u3002</p> <p>\u6240\u4ee5\uff0cFastAPI \u901a\u8fc7\u4e0a\u9762\u7684\u7c7b\u578b\u58f0\u660e\u63d0\u4f9b\u4e86\u5bf9\u8bf7\u6c42\u7684\u81ea\u52a8\"\u89e3\u6790\"\u3002</p>"},{"location":"tutorial/path-params/#_4","title":"\u6570\u636e\u6821\u9a8c","text":"<p>\u4f46\u5982\u679c\u4f60\u901a\u8fc7\u6d4f\u89c8\u5668\u8bbf\u95ee http://127.0.0.1:8000/items/foo\uff0c\u4f60\u4f1a\u770b\u5230\u4e00\u4e2a\u6e05\u6670\u53ef\u8bfb\u7684 HTTP \u9519\u8bef\uff1a</p> <pre><code>{\n\"detail\": [\n{\n\"loc\": [\n\"path\",\n\"item_id\"\n],\n\"msg\": \"value is not a valid integer\",\n\"type\": \"type_error.integer\"\n}\n]\n}\n</code></pre> <p>\u56e0\u4e3a\u8def\u5f84\u53c2\u6570 <code>item_id</code> \u4f20\u5165\u7684\u503c\u4e3a <code>\"foo\"</code>\uff0c\u5b83\u4e0d\u662f\u4e00\u4e2a <code>int</code>\u3002</p> <p>\u5982\u679c\u4f60\u63d0\u4f9b\u7684\u662f <code>float</code> \u800c\u975e\u6574\u6570\u4e5f\u4f1a\u51fa\u73b0\u540c\u6837\u7684\u9519\u8bef\uff0c\u6bd4\u5982\uff1a http://127.0.0.1:8000/items/4.2</p> <p>Check</p> <p>\u6240\u4ee5\uff0c\u901a\u8fc7\u540c\u6837\u7684 Python \u7c7b\u578b\u58f0\u660e\uff0cFastAPI \u63d0\u4f9b\u4e86\u6570\u636e\u6821\u9a8c\u529f\u80fd\u3002</p> <p>\u6ce8\u610f\u4e0a\u9762\u7684\u9519\u8bef\u540c\u6837\u6e05\u695a\u5730\u6307\u51fa\u4e86\u6821\u9a8c\u672a\u901a\u8fc7\u7684\u5177\u4f53\u539f\u56e0\u3002</p> <p>\u5728\u5f00\u53d1\u548c\u8c03\u8bd5\u4e0e\u4f60\u7684 API \u8fdb\u884c\u4ea4\u4e92\u7684\u4ee3\u7801\u65f6\uff0c\u8fd9\u975e\u5e38\u6709\u7528\u3002</p>"},{"location":"tutorial/path-params/#_5","title":"\u6587\u6863","text":"<p>\u5f53\u4f60\u6253\u5f00\u6d4f\u89c8\u5668\u8bbf\u95ee http://127.0.0.1:8000/docs\uff0c\u4f60\u5c06\u770b\u5230\u81ea\u52a8\u751f\u6210\u7684\u4ea4\u4e92\u5f0f API \u6587\u6863\uff1a</p> <p></p> <p>Check</p> <p>\u518d\u4e00\u6b21\uff0c\u8fd8\u662f\u901a\u8fc7\u76f8\u540c\u7684 Python \u7c7b\u578b\u58f0\u660e\uff0cFastAPI \u4e3a\u4f60\u63d0\u4f9b\u4e86\u81ea\u52a8\u751f\u6210\u7684\u4ea4\u4e92\u5f0f\u6587\u6863\uff08\u96c6\u6210 Swagger UI\uff09\u3002</p> <p>\u6ce8\u610f\u8fd9\u91cc\u7684\u8def\u5f84\u53c2\u6570\u88ab\u58f0\u660e\u4e3a\u4e00\u4e2a\u6574\u6570\u3002</p>"},{"location":"tutorial/path-params/#_6","title":"\u57fa\u4e8e\u6807\u51c6\u7684\u597d\u5904\uff1a\u53ef\u9009\u6587\u6863","text":"<p>\u7531\u4e8e\u751f\u6210\u7684 API \u6a21\u5f0f\u6765\u81ea\u4e8e OpenAPI \u6807\u51c6\uff0c\u6240\u4ee5\u6709\u5f88\u591a\u5de5\u5177\u4e0e\u5176\u517c\u5bb9\u3002</p> <p>\u6b63\u56e0\u5982\u6b64\uff0cFastAPI \u5185\u7f6e\u4e86\u4e00\u4e2a\u53ef\u9009\u7684 API \u6587\u6863\uff08\u4f7f\u7528 Redoc\uff09\uff1a</p> <p></p> <p>\u540c\u6837\u7684\uff0c\u8fd8\u6709\u5f88\u591a\u5176\u4ed6\u517c\u5bb9\u7684\u5de5\u5177\uff0c\u5305\u62ec\u9002\u7528\u4e8e\u591a\u79cd\u8bed\u8a00\u7684\u4ee3\u7801\u751f\u6210\u5de5\u5177\u3002</p>"},{"location":"tutorial/path-params/#pydantic","title":"Pydantic","text":"<p>\u6240\u6709\u7684\u6570\u636e\u6821\u9a8c\u90fd\u7531 Pydantic \u5728\u5e55\u540e\u5b8c\u6210\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u4ece\u5b83\u6240\u6709\u7684\u4f18\u70b9\u4e2d\u53d7\u76ca\u3002\u5e76\u4e14\u4f60\u77e5\u9053\u5b83\u5728\u8fd9\u65b9\u9762\u975e\u5e38\u80dc\u4efb\u3002</p> <p>\u4f60\u53ef\u4ee5\u4f7f\u7528\u540c\u6837\u7684\u7c7b\u578b\u58f0\u660e\u6765\u58f0\u660e <code>str</code>\u3001<code>float</code>\u3001<code>bool</code> \u4ee5\u53ca\u8bb8\u591a\u5176\u4ed6\u7684\u590d\u5408\u6570\u636e\u7c7b\u578b\u3002</p> <p>\u672c\u6559\u7a0b\u7684\u4e0b\u4e00\u7ae0\u8282\u5c06\u63a2\u8ba8\u5176\u4e2d\u7684\u4e00\u4e9b\u5185\u5bb9\u3002</p>"},{"location":"tutorial/path-params/#_7","title":"\u987a\u5e8f\u5f88\u91cd\u8981","text":"<p>\u5728\u521b\u5efa\u8def\u5f84\u64cd\u4f5c\u65f6\uff0c\u4f60\u4f1a\u53d1\u73b0\u6709\u4e9b\u60c5\u51b5\u4e0b\u8def\u5f84\u662f\u56fa\u5b9a\u7684\u3002</p> <p>\u6bd4\u5982 <code>/users/me</code>\uff0c\u6211\u4eec\u5047\u8bbe\u5b83\u7528\u6765\u83b7\u53d6\u5173\u4e8e\u5f53\u524d\u7528\u6237\u7684\u6570\u636e.</p> <p>\u7136\u540e\uff0c\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528\u8def\u5f84 <code>/users/{user_id}</code> \u6765\u901a\u8fc7\u7528\u6237 ID \u83b7\u53d6\u5173\u4e8e\u7279\u5b9a\u7528\u6237\u7684\u6570\u636e\u3002</p> <p>\u7531\u4e8e\u8def\u5f84\u64cd\u4f5c\u662f\u6309\u987a\u5e8f\u4f9d\u6b21\u8fd0\u884c\u7684\uff0c\u4f60\u9700\u8981\u786e\u4fdd\u8def\u5f84 <code>/users/me</code> \u58f0\u660e\u5728\u8def\u5f84 <code>/users/{user_id}</code>\u4e4b\u524d\uff1a <pre><code>from fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/users/me\")\nasync def read_user_me():\n    return {\"user_id\": \"the current user\"}\n\n\n@app.get(\"/users/{user_id}\")\nasync def read_user(user_id: str):\n    return {\"user_id\": user_id}\n</code></pre></p> <p>\u5426\u5219\uff0c<code>/users/{user_id}</code> \u7684\u8def\u5f84\u8fd8\u5c06\u4e0e <code>/users/me</code> \u76f8\u5339\u914d\uff0c\"\u8ba4\u4e3a\"\u81ea\u5df1\u6b63\u5728\u63a5\u6536\u4e00\u4e2a\u503c\u4e3a <code>\"me\"</code> \u7684 <code>user_id</code> \u53c2\u6570\u3002</p>"},{"location":"tutorial/path-params/#_8","title":"\u9884\u8bbe\u503c","text":"<p>\u5982\u679c\u4f60\u6709\u4e00\u4e2a\u63a5\u6536\u8def\u5f84\u53c2\u6570\u7684\u8def\u5f84\u64cd\u4f5c\uff0c\u4f46\u4f60\u5e0c\u671b\u9884\u5148\u8bbe\u5b9a\u53ef\u80fd\u7684\u6709\u6548\u53c2\u6570\u503c\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u6807\u51c6\u7684 Python <code>Enum</code> \u7c7b\u578b\u3002</p>"},{"location":"tutorial/path-params/#enum","title":"\u521b\u5efa\u4e00\u4e2a <code>Enum</code> \u7c7b","text":"<p>\u5bfc\u5165 <code>Enum</code> \u5e76\u521b\u5efa\u4e00\u4e2a\u7ee7\u627f\u81ea <code>str</code> \u548c <code>Enum</code> \u7684\u5b50\u7c7b\u3002</p> <p>\u901a\u8fc7\u4ece <code>str</code> \u7ee7\u627f\uff0cAPI \u6587\u6863\u5c06\u80fd\u591f\u77e5\u9053\u8fd9\u4e9b\u503c\u5fc5\u987b\u4e3a <code>string</code> \u7c7b\u578b\u5e76\u4e14\u80fd\u591f\u6b63\u786e\u5730\u5c55\u793a\u51fa\u6765\u3002</p> <p>\u7136\u540e\u521b\u5efa\u5177\u6709\u56fa\u5b9a\u503c\u7684\u7c7b\u5c5e\u6027\uff0c\u8fd9\u4e9b\u56fa\u5b9a\u503c\u5c06\u662f\u53ef\u7528\u7684\u6709\u6548\u503c\uff1a</p> <pre><code>from enum import Enum\nfrom fastapi import FastAPI\n\n\nclass ModelName(str, Enum):\nalexnet = \"alexnet\"\nresnet = \"resnet\"\nlenet = \"lenet\"\napp = FastAPI()\n\n\n@app.get(\"/models/{model_name}\")\nasync def get_model(model_name: ModelName):\n    if model_name is ModelName.alexnet:\n        return {\"model_name\": model_name, \"message\": \"Deep Learning FTW!\"}\n\n    if model_name.value == \"lenet\":\n        return {\"model_name\": model_name, \"message\": \"LeCNN all the images\"}\n\n    return {\"model_name\": model_name, \"message\": \"Have some residuals\"}\n</code></pre> <p>Info</p> <p>\u679a\u4e3e\uff08\u6216 enums\uff09\u4ece 3.4 \u7248\u672c\u8d77\u5728 Python \u4e2d\u53ef\u7528\u3002</p> <p>Tip</p> <p>\u5982\u679c\u4f60\u60f3\u77e5\u9053\uff0c\"AlexNet\"\u3001\"ResNet\" \u548c \"LeNet\" \u53ea\u662f\u673a\u5668\u5b66\u4e60\u4e2d\u7684\u6a21\u578b\u540d\u79f0\u3002</p>"},{"location":"tutorial/path-params/#_9","title":"\u58f0\u660e\u8def\u5f84\u53c2\u6570","text":"<p>\u7136\u540e\u4f7f\u7528\u4f60\u5b9a\u4e49\u7684\u679a\u4e3e\u7c7b\uff08<code>ModelName</code>\uff09\u521b\u5efa\u4e00\u4e2a\u5e26\u6709\u7c7b\u578b\u6807\u6ce8\u7684\u8def\u5f84\u53c2\u6570\uff1a</p> <pre><code>from enum import Enum\n\nfrom fastapi import FastAPI\n\n\nclass ModelName(str, Enum):\n    alexnet = \"alexnet\"\n    resnet = \"resnet\"\n    lenet = \"lenet\"\n\n\napp = FastAPI()\n\n\n@app.get(\"/models/{model_name}\")\nasync def get_model(model_name: ModelName):\nif model_name is ModelName.alexnet:\n        return {\"model_name\": model_name, \"message\": \"Deep Learning FTW!\"}\n\n    if model_name.value == \"lenet\":\n        return {\"model_name\": model_name, \"message\": \"LeCNN all the images\"}\n\n    return {\"model_name\": model_name, \"message\": \"Have some residuals\"}\n</code></pre>"},{"location":"tutorial/path-params/#_10","title":"\u67e5\u770b\u6587\u6863","text":"<p>\u56e0\u4e3a\u5df2\u7ecf\u6307\u5b9a\u4e86\u8def\u5f84\u53c2\u6570\u7684\u53ef\u7528\u503c\uff0c\u6240\u4ee5\u4ea4\u4e92\u5f0f\u6587\u6863\u53ef\u4ee5\u6070\u5f53\u5730\u5c55\u793a\u5b83\u4eec\uff1a</p> <p></p>"},{"location":"tutorial/path-params/#python","title":"\u4f7f\u7528 Python \u679a\u4e3e\u7c7b\u578b","text":"<p>\u8def\u5f84\u53c2\u6570\u7684\u503c\u5c06\u662f\u4e00\u4e2a\u679a\u4e3e\u6210\u5458\u3002</p>"},{"location":"tutorial/path-params/#_11","title":"\u6bd4\u8f83\u679a\u4e3e\u6210\u5458","text":"<p>\u4f60\u53ef\u4ee5\u5c06\u5b83\u4e0e\u4f60\u521b\u5efa\u7684\u679a\u4e3e\u7c7b <code>ModelName</code> \u4e2d\u7684\u679a\u4e3e\u6210\u5458\u8fdb\u884c\u6bd4\u8f83\uff1a</p> <pre><code>from enum import Enum\n\nfrom fastapi import FastAPI\n\n\nclass ModelName(str, Enum):\n    alexnet = \"alexnet\"\n    resnet = \"resnet\"\n    lenet = \"lenet\"\n\n\napp = FastAPI()\n\n\n@app.get(\"/models/{model_name}\")\nasync def get_model(model_name: ModelName):\nif model_name is ModelName.alexnet:\nreturn {\"model_name\": model_name, \"message\": \"Deep Learning FTW!\"}\n\n    if model_name.value == \"lenet\":\n        return {\"model_name\": model_name, \"message\": \"LeCNN all the images\"}\n\n    return {\"model_name\": model_name, \"message\": \"Have some residuals\"}\n</code></pre>"},{"location":"tutorial/path-params/#_12","title":"\u83b7\u53d6\u679a\u4e3e\u503c","text":"<p>\u4f60\u53ef\u4ee5\u4f7f\u7528 <code>model_name.value</code> \u6216\u901a\u5e38\u6765\u8bf4 <code>your_enum_member.value</code> \u6765\u83b7\u53d6\u5b9e\u9645\u7684\u503c\uff08\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u4e3a <code>str</code>\uff09\uff1a</p> <pre><code>from enum import Enum\n\nfrom fastapi import FastAPI\n\n\nclass ModelName(str, Enum):\n    alexnet = \"alexnet\"\n    resnet = \"resnet\"\n    lenet = \"lenet\"\n\n\napp = FastAPI()\n\n\n@app.get(\"/models/{model_name}\")\nasync def get_model(model_name: ModelName):\n    if model_name is ModelName.alexnet:\n        return {\"model_name\": model_name, \"message\": \"Deep Learning FTW!\"}\nif model_name.value == \"lenet\":\n        return {\"model_name\": model_name, \"message\": \"LeCNN all the images\"}\n\n    return {\"model_name\": model_name, \"message\": \"Have some residuals\"}\n</code></pre> <p>Tip</p> <p>\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>ModelName.lenet.value</code> \u6765\u83b7\u53d6\u503c <code>\"lenet\"</code>\u3002</p>"},{"location":"tutorial/path-params/#_13","title":"\u8fd4\u56de\u679a\u4e3e\u6210\u5458","text":"<p>\u4f60\u53ef\u4ee5\u4ece\u8def\u5f84\u64cd\u4f5c\u4e2d\u8fd4\u56de\u679a\u4e3e\u6210\u5458\uff0c\u5373\u4f7f\u5d4c\u5957\u5728 JSON \u7ed3\u6784\u4e2d\uff08\u4f8b\u5982\u4e00\u4e2a <code>dict</code> \u4e2d\uff09\u3002</p> <p>\u5728\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u4e4b\u524d\uff0c\u5b83\u4eec\u5c06\u88ab\u8f6c\u6362\u4e3a\u5bf9\u5e94\u7684\u503c\uff1a</p> <pre><code>from enum import Enum\n\nfrom fastapi import FastAPI\n\n\nclass ModelName(str, Enum):\n    alexnet = \"alexnet\"\n    resnet = \"resnet\"\n    lenet = \"lenet\"\n\n\napp = FastAPI()\n\n\n@app.get(\"/models/{model_name}\")\nasync def get_model(model_name: ModelName):\n    if model_name is ModelName.alexnet:\nreturn {\"model_name\": model_name, \"message\": \"Deep Learning FTW!\"}\nif model_name.value == \"lenet\":\nreturn {\"model_name\": model_name, \"message\": \"LeCNN all the images\"}\nreturn {\"model_name\": model_name, \"message\": \"Have some residuals\"}\n</code></pre>"},{"location":"tutorial/path-params/#_14","title":"\u5305\u542b\u8def\u5f84\u7684\u8def\u5f84\u53c2\u6570","text":"<p>\u5047\u8bbe\u4f60\u6709\u4e00\u4e2a\u8def\u5f84\u64cd\u4f5c\uff0c\u5b83\u7684\u8def\u5f84\u4e3a <code>/files/{file_path}</code>\u3002</p> <p>\u4f46\u662f\u4f60\u9700\u8981 <code>file_path</code> \u81ea\u8eab\u4e5f\u5305\u542b\u8def\u5f84\uff0c\u6bd4\u5982 <code>home/johndoe/myfile.txt</code>\u3002</p> <p>\u56e0\u6b64\uff0c\u8be5\u6587\u4ef6\u7684URL\u5c06\u7c7b\u4f3c\u4e8e\u8fd9\u6837\uff1a<code>/files/home/johndoe/myfile.txt</code>\u3002</p>"},{"location":"tutorial/path-params/#openapi","title":"OpenAPI \u652f\u6301","text":"<p>OpenAPI \u4e0d\u652f\u6301\u4efb\u4f55\u65b9\u5f0f\u53bb\u58f0\u660e\u8def\u5f84\u53c2\u6570\u4ee5\u5728\u5176\u5185\u90e8\u5305\u542b\u8def\u5f84\uff0c\u56e0\u4e3a\u8fd9\u53ef\u80fd\u4f1a\u5bfc\u81f4\u96be\u4ee5\u6d4b\u8bd5\u548c\u5b9a\u4e49\u7684\u60c5\u51b5\u51fa\u73b0\u3002</p> <p>\u4e0d\u8fc7\uff0c\u4f60\u4ecd\u7136\u53ef\u4ee5\u901a\u8fc7 Starlette \u7684\u4e00\u4e2a\u5185\u90e8\u5de5\u5177\u5728 FastAPI \u4e2d\u5b9e\u73b0\u5b83\u3002</p> <p>\u800c\u4e14\u6587\u6863\u4f9d\u65e7\u53ef\u4ee5\u4f7f\u7528\uff0c\u4f46\u662f\u4e0d\u4f1a\u6dfb\u52a0\u4efb\u4f55\u8be5\u53c2\u6570\u5e94\u5305\u542b\u8def\u5f84\u7684\u8bf4\u660e\u3002</p>"},{"location":"tutorial/path-params/#_15","title":"\u8def\u5f84\u8f6c\u6362\u5668","text":"<p>\u4f60\u53ef\u4ee5\u4f7f\u7528\u76f4\u63a5\u6765\u81ea Starlette \u7684\u9009\u9879\u6765\u58f0\u660e\u4e00\u4e2a\u5305\u542b\u8def\u5f84\u7684\u8def\u5f84\u53c2\u6570\uff1a</p> <pre><code>/files/{file_path:path}\n</code></pre> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u53c2\u6570\u7684\u540d\u79f0\u4e3a <code>file_path</code>\uff0c\u7ed3\u5c3e\u90e8\u5206\u7684 <code>:path</code> \u8bf4\u660e\u8be5\u53c2\u6570\u5e94\u5339\u914d\u4efb\u610f\u7684\u8def\u5f84\u3002</p> <p>\u56e0\u6b64\uff0c\u4f60\u53ef\u4ee5\u8fd9\u6837\u4f7f\u7528\u5b83\uff1a</p> <pre><code>from fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/files/{file_path:path}\")\nasync def read_file(file_path: str):\n    return {\"file_path\": file_path}\n</code></pre> <p>Tip</p> <p>\u4f60\u53ef\u80fd\u4f1a\u9700\u8981\u53c2\u6570\u5305\u542b <code>/home/johndoe/myfile.txt</code>\uff0c\u4ee5\u659c\u6760\uff08<code>/</code>\uff09\u5f00\u5934\u3002</p> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cURL \u5c06\u4f1a\u662f <code>/files//home/johndoe/myfile.txt</code>\uff0c\u5728<code>files</code> \u548c <code>home</code> \u4e4b\u95f4\u6709\u4e00\u4e2a\u53cc\u659c\u6760\uff08<code>//</code>\uff09\u3002</p>"},{"location":"tutorial/path-params/#_16","title":"\u603b\u7ed3","text":"<p>\u4f7f\u7528 FastAPI\uff0c\u901a\u8fc7\u7b80\u77ed\u3001\u76f4\u89c2\u548c\u6807\u51c6\u7684 Python \u7c7b\u578b\u58f0\u660e\uff0c\u4f60\u5c06\u83b7\u5f97\uff1a</p> <ul> <li>\u7f16\u8f91\u5668\u652f\u6301\uff1a\u9519\u8bef\u68c0\u67e5\uff0c\u4ee3\u7801\u8865\u5168\u7b49</li> <li>\u6570\u636e \"\u89e3\u6790\"</li> <li>\u6570\u636e\u6821\u9a8c</li> <li>API \u6807\u6ce8\u548c\u81ea\u52a8\u751f\u6210\u7684\u6587\u6863</li> </ul> <p>\u800c\u4e14\u4f60\u53ea\u9700\u8981\u58f0\u660e\u4e00\u6b21\u5373\u53ef\u3002</p> <p>\u8fd9\u53ef\u80fd\u662f FastAPI \u4e0e\u5176\u4ed6\u6846\u67b6\u76f8\u6bd4\u4e3b\u8981\u7684\u660e\u663e\u4f18\u52bf\uff08\u9664\u4e86\u539f\u59cb\u6027\u80fd\u4ee5\u5916\uff09\u3002</p>"},{"location":"tutorial/query-params-str-validations/","title":"\u67e5\u8be2\u53c2\u6570\u548c\u5b57\u7b26\u4e32\u6821\u9a8c","text":"<p>FastAPI \u5141\u8bb8\u4f60\u4e3a\u53c2\u6570\u58f0\u660e\u989d\u5916\u7684\u4fe1\u606f\u548c\u6821\u9a8c\u3002</p> <p>\u8ba9\u6211\u4eec\u4ee5\u4e0b\u9762\u7684\u5e94\u7528\u7a0b\u5e8f\u4e3a\u4f8b\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n@app.get(\"/items/\")\nasync def read_items(q: Union[str, None] = None):\n    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n    if q:\n        results.update({\"q\": q})\n    return results\n</code></pre> <p>\u67e5\u8be2\u53c2\u6570 <code>q</code> \u7684\u7c7b\u578b\u4e3a <code>str</code>\uff0c\u9ed8\u8ba4\u503c\u4e3a <code>None</code>\uff0c\u56e0\u6b64\u5b83\u662f\u53ef\u9009\u7684\u3002</p>"},{"location":"tutorial/query-params-str-validations/#_2","title":"\u989d\u5916\u7684\u6821\u9a8c","text":"<p>\u6211\u4eec\u6253\u7b97\u6dfb\u52a0\u7ea6\u675f\u6761\u4ef6\uff1a\u5373\u4f7f <code>q</code> \u662f\u53ef\u9009\u7684\uff0c\u4f46\u53ea\u8981\u63d0\u4f9b\u4e86\u8be5\u53c2\u6570\uff0c\u5219\u8be5\u53c2\u6570\u503c\u4e0d\u80fd\u8d85\u8fc750\u4e2a\u5b57\u7b26\u7684\u957f\u5ea6\u3002</p>"},{"location":"tutorial/query-params-str-validations/#query","title":"\u5bfc\u5165 <code>Query</code>","text":"<p>\u4e3a\u6b64\uff0c\u9996\u5148\u4ece <code>fastapi</code> \u5bfc\u5165 <code>Query</code>\uff1a</p> <pre><code>from typing import Union\nfrom fastapi import FastAPI, Query\n\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items(q: Union[str, None] = Query(default=None, max_length=50)):\n    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n    if q:\n        results.update({\"q\": q})\n    return results\n</code></pre>"},{"location":"tutorial/query-params-str-validations/#query_1","title":"\u4f7f\u7528 <code>Query</code> \u4f5c\u4e3a\u9ed8\u8ba4\u503c","text":"<p>\u73b0\u5728\uff0c\u5c06 <code>Query</code> \u7528\u4f5c\u67e5\u8be2\u53c2\u6570\u7684\u9ed8\u8ba4\u503c\uff0c\u5e76\u5c06\u5b83\u7684 <code>max_length</code> \u53c2\u6570\u8bbe\u7f6e\u4e3a 50\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI, Query\n\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items(q: Union[str, None] = Query(default=None, max_length=50)):\nresults = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n    if q:\n        results.update({\"q\": q})\n    return results\n</code></pre> <p>\u7531\u4e8e\u6211\u4eec\u5fc5\u987b\u7528 <code>Query(default=None)</code> \u66ff\u6362\u9ed8\u8ba4\u503c <code>None</code>\uff0c<code>Query</code> \u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u540c\u6837\u4e5f\u662f\u7528\u4e8e\u5b9a\u4e49\u9ed8\u8ba4\u503c\u3002</p> <p>\u6240\u4ee5\uff1a</p> <pre><code>q: Union[str, None] = Query(default=None)\n</code></pre> <p>...\u4f7f\u5f97\u53c2\u6570\u53ef\u9009\uff0c\u7b49\u540c\u4e8e\uff1a</p> <pre><code>q: str = None\n</code></pre> <p>\u4f46\u662f <code>Query</code> \u663e\u5f0f\u5730\u5c06\u5176\u58f0\u660e\u4e3a\u67e5\u8be2\u53c2\u6570\u3002</p> <p>\u7136\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u66f4\u591a\u7684\u53c2\u6570\u4f20\u9012\u7ed9 <code>Query</code>\u3002\u5728\u672c\u4f8b\u4e2d\uff0c\u9002\u7528\u4e8e\u5b57\u7b26\u4e32\u7684 <code>max_length</code> \u53c2\u6570\uff1a</p> <pre><code>q: Union[str, None] = Query(default=None, max_length=50)\n</code></pre> <p>\u5c06\u4f1a\u6821\u9a8c\u6570\u636e\uff0c\u5728\u6570\u636e\u65e0\u6548\u65f6\u5c55\u793a\u6e05\u6670\u7684\u9519\u8bef\u4fe1\u606f\uff0c\u5e76\u5728 OpenAPI \u6a21\u5f0f\u7684\u8def\u5f84\u64cd\u4f5c\u4e2d\u8bb0\u5f55\u8be5\u53c2\u200b\u200b\u6570\u3002</p>"},{"location":"tutorial/query-params-str-validations/#_3","title":"\u6dfb\u52a0\u66f4\u591a\u6821\u9a8c","text":"<p>\u4f60\u8fd8\u53ef\u4ee5\u6dfb\u52a0 <code>min_length</code> \u53c2\u6570\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI, Query\n\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items(\nq: Union[str, None] = Query(default=None, min_length=3, max_length=50)\n):\n    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n    if q:\n        results.update({\"q\": q})\n    return results\n</code></pre>"},{"location":"tutorial/query-params-str-validations/#_4","title":"\u6dfb\u52a0\u6b63\u5219\u8868\u8fbe\u5f0f","text":"<p>\u4f60\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e2a\u53c2\u6570\u503c\u5fc5\u987b\u5339\u914d\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI, Query\n\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items(\n    q: Union[str, None] = Query(\ndefault=None, min_length=3, max_length=50, regex=\"^fixedquery$\"\n)\n):\n    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n    if q:\n        results.update({\"q\": q})\n    return results\n</code></pre> <p>\u8fd9\u4e2a\u6307\u5b9a\u7684\u6b63\u5219\u8868\u8fbe\u5f0f\u901a\u8fc7\u4ee5\u4e0b\u89c4\u5219\u68c0\u67e5\u63a5\u6536\u5230\u7684\u53c2\u6570\u503c\uff1a</p> <ul> <li><code>^</code>\uff1a\u4ee5\u8be5\u7b26\u53f7\u4e4b\u540e\u7684\u5b57\u7b26\u5f00\u5934\uff0c\u7b26\u53f7\u4e4b\u524d\u6ca1\u6709\u5b57\u7b26\u3002</li> <li><code>fixedquery</code>: \u503c\u7cbe\u786e\u5730\u7b49\u4e8e <code>fixedquery</code>\u3002</li> <li><code>$</code>: \u5230\u6b64\u7ed3\u675f\uff0c\u5728 <code>fixedquery</code> \u4e4b\u540e\u6ca1\u6709\u66f4\u591a\u5b57\u7b26\u3002</li> </ul> <p>\u5982\u679c\u4f60\u5bf9\u6240\u6709\u7684\u8fd9\u4e9b\u300c\u6b63\u5219\u8868\u8fbe\u5f0f\u300d\u6982\u5ff5\u611f\u5230\u8ff7\u832b\uff0c\u8bf7\u4e0d\u8981\u62c5\u5fc3\u3002\u5bf9\u4e8e\u8bb8\u591a\u4eba\u6765\u8bf4\u8fd9\u90fd\u662f\u4e00\u4e2a\u56f0\u96be\u7684\u4e3b\u9898\u3002\u4f60\u4ecd\u7136\u53ef\u4ee5\u5728\u65e0\u9700\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u60c5\u51b5\u4e0b\u505a\u5f88\u591a\u4e8b\u60c5\u3002</p> <p>\u4f46\u662f\uff0c\u4e00\u65e6\u4f60\u9700\u8981\u7528\u5230\u5e76\u53bb\u5b66\u4e60\u5b83\u4eec\u65f6\uff0c\u8bf7\u4e86\u89e3\u4f60\u5df2\u7ecf\u53ef\u4ee5\u5728 FastAPI \u4e2d\u76f4\u63a5\u4f7f\u7528\u5b83\u4eec\u3002</p>"},{"location":"tutorial/query-params-str-validations/#_5","title":"\u9ed8\u8ba4\u503c","text":"<p>\u4f60\u53ef\u4ee5\u5411 <code>Query</code> \u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f20\u5165 <code>None</code> \u7528\u4f5c\u67e5\u8be2\u53c2\u6570\u7684\u9ed8\u8ba4\u503c\uff0c\u4ee5\u540c\u6837\u7684\u65b9\u5f0f\u4f60\u4e5f\u53ef\u4ee5\u4f20\u9012\u5176\u4ed6\u9ed8\u8ba4\u503c\u3002</p> <p>\u5047\u8bbe\u4f60\u60f3\u8981\u58f0\u660e\u67e5\u8be2\u53c2\u6570 <code>q</code>\uff0c\u4f7f\u5176 <code>min_length</code> \u4e3a <code>3</code>\uff0c\u5e76\u4e14\u9ed8\u8ba4\u503c\u4e3a <code>fixedquery</code>\uff1a</p> <pre><code>from fastapi import FastAPI, Query\n\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items(q: str = Query(default=\"fixedquery\", min_length=3)):\nresults = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n    if q:\n        results.update({\"q\": q})\n    return results\n</code></pre> <p>Note</p> <p>\u5177\u6709\u9ed8\u8ba4\u503c\u8fd8\u4f1a\u4f7f\u8be5\u53c2\u6570\u6210\u4e3a\u53ef\u9009\u53c2\u6570\u3002</p>"},{"location":"tutorial/query-params-str-validations/#_6","title":"\u58f0\u660e\u4e3a\u5fc5\u9700\u53c2\u6570","text":"<p>\u5f53\u6211\u4eec\u4e0d\u9700\u8981\u58f0\u660e\u989d\u5916\u7684\u6821\u9a8c\u6216\u5143\u6570\u636e\u65f6\uff0c\u53ea\u9700\u4e0d\u58f0\u660e\u9ed8\u8ba4\u503c\u5c31\u53ef\u4ee5\u4f7f <code>q</code> \u53c2\u6570\u6210\u4e3a\u5fc5\u9700\u53c2\u6570\uff0c\u4f8b\u5982\uff1a</p> <pre><code>q: str\n</code></pre> <p>\u4ee3\u66ff\uff1a</p> <pre><code>q: Union[str, None] = None\n</code></pre> <p>\u4f46\u662f\u73b0\u5728\u6211\u4eec\u6b63\u5728\u7528 <code>Query</code> \u58f0\u660e\u5b83\uff0c\u4f8b\u5982\uff1a</p> <pre><code>q: Union[str, None] = Query(default=None, min_length=3)\n</code></pre> <p>\u56e0\u6b64\uff0c\u5f53\u4f60\u5728\u4f7f\u7528 <code>Query</code> \u4e14\u9700\u8981\u58f0\u660e\u4e00\u4e2a\u503c\u662f\u5fc5\u9700\u7684\u65f6\uff0c\u53ea\u9700\u4e0d\u58f0\u660e\u9ed8\u8ba4\u53c2\u6570\uff1a</p> <pre><code>from fastapi import FastAPI, Query\n\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items(q: str = Query(min_length=3)):\nresults = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n    if q:\n        results.update({\"q\": q})\n    return results\n</code></pre>"},{"location":"tutorial/query-params-str-validations/#_7","title":"\u4f7f\u7528\u7701\u7565\u53f7(<code>...</code>)\u58f0\u660e\u5fc5\u9700\u53c2\u6570","text":"<p>\u6709\u53e6\u4e00\u79cd\u65b9\u6cd5\u53ef\u4ee5\u663e\u5f0f\u7684\u58f0\u660e\u4e00\u4e2a\u503c\u662f\u5fc5\u9700\u7684\uff0c\u5373\u5c06\u9ed8\u8ba4\u53c2\u6570\u7684\u9ed8\u8ba4\u503c\u8bbe\u4e3a <code>...</code> \uff1a</p> <pre><code>from fastapi import FastAPI, Query\n\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items(q: str = Query(default=..., min_length=3)):\nresults = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n    if q:\n        results.update({\"q\": q})\n    return results\n</code></pre> <p>Info</p> <p>\u5982\u679c\u4f60\u4e4b\u524d\u6ca1\u89c1\u8fc7 <code>...</code> \u8fd9\u79cd\u7528\u6cd5\uff1a\u5b83\u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u5355\u72ec\u503c\uff0c\u5b83\u662f Python \u7684\u4e00\u90e8\u5206\u5e76\u4e14\u88ab\u79f0\u4e3a\u300c\u7701\u7565\u53f7\u300d\u3002 Pydantic \u548c FastAPI \u4f7f\u7528\u5b83\u6765\u663e\u5f0f\u7684\u58f0\u660e\u9700\u8981\u4e00\u4e2a\u503c\u3002</p> <p>\u8fd9\u5c06\u4f7f FastAPI \u77e5\u9053\u6b64\u67e5\u8be2\u53c2\u6570\u662f\u5fc5\u9700\u7684\u3002</p>"},{"location":"tutorial/query-params-str-validations/#none","title":"\u4f7f\u7528<code>None</code>\u58f0\u660e\u5fc5\u9700\u53c2\u6570","text":"<p>\u4f60\u53ef\u4ee5\u58f0\u660e\u4e00\u4e2a\u53c2\u6570\u53ef\u4ee5\u63a5\u6536<code>None</code>\u503c\uff0c\u4f46\u5b83\u4ecd\u7136\u662f\u5fc5\u9700\u7684\u3002\u8fd9\u5c06\u5f3a\u5236\u5ba2\u6237\u7aef\u53d1\u9001\u4e00\u4e2a\u503c\uff0c\u5373\u4f7f\u8be5\u503c\u662f<code>None</code>\u3002</p> <p>\u4e3a\u6b64\uff0c\u4f60\u53ef\u4ee5\u58f0\u660e<code>None</code>\u662f\u4e00\u4e2a\u6709\u6548\u7684\u7c7b\u578b\uff0c\u5e76\u4ecd\u7136\u4f7f\u7528<code>default=...</code>\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI, Query\n\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items(q: Union[str, None] = Query(default=..., min_length=3)):\nresults = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n    if q:\n        results.update({\"q\": q})\n    return results\n</code></pre> <p>Tip</p> <p>Pydantic \u662f FastAPI \u4e2d\u6240\u6709\u6570\u636e\u9a8c\u8bc1\u548c\u5e8f\u5217\u5316\u7684\u6838\u5fc3\uff0c\u5f53\u4f60\u5728\u6ca1\u6709\u8bbe\u9ed8\u8ba4\u503c\u7684\u60c5\u51b5\u4e0b\u4f7f\u7528 <code>Optional</code> \u6216 <code>Union[Something, None]</code> \u65f6\uff0c\u5b83\u5177\u6709\u7279\u6b8a\u884c\u4e3a\uff0c\u4f60\u53ef\u4ee5\u5728 Pydantic \u6587\u6863\u4e2d\u9605\u8bfb\u6709\u5173\u5fc5\u9700\u53ef\u9009\u5b57\u6bb5\u7684\u66f4\u591a\u4fe1\u606f\u3002</p>"},{"location":"tutorial/query-params-str-validations/#pydanticrequired","title":"\u4f7f\u7528Pydantic\u4e2d\u7684<code>Required</code>\u4ee3\u66ff\u7701\u7565\u53f7(<code>...</code>)","text":"<p>\u5982\u679c\u4f60\u89c9\u5f97\u4f7f\u7528 <code>...</code> \u4e0d\u8212\u670d\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4ece Pydantic \u5bfc\u5165\u5e76\u4f7f\u7528 <code>Required</code>\uff1a</p> <pre><code>from fastapi import FastAPI, Query\nfrom pydantic import Required\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items(q: str = Query(default=Required, min_length=3)):\nresults = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n    if q:\n        results.update({\"q\": q})\n    return results\n</code></pre> <p>Tip</p> <p>\u8bf7\u8bb0\u4f4f\uff0c\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u5f53\u4f60\u9700\u8981\u67d0\u4e9b\u4e1c\u897f\u65f6\uff0c\u53ef\u4ee5\u7b80\u5355\u5730\u7701\u7565 <code>default</code> \u53c2\u6570\uff0c\u56e0\u6b64\u4f60\u901a\u5e38\u4e0d\u5fc5\u4f7f\u7528 <code>...</code> \u6216 <code>Required</code></p>"},{"location":"tutorial/query-params-str-validations/#_8","title":"\u67e5\u8be2\u53c2\u6570\u5217\u8868 / \u591a\u4e2a\u503c","text":"<p>\u5f53\u4f60\u4f7f\u7528 <code>Query</code> \u663e\u5f0f\u5730\u5b9a\u4e49\u67e5\u8be2\u53c2\u6570\u65f6\uff0c\u4f60\u8fd8\u53ef\u4ee5\u58f0\u660e\u5b83\u53bb\u63a5\u6536\u4e00\u7ec4\u503c\uff0c\u6216\u6362\u53e5\u8bdd\u6765\u8bf4\uff0c\u63a5\u6536\u591a\u4e2a\u503c\u3002</p> <p>\u4f8b\u5982\uff0c\u8981\u58f0\u660e\u4e00\u4e2a\u53ef\u5728 URL \u4e2d\u51fa\u73b0\u591a\u6b21\u7684\u67e5\u8be2\u53c2\u6570 <code>q</code>\uff0c\u4f60\u53ef\u4ee5\u8fd9\u6837\u5199\uff1a</p> <pre><code>from typing import List, Union\n\nfrom fastapi import FastAPI, Query\n\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items(q: Union[List[str], None] = Query(default=None)):\nquery_items = {\"q\": q}\n    return query_items\n</code></pre> <p>\u7136\u540e\uff0c\u8f93\u5165\u5982\u4e0b\u7f51\u5740\uff1a</p> <pre><code>http://localhost:8000/items/?q=foo&amp;q=bar\n</code></pre> <p>\u4f60\u4f1a\u5728\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u7684\u51fd\u6570\u53c2\u6570 <code>q</code> \u4e2d\u4ee5\u4e00\u4e2a Python <code>list</code> \u7684\u5f62\u5f0f\u63a5\u6536\u5230\u67e5\u8be2\u53c2\u6570 <code>q</code> \u7684\u591a\u4e2a\u503c\uff08<code>foo</code> \u548c <code>bar</code>\uff09\u3002</p> <p>\u56e0\u6b64\uff0c\u8be5 URL \u7684\u54cd\u5e94\u5c06\u4f1a\u662f\uff1a</p> <pre><code>{\n\"q\": [\n\"foo\",\n\"bar\"\n]\n}\n</code></pre> <p>Tip</p> <p>\u8981\u58f0\u660e\u7c7b\u578b\u4e3a <code>list</code> \u7684\u67e5\u8be2\u53c2\u6570\uff0c\u5982\u4e0a\u4f8b\u6240\u793a\uff0c\u4f60\u9700\u8981\u663e\u5f0f\u5730\u4f7f\u7528 <code>Query</code>\uff0c\u5426\u5219\u8be5\u53c2\u6570\u5c06\u88ab\u89e3\u91ca\u4e3a\u8bf7\u6c42\u4f53\u3002</p> <p>\u4ea4\u4e92\u5f0f API \u6587\u6863\u5c06\u4f1a\u76f8\u5e94\u5730\u8fdb\u884c\u66f4\u65b0\uff0c\u4ee5\u5141\u8bb8\u4f7f\u7528\u591a\u4e2a\u503c\uff1a</p> <p></p>"},{"location":"tutorial/query-params-str-validations/#_9","title":"\u5177\u6709\u9ed8\u8ba4\u503c\u7684\u67e5\u8be2\u53c2\u6570\u5217\u8868 / \u591a\u4e2a\u503c","text":"<p>\u4f60\u8fd8\u53ef\u4ee5\u5b9a\u4e49\u5728\u6ca1\u6709\u4efb\u4f55\u7ed9\u5b9a\u503c\u65f6\u7684\u9ed8\u8ba4 <code>list</code> \u503c\uff1a</p> <pre><code>from typing import List\n\nfrom fastapi import FastAPI, Query\n\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items(q: List[str] = Query(default=[\"foo\", \"bar\"])):\nquery_items = {\"q\": q}\n    return query_items\n</code></pre> <p>\u5982\u679c\u4f60\u8bbf\u95ee\uff1a</p> <pre><code>http://localhost:8000/items/\n</code></pre> <p><code>q</code> \u7684\u9ed8\u8ba4\u503c\u5c06\u4e3a\uff1a<code>[\"foo\", \"bar\"]</code>\uff0c\u4f60\u7684\u54cd\u5e94\u4f1a\u662f\uff1a</p> <pre><code>{\n\"q\": [\n\"foo\",\n\"bar\"\n]\n}\n</code></pre>"},{"location":"tutorial/query-params-str-validations/#list","title":"\u4f7f\u7528 <code>list</code>","text":"<p>\u4f60\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 <code>list</code> \u4ee3\u66ff <code>List [str]</code>\uff1a</p> <pre><code>from fastapi import FastAPI, Query\n\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items(q: list = Query(default=[])):\nquery_items = {\"q\": q}\n    return query_items\n</code></pre> <p>Note</p> <p>\u8bf7\u8bb0\u4f4f\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b FastAPI \u5c06\u4e0d\u4f1a\u68c0\u67e5\u5217\u8868\u7684\u5185\u5bb9\u3002</p> <p>\u4f8b\u5982\uff0c<code>List[int]</code> \u5c06\u68c0\u67e5\uff08\u5e76\u8bb0\u5f55\u5230\u6587\u6863\uff09\u5217\u8868\u7684\u5185\u5bb9\u5fc5\u987b\u662f\u6574\u6570\u3002\u4f46\u662f\u5355\u72ec\u7684 <code>list</code> \u4e0d\u4f1a\u3002</p>"},{"location":"tutorial/query-params-str-validations/#_10","title":"\u58f0\u660e\u66f4\u591a\u5143\u6570\u636e","text":"<p>\u4f60\u53ef\u4ee5\u6dfb\u52a0\u66f4\u591a\u6709\u5173\u8be5\u53c2\u6570\u7684\u4fe1\u606f\u3002</p> <p>\u8fd9\u4e9b\u4fe1\u606f\u5c06\u5305\u542b\u5728\u751f\u6210\u7684 OpenAPI \u6a21\u5f0f\u4e2d\uff0c\u5e76\u7531\u6587\u6863\u7528\u6237\u754c\u9762\u548c\u5916\u90e8\u5de5\u5177\u6240\u4f7f\u7528\u3002</p> <p>Note</p> <p>\u8bf7\u8bb0\u4f4f\uff0c\u4e0d\u540c\u7684\u5de5\u5177\u5bf9 OpenAPI \u7684\u652f\u6301\u7a0b\u5ea6\u53ef\u80fd\u4e0d\u540c\u3002</p> <p>\u5176\u4e2d\u4e00\u4e9b\u53ef\u80fd\u4e0d\u4f1a\u5c55\u793a\u6240\u6709\u5df2\u58f0\u660e\u7684\u989d\u5916\u4fe1\u606f\uff0c\u5c3d\u7ba1\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\uff0c\u7f3a\u5c11\u7684\u8fd9\u90e8\u5206\u529f\u80fd\u5df2\u7ecf\u8ba1\u5212\u8fdb\u884c\u5f00\u53d1\u3002</p> <p>\u4f60\u53ef\u4ee5\u6dfb\u52a0 <code>title</code>\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI, Query\n\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items(\nq: Union[str, None] = Query(default=None, title=\"Query string\", min_length=3)\n):\n    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n    if q:\n        results.update({\"q\": q})\n    return results\n</code></pre> <p>\u4ee5\u53ca <code>description</code>\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI, Query\n\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items(\n    q: Union[str, None] = Query(\n        default=None,\n        title=\"Query string\",\ndescription=\"Query string for the items to search in the database that have a good match\",\nmin_length=3,\n    )\n):\n    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n    if q:\n        results.update({\"q\": q})\n    return results\n</code></pre>"},{"location":"tutorial/query-params-str-validations/#_11","title":"\u522b\u540d\u53c2\u6570","text":"<p>\u5047\u8bbe\u4f60\u60f3\u8981\u67e5\u8be2\u53c2\u6570\u4e3a <code>item-query</code>\u3002</p> <p>\u50cf\u4e0b\u9762\u8fd9\u6837\uff1a</p> <pre><code>http://127.0.0.1:8000/items/?item-query=foobaritems\n</code></pre> <p>\u4f46\u662f <code>item-query</code> \u4e0d\u662f\u4e00\u4e2a\u6709\u6548\u7684 Python \u53d8\u91cf\u540d\u79f0\u3002</p> <p>\u6700\u63a5\u8fd1\u7684\u6709\u6548\u540d\u79f0\u662f <code>item_query</code>\u3002</p> <p>\u4f46\u662f\u4f60\u4ecd\u7136\u8981\u6c42\u5b83\u5728 URL \u4e2d\u5fc5\u987b\u662f <code>item-query</code>...</p> <p>\u8fd9\u65f6\u4f60\u53ef\u4ee5\u7528 <code>alias</code> \u53c2\u6570\u58f0\u660e\u4e00\u4e2a\u522b\u540d\uff0c\u8be5\u522b\u540d\u5c06\u7528\u4e8e\u5728 URL \u4e2d\u67e5\u627e\u67e5\u8be2\u53c2\u6570\u503c\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI, Query\n\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items(q: Union[str, None] = Query(default=None, alias=\"item-query\")):\nresults = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n    if q:\n        results.update({\"q\": q})\n    return results\n</code></pre>"},{"location":"tutorial/query-params-str-validations/#_12","title":"\u5f03\u7528\u53c2\u6570","text":"<p>\u73b0\u5728\u5047\u8bbe\u4f60\u4e0d\u518d\u559c\u6b22\u6b64\u53c2\u6570\u3002</p> <p>\u4f60\u4e0d\u5f97\u4e0d\u5c06\u5176\u4fdd\u7559\u4e00\u6bb5\u65f6\u95f4\uff0c\u56e0\u4e3a\u6709\u4e9b\u5ba2\u6237\u7aef\u6b63\u5728\u4f7f\u7528\u5b83\uff0c\u4f46\u4f60\u5e0c\u671b\u6587\u6863\u6e05\u695a\u5730\u5c06\u5176\u5c55\u793a\u4e3a\u5df2\u5f03\u7528\u3002</p> <p>\u90a3\u4e48\u5c06\u53c2\u6570 <code>deprecated=True</code> \u4f20\u5165 <code>Query</code>\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI, Query\n\napp = FastAPI()\n\n\n@app.get(\"/items/\")\nasync def read_items(\n    q: Union[str, None] = Query(\n        default=None,\n        alias=\"item-query\",\n        title=\"Query string\",\n        description=\"Query string for the items to search in the database that have a good match\",\n        min_length=3,\n        max_length=50,\n        regex=\"^fixedquery$\",\ndeprecated=True,\n)\n):\n    results = {\"items\": [{\"item_id\": \"Foo\"}, {\"item_id\": \"Bar\"}]}\n    if q:\n        results.update({\"q\": q})\n    return results\n</code></pre> <p>\u6587\u6863\u5c06\u4f1a\u50cf\u4e0b\u9762\u8fd9\u6837\u5c55\u793a\u5b83\uff1a</p> <p></p>"},{"location":"tutorial/query-params-str-validations/#_13","title":"\u603b\u7ed3","text":"<p>\u4f60\u53ef\u4ee5\u4e3a\u67e5\u8be2\u53c2\u6570\u58f0\u660e\u989d\u5916\u7684\u6821\u9a8c\u548c\u5143\u6570\u636e\u3002</p> <p>\u901a\u7528\u7684\u6821\u9a8c\u548c\u5143\u6570\u636e\uff1a</p> <ul> <li><code>alias</code></li> <li><code>title</code></li> <li><code>description</code></li> <li><code>deprecated</code></li> </ul> <p>\u7279\u5b9a\u4e8e\u5b57\u7b26\u4e32\u7684\u6821\u9a8c\uff1a</p> <ul> <li><code>min_length</code></li> <li><code>max_length</code></li> <li><code>regex</code></li> </ul> <p>\u5728\u8fd9\u4e9b\u793a\u4f8b\u4e2d\uff0c\u4f60\u4e86\u89e3\u4e86\u5982\u4f55\u58f0\u660e\u5bf9 <code>str</code> \u503c\u7684\u6821\u9a8c\u3002</p> <p>\u8bf7\u53c2\u9605\u4e0b\u4e00\u7ae0\u8282\uff0c\u4ee5\u4e86\u89e3\u5982\u4f55\u58f0\u660e\u5bf9\u5176\u4ed6\u7c7b\u578b\u4f8b\u5982\u6570\u503c\u7684\u6821\u9a8c\u3002</p>"},{"location":"tutorial/query-params/","title":"\u67e5\u8be2\u53c2\u6570","text":"<p>\u58f0\u660e\u4e0d\u5c5e\u4e8e\u8def\u5f84\u53c2\u6570\u7684\u5176\u4ed6\u51fd\u6570\u53c2\u6570\u65f6\uff0c\u5b83\u4eec\u5c06\u88ab\u81ea\u52a8\u89e3\u91ca\u4e3a\"\u67e5\u8be2\u5b57\u7b26\u4e32\"\u53c2\u6570</p> <pre><code>from fastapi import FastAPI\n\napp = FastAPI()\n\nfake_items_db = [{\"item_name\": \"Foo\"}, {\"item_name\": \"Bar\"}, {\"item_name\": \"Baz\"}]\n\n\n@app.get(\"/items/\")\nasync def read_item(skip: int = 0, limit: int = 10):\nreturn fake_items_db[skip : skip + limit]\n</code></pre> <p>\u67e5\u8be2\u5b57\u7b26\u4e32\u662f\u952e\u503c\u5bf9\u7684\u96c6\u5408\uff0c\u8fd9\u4e9b\u952e\u503c\u5bf9\u4f4d\u4e8e URL \u7684 <code>\uff1f</code> \u4e4b\u540e\uff0c\u5e76\u4ee5 <code>&amp;</code> \u7b26\u53f7\u5206\u9694\u3002</p> <p>\u4f8b\u5982\uff0c\u5728\u4ee5\u4e0b url \u4e2d\uff1a</p> <pre><code>http://127.0.0.1:8000/items/?skip=0&amp;limit=10\n</code></pre> <p>...\u67e5\u8be2\u53c2\u6570\u4e3a\uff1a</p> <ul> <li><code>skip</code>\uff1a\u5bf9\u5e94\u7684\u503c\u4e3a <code>0</code></li> <li><code>limit</code>\uff1a\u5bf9\u5e94\u7684\u503c\u4e3a <code>10</code></li> </ul> <p>\u7531\u4e8e\u5b83\u4eec\u662f URL \u7684\u4e00\u90e8\u5206\uff0c\u56e0\u6b64\u5b83\u4eec\u7684\"\u539f\u59cb\u503c\"\u662f\u5b57\u7b26\u4e32\u3002</p> <p>\u4f46\u662f\uff0c\u5f53\u4f60\u4e3a\u5b83\u4eec\u58f0\u660e\u4e86 Python \u7c7b\u578b\uff08\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\u4e3a <code>int</code>\uff09\u65f6\uff0c\u5b83\u4eec\u5c06\u8f6c\u6362\u4e3a\u8be5\u7c7b\u578b\u5e76\u9488\u5bf9\u8be5\u7c7b\u578b\u8fdb\u884c\u6821\u9a8c\u3002</p> <p>\u5e94\u7528\u4e8e\u8def\u5f84\u53c2\u6570\u7684\u6240\u6709\u76f8\u540c\u8fc7\u7a0b\u4e5f\u9002\u7528\u4e8e\u67e5\u8be2\u53c2\u6570\uff1a</p> <ul> <li>\uff08\u5f88\u660e\u663e\u7684\uff09\u7f16\u8f91\u5668\u652f\u6301</li> <li>\u6570\u636e\"\u89e3\u6790\"</li> <li>\u6570\u636e\u6821\u9a8c</li> <li>\u81ea\u52a8\u751f\u6210\u6587\u6863</li> </ul>"},{"location":"tutorial/query-params/#_2","title":"\u9ed8\u8ba4\u503c","text":"<p>\u7531\u4e8e\u67e5\u8be2\u53c2\u6570\u4e0d\u662f\u8def\u5f84\u7684\u56fa\u5b9a\u90e8\u5206\uff0c\u56e0\u6b64\u5b83\u4eec\u53ef\u4ee5\u662f\u53ef\u9009\u7684\uff0c\u5e76\u4e14\u53ef\u4ee5\u6709\u9ed8\u8ba4\u503c\u3002</p> <p>\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u5b83\u4eec\u5177\u6709 <code>skip=0</code> \u548c <code>limit=10</code> \u7684\u9ed8\u8ba4\u503c\u3002</p> <p>\u56e0\u6b64\uff0c\u8bbf\u95ee URL\uff1a</p> <pre><code>http://127.0.0.1:8000/items/\n</code></pre> <p>\u5c06\u4e0e\u8bbf\u95ee\u4ee5\u4e0b\u5730\u5740\u76f8\u540c\uff1a</p> <pre><code>http://127.0.0.1:8000/items/?skip=0&amp;limit=10\n</code></pre> <p>\u4f46\u662f\uff0c\u5982\u679c\u4f60\u8bbf\u95ee\u7684\u662f\uff1a</p> <pre><code>http://127.0.0.1:8000/items/?skip=20\n</code></pre> <p>\u51fd\u6570\u4e2d\u7684\u53c2\u6570\u503c\u5c06\u4f1a\u662f\uff1a</p> <ul> <li><code>skip=20</code>\uff1a\u5728 URL \u4e2d\u8bbe\u5b9a\u7684\u503c</li> <li><code>limit=10</code>\uff1a\u4f7f\u7528\u9ed8\u8ba4\u503c</li> </ul>"},{"location":"tutorial/query-params/#_3","title":"\u53ef\u9009\u53c2\u6570","text":"<p>\u901a\u8fc7\u540c\u6837\u7684\u65b9\u5f0f\uff0c\u4f60\u53ef\u4ee5\u5c06\u5b83\u4eec\u7684\u9ed8\u8ba4\u503c\u8bbe\u7f6e\u4e3a <code>None</code> \u6765\u58f0\u660e\u53ef\u9009\u67e5\u8be2\u53c2\u6570\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n@app.get(\"/items/{item_id}\")\nasync def read_item(item_id: str, q: Union[str, None] = None):\n    if q:\n        return {\"item_id\": item_id, \"q\": q}\n    return {\"item_id\": item_id}\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u51fd\u6570\u53c2\u6570 <code>q</code> \u5c06\u662f\u53ef\u9009\u7684\uff0c\u5e76\u4e14\u9ed8\u8ba4\u503c\u4e3a <code>None</code>\u3002</p> <p>Check</p> <p>\u8fd8\u8981\u6ce8\u610f\u7684\u662f\uff0cFastAPI \u8db3\u591f\u806a\u660e\uff0c\u80fd\u591f\u5206\u8fa8\u51fa\u53c2\u6570 <code>item_id</code> \u662f\u8def\u5f84\u53c2\u6570\u800c <code>q</code> \u4e0d\u662f\uff0c\u56e0\u6b64 <code>q</code> \u662f\u4e00\u4e2a\u67e5\u8be2\u53c2\u6570\u3002</p>"},{"location":"tutorial/query-params/#_4","title":"\u67e5\u8be2\u53c2\u6570\u7c7b\u578b\u8f6c\u6362","text":"<p>\u4f60\u8fd8\u53ef\u4ee5\u58f0\u660e <code>bool</code> \u7c7b\u578b\uff0c\u5b83\u4eec\u5c06\u88ab\u81ea\u52a8\u8f6c\u6362\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n@app.get(\"/items/{item_id}\")\nasync def read_item(item_id: str, q: Union[str, None] = None, short: bool = False):\n    item = {\"item_id\": item_id}\n    if q:\n        item.update({\"q\": q})\n    if not short:\n        item.update(\n            {\"description\": \"This is an amazing item that has a long description\"}\n        )\n    return item\n</code></pre> <p>\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u5982\u679c\u4f60\u8bbf\u95ee\uff1a</p> <pre><code>http://127.0.0.1:8000/items/foo?short=1\n</code></pre> <p>\u6216</p> <pre><code>http://127.0.0.1:8000/items/foo?short=True\n</code></pre> <p>\u6216</p> <pre><code>http://127.0.0.1:8000/items/foo?short=true\n</code></pre> <p>\u6216</p> <pre><code>http://127.0.0.1:8000/items/foo?short=on\n</code></pre> <p>\u6216</p> <pre><code>http://127.0.0.1:8000/items/foo?short=yes\n</code></pre> <p>\u6216\u4efb\u4f55\u5176\u4ed6\u7684\u53d8\u4f53\u5f62\u5f0f\uff08\u5927\u5199\uff0c\u9996\u5b57\u6bcd\u5927\u5199\u7b49\u7b49\uff09\uff0c\u4f60\u7684\u51fd\u6570\u63a5\u6536\u7684 <code>short</code> \u53c2\u6570\u90fd\u4f1a\u662f\u5e03\u5c14\u503c <code>True</code>\u3002\u5bf9\u4e8e\u503c\u4e3a <code>False</code> \u7684\u60c5\u51b5\u4e5f\u662f\u4e00\u6837\u7684\u3002</p>"},{"location":"tutorial/query-params/#_5","title":"\u591a\u4e2a\u8def\u5f84\u548c\u67e5\u8be2\u53c2\u6570","text":"<p>\u4f60\u53ef\u4ee5\u540c\u65f6\u58f0\u660e\u591a\u4e2a\u8def\u5f84\u53c2\u6570\u548c\u67e5\u8be2\u53c2\u6570\uff0cFastAPI \u80fd\u591f\u8bc6\u522b\u5b83\u4eec\u3002</p> <p>\u800c\u4e14\u4f60\u4e0d\u9700\u8981\u4ee5\u4efb\u4f55\u7279\u5b9a\u7684\u987a\u5e8f\u6765\u58f0\u660e\u3002</p> <p>\u5b83\u4eec\u5c06\u901a\u8fc7\u540d\u79f0\u88ab\u68c0\u6d4b\u5230\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\n\napp = FastAPI()\n@app.get(\"/users/{user_id}/items/{item_id}\")\nasync def read_user_item(\n    user_id: int, item_id: str, q: Union[str, None] = None, short: bool = False\n):\n    item = {\"item_id\": item_id, \"owner_id\": user_id}\n    if q:\n        item.update({\"q\": q})\n    if not short:\n        item.update(\n            {\"description\": \"This is an amazing item that has a long description\"}\n        )\n    return item\n</code></pre>"},{"location":"tutorial/query-params/#_6","title":"\u5fc5\u9700\u67e5\u8be2\u53c2\u6570","text":"<p>\u5f53\u4f60\u4e3a\u975e\u8def\u5f84\u53c2\u6570\u58f0\u660e\u4e86\u9ed8\u8ba4\u503c\u65f6\uff08\u76ee\u524d\u800c\u8a00\uff0c\u6211\u4eec\u6240\u77e5\u9053\u7684\u4ec5\u6709\u67e5\u8be2\u53c2\u6570\uff09\uff0c\u5219\u8be5\u53c2\u6570\u4e0d\u662f\u5fc5\u9700\u7684\u3002</p> <p>\u5982\u679c\u4f60\u4e0d\u60f3\u6dfb\u52a0\u4e00\u4e2a\u7279\u5b9a\u7684\u503c\uff0c\u800c\u53ea\u662f\u60f3\u4f7f\u8be5\u53c2\u6570\u6210\u4e3a\u53ef\u9009\u7684\uff0c\u5219\u5c06\u9ed8\u8ba4\u503c\u8bbe\u7f6e\u4e3a <code>None</code>\u3002</p> <p>\u4f46\u5f53\u4f60\u60f3\u8ba9\u4e00\u4e2a\u67e5\u8be2\u53c2\u6570\u6210\u4e3a\u5fc5\u9700\u7684\uff0c\u4e0d\u58f0\u660e\u4efb\u4f55\u9ed8\u8ba4\u503c\u5c31\u53ef\u4ee5\uff1a</p> <pre><code>from fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/items/{item_id}\")\nasync def read_user_item(item_id: str, needy: str):\nitem = {\"item_id\": item_id, \"needy\": needy}\n    return item\n</code></pre> <p>\u8fd9\u91cc\u7684\u67e5\u8be2\u53c2\u6570 <code>needy</code> \u662f\u7c7b\u578b\u4e3a <code>str</code> \u7684\u5fc5\u9700\u67e5\u8be2\u53c2\u6570\u3002</p> <p>\u5982\u679c\u4f60\u5728\u6d4f\u89c8\u5668\u4e2d\u6253\u5f00\u4e00\u4e2a\u50cf\u4e0b\u9762\u7684 URL\uff1a</p> <pre><code>http://127.0.0.1:8000/items/foo-item\n</code></pre> <p>...\u56e0\u4e3a\u6ca1\u6709\u6dfb\u52a0\u5fc5\u9700\u7684\u53c2\u6570 <code>needy</code>\uff0c\u4f60\u5c06\u770b\u5230\u7c7b\u4f3c\u4ee5\u4e0b\u7684\u9519\u8bef\uff1a</p> <pre><code>{\n\"detail\": [\n{\n\"loc\": [\n\"query\",\n\"needy\"\n],\n\"msg\": \"field required\",\n\"type\": \"value_error.missing\"\n}\n]\n}\n</code></pre> <p>\u7531\u4e8e <code>needy</code> \u662f\u5fc5\u9700\u53c2\u6570\uff0c\u56e0\u6b64\u4f60\u9700\u8981\u5728 URL \u4e2d\u8bbe\u7f6e\u5b83\u7684\u503c\uff1a</p> <pre><code>http://127.0.0.1:8000/items/foo-item?needy=sooooneedy\n</code></pre> <p>...\u8fd9\u6837\u5c31\u6b63\u5e38\u4e86\uff1a</p> <pre><code>{\n\"item_id\": \"foo-item\",\n\"needy\": \"sooooneedy\"\n}\n</code></pre> <p>\u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u5b9a\u4e49\u4e00\u4e9b\u53c2\u6570\u4e3a\u5fc5\u9700\u7684\uff0c\u4e00\u4e9b\u5177\u6709\u9ed8\u8ba4\u503c\uff0c\u800c\u67d0\u4e9b\u5219\u5b8c\u5168\u662f\u53ef\u9009\u7684\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\n\napp = FastAPI()\n\n@app.get(\"/items/{item_id}\")\nasync def read_user_item(\n    item_id: str, needy: str, skip: int = 0, limit: Union[int, None] = None\n):\n    item = {\"item_id\": item_id, \"needy\": needy, \"skip\": skip, \"limit\": limit}\n    return item\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u67093\u4e2a\u67e5\u8be2\u53c2\u6570\uff1a</p> <ul> <li><code>needy</code>\uff0c\u4e00\u4e2a\u5fc5\u9700\u7684 <code>str</code> \u7c7b\u578b\u53c2\u6570\u3002</li> <li><code>skip</code>\uff0c\u4e00\u4e2a\u9ed8\u8ba4\u503c\u4e3a <code>0</code> \u7684 <code>int</code> \u7c7b\u578b\u53c2\u6570\u3002</li> <li><code>limit</code>\uff0c\u4e00\u4e2a\u53ef\u9009\u7684 <code>int</code> \u7c7b\u578b\u53c2\u6570\u3002</li> </ul> <p>Tip</p> <p>\u4f60\u8fd8\u53ef\u4ee5\u50cf\u5728 \u8def\u5f84\u53c2\u6570 \u4e2d\u90a3\u6837\u4f7f\u7528 <code>Enum</code>\u3002</p>"},{"location":"tutorial/request-files/","title":"\u8bf7\u6c42\u6587\u4ef6","text":"<p><code>File</code> \u7528\u4e8e\u5b9a\u4e49\u5ba2\u6237\u7aef\u7684\u4e0a\u4f20\u6587\u4ef6\u3002</p> <p>\u8bf4\u660e</p> <p>\u56e0\u4e3a\u4e0a\u4f20\u6587\u4ef6\u4ee5\u300c\u8868\u5355\u6570\u636e\u300d\u5f62\u5f0f\u53d1\u9001\u3002</p> <p>\u6240\u4ee5\u63a5\u6536\u4e0a\u4f20\u6587\u4ef6\uff0c\u8981\u9884\u5148\u5b89\u88c5 <code>python-multipart</code>\u3002</p> <p>\u4f8b\u5982\uff1a <code>pip install python-multipart</code>\u3002</p>"},{"location":"tutorial/request-files/#file","title":"\u5bfc\u5165 <code>File</code>","text":"<p>\u4ece <code>fastapi</code> \u5bfc\u5165 <code>File</code> \u548c <code>UploadFile</code>\uff1a</p> <pre><code>from fastapi import FastAPI, File, UploadFile\napp = FastAPI()\n\n\n@app.post(\"/files/\")\nasync def create_file(file: bytes = File()):\n    return {\"file_size\": len(file)}\n\n\n@app.post(\"/uploadfile/\")\nasync def create_upload_file(file: UploadFile):\n    return {\"filename\": file.filename}\n</code></pre>"},{"location":"tutorial/request-files/#file_1","title":"\u5b9a\u4e49 <code>File</code> \u53c2\u6570","text":"<p>\u521b\u5efa\u6587\u4ef6\uff08<code>File</code>\uff09\u53c2\u6570\u7684\u65b9\u5f0f\u4e0e <code>Body</code> \u548c <code>Form</code> \u4e00\u6837\uff1a</p> <pre><code>from fastapi import FastAPI, File, UploadFile\n\napp = FastAPI()\n\n\n@app.post(\"/files/\")\nasync def create_file(file: bytes = File()):\nreturn {\"file_size\": len(file)}\n\n\n@app.post(\"/uploadfile/\")\nasync def create_upload_file(file: UploadFile):\n    return {\"filename\": file.filename}\n</code></pre> <p>\u8bf4\u660e</p> <p><code>File</code> \u662f\u76f4\u63a5\u7ee7\u627f\u81ea <code>Form</code> \u7684\u7c7b\u3002</p> <p>\u6ce8\u610f\uff0c\u4ece <code>fastapi</code> \u5bfc\u5165\u7684 <code>Query</code>\u3001<code>Path</code>\u3001<code>File</code> \u7b49\u9879\uff0c\u5b9e\u9645\u4e0a\u662f\u8fd4\u56de\u7279\u5b9a\u7c7b\u7684\u51fd\u6570\u3002</p> <p>\u63d0\u793a</p> <p>\u58f0\u660e\u6587\u4ef6\u4f53\u5fc5\u987b\u4f7f\u7528 <code>File</code>\uff0c\u5426\u5219\uff0cFastAPI \u4f1a\u628a\u8be5\u53c2\u6570\u5f53\u4f5c\u67e5\u8be2\u53c2\u6570\u6216\u8bf7\u6c42\u4f53\uff08JSON\uff09\u53c2\u6570\u3002</p> <p>\u6587\u4ef6\u4f5c\u4e3a\u300c\u8868\u5355\u6570\u636e\u300d\u4e0a\u4f20\u3002</p> <p>\u5982\u679c\u628a\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u53c2\u6570\u7684\u7c7b\u578b\u58f0\u660e\u4e3a <code>bytes</code>\uff0cFastAPI \u5c06\u4ee5 <code>bytes</code> \u5f62\u5f0f\u8bfb\u53d6\u548c\u63a5\u6536\u6587\u4ef6\u5185\u5bb9\u3002</p> <p>\u8fd9\u79cd\u65b9\u5f0f\u628a\u6587\u4ef6\u7684\u6240\u6709\u5185\u5bb9\u90fd\u5b58\u50a8\u5728\u5185\u5b58\u91cc\uff0c\u9002\u7528\u4e8e\u5c0f\u578b\u6587\u4ef6\u3002</p> <p>\u4e0d\u8fc7\uff0c\u5f88\u591a\u60c5\u51b5\u4e0b\uff0c<code>UploadFile</code> \u66f4\u597d\u7528\u3002</p>"},{"location":"tutorial/request-files/#uploadfile","title":"\u542b <code>UploadFile</code> \u7684\u6587\u4ef6\u53c2\u6570","text":"<p>\u5b9a\u4e49\u6587\u4ef6\u53c2\u6570\u65f6\u4f7f\u7528 <code>UploadFile</code>\uff1a</p> <pre><code>from fastapi import FastAPI, File, UploadFile\n\napp = FastAPI()\n\n\n@app.post(\"/files/\")\nasync def create_file(file: bytes = File()):\n    return {\"file_size\": len(file)}\n\n\n@app.post(\"/uploadfile/\")\nasync def create_upload_file(file: UploadFile):\nreturn {\"filename\": file.filename}\n</code></pre> <p><code>UploadFile</code> \u4e0e <code>bytes</code> \u76f8\u6bd4\u6709\u66f4\u591a\u4f18\u52bf\uff1a</p> <ul> <li>\u4f7f\u7528 <code>spooled</code> \u6587\u4ef6\uff1a<ul> <li>\u5b58\u50a8\u5728\u5185\u5b58\u7684\u6587\u4ef6\u8d85\u51fa\u6700\u5927\u4e0a\u9650\u65f6\uff0cFastAPI \u4f1a\u628a\u6587\u4ef6\u5b58\u5165\u78c1\u76d8\uff1b</li> </ul> </li> <li>\u8fd9\u79cd\u65b9\u5f0f\u66f4\u9002\u4e8e\u5904\u7406\u56fe\u50cf\u3001\u89c6\u9891\u3001\u4e8c\u8fdb\u5236\u6587\u4ef6\u7b49\u5927\u578b\u6587\u4ef6\uff0c\u597d\u5904\u662f\u4e0d\u4f1a\u5360\u7528\u6240\u6709\u5185\u5b58\uff1b</li> <li>\u53ef\u83b7\u53d6\u4e0a\u4f20\u6587\u4ef6\u7684\u5143\u6570\u636e\uff1b</li> <li>\u81ea\u5e26 file-like <code>async</code> \u63a5\u53e3\uff1b</li> <li>\u66b4\u9732\u7684 Python <code>SpooledTemporaryFile</code> \u5bf9\u8c61\uff0c\u53ef\u76f4\u63a5\u4f20\u9012\u7ed9\u5176\u4ed6\u9884\u671f\u300cfile-like\u300d\u5bf9\u8c61\u7684\u5e93\u3002</li> </ul>"},{"location":"tutorial/request-files/#uploadfile_1","title":"<code>UploadFile</code>","text":"<p><code>UploadFile</code> \u7684\u5c5e\u6027\u5982\u4e0b\uff1a</p> <ul> <li><code>filename</code>\uff1a\u4e0a\u4f20\u6587\u4ef6\u540d\u5b57\u7b26\u4e32\uff08<code>str</code>\uff09\uff0c\u4f8b\u5982\uff0c <code>myimage.jpg</code>\uff1b</li> <li><code>content_type</code>\uff1a\u5185\u5bb9\u7c7b\u578b\uff08MIME \u7c7b\u578b / \u5a92\u4f53\u7c7b\u578b\uff09\u5b57\u7b26\u4e32\uff08<code>str</code>\uff09\uff0c\u4f8b\u5982\uff0c<code>image/jpeg</code>\uff1b</li> <li><code>file</code>\uff1a <code>SpooledTemporaryFile</code>\uff08 file-like \u5bf9\u8c61\uff09\u3002\u5176\u5b9e\u5c31\u662f Python\u6587\u4ef6\uff0c\u53ef\u76f4\u63a5\u4f20\u9012\u7ed9\u5176\u4ed6\u9884\u671f <code>file-like</code> \u5bf9\u8c61\u7684\u51fd\u6570\u6216\u652f\u6301\u5e93\u3002</li> </ul> <p><code>UploadFile</code> \u652f\u6301\u4ee5\u4e0b <code>async</code> \u65b9\u6cd5\uff0c\uff08\u4f7f\u7528\u5185\u90e8 <code>SpooledTemporaryFile</code>\uff09\u53ef\u8c03\u7528\u76f8\u5e94\u7684\u6587\u4ef6\u65b9\u6cd5\u3002</p> <ul> <li><code>write(data)</code>\uff1a\u628a <code>data</code> \uff08<code>str</code> \u6216 <code>bytes</code>\uff09\u5199\u5165\u6587\u4ef6\uff1b</li> <li><code>read(size)</code>\uff1a\u6309\u6307\u5b9a\u6570\u91cf\u7684\u5b57\u8282\u6216\u5b57\u7b26\uff08<code>size</code> (<code>int</code>)\uff09\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\uff1b</li> <li><code>seek(offset)</code>\uff1a\u79fb\u52a8\u81f3\u6587\u4ef6 <code>offset</code> \uff08<code>int</code>\uff09\u5b57\u8282\u5904\u7684\u4f4d\u7f6e\uff1b<ul> <li>\u4f8b\u5982\uff0c<code>await myfile.seek(0)</code> \u79fb\u52a8\u5230\u6587\u4ef6\u5f00\u5934\uff1b</li> <li>\u6267\u884c <code>await myfile.read()</code> \u540e\uff0c\u9700\u518d\u6b21\u8bfb\u53d6\u5df2\u8bfb\u53d6\u5185\u5bb9\u65f6\uff0c\u8fd9\u79cd\u65b9\u6cd5\u7279\u522b\u597d\u7528\uff1b</li> </ul> </li> <li><code>close()</code>\uff1a\u5173\u95ed\u6587\u4ef6\u3002</li> </ul> <p>\u56e0\u4e3a\u4e0a\u8ff0\u65b9\u6cd5\u90fd\u662f <code>async</code> \u65b9\u6cd5\uff0c\u8981\u642d\u914d\u300cawait\u300d\u4f7f\u7528\u3002</p> <p>\u4f8b\u5982\uff0c\u5728 <code>async</code> \u8def\u5f84\u64cd\u4f5c\u51fd\u6570 \u5185\uff0c\u8981\u7528\u4ee5\u4e0b\u65b9\u5f0f\u8bfb\u53d6\u6587\u4ef6\u5185\u5bb9\uff1a</p> <pre><code>contents = await myfile.read()\n</code></pre> <p>\u5728\u666e\u901a <code>def</code> \u8def\u5f84\u64cd\u4f5c\u51fd\u6570  \u5185\uff0c\u5219\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee <code>UploadFile.file</code>\uff0c\u4f8b\u5982\uff1a</p> <pre><code>contents = myfile.file.read()\n</code></pre> <p><code>async</code> \u6280\u672f\u7ec6\u8282</p> <p>\u4f7f\u7528 <code>async</code> \u65b9\u6cd5\u65f6\uff0cFastAPI \u5728\u7ebf\u7a0b\u6c60\u4e2d\u6267\u884c\u6587\u4ef6\u65b9\u6cd5\uff0c\u5e76 <code>await</code> \u64cd\u4f5c\u5b8c\u6210\u3002</p> <p>Starlette \u6280\u672f\u7ec6\u8282</p> <p>FastAPI \u7684 <code>UploadFile</code> \u76f4\u63a5\u7ee7\u627f\u81ea Starlette \u7684 <code>UploadFile</code>\uff0c\u4f46\u6dfb\u52a0\u4e86\u4e00\u4e9b\u5fc5\u8981\u529f\u80fd\uff0c\u4f7f\u4e4b\u4e0e Pydantic \u53ca FastAPI \u7684\u5176\u5b83\u90e8\u4ef6\u517c\u5bb9\u3002</p>"},{"location":"tutorial/request-files/#_2","title":"\u4ec0\u4e48\u662f \u300c\u8868\u5355\u6570\u636e\u300d","text":"<p>\u4e0e JSON \u4e0d\u540c\uff0cHTML \u8868\u5355\uff08<code>&lt;form&gt;&lt;/form&gt;</code>\uff09\u5411\u670d\u52a1\u5668\u53d1\u9001\u6570\u636e\u901a\u5e38\u4f7f\u7528\u300c\u7279\u6b8a\u300d\u7684\u7f16\u7801\u3002</p> <p>FastAPI \u8981\u786e\u4fdd\u4ece\u6b63\u786e\u7684\u4f4d\u7f6e\u8bfb\u53d6\u6570\u636e\uff0c\u800c\u4e0d\u662f\u8bfb\u53d6 JSON\u3002</p> <p>\u6280\u672f\u7ec6\u8282</p> <p>\u4e0d\u5305\u542b\u6587\u4ef6\u65f6\uff0c\u8868\u5355\u6570\u636e\u4e00\u822c\u7528 <code>application/x-www-form-urlencoded</code>\u300c\u5a92\u4f53\u7c7b\u578b\u300d\u7f16\u7801\u3002</p> <p>\u4f46\u8868\u5355\u5305\u542b\u6587\u4ef6\u65f6\uff0c\u7f16\u7801\u4e3a <code>multipart/form-data</code>\u3002\u4f7f\u7528\u4e86 <code>File</code>\uff0cFastAPI \u5c31\u77e5\u9053\u8981\u4ece\u8bf7\u6c42\u4f53\u7684\u6b63\u786e\u4f4d\u7f6e\u83b7\u53d6\u6587\u4ef6\u3002</p> <p>\u7f16\u7801\u548c\u8868\u5355\u5b57\u6bb5\u8be6\u89c1 MDN Web \u6587\u6863\u7684 <code>POST </code> \u5c0f\u8282\u3002</p> <p>\u8b66\u544a</p> <p>\u53ef\u5728\u4e00\u4e2a\u8def\u5f84\u64cd\u4f5c\u4e2d\u58f0\u660e\u591a\u4e2a <code>File</code> \u548c <code>Form</code> \u53c2\u6570\uff0c\u4f46\u4e0d\u80fd\u540c\u65f6\u58f0\u660e\u8981\u63a5\u6536 JSON \u7684 <code>Body</code> \u5b57\u6bb5\u3002\u56e0\u4e3a\u6b64\u65f6\u8bf7\u6c42\u4f53\u7684\u7f16\u7801\u662f <code>multipart/form-data</code>\uff0c\u4e0d\u662f <code>application/json</code>\u3002</p> <p>\u8fd9\u4e0d\u662f FastAPI \u7684\u95ee\u9898\uff0c\u800c\u662f HTTP \u534f\u8bae\u7684\u89c4\u5b9a\u3002</p>"},{"location":"tutorial/request-files/#_3","title":"\u53ef\u9009\u6587\u4ef6\u4e0a\u4f20","text":"<p>\u60a8\u53ef\u4ee5\u901a\u8fc7\u4f7f\u7528\u6807\u51c6\u7c7b\u578b\u6ce8\u89e3\u5e76\u5c06 None \u4f5c\u4e3a\u9ed8\u8ba4\u503c\u7684\u65b9\u5f0f\u5c06\u4e00\u4e2a\u6587\u4ef6\u53c2\u6570\u8bbe\u4e3a\u53ef\u9009:</p> Python 3.9+Python 3.6+ <pre><code>from fastapi import FastAPI, File, UploadFile\n\napp = FastAPI()\n\n\n@app.post(\"/files/\")\nasync def create_file(file: bytes | None = File(default=None)):\nif not file:\n        return {\"message\": \"No file sent\"}\n    else:\n        return {\"file_size\": len(file)}\n\n\n@app.post(\"/uploadfile/\")\nasync def create_upload_file(file: UploadFile | None = None):\n    if not file:\n        return {\"message\": \"No upload file sent\"}\n    else:\n        return {\"filename\": file.filename}\n</code></pre> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI, File, UploadFile\n\napp = FastAPI()\n\n\n@app.post(\"/files/\")\nasync def create_file(file: Union[bytes, None] = File(default=None)):\nif not file:\n        return {\"message\": \"No file sent\"}\n    else:\n        return {\"file_size\": len(file)}\n\n\n@app.post(\"/uploadfile/\")\nasync def create_upload_file(file: Union[UploadFile, None] = None):\nif not file:\n        return {\"message\": \"No upload file sent\"}\n    else:\n        return {\"filename\": file.filename}\n</code></pre>"},{"location":"tutorial/request-files/#uploadfile_2","title":"\u5e26\u6709\u989d\u5916\u5143\u6570\u636e\u7684 <code>UploadFile</code>","text":"<p>\u60a8\u4e5f\u53ef\u4ee5\u5c06 <code>File()</code> \u4e0e <code>UploadFile</code> \u4e00\u8d77\u4f7f\u7528\uff0c\u4f8b\u5982\uff0c\u8bbe\u7f6e\u989d\u5916\u7684\u5143\u6570\u636e:</p> <pre><code>from fastapi import FastAPI, File, UploadFile\n\napp = FastAPI()\n\n\n@app.post(\"/files/\")\nasync def create_file(file: bytes = File(description=\"A file read as bytes\")):\n    return {\"file_size\": len(file)}\n\n\n@app.post(\"/uploadfile/\")\nasync def create_upload_file(\nfile: UploadFile = File(description=\"A file read as UploadFile\"),\n):\n    return {\"filename\": file.filename}\n</code></pre>"},{"location":"tutorial/request-files/#_4","title":"\u591a\u6587\u4ef6\u4e0a\u4f20","text":"<p>FastAPI \u652f\u6301\u540c\u65f6\u4e0a\u4f20\u591a\u4e2a\u6587\u4ef6\u3002</p> <p>\u53ef\u7528\u540c\u4e00\u4e2a\u300c\u8868\u5355\u5b57\u6bb5\u300d\u53d1\u9001\u542b\u591a\u4e2a\u6587\u4ef6\u7684\u300c\u8868\u5355\u6570\u636e\u300d\u3002</p> <p>\u4e0a\u4f20\u591a\u4e2a\u6587\u4ef6\u65f6\uff0c\u8981\u58f0\u660e\u542b <code>bytes</code> \u6216 <code>UploadFile</code> \u7684\u5217\u8868\uff08<code>List</code>\uff09\uff1a</p> Python 3.9+Python 3.6+ <pre><code>from fastapi import FastAPI, File, UploadFile\nfrom fastapi.responses import HTMLResponse\n\napp = FastAPI()\n\n\n@app.post(\"/files/\")\nasync def create_files(files: list[bytes] = File()):\nreturn {\"file_sizes\": [len(file) for file in files]}\n\n\n@app.post(\"/uploadfiles/\")\nasync def create_upload_files(files: list[UploadFile]):\nreturn {\"filenames\": [file.filename for file in files]}\n\n\n@app.get(\"/\")\nasync def main():\n    content = \"\"\"\n&lt;body&gt;\n&lt;form action=\"/files/\" enctype=\"multipart/form-data\" method=\"post\"&gt;\n&lt;input name=\"files\" type=\"file\" multiple&gt;\n&lt;input type=\"submit\"&gt;\n&lt;/form&gt;\n&lt;form action=\"/uploadfiles/\" enctype=\"multipart/form-data\" method=\"post\"&gt;\n&lt;input name=\"files\" type=\"file\" multiple&gt;\n&lt;input type=\"submit\"&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n    \"\"\"\n    return HTMLResponse(content=content)\n</code></pre> <pre><code>from typing import List\n\nfrom fastapi import FastAPI, File, UploadFile\nfrom fastapi.responses import HTMLResponse\n\napp = FastAPI()\n\n\n@app.post(\"/files/\")\nasync def create_files(files: List[bytes] = File()):\nreturn {\"file_sizes\": [len(file) for file in files]}\n\n\n@app.post(\"/uploadfiles/\")\nasync def create_upload_files(files: List[UploadFile]):\nreturn {\"filenames\": [file.filename for file in files]}\n\n\n@app.get(\"/\")\nasync def main():\n    content = \"\"\"\n&lt;body&gt;\n&lt;form action=\"/files/\" enctype=\"multipart/form-data\" method=\"post\"&gt;\n&lt;input name=\"files\" type=\"file\" multiple&gt;\n&lt;input type=\"submit\"&gt;\n&lt;/form&gt;\n&lt;form action=\"/uploadfiles/\" enctype=\"multipart/form-data\" method=\"post\"&gt;\n&lt;input name=\"files\" type=\"file\" multiple&gt;\n&lt;input type=\"submit\"&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n    \"\"\"\n    return HTMLResponse(content=content)\n</code></pre> <p>\u63a5\u6536\u7684\u4e5f\u662f\u542b <code>bytes</code> \u6216 <code>UploadFile</code> \u7684\u5217\u8868\uff08<code>list</code>\uff09\u3002</p> <p>\u6280\u672f\u7ec6\u8282</p> <p>\u4e5f\u53ef\u4ee5\u4f7f\u7528 <code>from starlette.responses import HTMLResponse</code>\u3002</p> <p><code>fastapi.responses</code> \u5176\u5b9e\u4e0e <code>starlette.responses</code> \u76f8\u540c\uff0c\u53ea\u662f\u4e3a\u4e86\u65b9\u4fbf\u5f00\u53d1\u8005\u8c03\u7528\u3002\u5b9e\u9645\u4e0a\uff0c\u5927\u591a\u6570 FastAPI \u7684\u54cd\u5e94\u90fd\u76f4\u63a5\u4ece Starlette \u8c03\u7528\u3002</p>"},{"location":"tutorial/request-files/#_5","title":"\u5e26\u6709\u989d\u5916\u5143\u6570\u636e\u7684\u591a\u6587\u4ef6\u4e0a\u4f20","text":"<p>\u548c\u4e4b\u524d\u7684\u65b9\u5f0f\u4e00\u6837, \u60a8\u53ef\u4ee5\u4e3a <code>File()</code> \u8bbe\u7f6e\u989d\u5916\u53c2\u6570, \u5373\u4f7f\u662f <code>UploadFile</code>:</p> Python 3.9+Python 3.6+ <pre><code>from fastapi import FastAPI, File, UploadFile\nfrom fastapi.responses import HTMLResponse\n\napp = FastAPI()\n\n\n@app.post(\"/files/\")\nasync def create_files(\n    files: list[bytes] = File(description=\"Multiple files as bytes\"),\n):\n    return {\"file_sizes\": [len(file) for file in files]}\n\n\n@app.post(\"/uploadfiles/\")\nasync def create_upload_files(\nfiles: list[UploadFile] = File(description=\"Multiple files as UploadFile\"),\n):\n    return {\"filenames\": [file.filename for file in files]}\n\n\n@app.get(\"/\")\nasync def main():\n    content = \"\"\"\n&lt;body&gt;\n&lt;form action=\"/files/\" enctype=\"multipart/form-data\" method=\"post\"&gt;\n&lt;input name=\"files\" type=\"file\" multiple&gt;\n&lt;input type=\"submit\"&gt;\n&lt;/form&gt;\n&lt;form action=\"/uploadfiles/\" enctype=\"multipart/form-data\" method=\"post\"&gt;\n&lt;input name=\"files\" type=\"file\" multiple&gt;\n&lt;input type=\"submit\"&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n    \"\"\"\n    return HTMLResponse(content=content)\n</code></pre> <pre><code>from typing import List\n\nfrom fastapi import FastAPI, File, UploadFile\nfrom fastapi.responses import HTMLResponse\n\napp = FastAPI()\n\n\n@app.post(\"/files/\")\nasync def create_files(\n    files: List[bytes] = File(description=\"Multiple files as bytes\"),\n):\n    return {\"file_sizes\": [len(file) for file in files]}\n\n\n@app.post(\"/uploadfiles/\")\nasync def create_upload_files(\nfiles: List[UploadFile] = File(description=\"Multiple files as UploadFile\"),\n):\n    return {\"filenames\": [file.filename for file in files]}\n\n\n@app.get(\"/\")\nasync def main():\n    content = \"\"\"\n&lt;body&gt;\n&lt;form action=\"/files/\" enctype=\"multipart/form-data\" method=\"post\"&gt;\n&lt;input name=\"files\" type=\"file\" multiple&gt;\n&lt;input type=\"submit\"&gt;\n&lt;/form&gt;\n&lt;form action=\"/uploadfiles/\" enctype=\"multipart/form-data\" method=\"post\"&gt;\n&lt;input name=\"files\" type=\"file\" multiple&gt;\n&lt;input type=\"submit\"&gt;\n&lt;/form&gt;\n&lt;/body&gt;\n    \"\"\"\n    return HTMLResponse(content=content)\n</code></pre>"},{"location":"tutorial/request-files/#_6","title":"\u5c0f\u7ed3","text":"<p>\u672c\u8282\u4ecb\u7ecd\u4e86\u5982\u4f55\u7528 <code>File</code> \u628a\u4e0a\u4f20\u6587\u4ef6\u58f0\u660e\u4e3a\uff08\u8868\u5355\u6570\u636e\u7684\uff09\u8f93\u5165\u53c2\u6570\u3002</p>"},{"location":"tutorial/request-forms-and-files/","title":"\u8bf7\u6c42\u8868\u5355\u4e0e\u6587\u4ef6","text":"<p>FastAPI \u652f\u6301\u540c\u65f6\u4f7f\u7528 <code>File</code> \u548c <code>Form</code> \u5b9a\u4e49\u6587\u4ef6\u548c\u8868\u5355\u5b57\u6bb5\u3002</p> <p>\u8bf4\u660e</p> <p>\u63a5\u6536\u4e0a\u4f20\u6587\u4ef6\u6216\u8868\u5355\u6570\u636e\uff0c\u8981\u9884\u5148\u5b89\u88c5 <code>python-multipart</code>\u3002</p> <p>\u4f8b\u5982\uff0c<code>pip install python-multipart</code>\u3002</p>"},{"location":"tutorial/request-forms-and-files/#file-form","title":"\u5bfc\u5165 <code>File</code> \u4e0e <code>Form</code>","text":"<pre><code>from fastapi import FastAPI, File, Form, UploadFile\napp = FastAPI()\n\n\n@app.post(\"/files/\")\nasync def create_file(\n    file: bytes = File(), fileb: UploadFile = File(), token: str = Form()\n):\n    return {\n        \"file_size\": len(file),\n        \"token\": token,\n        \"fileb_content_type\": fileb.content_type,\n    }\n</code></pre>"},{"location":"tutorial/request-forms-and-files/#file-form_1","title":"\u5b9a\u4e49 <code>File</code> \u4e0e <code>Form</code> \u53c2\u6570","text":"<p>\u521b\u5efa\u6587\u4ef6\u548c\u8868\u5355\u53c2\u6570\u7684\u65b9\u5f0f\u4e0e <code>Body</code> \u548c <code>Query</code> \u4e00\u6837\uff1a</p> <pre><code>from fastapi import FastAPI, File, Form, UploadFile\n\napp = FastAPI()\n\n\n@app.post(\"/files/\")\nasync def create_file(\nfile: bytes = File(), fileb: UploadFile = File(), token: str = Form()\n):\n    return {\n        \"file_size\": len(file),\n        \"token\": token,\n        \"fileb_content_type\": fileb.content_type,\n    }\n</code></pre> <p>\u6587\u4ef6\u548c\u8868\u5355\u5b57\u6bb5\u4f5c\u4e3a\u8868\u5355\u6570\u636e\u4e0a\u4f20\u4e0e\u63a5\u6536\u3002</p> <p>\u58f0\u660e\u6587\u4ef6\u53ef\u4ee5\u4f7f\u7528 <code>bytes</code> \u6216 <code>UploadFile</code> \u3002</p> <p>\u8b66\u544a</p> <p>\u53ef\u5728\u4e00\u4e2a\u8def\u5f84\u64cd\u4f5c\u4e2d\u58f0\u660e\u591a\u4e2a <code>File</code> \u4e0e <code>Form</code> \u53c2\u6570\uff0c\u4f46\u4e0d\u80fd\u540c\u65f6\u58f0\u660e\u8981\u63a5\u6536 JSON \u7684 <code>Body</code> \u5b57\u6bb5\u3002\u56e0\u4e3a\u6b64\u65f6\u8bf7\u6c42\u4f53\u7684\u7f16\u7801\u4e3a <code>multipart/form-data</code>\uff0c\u4e0d\u662f <code>application/json</code>\u3002</p> <p>\u8fd9\u4e0d\u662f FastAPI \u7684\u95ee\u9898\uff0c\u800c\u662f HTTP \u534f\u8bae\u7684\u89c4\u5b9a\u3002</p>"},{"location":"tutorial/request-forms-and-files/#_2","title":"\u5c0f\u7ed3","text":"<p>\u5728\u540c\u4e00\u4e2a\u8bf7\u6c42\u4e2d\u63a5\u6536\u6570\u636e\u548c\u6587\u4ef6\u65f6\uff0c\u5e94\u540c\u65f6\u4f7f\u7528 <code>File</code> \u548c <code>Form</code>\u3002</p>"},{"location":"tutorial/request-forms/","title":"\u8868\u5355\u6570\u636e","text":"<p>\u63a5\u6536\u7684\u4e0d\u662f JSON\uff0c\u800c\u662f\u8868\u5355\u5b57\u6bb5\u65f6\uff0c\u8981\u4f7f\u7528 <code>Form</code>\u3002</p> <p>\u8bf4\u660e</p> <p>\u8981\u4f7f\u7528\u8868\u5355\uff0c\u9700\u9884\u5148\u5b89\u88c5 <code>python-multipart</code>\u3002</p> <p>\u4f8b\u5982\uff0c<code>pip install python-multipart</code>\u3002</p>"},{"location":"tutorial/request-forms/#form","title":"\u5bfc\u5165 <code>Form</code>","text":"<p>\u4ece <code>fastapi</code> \u5bfc\u5165 <code>Form</code>\uff1a</p> <pre><code>from fastapi import FastAPI, Form\napp = FastAPI()\n\n\n@app.post(\"/login/\")\nasync def login(username: str = Form(), password: str = Form()):\n    return {\"username\": username}\n</code></pre>"},{"location":"tutorial/request-forms/#form_1","title":"\u5b9a\u4e49 <code>Form</code> \u53c2\u6570","text":"<p>\u521b\u5efa\u8868\u5355\uff08<code>Form</code>\uff09\u53c2\u6570\u7684\u65b9\u5f0f\u4e0e <code>Body</code> \u548c <code>Query</code> \u4e00\u6837\uff1a</p> <pre><code>from fastapi import FastAPI, Form\n\napp = FastAPI()\n\n\n@app.post(\"/login/\")\nasync def login(username: str = Form(), password: str = Form()):\nreturn {\"username\": username}\n</code></pre> <p>\u4f8b\u5982\uff0cOAuth2 \u89c4\u8303\u7684 \"\u5bc6\u7801\u6d41\" \u6a21\u5f0f\u89c4\u5b9a\u8981\u901a\u8fc7\u8868\u5355\u5b57\u6bb5\u53d1\u9001 <code>username</code> \u548c <code>password</code>\u3002</p> <p>\u8be5\u89c4\u8303\u8981\u6c42\u5b57\u6bb5\u5fc5\u987b\u547d\u540d\u4e3a <code>username</code> \u548c <code>password</code>\uff0c\u5e76\u901a\u8fc7\u8868\u5355\u5b57\u6bb5\u53d1\u9001\uff0c\u4e0d\u80fd\u7528 JSON\u3002</p> <p>\u4f7f\u7528 <code>Form</code> \u53ef\u4ee5\u58f0\u660e\u4e0e <code>Body</code> \uff08\u53ca <code>Query</code>\u3001<code>Path</code>\u3001<code>Cookie</code>\uff09\u76f8\u540c\u7684\u5143\u6570\u636e\u548c\u9a8c\u8bc1\u3002</p> <p>\u8bf4\u660e</p> <p><code>Form</code> \u662f\u76f4\u63a5\u7ee7\u627f\u81ea <code>Body</code> \u7684\u7c7b\u3002</p> <p>\u63d0\u793a</p> <p>\u58f0\u660e\u8868\u5355\u4f53\u8981\u663e\u5f0f\u4f7f\u7528 <code>Form</code> \uff0c\u5426\u5219\uff0cFastAPI \u4f1a\u628a\u8be5\u53c2\u6570\u5f53\u4f5c\u67e5\u8be2\u53c2\u6570\u6216\u8bf7\u6c42\u4f53\uff08JSON\uff09\u53c2\u6570\u3002</p>"},{"location":"tutorial/request-forms/#_2","title":"\u5173\u4e8e \"\u8868\u5355\u5b57\u6bb5\"","text":"<p>\u4e0e JSON \u4e0d\u540c\uff0cHTML \u8868\u5355\uff08<code>&lt;form&gt;&lt;/form&gt;</code>\uff09\u5411\u670d\u52a1\u5668\u53d1\u9001\u6570\u636e\u901a\u5e38\u4f7f\u7528\u300c\u7279\u6b8a\u300d\u7684\u7f16\u7801\u3002</p> <p>FastAPI \u8981\u786e\u4fdd\u4ece\u6b63\u786e\u7684\u4f4d\u7f6e\u8bfb\u53d6\u6570\u636e\uff0c\u800c\u4e0d\u662f\u8bfb\u53d6 JSON\u3002</p> <p>\u6280\u672f\u7ec6\u8282</p> <p>\u8868\u5355\u6570\u636e\u7684\u300c\u5a92\u4f53\u7c7b\u578b\u300d\u7f16\u7801\u4e00\u822c\u4e3a <code>application/x-www-form-urlencoded</code>\u3002</p> <p>\u4f46\u5305\u542b\u6587\u4ef6\u7684\u8868\u5355\u7f16\u7801\u4e3a <code>multipart/form-data</code>\u3002\u6587\u4ef6\u5904\u7406\u8be6\u89c1\u4e0b\u8282\u3002</p> <p>\u7f16\u7801\u548c\u8868\u5355\u5b57\u6bb5\u8be6\u89c1 MDN Web \u6587\u6863\u7684 <code>POST</code>\u5c0f\u8282\u3002</p> <p>\u8b66\u544a</p> <p>\u53ef\u5728\u4e00\u4e2a\u8def\u5f84\u64cd\u4f5c\u4e2d\u58f0\u660e\u591a\u4e2a <code>Form</code> \u53c2\u6570\uff0c\u4f46\u4e0d\u80fd\u540c\u65f6\u58f0\u660e\u8981\u63a5\u6536 JSON \u7684 <code>Body</code> \u5b57\u6bb5\u3002\u56e0\u4e3a\u6b64\u65f6\u8bf7\u6c42\u4f53\u7684\u7f16\u7801\u662f <code>application/x-www-form-urlencoded</code>\uff0c\u4e0d\u662f <code>application/json</code>\u3002</p> <p>\u8fd9\u4e0d\u662f FastAPI \u7684\u95ee\u9898\uff0c\u800c\u662f HTTP \u534f\u8bae\u7684\u89c4\u5b9a\u3002</p>"},{"location":"tutorial/request-forms/#_3","title":"\u5c0f\u7ed3","text":"<p>\u672c\u8282\u4ecb\u7ecd\u4e86\u5982\u4f55\u4f7f\u7528 <code>Form</code> \u58f0\u660e\u8868\u5355\u6570\u636e\u8f93\u5165\u53c2\u6570\u3002</p>"},{"location":"tutorial/response-model/","title":"\u54cd\u5e94\u6a21\u578b","text":"<p>\u4f60\u53ef\u4ee5\u5728\u4efb\u610f\u7684\u8def\u5f84\u64cd\u4f5c\u4e2d\u4f7f\u7528 <code>response_model</code> \u53c2\u6570\u6765\u58f0\u660e\u7528\u4e8e\u54cd\u5e94\u7684\u6a21\u578b\uff1a</p> <ul> <li><code>@app.get()</code></li> <li><code>@app.post()</code></li> <li><code>@app.put()</code></li> <li><code>@app.delete()</code></li> <li>\u7b49\u7b49\u3002</li> </ul> <pre><code>from typing import Any, List, Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n    tags: List[str] = []\n\n\n@app.post(\"/items/\", response_model=Item)\nasync def create_item(item: Item) -&gt; Any:\n    return item\n\n\n@app.get(\"/items/\", response_model=List[Item])\nasync def read_items() -&gt; Any:\n    return [\n        {\"name\": \"Portal Gun\", \"price\": 42.0},\n        {\"name\": \"Plumbus\", \"price\": 32.0},\n    ]\n</code></pre> <p>Note</p> <p>\u6ce8\u610f\uff0c<code>response_model</code>\u662f\u300c\u88c5\u9970\u5668\u300d\u65b9\u6cd5\uff08<code>get</code>\uff0c<code>post</code> \u7b49\uff09\u7684\u4e00\u4e2a\u53c2\u6570\u3002\u4e0d\u50cf\u4e4b\u524d\u7684\u6240\u6709\u53c2\u6570\u548c\u8bf7\u6c42\u4f53\uff0c\u5b83\u4e0d\u5c5e\u4e8e\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u3002</p> <p>\u5b83\u63a5\u6536\u7684\u7c7b\u578b\u4e0e\u4f60\u5c06\u4e3a Pydantic \u6a21\u578b\u5c5e\u6027\u6240\u58f0\u660e\u7684\u7c7b\u578b\u76f8\u540c\uff0c\u56e0\u6b64\u5b83\u53ef\u4ee5\u662f\u4e00\u4e2a Pydantic \u6a21\u578b\uff0c\u4f46\u4e5f\u53ef\u4ee5\u662f\u4e00\u4e2a\u7531 Pydantic \u6a21\u578b\u7ec4\u6210\u7684 <code>list</code>\uff0c\u4f8b\u5982 <code>List[Item]</code>\u3002</p> <p>FastAPI \u5c06\u4f7f\u7528\u6b64 <code>response_model</code> \u6765\uff1a</p> <ul> <li>\u5c06\u8f93\u51fa\u6570\u636e\u8f6c\u6362\u4e3a\u5176\u58f0\u660e\u7684\u7c7b\u578b\u3002</li> <li>\u6821\u9a8c\u6570\u636e\u3002</li> <li>\u5728 OpenAPI \u7684\u8def\u5f84\u64cd\u4f5c\u4e2d\u4e3a\u54cd\u5e94\u6dfb\u52a0\u4e00\u4e2a JSON Schema\u3002</li> <li>\u5e76\u5728\u81ea\u52a8\u751f\u6210\u6587\u6863\u7cfb\u7edf\u4e2d\u4f7f\u7528\u3002</li> </ul> <p>\u4f46\u6700\u91cd\u8981\u7684\u662f\uff1a</p> <ul> <li>\u4f1a\u5c06\u8f93\u51fa\u6570\u636e\u9650\u5236\u5728\u8be5\u6a21\u578b\u5b9a\u4e49\u5185\u3002\u4e0b\u9762\u6211\u4eec\u4f1a\u770b\u5230\u8fd9\u4e00\u70b9\u6709\u591a\u91cd\u8981\u3002</li> </ul> <p>\u6280\u672f\u7ec6\u8282</p> <p>\u54cd\u5e94\u6a21\u578b\u5728\u53c2\u6570\u4e2d\u88ab\u58f0\u660e\uff0c\u800c\u4e0d\u662f\u4f5c\u4e3a\u51fd\u6570\u8fd4\u56de\u7c7b\u578b\u7684\u6ce8\u89e3\uff0c\u8fd9\u662f\u56e0\u4e3a\u8def\u5f84\u51fd\u6570\u53ef\u80fd\u4e0d\u4f1a\u771f\u6b63\u8fd4\u56de\u8be5\u54cd\u5e94\u6a21\u578b\uff0c\u800c\u662f\u8fd4\u56de\u4e00\u4e2a <code>dict</code>\u3001\u6570\u636e\u5e93\u5bf9\u8c61\u6216\u5176\u4ed6\u6a21\u578b\uff0c\u7136\u540e\u518d\u4f7f\u7528 <code>response_model</code> \u6765\u6267\u884c\u5b57\u6bb5\u7ea6\u675f\u548c\u5e8f\u5217\u5316\u3002</p>"},{"location":"tutorial/response-model/#_2","title":"\u8fd4\u56de\u4e0e\u8f93\u5165\u76f8\u540c\u7684\u6570\u636e","text":"<p>\u73b0\u5728\u6211\u4eec\u58f0\u660e\u4e00\u4e2a <code>UserIn</code> \u6a21\u578b\uff0c\u5b83\u5c06\u5305\u542b\u4e00\u4e2a\u660e\u6587\u5bc6\u7801\u5c5e\u6027\u3002</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel, EmailStr\n\napp = FastAPI()\n\n\nclass UserIn(BaseModel):\nusername: str\npassword: str\nemail: EmailStr\n    full_name: Union[str, None] = None\n\n\n# Don't do this in production!\n@app.post(\"/user/\")\nasync def create_user(user: UserIn) -&gt; UserIn:\n    return user\n</code></pre> <p>\u6211\u4eec\u6b63\u5728\u4f7f\u7528\u6b64\u6a21\u578b\u58f0\u660e\u8f93\u5165\u6570\u636e\uff0c\u5e76\u4f7f\u7528\u540c\u4e00\u6a21\u578b\u58f0\u660e\u8f93\u51fa\u6570\u636e\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel, EmailStr\n\napp = FastAPI()\n\n\nclass UserIn(BaseModel):\n    username: str\n    password: str\n    email: EmailStr\n    full_name: Union[str, None] = None\n\n\n# Don't do this in production!\n@app.post(\"/user/\")\nasync def create_user(user: UserIn) -&gt; UserIn:\nreturn user\n</code></pre> <p>\u73b0\u5728\uff0c\u6bcf\u5f53\u6d4f\u89c8\u5668\u4f7f\u7528\u4e00\u4e2a\u5bc6\u7801\u521b\u5efa\u7528\u6237\u65f6\uff0cAPI \u90fd\u4f1a\u5728\u54cd\u5e94\u4e2d\u8fd4\u56de\u76f8\u540c\u7684\u5bc6\u7801\u3002</p> <p>\u5728\u8fd9\u4e2a\u6848\u4f8b\u4e2d\uff0c\u8fd9\u53ef\u80fd\u4e0d\u7b97\u662f\u95ee\u9898\uff0c\u56e0\u4e3a\u7528\u6237\u81ea\u5df1\u6b63\u5728\u53d1\u9001\u5bc6\u7801\u3002</p> <p>\u4f46\u662f\uff0c\u5982\u679c\u6211\u4eec\u5728\u5176\u4ed6\u7684\u8def\u5f84\u64cd\u4f5c\u4e2d\u4f7f\u7528\u76f8\u540c\u7684\u6a21\u578b\uff0c\u5219\u53ef\u80fd\u4f1a\u5c06\u7528\u6237\u7684\u5bc6\u7801\u53d1\u9001\u7ed9\u6bcf\u4e2a\u5ba2\u6237\u7aef\u3002</p> <p>Danger</p> <p>\u6c38\u8fdc\u4e0d\u8981\u5b58\u50a8\u7528\u6237\u7684\u660e\u6587\u5bc6\u7801\uff0c\u4e5f\u4e0d\u8981\u5728\u54cd\u5e94\u4e2d\u53d1\u9001\u5bc6\u7801\u3002</p>"},{"location":"tutorial/response-model/#_3","title":"\u6dfb\u52a0\u8f93\u51fa\u6a21\u578b","text":"<p>\u76f8\u53cd\uff0c\u6211\u4eec\u53ef\u4ee5\u521b\u5efa\u4e00\u4e2a\u6709\u660e\u6587\u5bc6\u7801\u7684\u8f93\u5165\u6a21\u578b\u548c\u4e00\u4e2a\u6ca1\u6709\u660e\u6587\u5bc6\u7801\u7684\u8f93\u51fa\u6a21\u578b\uff1a</p> <pre><code>from typing import Any, Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel, EmailStr\n\napp = FastAPI()\n\n\nclass UserIn(BaseModel):\nusername: str\npassword: str\nemail: EmailStr\n    full_name: Union[str, None] = None\n\n\nclass UserOut(BaseModel):\nusername: str\n    email: EmailStr\n    full_name: Union[str, None] = None\n\n\n@app.post(\"/user/\", response_model=UserOut)\nasync def create_user(user: UserIn) -&gt; Any:\n    return user\n</code></pre> <p>\u8fd9\u6837\uff0c\u5373\u4fbf\u6211\u4eec\u7684\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u5c06\u4f1a\u8fd4\u56de\u5305\u542b\u5bc6\u7801\u7684\u76f8\u540c\u8f93\u5165\u7528\u6237\uff1a</p> <pre><code>from typing import Any, Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel, EmailStr\n\napp = FastAPI()\n\n\nclass UserIn(BaseModel):\n    username: str\n    password: str\n    email: EmailStr\n    full_name: Union[str, None] = None\n\n\nclass UserOut(BaseModel):\n    username: str\n    email: EmailStr\n    full_name: Union[str, None] = None\n\n\n@app.post(\"/user/\", response_model=UserOut)\nasync def create_user(user: UserIn) -&gt; Any:\nreturn user\n</code></pre> <p>...\u6211\u4eec\u5df2\u7ecf\u5c06 <code>response_model</code> \u58f0\u660e\u4e3a\u4e86\u4e0d\u5305\u542b\u5bc6\u7801\u7684 <code>UserOut</code> \u6a21\u578b\uff1a</p> <pre><code>from typing import Any, Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel, EmailStr\n\napp = FastAPI()\n\n\nclass UserIn(BaseModel):\n    username: str\n    password: str\n    email: EmailStr\n    full_name: Union[str, None] = None\n\n\nclass UserOut(BaseModel):\n    username: str\n    email: EmailStr\n    full_name: Union[str, None] = None\n\n\n@app.post(\"/user/\", response_model=UserOut)\nasync def create_user(user: UserIn) -&gt; Any:\n    return user\n</code></pre> <p>\u56e0\u6b64\uff0cFastAPI \u5c06\u4f1a\u8d1f\u8d23\u8fc7\u6ee4\u6389\u672a\u5728\u8f93\u51fa\u6a21\u578b\u4e2d\u58f0\u660e\u7684\u6240\u6709\u6570\u636e\uff08\u4f7f\u7528 Pydantic\uff09\u3002</p>"},{"location":"tutorial/response-model/#_4","title":"\u5728\u6587\u6863\u4e2d\u67e5\u770b","text":"<p>\u5f53\u4f60\u67e5\u770b\u81ea\u52a8\u5316\u6587\u6863\u65f6\uff0c\u4f60\u53ef\u4ee5\u68c0\u67e5\u8f93\u5165\u6a21\u578b\u548c\u8f93\u51fa\u6a21\u578b\u662f\u5426\u90fd\u5177\u6709\u81ea\u5df1\u7684 JSON Schema\uff1a</p> <p></p> <p>\u5e76\u4e14\u4e24\u79cd\u6a21\u578b\u90fd\u5c06\u5728\u4ea4\u4e92\u5f0f API \u6587\u6863\u4e2d\u4f7f\u7528\uff1a</p> <p></p>"},{"location":"tutorial/response-model/#_5","title":"\u54cd\u5e94\u6a21\u578b\u7f16\u7801\u53c2\u6570","text":"<p>\u4f60\u7684\u54cd\u5e94\u6a21\u578b\u53ef\u4ee5\u5177\u6709\u9ed8\u8ba4\u503c\uff0c\u4f8b\u5982\uff1a</p> <pre><code>from typing import List, Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\ndescription: Union[str, None] = None\nprice: float\ntax: float = 10.5\ntags: List[str] = []\nitems = {\n    \"foo\": {\"name\": \"Foo\", \"price\": 50.2},\n    \"bar\": {\"name\": \"Bar\", \"description\": \"The bartenders\", \"price\": 62, \"tax\": 20.2},\n    \"baz\": {\"name\": \"Baz\", \"description\": None, \"price\": 50.2, \"tax\": 10.5, \"tags\": []},\n}\n\n\n@app.get(\"/items/{item_id}\", response_model=Item, response_model_exclude_unset=True)\nasync def read_item(item_id: str):\n    return items[item_id]\n</code></pre> <ul> <li><code>description: Union[str, None] = None</code> \u5177\u6709\u9ed8\u8ba4\u503c <code>None</code>\u3002</li> <li><code>tax: float = 10.5</code> \u5177\u6709\u9ed8\u8ba4\u503c <code>10.5</code>.</li> <li><code>tags: List[str] = []</code> \u5177\u6709\u4e00\u4e2a\u7a7a\u5217\u8868\u4f5c\u4e3a\u9ed8\u8ba4\u503c\uff1a <code>[]</code>.</li> </ul> <p>\u4f46\u5982\u679c\u5b83\u4eec\u5e76\u6ca1\u6709\u5b58\u50a8\u5b9e\u9645\u7684\u503c\uff0c\u4f60\u53ef\u80fd\u60f3\u4ece\u7ed3\u679c\u4e2d\u5ffd\u7565\u5b83\u4eec\u7684\u9ed8\u8ba4\u503c\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5f53\u4f60\u5728 NoSQL \u6570\u636e\u5e93\u4e2d\u4fdd\u5b58\u4e86\u5177\u6709\u8bb8\u591a\u53ef\u9009\u5c5e\u6027\u7684\u6a21\u578b\uff0c\u4f46\u4f60\u53c8\u4e0d\u60f3\u53d1\u9001\u5145\u6ee1\u9ed8\u8ba4\u503c\u7684\u5f88\u957f\u7684 JSON \u54cd\u5e94\u3002</p>"},{"location":"tutorial/response-model/#response_model_exclude_unset","title":"\u4f7f\u7528 <code>response_model_exclude_unset</code> \u53c2\u6570","text":"<p>\u4f60\u53ef\u4ee5\u8bbe\u7f6e\u8def\u5f84\u64cd\u4f5c\u88c5\u9970\u5668\u7684 <code>response_model_exclude_unset=True</code> \u53c2\u6570\uff1a</p> <pre><code>from typing import List, Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: float = 10.5\n    tags: List[str] = []\n\n\nitems = {\n    \"foo\": {\"name\": \"Foo\", \"price\": 50.2},\n    \"bar\": {\"name\": \"Bar\", \"description\": \"The bartenders\", \"price\": 62, \"tax\": 20.2},\n    \"baz\": {\"name\": \"Baz\", \"description\": None, \"price\": 50.2, \"tax\": 10.5, \"tags\": []},\n}\n\n\n@app.get(\"/items/{item_id}\", response_model=Item, response_model_exclude_unset=True)\nasync def read_item(item_id: str):\n    return items[item_id]\n</code></pre> <p>\u7136\u540e\u54cd\u5e94\u4e2d\u5c06\u4e0d\u4f1a\u5305\u542b\u90a3\u4e9b\u9ed8\u8ba4\u503c\uff0c\u800c\u662f\u4ec5\u6709\u5b9e\u9645\u8bbe\u7f6e\u7684\u503c\u3002</p> <p>\u56e0\u6b64\uff0c\u5982\u679c\u4f60\u5411\u8def\u5f84\u64cd\u4f5c\u53d1\u9001 ID \u4e3a <code>foo</code> \u7684\u5546\u54c1\u7684\u8bf7\u6c42\uff0c\u5219\u54cd\u5e94\uff08\u4e0d\u5305\u62ec\u9ed8\u8ba4\u503c\uff09\u5c06\u4e3a\uff1a</p> <pre><code>{\n\"name\": \"Foo\",\n\"price\": 50.2\n}\n</code></pre> <p>Info</p> <p>FastAPI \u901a\u8fc7 Pydantic \u6a21\u578b\u7684 <code>.dict()</code> \u914d\u5408 \u8be5\u65b9\u6cd5\u7684 <code>exclude_unset</code> \u53c2\u6570 \u6765\u5b9e\u73b0\u6b64\u529f\u80fd\u3002</p> <p>Info</p> <p>\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528\uff1a</p> <ul> <li><code>response_model_exclude_defaults=True</code></li> <li><code>response_model_exclude_none=True</code></li> </ul> <p>\u53c2\u8003 Pydantic \u6587\u6863 \u4e2d\u5bf9 <code>exclude_defaults</code> \u548c <code>exclude_none</code> \u7684\u63cf\u8ff0\u3002</p>"},{"location":"tutorial/response-model/#_6","title":"\u9ed8\u8ba4\u503c\u5b57\u6bb5\u6709\u5b9e\u9645\u503c\u7684\u6570\u636e","text":"<p>\u4f46\u662f\uff0c\u5982\u679c\u4f60\u7684\u6570\u636e\u5728\u5177\u6709\u9ed8\u8ba4\u503c\u7684\u6a21\u578b\u5b57\u6bb5\u4e2d\u6709\u5b9e\u9645\u7684\u503c\uff0c\u4f8b\u5982 ID \u4e3a <code>bar</code> \u7684\u9879\uff1a</p> <pre><code>{\n    \"name\": \"Bar\",\n\"description\": \"The bartenders\",\n\"price\": 62,\n\"tax\": 20.2\n}\n</code></pre> <p>\u8fd9\u4e9b\u503c\u5c06\u5305\u542b\u5728\u54cd\u5e94\u4e2d\u3002</p>"},{"location":"tutorial/response-model/#_7","title":"\u5177\u6709\u4e0e\u9ed8\u8ba4\u503c\u76f8\u540c\u503c\u7684\u6570\u636e","text":"<p>\u5982\u679c\u6570\u636e\u5177\u6709\u4e0e\u9ed8\u8ba4\u503c\u76f8\u540c\u7684\u503c\uff0c\u4f8b\u5982 ID \u4e3a <code>baz</code> \u7684\u9879\uff1a</p> <pre><code>{\n    \"name\": \"Baz\",\n\"description\": None,\n\"price\": 50.2,\n\"tax\": 10.5,\n\"tags\": []\n}\n</code></pre> <p>\u5373\u4f7f <code>description</code>\u3001<code>tax</code> \u548c <code>tags</code> \u5177\u6709\u4e0e\u9ed8\u8ba4\u503c\u76f8\u540c\u7684\u503c\uff0cFastAPI \u8db3\u591f\u806a\u660e (\u5b9e\u9645\u4e0a\u662f Pydantic \u8db3\u591f\u806a\u660e) \u53bb\u8ba4\u8bc6\u5230\u8fd9\u4e00\u70b9\uff0c\u5b83\u4eec\u7684\u503c\u88ab\u663e\u5f0f\u5730\u6240\u8bbe\u5b9a\uff08\u800c\u4e0d\u662f\u53d6\u81ea\u9ed8\u8ba4\u503c\uff09\u3002</p> <p>\u56e0\u6b64\uff0c\u5b83\u4eec\u5c06\u5305\u542b\u5728 JSON \u54cd\u5e94\u4e2d\u3002</p> <p>Tip</p> <p>\u8bf7\u6ce8\u610f\u9ed8\u8ba4\u503c\u53ef\u4ee5\u662f\u4efb\u4f55\u503c\uff0c\u800c\u4e0d\u4ec5\u662f<code>None</code>\u3002</p> <p>\u5b83\u4eec\u53ef\u4ee5\u662f\u4e00\u4e2a\u5217\u8868\uff08<code>[]</code>\uff09\uff0c\u4e00\u4e2a\u503c\u4e3a <code>10.5</code>\u7684 <code>float</code>\uff0c\u7b49\u7b49\u3002</p>"},{"location":"tutorial/response-model/#response_model_include-response_model_exclude","title":"<code>response_model_include</code> \u548c <code>response_model_exclude</code>","text":"<p>\u4f60\u8fd8\u53ef\u4ee5\u4f7f\u7528\u8def\u5f84\u64cd\u4f5c\u88c5\u9970\u5668\u7684 <code>response_model_include</code> \u548c <code>response_model_exclude</code> \u53c2\u6570\u3002</p> <p>\u5b83\u4eec\u63a5\u6536\u4e00\u4e2a\u7531\u5c5e\u6027\u540d\u79f0 <code>str</code> \u7ec4\u6210\u7684 <code>set</code> \u6765\u5305\u542b\uff08\u5ffd\u7565\u5176\u4ed6\u7684\uff09\u6216\u8005\u6392\u9664\uff08\u5305\u542b\u5176\u4ed6\u7684\uff09\u8fd9\u4e9b\u5c5e\u6027\u3002</p> <p>\u5982\u679c\u4f60\u53ea\u6709\u4e00\u4e2a Pydantic \u6a21\u578b\uff0c\u5e76\u4e14\u60f3\u8981\u4ece\u8f93\u51fa\u4e2d\u79fb\u9664\u4e00\u4e9b\u6570\u636e\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528\u8fd9\u79cd\u5feb\u6377\u65b9\u6cd5\u3002</p> <p>Tip</p> <p>\u4f46\u662f\u4f9d\u7136\u5efa\u8bae\u4f60\u4f7f\u7528\u4e0a\u9762\u63d0\u5230\u7684\u4e3b\u610f\uff0c\u4f7f\u7528\u591a\u4e2a\u7c7b\u800c\u4e0d\u662f\u8fd9\u4e9b\u53c2\u6570\u3002</p> <p>\u8fd9\u662f\u56e0\u4e3a\u5373\u4f7f\u4f7f\u7528 <code>response_model_include</code> \u6216 <code>response_model_exclude</code> \u6765\u7701\u7565\u67d0\u4e9b\u5c5e\u6027\uff0c\u5728\u5e94\u7528\u7a0b\u5e8f\u7684 OpenAPI \u5b9a\u4e49\uff08\u548c\u6587\u6863\uff09\u4e2d\u751f\u6210\u7684 JSON Schema \u4ecd\u5c06\u662f\u5b8c\u6574\u7684\u6a21\u578b\u3002</p> <p>\u8fd9\u4e5f\u9002\u7528\u4e8e\u4f5c\u7528\u7c7b\u4f3c\u7684 <code>response_model_by_alias</code>\u3002</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: float = 10.5\n\n\nitems = {\n    \"foo\": {\"name\": \"Foo\", \"price\": 50.2},\n    \"bar\": {\"name\": \"Bar\", \"description\": \"The Bar fighters\", \"price\": 62, \"tax\": 20.2},\n    \"baz\": {\n        \"name\": \"Baz\",\n        \"description\": \"There goes my baz\",\n        \"price\": 50.2,\n        \"tax\": 10.5,\n    },\n}\n\n\n@app.get(\n    \"/items/{item_id}/name\",\n    response_model=Item,\nresponse_model_include={\"name\", \"description\"},\n)\nasync def read_item_name(item_id: str):\n    return items[item_id]\n\n\n@app.get(\"/items/{item_id}/public\", response_model=Item, response_model_exclude={\"tax\"})\nasync def read_item_public_data(item_id: str):\n    return items[item_id]\n</code></pre> <p>Tip</p> <p><code>{\"name\", \"description\"}</code> \u8bed\u6cd5\u521b\u5efa\u4e00\u4e2a\u5177\u6709\u8fd9\u4e24\u4e2a\u503c\u7684 <code>set</code>\u3002</p> <p>\u7b49\u540c\u4e8e <code>set([\"name\", \"description\"])</code>\u3002</p>"},{"location":"tutorial/response-model/#list-set","title":"\u4f7f\u7528 <code>list</code> \u800c\u4e0d\u662f <code>set</code>","text":"<p>\u5982\u679c\u4f60\u5fd8\u8bb0\u4f7f\u7528 <code>set</code> \u800c\u662f\u4f7f\u7528 <code>list</code> \u6216 <code>tuple</code>\uff0cFastAPI \u4ecd\u4f1a\u5c06\u5176\u8f6c\u6362\u4e3a <code>set</code> \u5e76\u4e14\u6b63\u5e38\u5de5\u4f5c\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: float = 10.5\n\n\nitems = {\n    \"foo\": {\"name\": \"Foo\", \"price\": 50.2},\n    \"bar\": {\"name\": \"Bar\", \"description\": \"The Bar fighters\", \"price\": 62, \"tax\": 20.2},\n    \"baz\": {\n        \"name\": \"Baz\",\n        \"description\": \"There goes my baz\",\n        \"price\": 50.2,\n        \"tax\": 10.5,\n    },\n}\n\n\n@app.get(\n    \"/items/{item_id}/name\",\n    response_model=Item,\nresponse_model_include=[\"name\", \"description\"],\n)\nasync def read_item_name(item_id: str):\n    return items[item_id]\n\n\n@app.get(\"/items/{item_id}/public\", response_model=Item, response_model_exclude=[\"tax\"])\nasync def read_item_public_data(item_id: str):\n    return items[item_id]\n</code></pre>"},{"location":"tutorial/response-model/#_8","title":"\u603b\u7ed3","text":"<p>\u4f7f\u7528\u8def\u5f84\u64cd\u4f5c\u88c5\u9970\u5668\u7684 <code>response_model</code> \u53c2\u6570\u6765\u5b9a\u4e49\u54cd\u5e94\u6a21\u578b\uff0c\u7279\u522b\u662f\u786e\u4fdd\u79c1\u6709\u6570\u636e\u88ab\u8fc7\u6ee4\u6389\u3002</p> <p>\u4f7f\u7528 <code>response_model_exclude_unset</code> \u6765\u4ec5\u8fd4\u56de\u663e\u5f0f\u8bbe\u5b9a\u7684\u503c\u3002</p>"},{"location":"tutorial/response-status-code/","title":"\u54cd\u5e94\u72b6\u6001\u7801","text":"<p>\u4e0e\u6307\u5b9a\u54cd\u5e94\u6a21\u578b\u7684\u65b9\u5f0f\u76f8\u540c\uff0c\u4f60\u4e5f\u53ef\u4ee5\u5728\u4ee5\u4e0b\u4efb\u610f\u7684\u8def\u5f84\u64cd\u4f5c\u4e2d\u4f7f\u7528 <code>status_code</code> \u53c2\u6570\u6765\u58f0\u660e\u7528\u4e8e\u54cd\u5e94\u7684 HTTP \u72b6\u6001\u7801\uff1a</p> <ul> <li><code>@app.get()</code></li> <li><code>@app.post()</code></li> <li><code>@app.put()</code></li> <li><code>@app.delete()</code></li> <li>\u7b49\u7b49\u3002</li> </ul> <pre><code>from fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.post(\"/items/\", status_code=201)\nasync def create_item(name: str):\n    return {\"name\": name}\n</code></pre> <p>Note</p> <p>\u6ce8\u610f\uff0c<code>status_code</code> \u662f\u300c\u88c5\u9970\u5668\u300d\u65b9\u6cd5\uff08<code>get</code>\uff0c<code>post</code> \u7b49\uff09\u7684\u4e00\u4e2a\u53c2\u6570\u3002\u4e0d\u50cf\u4e4b\u524d\u7684\u6240\u6709\u53c2\u6570\u548c\u8bf7\u6c42\u4f53\uff0c\u5b83\u4e0d\u5c5e\u4e8e\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u3002</p> <p><code>status_code</code> \u53c2\u6570\u63a5\u6536\u4e00\u4e2a\u8868\u793a HTTP \u72b6\u6001\u7801\u7684\u6570\u5b57\u3002</p> <p>Info</p> <p><code>status_code</code> \u4e5f\u80fd\u591f\u63a5\u6536\u4e00\u4e2a <code>IntEnum</code> \u7c7b\u578b\uff0c\u6bd4\u5982 Python \u7684 <code>http.HTTPStatus</code>\u3002</p> <p>\u5b83\u5c06\u4f1a\uff1a</p> <ul> <li>\u5728\u54cd\u5e94\u4e2d\u8fd4\u56de\u8be5\u72b6\u6001\u7801\u3002</li> <li>\u5728 OpenAPI \u6a21\u5f0f\u4e2d\uff08\u4ee5\u53ca\u5728\u7528\u6237\u754c\u9762\u4e2d\uff09\u5c06\u5176\u8bb0\u5f55\u4e3a\uff1a</li> </ul> <p></p> <p>Note</p> <p>\u4e00\u4e9b\u54cd\u5e94\u72b6\u6001\u7801\uff08\u8bf7\u53c2\u9605\u4e0b\u4e00\u90e8\u5206\uff09\u8868\u793a\u54cd\u5e94\u6ca1\u6709\u54cd\u5e94\u4f53\u3002</p> <p>FastAPI \u77e5\u9053\u8fd9\u4e00\u70b9\uff0c\u5e76\u5c06\u751f\u6210\u8868\u660e\u6ca1\u6709\u54cd\u5e94\u4f53\u7684 OpenAPI \u6587\u6863\u3002</p>"},{"location":"tutorial/response-status-code/#http","title":"\u5173\u4e8e HTTP \u72b6\u6001\u7801","text":"<p>Note</p> <p>\u5982\u679c\u4f60\u5df2\u7ecf\u4e86\u89e3\u4ec0\u4e48\u662f HTTP \u72b6\u6001\u7801\uff0c\u8bf7\u8df3\u5230\u4e0b\u4e00\u90e8\u5206\u3002</p> <p>\u5728 HTTP \u534f\u8bae\u4e2d\uff0c\u4f60\u5c06\u53d1\u9001 3 \u4f4d\u6570\u7684\u6570\u5b57\u72b6\u6001\u7801\u4f5c\u4e3a\u54cd\u5e94\u7684\u4e00\u90e8\u5206\u3002</p> <p>\u8fd9\u4e9b\u72b6\u6001\u7801\u6709\u4e00\u4e2a\u8bc6\u522b\u5b83\u4eec\u7684\u5173\u8054\u540d\u79f0\uff0c\u4f46\u662f\u91cd\u8981\u7684\u8fd8\u662f\u6570\u5b57\u3002</p> <p>\u7b80\u800c\u8a00\u4e4b\uff1a</p> <ul> <li><code>100</code> \u53ca\u4ee5\u4e0a\u72b6\u6001\u7801\u7528\u4e8e\u300c\u6d88\u606f\u300d\u54cd\u5e94\u3002\u4f60\u5f88\u5c11\u76f4\u63a5\u4f7f\u7528\u5b83\u4eec\u3002\u5177\u6709\u8fd9\u4e9b\u72b6\u6001\u4ee3\u7801\u7684\u54cd\u5e94\u4e0d\u80fd\u5e26\u6709\u54cd\u5e94\u4f53\u3002</li> <li><code>200</code> \u53ca\u4ee5\u4e0a\u72b6\u6001\u7801\u7528\u4e8e\u300c\u6210\u529f\u300d\u54cd\u5e94\u3002\u8fd9\u4e9b\u662f\u4f60\u6700\u5e38\u4f7f\u7528\u7684\u3002<ul> <li><code>200</code> \u662f\u9ed8\u8ba4\u72b6\u6001\u4ee3\u7801\uff0c\u5b83\u8868\u793a\u4e00\u5207\u300c\u6b63\u5e38\u300d\u3002</li> <li>\u53e6\u4e00\u4e2a\u4f8b\u5b50\u4f1a\u662f <code>201</code>\uff0c\u300c\u5df2\u521b\u5efa\u300d\u3002\u5b83\u901a\u5e38\u5728\u6570\u636e\u5e93\u4e2d\u521b\u5efa\u4e86\u4e00\u6761\u65b0\u8bb0\u5f55\u540e\u4f7f\u7528\u3002</li> <li>\u4e00\u4e2a\u7279\u6b8a\u7684\u4f8b\u5b50\u662f <code>204</code>\uff0c\u300c\u65e0\u5185\u5bb9\u300d\u3002\u6b64\u54cd\u5e94\u5728\u6ca1\u6709\u5185\u5bb9\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u65f6\u4f7f\u7528\uff0c\u56e0\u6b64\u8be5\u54cd\u5e94\u4e0d\u80fd\u5305\u542b\u54cd\u5e94\u4f53\u3002</li> </ul> </li> <li><code>300</code> \u53ca\u4ee5\u4e0a\u72b6\u6001\u7801\u7528\u4e8e\u300c\u91cd\u5b9a\u5411\u300d\u3002\u5177\u6709\u8fd9\u4e9b\u72b6\u6001\u7801\u7684\u54cd\u5e94\u53ef\u80fd\u6709\u6216\u8005\u53ef\u80fd\u6ca1\u6709\u54cd\u5e94\u4f53\uff0c\u4f46 <code>304</code>\u300c\u672a\u4fee\u6539\u300d\u662f\u4e2a\u4f8b\u5916\uff0c\u8be5\u54cd\u5e94\u4e0d\u5f97\u542b\u6709\u54cd\u5e94\u4f53\u3002</li> <li><code>400</code> \u53ca\u4ee5\u4e0a\u72b6\u6001\u7801\u7528\u4e8e\u300c\u5ba2\u6237\u7aef\u9519\u8bef\u300d\u54cd\u5e94\u3002\u8fd9\u4e9b\u53ef\u80fd\u662f\u4f60\u7b2c\u4e8c\u5e38\u4f7f\u7528\u7684\u7c7b\u578b\u3002<ul> <li>\u4e00\u4e2a\u4f8b\u5b50\u662f <code>404</code>\uff0c\u7528\u4e8e\u300c\u672a\u627e\u5230\u300d\u54cd\u5e94\u3002</li> <li>\u5bf9\u4e8e\u6765\u81ea\u5ba2\u6237\u7aef\u7684\u4e00\u822c\u9519\u8bef\uff0c\u4f60\u53ef\u4ee5\u53ea\u4f7f\u7528 <code>400</code>\u3002</li> </ul> </li> <li><code>500</code> \u53ca\u4ee5\u4e0a\u72b6\u6001\u7801\u7528\u4e8e\u670d\u52a1\u5668\u7aef\u9519\u8bef\u3002\u4f60\u51e0\u4e4e\u6c38\u8fdc\u4e0d\u4f1a\u76f4\u63a5\u4f7f\u7528\u5b83\u4eec\u3002\u5f53\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\u6216\u670d\u52a1\u5668\u4e2d\u7684\u67d0\u4e9b\u90e8\u5206\u51fa\u73b0\u95ee\u9898\u65f6\uff0c\u5b83\u5c06\u81ea\u52a8\u8fd4\u56de\u8fd9\u4e9b\u72b6\u6001\u4ee3\u7801\u4e4b\u4e00\u3002</li> </ul> <p>Tip</p> <p>\u8981\u4e86\u89e3\u6709\u5173\u6bcf\u4e2a\u72b6\u6001\u4ee3\u7801\u4ee5\u53ca\u9002\u7528\u573a\u666f\u7684\u66f4\u591a\u4fe1\u606f\uff0c\u8bf7\u67e5\u770b MDN \u5173\u4e8e HTTP \u72b6\u6001\u7801\u7684\u6587\u6863\u3002</p>"},{"location":"tutorial/response-status-code/#_2","title":"\u8bb0\u4f4f\u540d\u79f0\u7684\u6377\u5f84","text":"<p>\u8ba9\u6211\u4eec\u518d\u6b21\u770b\u770b\u4e4b\u524d\u7684\u4f8b\u5b50\uff1a</p> <pre><code>from fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.post(\"/items/\", status_code=201)\nasync def create_item(name: str):\n    return {\"name\": name}\n</code></pre> <p><code>201</code> \u662f\u8868\u793a\u300c\u5df2\u521b\u5efa\u300d\u7684\u72b6\u6001\u7801\u3002</p> <p>\u4f46\u662f\u4f60\u4e0d\u5fc5\u53bb\u8bb0\u4f4f\u6bcf\u4e2a\u4ee3\u7801\u7684\u542b\u4e49\u3002</p> <p>\u4f60\u53ef\u4ee5\u4f7f\u7528\u6765\u81ea <code>fastapi.status</code> \u7684\u4fbf\u6377\u53d8\u91cf\u3002</p> <pre><code>from fastapi import FastAPI, status\napp = FastAPI()\n\n\n@app.post(\"/items/\", status_code=status.HTTP_201_CREATED)\nasync def create_item(name: str):\n    return {\"name\": name}\n</code></pre> <p>\u5b83\u4eec\u53ea\u662f\u4e00\u79cd\u4fbf\u6377\u65b9\u5f0f\uff0c\u5b83\u4eec\u5177\u6709\u540c\u6837\u7684\u6570\u5b57\u4ee3\u7801\uff0c\u4f46\u662f\u8fd9\u6837\u4f7f\u7528\u4f60\u5c31\u53ef\u4ee5\u4f7f\u7528\u7f16\u8f91\u5668\u7684\u81ea\u52a8\u8865\u5168\u529f\u80fd\u6765\u67e5\u627e\u5b83\u4eec\uff1a</p> <p></p> <p>\u6280\u672f\u7ec6\u8282</p> <p>\u4f60\u4e5f\u53ef\u4ee5\u4f7f\u7528 <code>from starlette import status</code>\u3002</p> <p>\u4e3a\u4e86\u7ed9\u4f60\uff08\u5373\u5f00\u53d1\u8005\uff09\u63d0\u4f9b\u65b9\u4fbf\uff0cFastAPI \u63d0\u4f9b\u4e86\u4e0e <code>starlette.status</code> \u5b8c\u5168\u76f8\u540c\u7684 <code>fastapi.status</code>\u3002\u4f46\u5b83\u76f4\u63a5\u6765\u81ea\u4e8e Starlette\u3002</p>"},{"location":"tutorial/response-status-code/#_3","title":"\u66f4\u6539\u9ed8\u8ba4\u72b6\u6001\u7801","text":"<p>\u7a0d\u540e\uff0c\u5728\u9ad8\u7ea7\u7528\u6237\u6307\u5357\u4e2d\u4f60\u5c06\u4e86\u89e3\u5982\u4f55\u8fd4\u56de\u4e0e\u5728\u6b64\u58f0\u660e\u7684\u9ed8\u8ba4\u72b6\u6001\u7801\u4e0d\u540c\u7684\u72b6\u6001\u7801\u3002</p>"},{"location":"tutorial/schema-extra-example/","title":"\u6a21\u5f0f\u7684\u989d\u5916\u4fe1\u606f - \u4f8b\u5b50","text":"<p>\u60a8\u53ef\u4ee5\u5728JSON\u6a21\u5f0f\u4e2d\u5b9a\u4e49\u989d\u5916\u7684\u4fe1\u606f\u3002</p> <p>\u4e00\u4e2a\u5e38\u89c1\u7684\u7528\u4f8b\u662f\u6dfb\u52a0\u4e00\u4e2a\u5c06\u5728\u6587\u6863\u4e2d\u663e\u793a\u7684<code>example</code>\u3002</p> <p>\u6709\u51e0\u79cd\u65b9\u6cd5\u53ef\u4ee5\u58f0\u660e\u989d\u5916\u7684 JSON \u6a21\u5f0f\u4fe1\u606f\u3002</p>"},{"location":"tutorial/schema-extra-example/#pydantic-schema_extra","title":"Pydantic <code>schema_extra</code>","text":"<p>\u60a8\u53ef\u4ee5\u4f7f\u7528 <code>Config</code> \u548c <code>schema_extra</code> \u4e3aPydantic\u6a21\u578b\u58f0\u660e\u4e00\u4e2a\u793a\u4f8b\uff0c\u5982Pydantic \u6587\u6863\uff1a\u5b9a\u5236 Schema \u4e2d\u6240\u8ff0:</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n\nclass Config:\nschema_extra = {\n\"example\": {\n\"name\": \"Foo\",\n\"description\": \"A very nice Item\",\n\"price\": 35.4,\n\"tax\": 3.2,\n}\n}\n@app.put(\"/items/{item_id}\")\nasync def update_item(item_id: int, item: Item):\n    results = {\"item_id\": item_id, \"item\": item}\n    return results\n</code></pre> <p>\u8fd9\u4e9b\u989d\u5916\u7684\u4fe1\u606f\u5c06\u6309\u539f\u6837\u6dfb\u52a0\u5230\u8f93\u51fa\u7684JSON\u6a21\u5f0f\u4e2d\u3002</p>"},{"location":"tutorial/schema-extra-example/#field","title":"<code>Field</code> \u7684\u9644\u52a0\u53c2\u6570","text":"<p>\u5728 <code>Field</code>, <code>Path</code>, <code>Query</code>, <code>Body</code> \u548c\u5176\u4ed6\u4f60\u4e4b\u540e\u5c06\u4f1a\u770b\u5230\u7684\u5de5\u5382\u51fd\u6570\uff0c\u4f60\u53ef\u4ee5\u4e3aJSON \u6a21\u5f0f\u58f0\u660e\u989d\u5916\u4fe1\u606f\uff0c\u4f60\u4e5f\u53ef\u4ee5\u901a\u8fc7\u7ed9\u5de5\u5382\u51fd\u6570\u4f20\u9012\u5176\u4ed6\u7684\u4efb\u610f\u53c2\u6570\u6765\u7ed9JSON \u6a21\u5f0f\u58f0\u660e\u989d\u5916\u4fe1\u606f\uff0c\u6bd4\u5982\u589e\u52a0 <code>example</code>:</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI\nfrom pydantic import BaseModel, Field\napp = FastAPI()\n\n\nclass Item(BaseModel):\nname: str = Field(example=\"Foo\")\ndescription: Union[str, None] = Field(default=None, example=\"A very nice Item\")\nprice: float = Field(example=35.4)\ntax: Union[float, None] = Field(default=None, example=3.2)\n@app.put(\"/items/{item_id}\")\nasync def update_item(item_id: int, item: Item):\n    results = {\"item_id\": item_id, \"item\": item}\n    return results\n</code></pre> <p>Warning</p> <p>\u8bf7\u8bb0\u4f4f\uff0c\u4f20\u9012\u7684\u90a3\u4e9b\u989d\u5916\u53c2\u6570\u4e0d\u4f1a\u6dfb\u52a0\u4efb\u4f55\u9a8c\u8bc1\uff0c\u53ea\u4f1a\u6dfb\u52a0\u6ce8\u91ca\uff0c\u7528\u4e8e\u6587\u6863\u7684\u76ee\u7684\u3002</p>"},{"location":"tutorial/schema-extra-example/#body","title":"<code>Body</code> \u989d\u5916\u53c2\u6570","text":"<p>\u4f60\u53ef\u4ee5\u901a\u8fc7\u4f20\u9012\u989d\u5916\u4fe1\u606f\u7ed9 <code>Field</code> \u540c\u6837\u7684\u65b9\u5f0f\u64cd\u4f5c<code>Path</code>, <code>Query</code>, <code>Body</code>\u7b49\u3002</p> <p>\u6bd4\u5982\uff0c\u4f60\u53ef\u4ee5\u5c06\u8bf7\u6c42\u4f53\u7684\u4e00\u4e2a <code>example</code> \u4f20\u9012\u7ed9 <code>Body</code>:</p> <pre><code>from typing import Union\n\nfrom fastapi import Body, FastAPI\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    name: str\n    description: Union[str, None] = None\n    price: float\n    tax: Union[float, None] = None\n\n\n@app.put(\"/items/{item_id}\")\nasync def update_item(\n    item_id: int,\n    item: Item = Body(\nexample={\n\"name\": \"Foo\",\n\"description\": \"A very nice Item\",\n\"price\": 35.4,\n\"tax\": 3.2,\n},\n),\n):\n    results = {\"item_id\": item_id, \"item\": item}\n    return results\n</code></pre>"},{"location":"tutorial/schema-extra-example/#ui","title":"\u6587\u6863 UI \u4e2d\u7684\u4f8b\u5b50","text":"<p>\u4f7f\u7528\u4e0a\u9762\u7684\u4efb\u4f55\u65b9\u6cd5\uff0c\u5b83\u5728 <code>/docs</code> \u4e2d\u770b\u8d77\u6765\u90fd\u662f\u8fd9\u6837\u7684:</p> <p></p>"},{"location":"tutorial/schema-extra-example/#_1","title":"\u6280\u672f\u7ec6\u8282","text":"<p>\u5173\u4e8e <code>example</code> \u548c <code>examples</code>...</p> <p>JSON Schema\u5728\u6700\u65b0\u7684\u4e00\u4e2a\u7248\u672c\u4e2d\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5b57\u6bb5 <code>examples</code> \uff0c\u4f46\u662f OpenAPI \u57fa\u4e8e\u4e4b\u524d\u7684\u4e00\u4e2a\u65e7\u7248JSON Schema\uff0c\u5e76\u6ca1\u6709 <code>examples</code>.</p> <p>\u6240\u4ee5 OpenAPI\u4e3a\u4e86\u76f8\u4f3c\u7684\u76ee\u7684\u5b9a\u4e49\u4e86\u81ea\u5df1\u7684 <code>example</code> (\u4f7f\u7528 <code>example</code>, \u800c\u4e0d\u662f <code>examples</code>), \u8fd9\u4e5f\u662f\u6587\u6863 UI \u6240\u4f7f\u7528\u7684 (\u4f7f\u7528 Swagger UI).</p> <p>\u6240\u4ee5\uff0c\u867d\u7136 <code>example</code> \u4e0d\u662fJSON Schema\u7684\u4e00\u90e8\u5206\uff0c\u4f46\u5b83\u662fOpenAPI\u7684\u4e00\u90e8\u5206\uff0c\u8fd9\u5c06\u88ab\u6587\u6863UI\u4f7f\u7528\u3002</p>"},{"location":"tutorial/schema-extra-example/#_2","title":"\u5176\u4ed6\u4fe1\u606f","text":"<p>\u540c\u6837\u7684\u65b9\u6cd5\uff0c\u4f60\u53ef\u4ee5\u6dfb\u52a0\u4f60\u81ea\u5df1\u7684\u989d\u5916\u4fe1\u606f\uff0c\u8fd9\u4e9b\u4fe1\u606f\u5c06\u88ab\u6dfb\u52a0\u5230\u6bcf\u4e2a\u6a21\u578b\u7684JSON\u6a21\u5f0f\u4e2d\uff0c\u4f8b\u5982\u5b9a\u5236\u524d\u7aef\u7528\u6237\u754c\u9762\uff0c\u7b49\u7b49\u3002</p>"},{"location":"tutorial/sql-databases/","title":"SQL (\u5173\u7cfb\u578b) \u6570\u636e\u5e93","text":"<p>FastAPI\u4e0d\u9700\u8981\u4f60\u4f7f\u7528SQL(\u5173\u7cfb\u578b)\u6570\u636e\u5e93\u3002</p> <p>\u4f46\u662f\u60a8\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u60a8\u60f3\u8981\u7684\u5173\u7cfb\u578b\u6570\u636e\u5e93\u3002</p> <p>\u5728\u8fd9\u91cc\uff0c\u8ba9\u6211\u4eec\u770b\u4e00\u4e2a\u4f7f\u7528\u7740SQLAlchemy\u7684\u793a\u4f8b\u3002</p> <p>\u60a8\u53ef\u4ee5\u5f88\u5bb9\u6613\u5730\u5c06SQLAlchemy\u652f\u6301\u4efb\u4f55\u6570\u636e\u5e93\uff0c\u50cf\uff1a</p> <ul> <li>PostgreSQL</li> <li>MySQL</li> <li>SQLite</li> <li>Oracle</li> <li>Microsoft SQL Server\uff0c\u7b49\u7b49\u5176\u5b83\u6570\u636e\u5e93</li> </ul> <p>\u5728\u6b64\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u5c06\u4f7f\u7528SQLite\uff0c\u56e0\u4e3a\u5b83\u4f7f\u7528\u5355\u4e2a\u6587\u4ef6\u5e76\u4e14 \u5728Python\u4e2d\u5177\u6709\u96c6\u6210\u652f\u6301\u3002\u56e0\u6b64\uff0c\u60a8\u53ef\u4ee5\u590d\u5236\u6b64\u793a\u4f8b\u5e76\u6309\u539f\u6837\u6765\u8fd0\u884c\u5b83\u3002</p> <p>\u7a0d\u540e\uff0c\u5bf9\u4e8e\u60a8\u7684\u4ea7\u54c1\u7ea7\u522b\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u60a8\u53ef\u80fd\u4f1a\u8981\u4f7f\u7528\u50cfPostgreSQL\u8fd9\u6837\u7684\u6570\u636e\u5e93\u670d\u52a1\u5668\u3002</p> <p>Tip</p> <p>\u8fd9\u513f\u6709\u4e00\u4e2aFastAPI\u548cPostgreSQL\u7684\u5b98\u65b9\u9879\u76ee\u751f\u6210\u5668\uff0c\u5168\u90e8\u57fa\u4e8eDocker\uff0c\u5305\u62ec\u524d\u7aef\u548c\u66f4\u591a\u5de5\u5177\uff1ahttps://github.com/tiangolo/full-stack-fastapi-postgresql</p> <p>Note</p> <p>\u8bf7\u6ce8\u610f\uff0c\u5927\u90e8\u5206\u4ee3\u7801\u662f<code>SQLAlchemy</code>\u7684\u6807\u51c6\u4ee3\u7801\uff0c\u60a8\u53ef\u4ee5\u7528\u4e8e\u4efb\u4f55\u6846\u67b6\u3002FastAPI\u7279\u5b9a\u7684\u4ee3\u7801\u548c\u5f80\u5e38\u4e00\u6837\u5c11\u3002</p>"},{"location":"tutorial/sql-databases/#orms","title":"ORMs\uff08\u5bf9\u8c61\u5173\u7cfb\u6620\u5c04\uff09","text":"<p>FastAPI\u53ef\u4e0e\u4efb\u4f55\u6570\u636e\u5e93\u5728\u4efb\u4f55\u6837\u5f0f\u7684\u5e93\u4e2d\u4e00\u8d77\u4e0e \u6570\u636e\u5e93\u8fdb\u884c\u901a\u4fe1\u3002</p> <p>\u4e00\u79cd\u5e38\u89c1\u7684\u6a21\u5f0f\u662f\u4f7f\u7528\u201cORM\u201d\uff1a\u5bf9\u8c61\u5173\u7cfb\u6620\u5c04\u3002</p> <p>ORM \u5177\u6709\u5728\u4ee3\u7801\u548c\u6570\u636e\u5e93\u8868\uff08\u201c\u5173\u7cfb\u578b\u201d\uff09\u4e2d\u7684\u5bf9\u8c61\u4e4b\u95f4\u8f6c\u6362\uff08\u201c\u6620\u5c04*\u201d\uff09\u7684\u5de5\u5177\u3002</p> <p>\u4f7f\u7528 ORM\uff0c\u60a8\u901a\u5e38\u4f1a\u5728 SQL \u6570\u636e\u5e93\u4e2d\u521b\u5efa\u4e00\u4e2a\u4ee3\u8868\u6620\u5c04\u7684\u7c7b\uff0c\u8be5\u7c7b\u7684\u6bcf\u4e2a\u5c5e\u6027\u4ee3\u8868\u4e00\u4e2a\u5217\uff0c\u5177\u6709\u540d\u79f0\u548c\u7c7b\u578b\u3002</p> <p>\u4f8b\u5982\uff0c\u4e00\u4e2a\u7c7b<code>Pet</code>\u53ef\u4ee5\u8868\u793a\u4e00\u4e2a SQL \u8868<code>pets</code>\u3002</p> <p>\u8be5\u7c7b\u7684\u6bcf\u4e2a\u5b9e\u4f8b\u5bf9\u8c61\u90fd\u4ee3\u8868\u6570\u636e\u5e93\u4e2d\u7684\u4e00\u884c\u6570\u636e\u3002</p> <p>\u53c8\u4f8b\u5982\uff0c\u4e00\u4e2a\u5bf9\u8c61<code>orion_cat</code>\uff08<code>Pet</code>\u7684\u4e00\u4e2a\u5b9e\u4f8b\uff09\u53ef\u4ee5\u6709\u4e00\u4e2a\u5c5e\u6027<code>orion_cat.type</code>, \u5bf9\u6807\u6570\u636e\u5e93\u4e2d\u7684<code>type</code>\u5217\u3002\u5e76\u4e14\u8be5\u5c5e\u6027\u7684\u503c\u53ef\u4ee5\u662f\u5176\u5b83\uff0c\u4f8b\u5982<code>\"cat\"</code>\u3002</p> <p>\u8fd9\u4e9b ORM \u8fd8\u5177\u6709\u5728\u8868\u6216\u5b9e\u4f53\u4e4b\u95f4\u5efa\u7acb\u5173\u7cfb\u7684\u5de5\u5177\uff08\u6bd4\u5982\u521b\u5efa\u591a\u8868\u5173\u7cfb\uff09\u3002</p> <p>\u8fd9\u6837\uff0c\u60a8\u8fd8\u53ef\u4ee5\u62e5\u6709\u4e00\u4e2a\u5c5e\u6027<code>orion_cat.owner</code>\uff0c\u5b83\u5305\u542b\u8be5\u5ba0\u7269\u6240\u6709\u8005\u7684\u6570\u636e\uff0c\u8fd9\u4e9b\u6570\u636e\u53d6\u81ea\u53e6\u5916\u4e00\u4e2a\u8868\u3002</p> <p>\u56e0\u6b64\uff0c<code>orion_cat.owner.name</code>\u53ef\u80fd\u662f\u8be5\u5ba0\u7269\u4e3b\u4eba\u7684\u59d3\u540d\uff08\u6765\u81ea\u8868<code>owners</code>\u4e2d\u7684\u5217<code>name</code>\uff09\u3002</p> <p>\u5b83\u53ef\u80fd\u6709\u4e00\u4e2a\u50cf<code>\"Arquilian\"</code>(\u4e00\u79cd\u4e1a\u52a1\u903b\u8f91)\u3002</p> <p>\u5f53\u60a8\u5c1d\u8bd5\u4ece\u60a8\u7684\u5ba0\u7269\u5bf9\u8c61\u8bbf\u95ee\u5b83\u65f6\uff0cORM \u5c06\u5b8c\u6210\u6240\u6709\u5de5\u4f5c\u4ee5\u4ece\u76f8\u5e94\u7684\u8868\u6240\u6709\u8005\u90a3\u91cc\u518d\u83b7\u53d6\u4fe1\u606f\u3002</p> <p>\u5e38\u89c1\u7684 ORM \u4f8b\u5982\uff1aDjango-ORM\uff08Django \u6846\u67b6\u7684\u4e00\u90e8\u5206\uff09\u3001SQLAlchemy ORM\uff08SQLAlchemy \u7684\u4e00\u90e8\u5206\uff0c\u72ec\u7acb\u4e8e\u6846\u67b6\uff09\u548c Peewee\uff08\u72ec\u7acb\u4e8e\u6846\u67b6\uff09\u7b49\u3002</p> <p>\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u5c06\u770b\u5230\u5982\u4f55\u4f7f\u7528SQLAlchemy ORM\u3002</p> <p>\u4ee5\u7c7b\u4f3c\u7684\u65b9\u5f0f\uff0c\u60a8\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u5176\u4ed6 ORM\u3002</p> <p>Tip</p> <p>\u5728\u6587\u6863\u4e2d\u4e5f\u6709\u4e00\u7bc7\u4f7f\u7528 Peewee \u7684\u7b49\u6548\u7684\u6587\u7ae0\u3002</p>"},{"location":"tutorial/sql-databases/#_1","title":"\u6587\u4ef6\u7ed3\u6784","text":"<p>\u5bf9\u4e8e\u8fd9\u4e9b\u793a\u4f8b\uff0c\u5047\u8bbe\u60a8\u6709\u4e00\u4e2a\u540d\u4e3a\u7684\u76ee\u5f55<code>my_super_project</code>\uff0c\u5176\u4e2d\u5305\u542b\u4e00\u4e2a\u540d\u4e3a\u7684\u5b50\u76ee\u5f55<code>sql_app</code>\uff0c\u5176\u7ed3\u6784\u5982\u4e0b\uff1a</p> <pre><code>.\n\u2514\u2500\u2500 sql_app\n    \u251c\u2500\u2500 __init__.py\n    \u251c\u2500\u2500 crud.py\n    \u251c\u2500\u2500 database.py\n    \u251c\u2500\u2500 main.py\n    \u251c\u2500\u2500 models.py\n    \u2514\u2500\u2500 schemas.py\n</code></pre> <p>\u8be5\u6587\u4ef6<code>__init__.py</code>\u53ea\u662f\u4e00\u4e2a\u7a7a\u6587\u4ef6\uff0c\u4f46\u5b83\u544a\u8bc9 Python \u5176\u4e2d<code>sql_app</code>\u7684\u6240\u6709\u6a21\u5757\uff08Python \u6587\u4ef6\uff09\u90fd\u662f\u4e00\u4e2a\u5305\u3002</p> <p>\u73b0\u5728\u8ba9\u6211\u4eec\u770b\u770b\u6bcf\u4e2a\u6587\u4ef6/\u6a21\u5757\u7684\u4f5c\u7528\u3002</p>"},{"location":"tutorial/sql-databases/#sqlalchemy","title":"\u521b\u5efa SQLAlchemy \u90e8\u4ef6","text":"<p>\u8ba9\u6211\u4eec\u6d89\u53ca\u5230\u6587\u4ef6<code>sql_app/database.py</code>\u3002</p>"},{"location":"tutorial/sql-databases/#sqlalchemy_1","title":"\u5bfc\u5165 SQLAlchemy \u90e8\u4ef6","text":"<pre><code>from sqlalchemy import create_engine\nfrom sqlalchemy.ext.declarative import declarative_base\nfrom sqlalchemy.orm import sessionmaker\nSQLALCHEMY_DATABASE_URL = \"sqlite:///./sql_app.db\"\n# SQLALCHEMY_DATABASE_URL = \"postgresql://user:password@postgresserver/db\"\n\nengine = create_engine(\n    SQLALCHEMY_DATABASE_URL, connect_args={\"check_same_thread\": False}\n)\nSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)\n\nBase = declarative_base()\n</code></pre>"},{"location":"tutorial/sql-databases/#sqlalchemy-url","title":"\u4e3a SQLAlchemy \u5b9a\u4e49\u6570\u636e\u5e93 URL\u5730\u5740","text":"<pre><code>from sqlalchemy import create_engine\nfrom sqlalchemy.ext.declarative import declarative_base\nfrom sqlalchemy.orm import sessionmaker\n\nSQLALCHEMY_DATABASE_URL = \"sqlite:///./sql_app.db\"\n# SQLALCHEMY_DATABASE_URL = \"postgresql://user:password@postgresserver/db\"\nengine = create_engine(\n    SQLALCHEMY_DATABASE_URL, connect_args={\"check_same_thread\": False}\n)\nSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)\n\nBase = declarative_base()\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u6b63\u5728\u201c\u8fde\u63a5\u201d\u5230\u4e00\u4e2a SQLite \u6570\u636e\u5e93\uff08\u7528 SQLite \u6570\u636e\u5e93\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\uff09\u3002</p> <p>\u8be5\u6587\u4ef6\u5c06\u4f4d\u4e8e\u6587\u4ef6\u4e2d\u7684\u540c\u4e00\u76ee\u5f55\u4e2d<code>sql_app.db</code>\u3002</p> <p>\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48\u6700\u540e\u4e00\u90e8\u5206\u662f<code>./sql_app.db</code>.</p> <p>\u5982\u679c\u60a8\u4f7f\u7528\u7684\u662fPostgreSQL\u6570\u636e\u5e93\uff0c\u5219\u53ea\u9700\u53d6\u6d88\u6ce8\u91ca\u8be5\u884c\uff1a</p> <pre><code>SQLALCHEMY_DATABASE_URL = \"postgresql://user:password@postgresserver/db\"\n</code></pre> <p>...\u5e76\u6839\u636e\u60a8\u7684\u6570\u636e\u5e93\u6570\u636e\u548c\u76f8\u5173\u51ed\u636e\uff08\u4e5f\u9002\u7528\u4e8e MySQL\u3001MariaDB \u6216\u4efb\u4f55\u5176\u4ed6\uff09\u5bf9\u5176\u8fdb\u884c\u8c03\u6574\u3002</p> <p>Tip</p> <p>\u5982\u679c\u60a8\u60f3\u4f7f\u7528\u4e0d\u540c\u7684\u6570\u636e\u5e93\uff0c\u8fd9\u662f\u5c31\u662f\u60a8\u5fc5\u987b\u4fee\u6539\u7684\u5730\u65b9\u3002</p>"},{"location":"tutorial/sql-databases/#sqlalchemy_2","title":"\u521b\u5efa SQLAlchemy \u5f15\u64ce","text":"<p>\u7b2c\u4e00\u6b65\uff0c\u521b\u5efa\u4e00\u4e2a SQLAlchemy\u7684\u201c\u5f15\u64ce\u201d\u3002</p> <p>\u6211\u4eec\u7a0d\u540e\u4f1a\u5c06\u8fd9\u4e2a<code>engine</code>\u5728\u5176\u4ed6\u5730\u65b9\u4f7f\u7528\u3002</p> <pre><code>from sqlalchemy import create_engine\nfrom sqlalchemy.ext.declarative import declarative_base\nfrom sqlalchemy.orm import sessionmaker\n\nSQLALCHEMY_DATABASE_URL = \"sqlite:///./sql_app.db\"\n# SQLALCHEMY_DATABASE_URL = \"postgresql://user:password@postgresserver/db\"\n\nengine = create_engine(\nSQLALCHEMY_DATABASE_URL, connect_args={\"check_same_thread\": False}\n)\nSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)\n\nBase = declarative_base()\n</code></pre>"},{"location":"tutorial/sql-databases/#_2","title":"\u6ce8\u610f","text":"<p>\u53c2\u6570:</p> <pre><code>connect_args={\"check_same_thread\": False}\n</code></pre> <p>...\u4ec5\u7528\u4e8e<code>SQLite</code>\uff0c\u5728\u5176\u4ed6\u6570\u636e\u5e93\u4e0d\u9700\u8981\u5b83\u3002</p> <p>\u6280\u672f\u7ec6\u8282</p> <p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cSQLite \u53ea\u5141\u8bb8\u4e00\u4e2a\u7ebf\u7a0b\u4e0e\u5176\u901a\u4fe1\uff0c\u5047\u8bbe\u6709\u591a\u4e2a\u7ebf\u7a0b\u7684\u8bdd\uff0c\u4e5f\u53ea\u5c06\u5904\u7406\u4e00\u4e2a\u72ec\u7acb\u7684\u8bf7\u6c42\u3002</p> <p>\u8fd9\u662f\u4e3a\u4e86\u9632\u6b62\u610f\u5916\u5730\u4e3a\u4e0d\u540c\u7684\u4e8b\u7269\uff08\u4e0d\u540c\u7684\u8bf7\u6c42\uff09\u5171\u4eab\u76f8\u540c\u7684\u8fde\u63a5\u3002</p> <p>\u4f46\u662f\u5728 FastAPI \u4e2d\uff0c\u666e\u904d\u4f7f\u7528def\u51fd\u6570\uff0c\u591a\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u4e3a\u540c\u4e00\u4e2a\u8bf7\u6c42\u4e0e\u6570\u636e\u5e93\u4ea4\u4e92\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u4f7f\u7528<code>connect_args={\"check_same_thread\": False}</code>\u6765\u8ba9SQLite\u5141\u8bb8\u8fd9\u6837\u3002</p> <p>\u6b64\u5916\uff0c\u6211\u4eec\u5c06\u786e\u4fdd\u6bcf\u4e2a\u8bf7\u6c42\u90fd\u5728\u4f9d\u8d56\u9879\u4e2d\u83b7\u5f97\u81ea\u5df1\u7684\u6570\u636e\u5e93\u8fde\u63a5\u4f1a\u8bdd\uff0c\u56e0\u6b64\u4e0d\u9700\u8981\u8be5\u9ed8\u8ba4\u673a\u5236\u3002</p>"},{"location":"tutorial/sql-databases/#sessionlocal","title":"\u521b\u5efa\u4e00\u4e2a<code>SessionLocal</code>\u7c7b","text":"<p>\u6bcf\u4e2a\u5b9e\u4f8b<code>SessionLocal</code>\u90fd\u4f1a\u662f\u4e00\u4e2a\u6570\u636e\u5e93\u4f1a\u8bdd\u3002\u5f53\u7136\u8be5\u7c7b\u672c\u8eab\u8fd8\u4e0d\u662f\u6570\u636e\u5e93\u4f1a\u8bdd\u3002</p> <p>\u4f46\u662f\u4e00\u65e6\u6211\u4eec\u521b\u5efa\u4e86\u4e00\u4e2a<code>SessionLocal</code>\u7c7b\u7684\u5b9e\u4f8b\uff0c\u8fd9\u4e2a\u5b9e\u4f8b\u5c06\u662f\u5b9e\u9645\u7684\u6570\u636e\u5e93\u4f1a\u8bdd\u3002</p> <p>\u6211\u4eec\u547d\u540d\u5b83\u662f<code>SessionLocal</code>\u4e3a\u4e86\u5c06\u5b83\u4e0e\u6211\u4eec\u4ece SQLAlchemy \u5bfc\u5165\u7684<code>Session</code>\u533a\u522b\u5f00\u6765\u3002</p> <p>\u7a0d\u540e\u6211\u4eec\u5c06\u4f7f\u7528<code>Session</code>\uff08\u4ece SQLAlchemy \u5bfc\u5165\u7684\u90a3\u4e2a\uff09\u3002</p> <p>\u8981\u521b\u5efa<code>SessionLocal</code>\u7c7b\uff0c\u8bf7\u4f7f\u7528\u51fd\u6570<code>sessionmaker</code>\uff1a</p> <pre><code>from sqlalchemy import create_engine\nfrom sqlalchemy.ext.declarative import declarative_base\nfrom sqlalchemy.orm import sessionmaker\n\nSQLALCHEMY_DATABASE_URL = \"sqlite:///./sql_app.db\"\n# SQLALCHEMY_DATABASE_URL = \"postgresql://user:password@postgresserver/db\"\n\nengine = create_engine(\n    SQLALCHEMY_DATABASE_URL, connect_args={\"check_same_thread\": False}\n)\nSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)\nBase = declarative_base()\n</code></pre>"},{"location":"tutorial/sql-databases/#base","title":"\u521b\u5efa\u4e00\u4e2a<code>Base</code>\u7c7b","text":"<p>\u73b0\u5728\u6211\u4eec\u5c06\u4f7f\u7528<code>declarative_base()</code>\u8fd4\u56de\u4e00\u4e2a\u7c7b\u3002</p> <p>\u7a0d\u540e\u6211\u4eec\u5c06\u7528\u8fd9\u4e2a\u7c7b\u7ee7\u627f\uff0c\u6765\u521b\u5efa\u6bcf\u4e2a\u6570\u636e\u5e93\u6a21\u578b\u6216\u7c7b\uff08ORM \u6a21\u578b\uff09\uff1a</p> <pre><code>from sqlalchemy import create_engine\nfrom sqlalchemy.ext.declarative import declarative_base\nfrom sqlalchemy.orm import sessionmaker\n\nSQLALCHEMY_DATABASE_URL = \"sqlite:///./sql_app.db\"\n# SQLALCHEMY_DATABASE_URL = \"postgresql://user:password@postgresserver/db\"\n\nengine = create_engine(\n    SQLALCHEMY_DATABASE_URL, connect_args={\"check_same_thread\": False}\n)\nSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)\n\nBase = declarative_base()\n</code></pre>"},{"location":"tutorial/sql-databases/#_3","title":"\u521b\u5efa\u6570\u636e\u5e93\u6a21\u578b","text":"<p>\u73b0\u5728\u8ba9\u6211\u4eec\u770b\u770b\u6587\u4ef6<code>sql_app/models.py</code>\u3002</p>"},{"location":"tutorial/sql-databases/#base-sqlalchemy","title":"\u7528<code>Base</code>\u7c7b\u6765\u521b\u5efa SQLAlchemy \u6a21\u578b","text":"<p>\u6211\u4eec\u5c06\u4f7f\u7528\u6211\u4eec\u4e4b\u524d\u521b\u5efa\u7684<code>Base</code>\u7c7b\u6765\u521b\u5efa SQLAlchemy \u6a21\u578b\u3002</p> <p>Tip</p> <p>SQLAlchemy \u4f7f\u7528\u7684\u201c\u6a21\u578b\u201d\u8fd9\u4e2a\u672f\u8bed \u6765\u6307\u4ee3\u4e0e\u6570\u636e\u5e93\u4ea4\u4e92\u7684\u8fd9\u4e9b\u7c7b\u548c\u5b9e\u4f8b\u3002</p> <p>\u800c Pydantic \u4e5f\u4f7f\u7528\u201c\u6a21\u578b\u201d\u8fd9\u4e2a\u672f\u8bed \u6765\u6307\u4ee3\u4e0d\u540c\u7684\u4e1c\u897f\uff0c\u5373\u6570\u636e\u9a8c\u8bc1\u3001\u8f6c\u6362\u4ee5\u53ca\u6587\u6863\u7c7b\u548c\u5b9e\u4f8b\u3002</p> <p>\u4ece<code>database</code>\uff08\u6765\u81ea\u4e0a\u9762\u7684<code>database.py</code>\u6587\u4ef6\uff09\u5bfc\u5165<code>Base</code>\u3002</p> <p>\u521b\u5efa\u4ece\u5b83\u7ee7\u627f\u7684\u7c7b\u3002</p> <p>\u8fd9\u4e9b\u7c7b\u5c31\u662f SQLAlchemy \u6a21\u578b\u3002</p> <pre><code>from sqlalchemy import Boolean, Column, ForeignKey, Integer, String\nfrom sqlalchemy.orm import relationship\n\nfrom .database import Base\nclass User(Base):\n__tablename__ = \"users\"\nid = Column(Integer, primary_key=True, index=True)\n    email = Column(String, unique=True, index=True)\n    hashed_password = Column(String)\n    is_active = Column(Boolean, default=True)\n\n    items = relationship(\"Item\", back_populates=\"owner\")\n\n\nclass Item(Base):\n__tablename__ = \"items\"\nid = Column(Integer, primary_key=True, index=True)\n    title = Column(String, index=True)\n    description = Column(String, index=True)\n    owner_id = Column(Integer, ForeignKey(\"users.id\"))\n\n    owner = relationship(\"User\", back_populates=\"items\")\n</code></pre> <p>\u8fd9\u4e2a<code>__tablename__</code>\u5c5e\u6027\u662f\u7528\u6765\u544a\u8bc9 SQLAlchemy \u8981\u5728\u6570\u636e\u5e93\u4e2d\u4e3a\u6bcf\u4e2a\u6a21\u578b\u4f7f\u7528\u7684\u6570\u636e\u5e93\u8868\u7684\u540d\u79f0\u3002</p>"},{"location":"tutorial/sql-databases/#_4","title":"\u521b\u5efa\u6a21\u578b\u5c5e\u6027/\u5217","text":"<p>\u73b0\u5728\u521b\u5efa\u6240\u6709\u6a21\u578b\uff08\u7c7b\uff09\u5c5e\u6027\u3002</p> <p>\u8fd9\u4e9b\u5c5e\u6027\u4e2d\u7684\u6bcf\u4e00\u4e2a\u90fd\u4ee3\u8868\u5176\u76f8\u5e94\u6570\u636e\u5e93\u8868\u4e2d\u7684\u4e00\u5217\u3002</p> <p>\u6211\u4eec\u4f7f\u7528<code>Column</code>\u6765\u8868\u793a SQLAlchemy \u4e2d\u7684\u9ed8\u8ba4\u503c\u3002</p> <p>\u6211\u4eec\u4f20\u9012\u4e00\u4e2a SQLAlchemy \u201c\u7c7b\u578b\u201d\uff0c\u5982<code>Integer</code>\u3001<code>String</code>\u548c<code>Boolean</code>\uff0c\u5b83\u5b9a\u4e49\u4e86\u6570\u636e\u5e93\u4e2d\u7684\u7c7b\u578b\uff0c\u4f5c\u4e3a\u53c2\u6570\u3002</p> <pre><code>from sqlalchemy import Boolean, Column, ForeignKey, Integer, String\nfrom sqlalchemy.orm import relationship\n\nfrom .database import Base\n\n\nclass User(Base):\n    __tablename__ = \"users\"\n\nid = Column(Integer, primary_key=True, index=True)\nemail = Column(String, unique=True, index=True)\nhashed_password = Column(String)\nis_active = Column(Boolean, default=True)\nitems = relationship(\"Item\", back_populates=\"owner\")\n\n\nclass Item(Base):\n    __tablename__ = \"items\"\n\nid = Column(Integer, primary_key=True, index=True)\ntitle = Column(String, index=True)\ndescription = Column(String, index=True)\nowner_id = Column(Integer, ForeignKey(\"users.id\"))\nowner = relationship(\"User\", back_populates=\"items\")\n</code></pre>"},{"location":"tutorial/sql-databases/#_5","title":"\u521b\u5efa\u5173\u7cfb","text":"<p>\u73b0\u5728\u521b\u5efa\u5173\u7cfb\u3002</p> <p>\u4e3a\u6b64\uff0c\u6211\u4eec\u4f7f\u7528SQLAlchemy  ORM\u63d0\u4f9b\u7684<code>relationship</code>\u3002</p> <p>\u8fd9\u5c06\u6216\u591a\u6216\u5c11\u4f1a\u6210\u4e3a\u4e00\u79cd\u201c\u795e\u5947\u201d\u5c5e\u6027\uff0c\u5176\u4e2d\u8868\u793a\u8be5\u8868\u4e0e\u5176\u4ed6\u76f8\u5173\u7684\u8868\u4e2d\u7684\u503c\u3002</p> <pre><code>from sqlalchemy import Boolean, Column, ForeignKey, Integer, String\nfrom sqlalchemy.orm import relationship\nfrom .database import Base\n\n\nclass User(Base):\n    __tablename__ = \"users\"\n\n    id = Column(Integer, primary_key=True, index=True)\n    email = Column(String, unique=True, index=True)\n    hashed_password = Column(String)\n    is_active = Column(Boolean, default=True)\n\nitems = relationship(\"Item\", back_populates=\"owner\")\nclass Item(Base):\n    __tablename__ = \"items\"\n\n    id = Column(Integer, primary_key=True, index=True)\n    title = Column(String, index=True)\n    description = Column(String, index=True)\n    owner_id = Column(Integer, ForeignKey(\"users.id\"))\n\nowner = relationship(\"User\", back_populates=\"items\")\n</code></pre> <p>\u5f53\u8bbf\u95ee user \u4e2d\u7684\u5c5e\u6027<code>items</code>\u65f6\uff0c\u5982 \u4e2d<code>my_user.items</code>\uff0c\u5b83\u5c06\u6709\u4e00\u4e2a<code>Item</code>SQLAlchemy \u6a21\u578b\u5217\u8868\uff08\u6765\u81ea<code>items</code>\u8868\uff09\uff0c\u8fd9\u4e9b\u6a21\u578b\u5177\u6709\u6307\u5411<code>users</code>\u8868\u4e2d\u6b64\u8bb0\u5f55\u7684\u5916\u952e\u3002</p> <p>\u5f53\u60a8\u8bbf\u95ee<code>my_user.items</code>\u65f6\uff0cSQLAlchemy \u5b9e\u9645\u4e0a\u4f1a\u4ece<code>items</code>\u8868\u4e2d\u7684\u83b7\u53d6\u4e00\u6279\u8bb0\u5f55\u5e76\u5728\u6b64\u5904\u586b\u5145\u8fdb\u53bb\u3002</p> <p>\u540c\u6837\uff0c\u5f53\u8bbf\u95ee Item\u4e2d\u7684\u5c5e\u6027<code>owner</code>\u65f6\uff0c\u5b83\u5c06\u5305\u542b\u8868\u4e2d\u7684<code>User</code>SQLAlchemy \u6a21\u578b<code>users</code>\u3002\u4f7f\u7528<code>owner_id</code>\u5c5e\u6027/\u5217\u53ca\u5176\u5916\u952e\u6765\u4e86\u89e3\u8981\u4ece<code>users</code>\u8868\u4e2d\u83b7\u53d6\u54ea\u6761\u8bb0\u5f55\u3002</p>"},{"location":"tutorial/sql-databases/#pydantic","title":"\u521b\u5efa Pydantic \u6a21\u578b","text":"<p>\u73b0\u5728\u8ba9\u6211\u4eec\u67e5\u770b\u4e00\u4e0b\u6587\u4ef6<code>sql_app/schemas.py</code>\u3002</p> <p>Tip</p> <p>\u4e3a\u4e86\u907f\u514d SQLAlchemy\u6a21\u578b\u548c Pydantic\u6a21\u578b\u4e4b\u95f4\u7684\u6df7\u6dc6\uff0c\u6211\u4eec\u5c06\u6709<code>models.py</code>\uff08SQLAlchemy \u6a21\u578b\u7684\u6587\u4ef6\uff09\u548c<code>schemas.py</code>\uff08 Pydantic \u6a21\u578b\u7684\u6587\u4ef6\uff09\u3002</p> <p>\u8fd9\u4e9b Pydantic \u6a21\u578b\u6216\u591a\u6216\u5c11\u5730\u5b9a\u4e49\u4e86\u4e00\u4e2a\u201cschema\u201d\uff08\u4e00\u4e2a\u6709\u6548\u7684\u6570\u636e\u5f62\u72b6\uff09\u3002</p> <p>\u56e0\u6b64\uff0c\u8fd9\u5c06\u5e2e\u52a9\u6211\u4eec\u5728\u4f7f\u7528\u4e24\u8005\u65f6\u907f\u514d\u6df7\u6dc6\u3002</p>"},{"location":"tutorial/sql-databases/#pydantic_1","title":"\u521b\u5efa\u521d\u59cb Pydantic\u6a21\u578b/\u6a21\u5f0f","text":"<p>\u521b\u5efa\u4e00\u4e2a<code>ItemBase</code>\u548c<code>UserBase</code>Pydantic\u6a21\u578b\uff08\u6216\u8005\u6211\u4eec\u8bf4\u201cschema\u201d\uff09\u4ee5\u53ca\u5728\u521b\u5efa\u6216\u8bfb\u53d6\u6570\u636e\u65f6\u5177\u6709\u5171\u540c\u7684\u5c5e\u6027\u3002</p> <p><code>ItemCreate</code>\u4e3a \u521b\u5efa\u4e00\u4e2a<code>UserCreate</code>\u7ee7\u627f\u81ea\u5b83\u4eec\u7684\u6240\u6709\u5c5e\u6027\uff08\u56e0\u6b64\u5b83\u4eec\u5c06\u5177\u6709\u76f8\u540c\u7684\u5c5e\u6027\uff09\uff0c\u4ee5\u53ca\u521b\u5efa\u6240\u9700\u7684\u4efb\u4f55\u5176\u4ed6\u6570\u636e\uff08\u5c5e\u6027\uff09\u3002</p> <p>\u56e0\u6b64\u5728\u521b\u5efa\u65f6\u4e5f\u5e94\u5f53\u6709\u4e00\u4e2a<code>password</code>\u5c5e\u6027\u3002</p> <p>\u4f46\u662f\u4e3a\u4e86\u5b89\u5168\u8d77\u89c1\uff0c<code>password</code>\u4e0d\u4f1a\u51fa\u73b0\u5728\u5176\u4ed6\u540c\u7c7b Pydantic\u6a21\u578b\u4e2d\uff0c\u4f8b\u5982\u7528\u6237\u8bf7\u6c42\u65f6\u4e0d\u5e94\u8be5\u4ece API \u8fd4\u56de\u54cd\u5e94\u4e2d\u5305\u542b\u5b83\u3002</p> Python 3.10+Python 3.9+Python 3.6+ <pre><code>from pydantic import BaseModel\nclass ItemBase(BaseModel):\ntitle: str\ndescription: str | None = None\nclass ItemCreate(ItemBase):\npass\nclass Item(ItemBase):\n    id: int\n    owner_id: int\n\n    class Config:\n        orm_mode = True\n\n\nclass UserBase(BaseModel):\nemail: str\nclass UserCreate(UserBase):\npassword: str\nclass User(UserBase):\n    id: int\n    is_active: bool\n    items: list[Item] = []\n\n    class Config:\n        orm_mode = True\n</code></pre> <pre><code>from typing import Union\n\nfrom pydantic import BaseModel\nclass ItemBase(BaseModel):\ntitle: str\ndescription: Union[str, None] = None\nclass ItemCreate(ItemBase):\npass\nclass Item(ItemBase):\n    id: int\n    owner_id: int\n\n    class Config:\n        orm_mode = True\n\n\nclass UserBase(BaseModel):\nemail: str\nclass UserCreate(UserBase):\npassword: str\nclass User(UserBase):\n    id: int\n    is_active: bool\n    items: list[Item] = []\n\n    class Config:\n        orm_mode = True\n</code></pre> <pre><code>from typing import List, Union\n\nfrom pydantic import BaseModel\nclass ItemBase(BaseModel):\ntitle: str\ndescription: Union[str, None] = None\nclass ItemCreate(ItemBase):\npass\nclass Item(ItemBase):\n    id: int\n    owner_id: int\n\n    class Config:\n        orm_mode = True\n\n\nclass UserBase(BaseModel):\nemail: str\nclass UserCreate(UserBase):\npassword: str\nclass User(UserBase):\n    id: int\n    is_active: bool\n    items: List[Item] = []\n\n    class Config:\n        orm_mode = True\n</code></pre>"},{"location":"tutorial/sql-databases/#sqlalchemy-pydantic","title":"SQLAlchemy \u98ce\u683c\u548c Pydantic \u98ce\u683c","text":"<p>\u8bf7\u6ce8\u610f\uff0cSQLAlchemy\u6a21\u578b\u4f7f\u7528 <code>=</code>\u6765\u5b9a\u4e49\u5c5e\u6027\uff0c\u5e76\u5c06\u7c7b\u578b\u4f5c\u4e3a\u53c2\u6570\u4f20\u9012\u7ed9<code>Column</code>\uff0c\u4f8b\u5982\uff1a</p> <pre><code>name = Column(String)\n</code></pre> <p>\u867d\u7136 Pydantic\u6a21\u578b\u4f7f\u7528<code>:</code> \u58f0\u660e\u7c7b\u578b\uff0c\u4f46\u65b0\u7684\u7c7b\u578b\u6ce8\u91ca\u8bed\u6cd5/\u7c7b\u578b\u63d0\u793a\u662f\uff1a</p> <pre><code>name: str\n</code></pre> <p>\u8bf7\u7262\u8bb0\u8fd9\u4e00\u70b9\uff0c\u8fd9\u6837\u60a8\u5728\u4f7f\u7528<code>:</code>\u8fd8\u662f<code>=</code>\u65f6\u5c31\u4e0d\u4f1a\u611f\u5230\u56f0\u60d1\u3002</p>"},{"location":"tutorial/sql-databases/#pydantic_2","title":"\u521b\u5efa\u7528\u4e8e\u8bfb\u53d6/\u8fd4\u56de\u7684Pydantic\u6a21\u578b/\u6a21\u5f0f","text":"<p>\u73b0\u5728\u521b\u5efa\u5f53\u4ece API \u8fd4\u56de\u6570\u636e\u65f6\u3001\u5c06\u5728\u8bfb\u53d6\u6570\u636e\u65f6\u4f7f\u7528\u7684Pydantic\u6a21\u578b\uff08schemas\uff09\u3002</p> <p>\u4f8b\u5982\uff0c\u5728\u521b\u5efa\u4e00\u4e2a\u9879\u76ee\u4e4b\u524d\uff0c\u6211\u4eec\u4e0d\u77e5\u9053\u5206\u914d\u7ed9\u5b83\u7684 ID \u662f\u4ec0\u4e48\uff0c\u4f46\u662f\u5728\u8bfb\u53d6\u5b83\u65f6\uff08\u4ece API \u8fd4\u56de\u65f6\uff09\u6211\u4eec\u5df2\u7ecf\u77e5\u9053\u5b83\u7684 ID\u3002</p> <p>\u540c\u6837\uff0c\u5f53\u8bfb\u53d6\u7528\u6237\u65f6\uff0c\u6211\u4eec\u73b0\u5728\u53ef\u4ee5\u58f0\u660e<code>items</code>\uff0c\u5c06\u5305\u542b\u5c5e\u4e8e\u8be5\u7528\u6237\u7684\u9879\u76ee\u3002</p> <p>\u4e0d\u4ec5\u662f\u8fd9\u4e9b\u9879\u76ee\u7684 ID\uff0c\u8fd8\u6709\u6211\u4eec\u5728 Pydantic\u6a21\u578b\u4e2d\u5b9a\u4e49\u7684\u7528\u4e8e\u8bfb\u53d6\u9879\u76ee\u7684\u6240\u6709\u6570\u636e\uff1a<code>Item</code>.</p> Python 3.10+Python 3.9+Python 3.6+ <pre><code>from pydantic import BaseModel\n\n\nclass ItemBase(BaseModel):\n    title: str\n    description: str | None = None\n\n\nclass ItemCreate(ItemBase):\n    pass\n\n\nclass Item(ItemBase):\nid: int\nowner_id: int\nclass Config:\n        orm_mode = True\n\n\nclass UserBase(BaseModel):\n    email: str\n\n\nclass UserCreate(UserBase):\n    password: str\n\n\nclass User(UserBase):\nid: int\nis_active: bool\nitems: list[Item] = []\nclass Config:\n        orm_mode = True\n</code></pre> <pre><code>from typing import Union\n\nfrom pydantic import BaseModel\n\n\nclass ItemBase(BaseModel):\n    title: str\n    description: Union[str, None] = None\n\n\nclass ItemCreate(ItemBase):\n    pass\n\n\nclass Item(ItemBase):\nid: int\nowner_id: int\nclass Config:\n        orm_mode = True\n\n\nclass UserBase(BaseModel):\n    email: str\n\n\nclass UserCreate(UserBase):\n    password: str\n\n\nclass User(UserBase):\nid: int\nis_active: bool\nitems: list[Item] = []\nclass Config:\n        orm_mode = True\n</code></pre> <pre><code>from typing import List, Union\n\nfrom pydantic import BaseModel\n\n\nclass ItemBase(BaseModel):\n    title: str\n    description: Union[str, None] = None\n\n\nclass ItemCreate(ItemBase):\n    pass\n\n\nclass Item(ItemBase):\nid: int\nowner_id: int\nclass Config:\n        orm_mode = True\n\n\nclass UserBase(BaseModel):\n    email: str\n\n\nclass UserCreate(UserBase):\n    password: str\n\n\nclass User(UserBase):\nid: int\nis_active: bool\nitems: List[Item] = []\nclass Config:\n        orm_mode = True\n</code></pre> <p>Tip</p> <p>\u8bf7\u6ce8\u610f\uff0c\u8bfb\u53d6\u7528\u6237\uff08\u4ece API \u8fd4\u56de\uff09\u65f6\u5c06\u4f7f\u7528\u4e0d\u5305\u62ec<code>password</code>\u7684<code>User</code> Pydantic\u6a21\u578b\u3002</p>"},{"location":"tutorial/sql-databases/#pydantic-orm_mode","title":"\u4f7f\u7528 Pydantic \u7684<code>orm_mode</code>","text":"<p>\u73b0\u5728\uff0c\u5728\u7528\u4e8e\u67e5\u8be2\u7684 Pydantic\u6a21\u578b<code>Item</code>\u4e2d<code>User</code>\uff0c\u6dfb\u52a0\u4e00\u4e2a\u5185\u90e8<code>Config</code>\u7c7b\u3002</p> <p>\u6b64\u7c7b<code>Config</code>\u7528\u4e8e\u4e3a Pydantic \u63d0\u4f9b\u914d\u7f6e\u3002</p> <p>\u5728<code>Config</code>\u7c7b\u4e2d\uff0c\u8bbe\u7f6e\u5c5e\u6027<code>orm_mode = True</code>\u3002</p> Python 3.10+Python 3.9+Python 3.6+ <pre><code>from pydantic import BaseModel\n\n\nclass ItemBase(BaseModel):\n    title: str\n    description: str | None = None\n\n\nclass ItemCreate(ItemBase):\n    pass\n\n\nclass Item(ItemBase):\nid: int\n    owner_id: int\n\nclass Config:\norm_mode = True\nclass UserBase(BaseModel):\n    email: str\n\n\nclass UserCreate(UserBase):\n    password: str\n\n\nclass User(UserBase):\nid: int\n    is_active: bool\n    items: list[Item] = []\n\nclass Config:\norm_mode = True\n</code></pre> <pre><code>from typing import Union\n\nfrom pydantic import BaseModel\n\n\nclass ItemBase(BaseModel):\n    title: str\n    description: Union[str, None] = None\n\n\nclass ItemCreate(ItemBase):\n    pass\n\n\nclass Item(ItemBase):\nid: int\n    owner_id: int\n\nclass Config:\norm_mode = True\nclass UserBase(BaseModel):\n    email: str\n\n\nclass UserCreate(UserBase):\n    password: str\n\n\nclass User(UserBase):\nid: int\n    is_active: bool\n    items: list[Item] = []\n\nclass Config:\norm_mode = True\n</code></pre> <pre><code>from typing import List, Union\n\nfrom pydantic import BaseModel\n\n\nclass ItemBase(BaseModel):\n    title: str\n    description: Union[str, None] = None\n\n\nclass ItemCreate(ItemBase):\n    pass\n\n\nclass Item(ItemBase):\nid: int\n    owner_id: int\n\nclass Config:\norm_mode = True\nclass UserBase(BaseModel):\n    email: str\n\n\nclass UserCreate(UserBase):\n    password: str\n\n\nclass User(UserBase):\nid: int\n    is_active: bool\n    items: List[Item] = []\n\nclass Config:\norm_mode = True\n</code></pre> <p>Tip</p> <p>\u8bf7\u6ce8\u610f\uff0c\u5b83\u4f7f\u7528<code>=</code>\u5206\u914d\u4e00\u4e2a\u503c\uff0c\u4f8b\u5982\uff1a</p> <p><code>orm_mode = True</code></p> <p>\u5b83\u4e0d\u4f7f\u7528\u4e4b\u524d\u7684<code>:</code>\u6765\u7c7b\u578b\u58f0\u660e\u3002</p> <p>\u8fd9\u662f\u8bbe\u7f6e\u914d\u7f6e\u503c\uff0c\u800c\u4e0d\u662f\u58f0\u660e\u7c7b\u578b\u3002</p> <p>Pydantic<code>orm_mode</code>\u5c06\u544a\u8bc9 Pydantic\u6a21\u578b\u8bfb\u53d6\u6570\u636e\uff0c\u5373\u5b83\u4e0d\u662f\u4e00\u4e2a<code>dict</code>\uff0c\u800c\u662f\u4e00\u4e2a ORM \u6a21\u578b\uff08\u6216\u4efb\u4f55\u5176\u4ed6\u5177\u6709\u5c5e\u6027\u7684\u4efb\u610f\u5bf9\u8c61\uff09\u3002</p> <p>\u8fd9\u6837\uff0c\u800c\u4e0d\u662f\u4ec5\u4ec5\u8bd5\u56fe\u4ece<code>dict</code>\u4e0a <code>id</code> \u4e2d\u83b7\u53d6\u503c\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>id = data[\"id\"]\n</code></pre> <p>\u5c1d\u8bd5\u4ece\u5c5e\u6027\u4e2d\u83b7\u53d6\u5b83\uff0c\u5982\uff1a</p> <pre><code>id = data.id\n</code></pre> <p>\u6709\u4e86\u8fd9\u4e2a\uff0cPydantic\u6a21\u578b\u4e0e ORM \u517c\u5bb9\uff0c\u60a8\u53ea\u9700\u5728\u8def\u5f84\u64cd\u4f5c<code>response_model</code>\u7684\u53c2\u6570\u4e2d\u58f0\u660e\u5b83\u5373\u53ef\u3002</p> <p>\u60a8\u5c06\u80fd\u591f\u8fd4\u56de\u4e00\u4e2a\u6570\u636e\u5e93\u6a21\u578b\uff0c\u5b83\u5c06\u4ece\u4e2d\u8bfb\u53d6\u6570\u636e\u3002</p>"},{"location":"tutorial/sql-databases/#orm","title":"ORM \u6a21\u5f0f\u7684\u6280\u672f\u7ec6\u8282","text":"<p>SQLAlchemy \u548c\u8bb8\u591a\u5176\u4ed6\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u201c\u5ef6\u8fdf\u52a0\u8f7d\u201d\u3002</p> <p>\u8fd9\u610f\u5473\u7740\uff0c\u4f8b\u5982\uff0c\u9664\u975e\u60a8\u5c1d\u8bd5\u8bbf\u95ee\u5305\u542b\u8be5\u6570\u636e\u7684\u5c5e\u6027\uff0c\u5426\u5219\u5b83\u4eec\u4e0d\u4f1a\u4ece\u6570\u636e\u5e93\u4e2d\u83b7\u53d6\u5173\u7cfb\u6570\u636e\u3002</p> <p>\u4f8b\u5982\uff0c\u8bbf\u95ee\u5c5e\u6027<code>items</code>\uff1a</p> <pre><code>current_user.items\n</code></pre> <p>\u5c06\u4f7f SQLAlchemy \u8f6c\u5230<code>items</code>\u8868\u5e76\u83b7\u53d6\u8be5\u7528\u6237\u7684\u9879\u76ee\uff0c\u5728\u8c03\u7528<code>.items</code>\u4e4b\u524d\u4e0d\u4f1a\u53bb\u67e5\u8be2\u6570\u636e\u5e93\u3002</p> <p>\u6ca1\u6709<code>orm_mode</code>\uff0c\u5982\u679c\u60a8\u4ece\u8def\u5f84\u64cd\u4f5c\u8fd4\u56de\u4e00\u4e2a SQLAlchemy \u6a21\u578b\uff0c\u5b83\u4e0d\u4f1a\u5305\u542b\u5173\u7cfb\u6570\u636e\u3002</p> <p>\u5373\u4f7f\u60a8\u5728 Pydantic \u6a21\u578b\u4e2d\u58f0\u660e\u4e86\u8fd9\u4e9b\u5173\u7cfb\uff0c\u4e5f\u6ca1\u6709\u7528\u5904\u3002</p> <p>\u4f46\u662f\u5728 ORM \u6a21\u5f0f\u4e0b\uff0c\u7531\u4e8e Pydantic \u672c\u8eab\u4f1a\u5c1d\u8bd5\u4ece\u5c5e\u6027\u8bbf\u95ee\u5b83\u9700\u8981\u7684\u6570\u636e\uff08\u800c\u4e0d\u662f\u5047\u8bbe\u4e3a <code>dict</code>\uff09\uff0c\u4f60\u53ef\u4ee5\u58f0\u660e\u4f60\u60f3\u8981\u8fd4\u56de\u7684\u7279\u5b9a\u6570\u636e\uff0c\u5b83\u751a\u81f3\u53ef\u4ee5\u4ece ORM \u4e2d\u83b7\u53d6\u5b83\u3002</p>"},{"location":"tutorial/sql-databases/#crud","title":"CRUD\u5de5\u5177","text":"<p>\u73b0\u5728\u8ba9\u6211\u4eec\u770b\u770b\u6587\u4ef6<code>sql_app/crud.py</code>\u3002</p> <p>\u5728\u8fd9\u4e2a\u6587\u4ef6\u4e2d\uff0c\u6211\u4eec\u5c06\u7f16\u5199\u53ef\u91cd\u7528\u7684\u51fd\u6570\u7528\u6765\u4e0e\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u8fdb\u884c\u4ea4\u4e92\u3002</p> <p>CRUD\u5206\u522b\u4e3a\uff1a\u589e\u52a0\u3001\u67e5\u8be2\u3001\u66f4\u6539\u548c\u5220\u9664\uff0c\u5373\u589e\u5220\u6539\u67e5\u3002</p> <p>...\u867d\u7136\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u6211\u4eec\u53ea\u662f\u65b0\u589e\u548c\u67e5\u8be2\u3002</p>"},{"location":"tutorial/sql-databases/#_6","title":"\u8bfb\u53d6\u6570\u636e","text":"<p>\u4ece <code>sqlalchemy.orm</code>\u4e2d\u5bfc\u5165<code>Session</code>\uff0c\u8fd9\u5c06\u5141\u8bb8\u60a8\u58f0\u660e<code>db</code>\u53c2\u6570\u7684\u7c7b\u578b\uff0c\u5e76\u5728\u60a8\u7684\u51fd\u6570\u4e2d\u8fdb\u884c\u66f4\u597d\u7684\u7c7b\u578b\u68c0\u67e5\u548c\u5b8c\u6210\u3002</p> <p>\u5bfc\u5165\u4e4b\u524d\u7684<code>models</code>\uff08SQLAlchemy \u6a21\u578b\uff09\u548c<code>schemas</code>\uff08Pydantic\u6a21\u578b/\u6a21\u5f0f\uff09\u3002</p> <p>\u521b\u5efa\u4e00\u4e9b\u5b9e\u7528\u51fd\u6570\u6765\u5b8c\u6210\uff1a</p> <ul> <li>\u901a\u8fc7 ID \u548c\u7535\u5b50\u90ae\u4ef6\u67e5\u8be2\u5355\u4e2a\u7528\u6237\u3002</li> <li>\u67e5\u8be2\u591a\u4e2a\u7528\u6237\u3002</li> <li>\u67e5\u8be2\u591a\u4e2a\u9879\u76ee\u3002</li> </ul> <pre><code>from sqlalchemy.orm import Session\nfrom . import models, schemas\ndef get_user(db: Session, user_id: int):\nreturn db.query(models.User).filter(models.User.id == user_id).first()\ndef get_user_by_email(db: Session, email: str):\nreturn db.query(models.User).filter(models.User.email == email).first()\ndef get_users(db: Session, skip: int = 0, limit: int = 100):\nreturn db.query(models.User).offset(skip).limit(limit).all()\ndef create_user(db: Session, user: schemas.UserCreate):\n    fake_hashed_password = user.password + \"notreallyhashed\"\n    db_user = models.User(email=user.email, hashed_password=fake_hashed_password)\n    db.add(db_user)\n    db.commit()\n    db.refresh(db_user)\n    return db_user\n\n\ndef get_items(db: Session, skip: int = 0, limit: int = 100):\nreturn db.query(models.Item).offset(skip).limit(limit).all()\ndef create_user_item(db: Session, item: schemas.ItemCreate, user_id: int):\n    db_item = models.Item(**item.dict(), owner_id=user_id)\n    db.add(db_item)\n    db.commit()\n    db.refresh(db_item)\n    return db_item\n</code></pre> <p>Tip</p> <p>\u901a\u8fc7\u521b\u5efa\u4ec5\u4e13\u7528\u4e8e\u4e0e\u6570\u636e\u5e93\u4ea4\u4e92\uff08\u83b7\u53d6\u7528\u6237\u6216\u9879\u76ee\uff09\u7684\u51fd\u6570\uff0c\u72ec\u7acb\u4e8e\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\uff0c\u60a8\u53ef\u4ee5\u66f4\u8f7b\u677e\u5730\u5728\u591a\u4e2a\u90e8\u5206\u4e2d\u91cd\u7528\u5b83\u4eec\uff0c\u5e76\u4e3a\u5b83\u4eec\u6dfb\u52a0\u5355\u5143\u6d4b\u8bd5\u3002</p>"},{"location":"tutorial/sql-databases/#_7","title":"\u521b\u5efa\u6570\u636e","text":"<p>\u73b0\u5728\u521b\u5efa\u5b9e\u7528\u7a0b\u5e8f\u51fd\u6570\u6765\u521b\u5efa\u6570\u636e\u3002</p> <p>\u5b83\u7684\u6b65\u9aa4\u662f\uff1a</p> <ul> <li>\u4f7f\u7528\u60a8\u7684\u6570\u636e\u521b\u5efa\u4e00\u4e2a SQLAlchemy \u6a21\u578b\u5b9e\u4f8b\u3002</li> <li>\u4f7f\u7528<code>add</code>\u6765\u5c06\u8be5\u5b9e\u4f8b\u5bf9\u8c61\u6dfb\u52a0\u5230\u60a8\u7684\u6570\u636e\u5e93\u3002</li> <li>\u4f7f\u7528<code>commit</code>\u6765\u5bf9\u6570\u636e\u5e93\u7684\u4e8b\u52a1\u63d0\u4ea4\uff08\u4ee5\u4fbf\u4fdd\u5b58\u5b83\u4eec\uff09\u3002</li> <li>\u4f7f\u7528<code>refresh</code>\u6765\u5237\u65b0\u60a8\u7684\u6570\u636e\u5e93\u5b9e\u4f8b\uff08\u4ee5\u4fbf\u5b83\u5305\u542b\u6765\u81ea\u6570\u636e\u5e93\u7684\u4efb\u4f55\u65b0\u6570\u636e\uff0c\u4f8b\u5982\u751f\u6210\u7684 ID\uff09\u3002</li> </ul> <pre><code>from sqlalchemy.orm import Session\n\nfrom . import models, schemas\n\n\ndef get_user(db: Session, user_id: int):\n    return db.query(models.User).filter(models.User.id == user_id).first()\n\n\ndef get_user_by_email(db: Session, email: str):\n    return db.query(models.User).filter(models.User.email == email).first()\n\n\ndef get_users(db: Session, skip: int = 0, limit: int = 100):\n    return db.query(models.User).offset(skip).limit(limit).all()\n\n\ndef create_user(db: Session, user: schemas.UserCreate):\nfake_hashed_password = user.password + \"notreallyhashed\"\ndb_user = models.User(email=user.email, hashed_password=fake_hashed_password)\ndb.add(db_user)\ndb.commit()\ndb.refresh(db_user)\nreturn db_user\ndef get_items(db: Session, skip: int = 0, limit: int = 100):\n    return db.query(models.Item).offset(skip).limit(limit).all()\n\n\ndef create_user_item(db: Session, item: schemas.ItemCreate, user_id: int):\ndb_item = models.Item(**item.dict(), owner_id=user_id)\ndb.add(db_item)\ndb.commit()\ndb.refresh(db_item)\nreturn db_item\n</code></pre> <p>Tip</p> <p>SQLAlchemy \u6a21\u578b<code>User</code>\u5305\u542b\u4e00\u4e2a<code>hashed_password</code>\uff0c\u5b83\u5e94\u8be5\u662f\u4e00\u4e2a\u5305\u542b\u6563\u5217\u7684\u5b89\u5168\u5bc6\u7801\u3002</p> <p>\u4f46\u7531\u4e8e API \u5ba2\u6237\u7aef\u63d0\u4f9b\u7684\u662f\u539f\u59cb\u5bc6\u7801\uff0c\u56e0\u6b64\u60a8\u9700\u8981\u5c06\u5176\u63d0\u53d6\u5e76\u5728\u5e94\u7528\u7a0b\u5e8f\u4e2d\u751f\u6210\u6563\u5217\u5bc6\u7801\u3002</p> <p>\u7136\u540e\u5c06hashed_password\u53c2\u6570\u4e0e\u8981\u4fdd\u5b58\u7684\u503c\u4e00\u8d77\u4f20\u9012\u3002</p> <p>Warning</p> <p>\u6b64\u793a\u4f8b\u4e0d\u5b89\u5168\uff0c\u5bc6\u7801\u672a\u7ecf\u8fc7\u54c8\u5e0c\u5904\u7406\u3002</p> <p>\u5728\u73b0\u5b9e\u751f\u6d3b\u4e2d\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u60a8\u9700\u8981\u5bf9\u5bc6\u7801\u8fdb\u884c\u54c8\u5e0c\u5904\u7406\uff0c\u5e76\u4e14\u6c38\u8fdc\u4e0d\u8981\u4ee5\u660e\u6587\u5f62\u5f0f\u4fdd\u5b58\u5b83\u4eec\u3002</p> <p>\u6709\u5173\u66f4\u591a\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u8fd4\u56de\u6559\u7a0b\u4e2d\u7684\u5b89\u5168\u90e8\u5206\u3002</p> <p>\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u53ea\u5173\u6ce8\u6570\u636e\u5e93\u7684\u5de5\u5177\u548c\u673a\u5236\u3002</p> <p>Tip</p> <p>\u8fd9\u91cc\u4e0d\u662f\u5c06\u6bcf\u4e2a\u5173\u952e\u5b57\u53c2\u6570\u4f20\u9012\u7ed9Item\u5e76\u4ecePydantic\u6a21\u578b\u4e2d\u8bfb\u53d6\u6bcf\u4e2a\u53c2\u6570\uff0c\u800c\u662f\u5148\u751f\u6210\u4e00\u4e2a\u5b57\u5178\uff0c\u5176\u4e2d\u5305\u542bPydantic\u6a21\u578b\u7684\u6570\u636e\uff1a</p> <p><code>item.dict()</code></p> <p>\u7136\u540e\u6211\u4eec\u5c06dict\u7684\u952e\u503c\u5bf9 \u4f5c\u4e3a\u5173\u952e\u5b57\u53c2\u6570\u4f20\u9012\u7ed9 SQLAlchemy <code>Item</code>\uff1a</p> <p><code>Item(**item.dict())</code></p> <p>\u7136\u540e\u6211\u4eec\u4f20\u9012 Pydantic\u6a21\u578b\u672a\u63d0\u4f9b\u7684\u989d\u5916\u5173\u952e\u5b57\u53c2\u6570<code>owner_id</code>\uff1a</p> <p><code>Item(**item.dict(), owner_id=user_id)</code></p>"},{"location":"tutorial/sql-databases/#fastapi","title":"\u4e3bFastAPI\u5e94\u7528\u7a0b\u5e8f","text":"<p>\u73b0\u5728\u5728<code>sql_app/main.py</code>\u6587\u4ef6\u4e2d \u8ba9\u6211\u4eec\u96c6\u6210\u548c\u4f7f\u7528\u6211\u4eec\u4e4b\u524d\u521b\u5efa\u7684\u6240\u6709\u5176\u4ed6\u90e8\u5206\u3002</p>"},{"location":"tutorial/sql-databases/#_8","title":"\u521b\u5efa\u6570\u636e\u5e93\u8868","text":"<p>\u4ee5\u975e\u5e38\u7b80\u5355\u7684\u65b9\u5f0f\u521b\u5efa\u6570\u636e\u5e93\u8868\uff1a</p> Python 3.9+Python 3.6+ <pre><code>from fastapi import Depends, FastAPI, HTTPException\nfrom sqlalchemy.orm import Session\n\nfrom . import crud, models, schemas\nfrom .database import SessionLocal, engine\n\nmodels.Base.metadata.create_all(bind=engine)\napp = FastAPI()\n\n\n# Dependency\ndef get_db():\n    db = SessionLocal()\n    try:\n        yield db\n    finally:\n        db.close()\n\n\n@app.post(\"/users/\", response_model=schemas.User)\ndef create_user(user: schemas.UserCreate, db: Session = Depends(get_db)):\n    db_user = crud.get_user_by_email(db, email=user.email)\n    if db_user:\n        raise HTTPException(status_code=400, detail=\"Email already registered\")\n    return crud.create_user(db=db, user=user)\n\n\n@app.get(\"/users/\", response_model=list[schemas.User])\ndef read_users(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\n    users = crud.get_users(db, skip=skip, limit=limit)\n    return users\n\n\n@app.get(\"/users/{user_id}\", response_model=schemas.User)\ndef read_user(user_id: int, db: Session = Depends(get_db)):\n    db_user = crud.get_user(db, user_id=user_id)\n    if db_user is None:\n        raise HTTPException(status_code=404, detail=\"User not found\")\n    return db_user\n\n\n@app.post(\"/users/{user_id}/items/\", response_model=schemas.Item)\ndef create_item_for_user(\n    user_id: int, item: schemas.ItemCreate, db: Session = Depends(get_db)\n):\n    return crud.create_user_item(db=db, item=item, user_id=user_id)\n\n\n@app.get(\"/items/\", response_model=list[schemas.Item])\ndef read_items(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\n    items = crud.get_items(db, skip=skip, limit=limit)\n    return items\n</code></pre> <pre><code>from typing import List\n\nfrom fastapi import Depends, FastAPI, HTTPException\nfrom sqlalchemy.orm import Session\n\nfrom . import crud, models, schemas\nfrom .database import SessionLocal, engine\n\nmodels.Base.metadata.create_all(bind=engine)\napp = FastAPI()\n\n\n# Dependency\ndef get_db():\n    db = SessionLocal()\n    try:\n        yield db\n    finally:\n        db.close()\n\n\n@app.post(\"/users/\", response_model=schemas.User)\ndef create_user(user: schemas.UserCreate, db: Session = Depends(get_db)):\n    db_user = crud.get_user_by_email(db, email=user.email)\n    if db_user:\n        raise HTTPException(status_code=400, detail=\"Email already registered\")\n    return crud.create_user(db=db, user=user)\n\n\n@app.get(\"/users/\", response_model=List[schemas.User])\ndef read_users(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\n    users = crud.get_users(db, skip=skip, limit=limit)\n    return users\n\n\n@app.get(\"/users/{user_id}\", response_model=schemas.User)\ndef read_user(user_id: int, db: Session = Depends(get_db)):\n    db_user = crud.get_user(db, user_id=user_id)\n    if db_user is None:\n        raise HTTPException(status_code=404, detail=\"User not found\")\n    return db_user\n\n\n@app.post(\"/users/{user_id}/items/\", response_model=schemas.Item)\ndef create_item_for_user(\n    user_id: int, item: schemas.ItemCreate, db: Session = Depends(get_db)\n):\n    return crud.create_user_item(db=db, item=item, user_id=user_id)\n\n\n@app.get(\"/items/\", response_model=List[schemas.Item])\ndef read_items(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\n    items = crud.get_items(db, skip=skip, limit=limit)\n    return items\n</code></pre>"},{"location":"tutorial/sql-databases/#alembic","title":"Alembic \u6ce8\u610f","text":"<p>\u901a\u5e38\u4f60\u53ef\u80fd\u4f1a\u4f7f\u7528 Alembic\uff0c\u6765\u8fdb\u884c\u683c\u5f0f\u5316\u6570\u636e\u5e93\uff08\u521b\u5efa\u8868\u7b49\uff09\u3002</p> <p>\u800c\u4e14\u60a8\u8fd8\u53ef\u4ee5\u5c06 Alembic \u7528\u4e8e\u201c\u8fc1\u79fb\u201d\uff08\u8fd9\u662f\u5b83\u7684\u4e3b\u8981\u5de5\u4f5c\uff09\u3002</p> <p>\u201c\u8fc1\u79fb\u201d\u662f\u6bcf\u5f53\u60a8\u66f4\u6539 SQLAlchemy \u6a21\u578b\u7684\u7ed3\u6784\u3001\u6dfb\u52a0\u65b0\u5c5e\u6027\u7b49\u4ee5\u5728\u6570\u636e\u5e93\u4e2d\u590d\u5236\u8fd9\u4e9b\u66f4\u6539\u3001\u6dfb\u52a0\u65b0\u5217\u3001\u65b0\u8868\u7b49\u65f6\u6240\u9700\u7684\u4e00\u7ec4\u6b65\u9aa4\u3002</p> <p>\u60a8\u53ef\u4ee5\u5728Project Generation - Template\u7684\u6a21\u677f\u4e2d\u627e\u5230\u4e00\u4e2a FastAPI \u9879\u76ee\u4e2d\u7684 Alembic \u793a\u4f8b\u3002\u5177\u4f53\u5728<code>alembic</code>\u4ee3\u7801\u76ee\u5f55\u4e2d\u3002</p>"},{"location":"tutorial/sql-databases/#_9","title":"\u521b\u5efa\u4f9d\u8d56\u9879","text":"<p>\u73b0\u5728\u4f7f\u7528\u6211\u4eec\u5728<code>sql_app/database.py</code>\u6587\u4ef6\u4e2d\u521b\u5efa\u7684<code>SessionLocal</code>\u6765\u521b\u5efa\u4f9d\u8d56\u9879\u3002</p> <p>\u6211\u4eec\u9700\u8981\u6bcf\u4e2a\u8bf7\u6c42\u6709\u4e00\u4e2a\u72ec\u7acb\u7684\u6570\u636e\u5e93\u4f1a\u8bdd/\u8fde\u63a5\uff08<code>SessionLocal</code>\uff09\uff0c\u5728\u6240\u6709\u8bf7\u6c42\u4e2d\u4f7f\u7528\u76f8\u540c\u7684\u4f1a\u8bdd\uff0c\u7136\u540e\u5728\u8bf7\u6c42\u5b8c\u6210\u540e\u5173\u95ed\u5b83\u3002</p> <p>\u7136\u540e\u5c06\u4e3a\u4e0b\u4e00\u4e2a\u8bf7\u6c42\u521b\u5efa\u4e00\u4e2a\u65b0\u4f1a\u8bdd\u3002</p> <p>\u4e3a\u6b64\uff0c\u6211\u4eec\u5c06\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u4f9d\u8d56\u9879<code>yield</code>\uff0c\u6b63\u5982\u524d\u9762\u5173\u4e8eDependencies with<code>yield</code>\u7684\u90e8\u5206\u4e2d\u6240\u89e3\u91ca\u7684\u90a3\u6837\u3002</p> <p>\u6211\u4eec\u7684\u4f9d\u8d56\u9879\u5c06\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 SQLAlchemy <code>SessionLocal</code>\uff0c\u5b83\u5c06\u5728\u5355\u4e2a\u8bf7\u6c42\u4e2d\u4f7f\u7528\uff0c\u7136\u540e\u5728\u8bf7\u6c42\u5b8c\u6210\u540e\u5173\u95ed\u5b83\u3002</p> Python 3.9+Python 3.6+ <pre><code>from fastapi import Depends, FastAPI, HTTPException\nfrom sqlalchemy.orm import Session\n\nfrom . import crud, models, schemas\nfrom .database import SessionLocal, engine\n\nmodels.Base.metadata.create_all(bind=engine)\n\napp = FastAPI()\n\n\n# Dependency\ndef get_db():\ndb = SessionLocal()\ntry:\nyield db\nfinally:\ndb.close()\n@app.post(\"/users/\", response_model=schemas.User)\ndef create_user(user: schemas.UserCreate, db: Session = Depends(get_db)):\n    db_user = crud.get_user_by_email(db, email=user.email)\n    if db_user:\n        raise HTTPException(status_code=400, detail=\"Email already registered\")\n    return crud.create_user(db=db, user=user)\n\n\n@app.get(\"/users/\", response_model=list[schemas.User])\ndef read_users(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\n    users = crud.get_users(db, skip=skip, limit=limit)\n    return users\n\n\n@app.get(\"/users/{user_id}\", response_model=schemas.User)\ndef read_user(user_id: int, db: Session = Depends(get_db)):\n    db_user = crud.get_user(db, user_id=user_id)\n    if db_user is None:\n        raise HTTPException(status_code=404, detail=\"User not found\")\n    return db_user\n\n\n@app.post(\"/users/{user_id}/items/\", response_model=schemas.Item)\ndef create_item_for_user(\n    user_id: int, item: schemas.ItemCreate, db: Session = Depends(get_db)\n):\n    return crud.create_user_item(db=db, item=item, user_id=user_id)\n\n\n@app.get(\"/items/\", response_model=list[schemas.Item])\ndef read_items(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\n    items = crud.get_items(db, skip=skip, limit=limit)\n    return items\n</code></pre> <pre><code>from typing import List\n\nfrom fastapi import Depends, FastAPI, HTTPException\nfrom sqlalchemy.orm import Session\n\nfrom . import crud, models, schemas\nfrom .database import SessionLocal, engine\n\nmodels.Base.metadata.create_all(bind=engine)\n\napp = FastAPI()\n\n\n# Dependency\ndef get_db():\ndb = SessionLocal()\ntry:\nyield db\nfinally:\ndb.close()\n@app.post(\"/users/\", response_model=schemas.User)\ndef create_user(user: schemas.UserCreate, db: Session = Depends(get_db)):\n    db_user = crud.get_user_by_email(db, email=user.email)\n    if db_user:\n        raise HTTPException(status_code=400, detail=\"Email already registered\")\n    return crud.create_user(db=db, user=user)\n\n\n@app.get(\"/users/\", response_model=List[schemas.User])\ndef read_users(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\n    users = crud.get_users(db, skip=skip, limit=limit)\n    return users\n\n\n@app.get(\"/users/{user_id}\", response_model=schemas.User)\ndef read_user(user_id: int, db: Session = Depends(get_db)):\n    db_user = crud.get_user(db, user_id=user_id)\n    if db_user is None:\n        raise HTTPException(status_code=404, detail=\"User not found\")\n    return db_user\n\n\n@app.post(\"/users/{user_id}/items/\", response_model=schemas.Item)\ndef create_item_for_user(\n    user_id: int, item: schemas.ItemCreate, db: Session = Depends(get_db)\n):\n    return crud.create_user_item(db=db, item=item, user_id=user_id)\n\n\n@app.get(\"/items/\", response_model=List[schemas.Item])\ndef read_items(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\n    items = crud.get_items(db, skip=skip, limit=limit)\n    return items\n</code></pre> <p>Info</p> <p>\u6211\u4eec\u5c06<code>SessionLocal()</code>\u8bf7\u6c42\u7684\u521b\u5efa\u548c\u5904\u7406\u653e\u5728\u4e00\u4e2a<code>try</code>\u5757\u4e2d\u3002</p> <p>\u7136\u540e\u6211\u4eec\u5728finally\u5757\u4e2d\u5173\u95ed\u5b83\u3002</p> <p>\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u6211\u4eec\u786e\u4fdd\u6570\u636e\u5e93\u4f1a\u8bdd\u5728\u8bf7\u6c42\u540e\u59cb\u7ec8\u5173\u95ed\u3002\u5373\u4f7f\u5728\u5904\u7406\u8bf7\u6c42\u65f6\u51fa\u73b0\u5f02\u5e38\u3002</p> <p>\u4f46\u662f\u60a8\u4e0d\u80fd\u4ece\u9000\u51fa\u4ee3\u7801\u4e2d\u5f15\u53d1\u53e6\u4e00\u4e2a\u5f02\u5e38\uff08\u5728yield\u4e4b\u540e\uff09\u3002\u53ef\u4ee5\u67e5\u9605 Dependencies with yield and HTTPException</p> <p>\u7136\u540e\uff0c\u5f53\u5728\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u4e2d\u4f7f\u7528\u4f9d\u8d56\u9879\u65f6\uff0c\u6211\u4eec\u4f7f\u7528<code>Session</code>\uff0c\u76f4\u63a5\u4ece SQLAlchemy \u5bfc\u5165\u7684\u7c7b\u578b\u58f0\u660e\u5b83\u3002</p> <p>\u8fd9\u5c06\u4e3a\u6211\u4eec\u5728\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u4e2d\u63d0\u4f9b\u66f4\u597d\u7684\u7f16\u8f91\u5668\u652f\u6301\uff0c\u56e0\u4e3a\u7f16\u8f91\u5668\u5c06\u77e5\u9053<code>db</code>\u53c2\u6570\u7684\u7c7b\u578b<code>Session</code>\uff1a</p> Python 3.9+Python 3.6+ <pre><code>from fastapi import Depends, FastAPI, HTTPException\nfrom sqlalchemy.orm import Session\n\nfrom . import crud, models, schemas\nfrom .database import SessionLocal, engine\n\nmodels.Base.metadata.create_all(bind=engine)\n\napp = FastAPI()\n\n\n# Dependency\ndef get_db():\n    db = SessionLocal()\n    try:\n        yield db\n    finally:\n        db.close()\n\n\n@app.post(\"/users/\", response_model=schemas.User)\ndef create_user(user: schemas.UserCreate, db: Session = Depends(get_db)):\ndb_user = crud.get_user_by_email(db, email=user.email)\n    if db_user:\n        raise HTTPException(status_code=400, detail=\"Email already registered\")\n    return crud.create_user(db=db, user=user)\n\n\n@app.get(\"/users/\", response_model=list[schemas.User])\ndef read_users(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\nusers = crud.get_users(db, skip=skip, limit=limit)\n    return users\n\n\n@app.get(\"/users/{user_id}\", response_model=schemas.User)\ndef read_user(user_id: int, db: Session = Depends(get_db)):\ndb_user = crud.get_user(db, user_id=user_id)\n    if db_user is None:\n        raise HTTPException(status_code=404, detail=\"User not found\")\n    return db_user\n\n\n@app.post(\"/users/{user_id}/items/\", response_model=schemas.Item)\ndef create_item_for_user(\nuser_id: int, item: schemas.ItemCreate, db: Session = Depends(get_db)\n):\n    return crud.create_user_item(db=db, item=item, user_id=user_id)\n\n\n@app.get(\"/items/\", response_model=list[schemas.Item])\ndef read_items(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\nitems = crud.get_items(db, skip=skip, limit=limit)\n    return items\n</code></pre> <pre><code>from typing import List\n\nfrom fastapi import Depends, FastAPI, HTTPException\nfrom sqlalchemy.orm import Session\n\nfrom . import crud, models, schemas\nfrom .database import SessionLocal, engine\n\nmodels.Base.metadata.create_all(bind=engine)\n\napp = FastAPI()\n\n\n# Dependency\ndef get_db():\n    db = SessionLocal()\n    try:\n        yield db\n    finally:\n        db.close()\n\n\n@app.post(\"/users/\", response_model=schemas.User)\ndef create_user(user: schemas.UserCreate, db: Session = Depends(get_db)):\ndb_user = crud.get_user_by_email(db, email=user.email)\n    if db_user:\n        raise HTTPException(status_code=400, detail=\"Email already registered\")\n    return crud.create_user(db=db, user=user)\n\n\n@app.get(\"/users/\", response_model=List[schemas.User])\ndef read_users(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\nusers = crud.get_users(db, skip=skip, limit=limit)\n    return users\n\n\n@app.get(\"/users/{user_id}\", response_model=schemas.User)\ndef read_user(user_id: int, db: Session = Depends(get_db)):\ndb_user = crud.get_user(db, user_id=user_id)\n    if db_user is None:\n        raise HTTPException(status_code=404, detail=\"User not found\")\n    return db_user\n\n\n@app.post(\"/users/{user_id}/items/\", response_model=schemas.Item)\ndef create_item_for_user(\nuser_id: int, item: schemas.ItemCreate, db: Session = Depends(get_db)\n):\n    return crud.create_user_item(db=db, item=item, user_id=user_id)\n\n\n@app.get(\"/items/\", response_model=List[schemas.Item])\ndef read_items(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\nitems = crud.get_items(db, skip=skip, limit=limit)\n    return items\n</code></pre> <p>\u6280\u672f\u7ec6\u8282</p> <p>\u53c2\u6570<code>db</code>\u5b9e\u9645\u4e0a\u662f type <code>SessionLocal</code>\uff0c\u4f46\u662f\u8fd9\u4e2a\u7c7b\uff08\u7528 \u521b\u5efa<code>sessionmaker()</code>\uff09\u662f SQLAlchemy \u7684\u201c\u4ee3\u7406\u201d <code>Session</code>\uff0c\u6240\u4ee5\uff0c\u7f16\u8f91\u5668\u5e76\u4e0d\u771f\u6b63\u77e5\u9053\u63d0\u4f9b\u4e86\u54ea\u4e9b\u65b9\u6cd5\u3002</p> <p>\u4f46\u662f\u901a\u8fc7\u5c06\u7c7b\u578b\u58f0\u660e\u4e3aSession\uff0c\u7f16\u8f91\u5668\u73b0\u5728\u53ef\u4ee5\u77e5\u9053\u53ef\u7528\u7684\u65b9\u6cd5\uff08.add()\u3001.query()\u3001.commit()\u7b49\uff09\u5e76\u4e14\u53ef\u4ee5\u63d0\u4f9b\u66f4\u597d\u7684\u652f\u6301\uff08\u6bd4\u5982\u5b8c\u6210\uff09\u3002\u7c7b\u578b\u58f0\u660e\u4e0d\u5f71\u54cd\u5b9e\u9645\u5bf9\u8c61\u3002</p>"},{"location":"tutorial/sql-databases/#fastapi_1","title":"\u521b\u5efa\u60a8\u7684FastAPI \u8def\u5f84\u64cd\u4f5c","text":"<p>\u73b0\u5728\uff0c\u5230\u4e86\u6700\u540e\uff0c\u7f16\u5199\u6807\u51c6\u7684FastAPI \u8def\u5f84\u64cd\u4f5c\u4ee3\u7801\u3002</p> Python 3.9+Python 3.6+ <pre><code>from fastapi import Depends, FastAPI, HTTPException\nfrom sqlalchemy.orm import Session\n\nfrom . import crud, models, schemas\nfrom .database import SessionLocal, engine\n\nmodels.Base.metadata.create_all(bind=engine)\n\napp = FastAPI()\n\n\n# Dependency\ndef get_db():\n    db = SessionLocal()\n    try:\n        yield db\n    finally:\n        db.close()\n\n\n@app.post(\"/users/\", response_model=schemas.User)\ndef create_user(user: schemas.UserCreate, db: Session = Depends(get_db)):\ndb_user = crud.get_user_by_email(db, email=user.email)\nif db_user:\nraise HTTPException(status_code=400, detail=\"Email already registered\")\nreturn crud.create_user(db=db, user=user)\n@app.get(\"/users/\", response_model=list[schemas.User])\ndef read_users(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\nusers = crud.get_users(db, skip=skip, limit=limit)\nreturn users\n@app.get(\"/users/{user_id}\", response_model=schemas.User)\ndef read_user(user_id: int, db: Session = Depends(get_db)):\ndb_user = crud.get_user(db, user_id=user_id)\nif db_user is None:\nraise HTTPException(status_code=404, detail=\"User not found\")\nreturn db_user\n@app.post(\"/users/{user_id}/items/\", response_model=schemas.Item)\ndef create_item_for_user(\nuser_id: int, item: schemas.ItemCreate, db: Session = Depends(get_db)\n):\nreturn crud.create_user_item(db=db, item=item, user_id=user_id)\n@app.get(\"/items/\", response_model=list[schemas.Item])\ndef read_items(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\nitems = crud.get_items(db, skip=skip, limit=limit)\nreturn items\n</code></pre> <pre><code>from typing import List\n\nfrom fastapi import Depends, FastAPI, HTTPException\nfrom sqlalchemy.orm import Session\n\nfrom . import crud, models, schemas\nfrom .database import SessionLocal, engine\n\nmodels.Base.metadata.create_all(bind=engine)\n\napp = FastAPI()\n\n\n# Dependency\ndef get_db():\n    db = SessionLocal()\n    try:\n        yield db\n    finally:\n        db.close()\n\n\n@app.post(\"/users/\", response_model=schemas.User)\ndef create_user(user: schemas.UserCreate, db: Session = Depends(get_db)):\ndb_user = crud.get_user_by_email(db, email=user.email)\nif db_user:\nraise HTTPException(status_code=400, detail=\"Email already registered\")\nreturn crud.create_user(db=db, user=user)\n@app.get(\"/users/\", response_model=List[schemas.User])\ndef read_users(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\nusers = crud.get_users(db, skip=skip, limit=limit)\nreturn users\n@app.get(\"/users/{user_id}\", response_model=schemas.User)\ndef read_user(user_id: int, db: Session = Depends(get_db)):\ndb_user = crud.get_user(db, user_id=user_id)\nif db_user is None:\nraise HTTPException(status_code=404, detail=\"User not found\")\nreturn db_user\n@app.post(\"/users/{user_id}/items/\", response_model=schemas.Item)\ndef create_item_for_user(\nuser_id: int, item: schemas.ItemCreate, db: Session = Depends(get_db)\n):\nreturn crud.create_user_item(db=db, item=item, user_id=user_id)\n@app.get(\"/items/\", response_model=List[schemas.Item])\ndef read_items(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\nitems = crud.get_items(db, skip=skip, limit=limit)\nreturn items\n</code></pre> <p>\u6211\u4eec\u5728\u4f9d\u8d56\u9879\u4e2d\u7684\u6bcf\u4e2a\u8bf7\u6c42\u4e4b\u524d\u5229\u7528<code>yield</code>\u521b\u5efa\u6570\u636e\u5e93\u4f1a\u8bdd\uff0c\u7136\u540e\u5173\u95ed\u5b83\u3002</p> <p>\u6240\u4ee5\u6211\u4eec\u5c31\u53ef\u4ee5\u5728\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u4e2d\u521b\u5efa\u9700\u8981\u7684\u4f9d\u8d56\uff0c\u5c31\u80fd\u76f4\u63a5\u83b7\u53d6\u4f1a\u8bdd\u3002</p> <p>\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u76f4\u63a5\u4ece\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u5185\u90e8\u8c03\u7528<code>crud.get_user</code>\u5e76\u4f7f\u7528\u8be5\u4f1a\u8bdd\uff0c\u6765\u8fdb\u884c\u5bf9\u6570\u636e\u5e93\u64cd\u4f5c\u3002</p> <p>Tip</p> <p>\u8bf7\u6ce8\u610f\uff0c\u60a8\u8fd4\u56de\u7684\u503c\u662f SQLAlchemy \u6a21\u578b\u6216 SQLAlchemy \u6a21\u578b\u5217\u8868\u3002</p> <p>\u4f46\u662f\u7531\u4e8e\u6240\u6709\u8def\u5f84\u64cd\u4f5c\u7684response_model\u90fd\u4f7f\u7528 Pydantic\u6a21\u578b/\u4f7f\u7528orm_mode\u6a21\u5f0f\uff0c\u56e0\u6b64\u60a8\u7684 Pydantic \u6a21\u578b\u4e2d\u58f0\u660e\u7684\u6570\u636e\u5c06\u4ece\u5b83\u4eec\u4e2d\u63d0\u53d6\u5e76\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u5e76\u8fdb\u884c\u6240\u6709\u6b63\u5e38\u7684\u8fc7\u6ee4\u548c\u9a8c\u8bc1\u3002</p> <p>Tip</p> <p>\u53e6\u8bf7\u6ce8\u610f\uff0c<code>response_models</code>\u5e94\u5f53\u662f\u6807\u51c6 Python \u7c7b\u578b\uff0c\u4f8b\u5982<code>List[schemas.Item]</code>.</p> <p>\u4f46\u662f\u7531\u4e8e\u5b83\u7684\u5185\u5bb9/\u53c2\u6570List\u662f\u4e00\u4e2a \u4f7f\u7528orm_mode\u6a21\u5f0f\u7684Pydantic\u6a21\u578b\uff0c\u6240\u4ee5\u6570\u636e\u5c06\u88ab\u6b63\u5e38\u68c0\u7d22\u5e76\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u6240\u4ee5\u6ca1\u6709\u95ee\u9898\u3002</p>"},{"location":"tutorial/sql-databases/#def-async-def","title":"\u5173\u4e8e <code>def</code> \u5bf9\u6bd4 <code>async def</code>","text":"<p>\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u5728\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u548c\u4f9d\u8d56\u9879\u4e2d\u90fd\u4f7f\u7528\u7740 SQLAlchemy \u6a21\u578b\uff0c\u5b83\u5c06\u4e0e\u5916\u90e8\u6570\u636e\u5e93\u8fdb\u884c\u901a\u4fe1\u3002</p> <p>\u8fd9\u4f1a\u9700\u8981\u4e00\u4e9b\u201c\u7b49\u5f85\u65f6\u95f4\u201d\u3002</p> <p>\u4f46\u662f\u7531\u4e8e SQLAlchemy \u4e0d\u5177\u6709<code>await</code>\u76f4\u63a5\u4f7f\u7528\u7684\u517c\u5bb9\u6027\uff0c\u56e0\u6b64\u7c7b\u4f3c\u4e8e\uff1a</p> <pre><code>user = await db.query(User).first()\n</code></pre> <p>...\u76f8\u53cd\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\uff1a</p> <pre><code>user = db.query(User).first()\n</code></pre> <p>\u7136\u540e\u6211\u4eec\u5e94\u8be5\u58f0\u660e\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u548c\u4e0d\u5e26 \u7684\u4f9d\u8d56\u5173\u7cfb<code>async def</code>\uff0c\u53ea\u9700\u4f7f\u7528\u666e\u901a\u7684<code>def</code>\uff0c\u5982\u4e0b\uff1a</p> <pre><code>@app.get(\"/users/{user_id}\", response_model=schemas.User)\ndef read_user(user_id: int, db: Session = Depends(get_db)):\ndb_user = crud.get_user(db, user_id=user_id)\n    ...\n</code></pre> <p>Info</p> <p>\u5982\u679c\u60a8\u9700\u8981\u5f02\u6b65\u8fde\u63a5\u5230\u5173\u7cfb\u6570\u636e\u5e93\uff0c\u8bf7\u53c2\u9605Async SQL (Relational) Databases</p> <p>Very Technical Details</p> <p>\u5982\u679c\u60a8\u5f88\u597d\u5947\u5e76\u4e14\u62e5\u6709\u6df1\u539a\u7684\u6280\u672f\u77e5\u8bc6\uff0c\u60a8\u53ef\u4ee5\u5728Async\u6587\u6863\u4e2d\u67e5\u770b\u6709\u5173\u5982\u4f55\u5904\u7406 <code>async def</code>\u4e8e<code>def</code>\u5dee\u522b\u7684\u6280\u672f\u7ec6\u8282\u3002</p>"},{"location":"tutorial/sql-databases/#_10","title":"\u8fc1\u79fb","text":"<p>\u56e0\u4e3a\u6211\u4eec\u76f4\u63a5\u4f7f\u7528 SQLAlchemy\uff0c\u5e76\u4e14\u6211\u4eec\u4e0d\u9700\u8981\u4efb\u4f55\u7c7b\u578b\u7684\u63d2\u4ef6\u6765\u4f7f\u7528FastAPI\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5c06\u6570\u636e\u5e93\u8fc1\u79fb\u81f3Alembic\u8fdb\u884c\u96c6\u6210\u3002</p> <p>\u7531\u4e8e\u4e0e SQLAlchemy \u548c SQLAlchemy \u6a21\u578b\u76f8\u5173\u7684\u4ee3\u7801\u4f4d\u4e8e\u5355\u72ec\u7684\u72ec\u7acb\u6587\u4ef6\u4e2d\uff0c\u60a8\u751a\u81f3\u53ef\u4ee5\u4f7f\u7528 Alembic \u6267\u884c\u8fc1\u79fb\uff0c\u800c\u65e0\u9700\u5b89\u88c5 FastAPI\u3001Pydantic \u6216\u5176\u4ed6\u4efb\u4f55\u4e1c\u897f\u3002</p> <p>\u540c\u6837\uff0c\u60a8\u5c06\u80fd\u591f\u5728\u4e0eFastAPI\u65e0\u5173\u7684\u4ee3\u7801\u7684\u5176\u4ed6\u90e8\u5206\u4e2d\u4f7f\u7528\u76f8\u540c\u7684 SQLAlchemy \u6a21\u578b\u548c\u5b9e\u7528\u7a0b\u5e8f\u3002</p> <p>\u4f8b\u5982\uff0c\u5728\u5177\u6709Celery\u3001RQ\u6216ARQ\u7684\u540e\u53f0\u4efb\u52a1\u5de5\u4f5c\u8005\u4e2d\u3002</p>"},{"location":"tutorial/sql-databases/#_11","title":"\u5ba1\u67e5\u6240\u6709\u6587\u4ef6","text":"<p>\u6700\u540e\u56de\u987e\u6574\u4e2a\u6848\u4f8b\uff0c\u60a8\u5e94\u8be5\u6709\u4e00\u4e2a\u540d\u4e3a\u7684\u76ee\u5f55<code>my_super_project</code>\uff0c\u5176\u4e2d\u5305\u542b\u4e00\u4e2a\u540d\u4e3a<code>sql_app</code>\u3002</p> <p><code>sql_app</code>\u4e2d\u5e94\u8be5\u6709\u4ee5\u4e0b\u6587\u4ef6\uff1a</p> <ul> <li> <p><code>sql_app/__init__.py</code>\uff1a\u8fd9\u662f\u4e00\u4e2a\u7a7a\u6587\u4ef6\u3002</p> </li> <li> <p><code>sql_app/database.py</code>\uff1a</p> </li> </ul> <pre><code>from sqlalchemy import create_engine\nfrom sqlalchemy.ext.declarative import declarative_base\nfrom sqlalchemy.orm import sessionmaker\n\nSQLALCHEMY_DATABASE_URL = \"sqlite:///./sql_app.db\"\n# SQLALCHEMY_DATABASE_URL = \"postgresql://user:password@postgresserver/db\"\n\nengine = create_engine(\n    SQLALCHEMY_DATABASE_URL, connect_args={\"check_same_thread\": False}\n)\nSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)\n\nBase = declarative_base()\n</code></pre> <ul> <li><code>sql_app/models.py</code>:</li> </ul> <pre><code>from sqlalchemy import Boolean, Column, ForeignKey, Integer, String\nfrom sqlalchemy.orm import relationship\n\nfrom .database import Base\n\n\nclass User(Base):\n    __tablename__ = \"users\"\n\n    id = Column(Integer, primary_key=True, index=True)\n    email = Column(String, unique=True, index=True)\n    hashed_password = Column(String)\n    is_active = Column(Boolean, default=True)\n\n    items = relationship(\"Item\", back_populates=\"owner\")\n\n\nclass Item(Base):\n    __tablename__ = \"items\"\n\n    id = Column(Integer, primary_key=True, index=True)\n    title = Column(String, index=True)\n    description = Column(String, index=True)\n    owner_id = Column(Integer, ForeignKey(\"users.id\"))\n\n    owner = relationship(\"User\", back_populates=\"items\")\n</code></pre> <ul> <li><code>sql_app/schemas.py</code>:</li> </ul> Python 3.10+Python 3.9+Python 3.6+ <pre><code>from pydantic import BaseModel\n\n\nclass ItemBase(BaseModel):\n    title: str\n    description: str | None = None\n\n\nclass ItemCreate(ItemBase):\n    pass\n\n\nclass Item(ItemBase):\n    id: int\n    owner_id: int\n\n    class Config:\n        orm_mode = True\n\n\nclass UserBase(BaseModel):\n    email: str\n\n\nclass UserCreate(UserBase):\n    password: str\n\n\nclass User(UserBase):\n    id: int\n    is_active: bool\n    items: list[Item] = []\n\n    class Config:\n        orm_mode = True\n</code></pre> <pre><code>from typing import Union\n\nfrom pydantic import BaseModel\n\n\nclass ItemBase(BaseModel):\n    title: str\n    description: Union[str, None] = None\n\n\nclass ItemCreate(ItemBase):\n    pass\n\n\nclass Item(ItemBase):\n    id: int\n    owner_id: int\n\n    class Config:\n        orm_mode = True\n\n\nclass UserBase(BaseModel):\n    email: str\n\n\nclass UserCreate(UserBase):\n    password: str\n\n\nclass User(UserBase):\n    id: int\n    is_active: bool\n    items: list[Item] = []\n\n    class Config:\n        orm_mode = True\n</code></pre> <pre><code>from typing import List, Union\n\nfrom pydantic import BaseModel\n\n\nclass ItemBase(BaseModel):\n    title: str\n    description: Union[str, None] = None\n\n\nclass ItemCreate(ItemBase):\n    pass\n\n\nclass Item(ItemBase):\n    id: int\n    owner_id: int\n\n    class Config:\n        orm_mode = True\n\n\nclass UserBase(BaseModel):\n    email: str\n\n\nclass UserCreate(UserBase):\n    password: str\n\n\nclass User(UserBase):\n    id: int\n    is_active: bool\n    items: List[Item] = []\n\n    class Config:\n        orm_mode = True\n</code></pre> <ul> <li><code>sql_app/crud.py</code>:</li> </ul> <pre><code>from sqlalchemy.orm import Session\n\nfrom . import models, schemas\n\n\ndef get_user(db: Session, user_id: int):\n    return db.query(models.User).filter(models.User.id == user_id).first()\n\n\ndef get_user_by_email(db: Session, email: str):\n    return db.query(models.User).filter(models.User.email == email).first()\n\n\ndef get_users(db: Session, skip: int = 0, limit: int = 100):\n    return db.query(models.User).offset(skip).limit(limit).all()\n\n\ndef create_user(db: Session, user: schemas.UserCreate):\n    fake_hashed_password = user.password + \"notreallyhashed\"\n    db_user = models.User(email=user.email, hashed_password=fake_hashed_password)\n    db.add(db_user)\n    db.commit()\n    db.refresh(db_user)\n    return db_user\n\n\ndef get_items(db: Session, skip: int = 0, limit: int = 100):\n    return db.query(models.Item).offset(skip).limit(limit).all()\n\n\ndef create_user_item(db: Session, item: schemas.ItemCreate, user_id: int):\n    db_item = models.Item(**item.dict(), owner_id=user_id)\n    db.add(db_item)\n    db.commit()\n    db.refresh(db_item)\n    return db_item\n</code></pre> <ul> <li><code>sql_app/main.py</code>:</li> </ul> Python 3.9+Python 3.6+ <pre><code>from fastapi import Depends, FastAPI, HTTPException\nfrom sqlalchemy.orm import Session\n\nfrom . import crud, models, schemas\nfrom .database import SessionLocal, engine\n\nmodels.Base.metadata.create_all(bind=engine)\n\napp = FastAPI()\n\n\n# Dependency\ndef get_db():\n    db = SessionLocal()\n    try:\n        yield db\n    finally:\n        db.close()\n\n\n@app.post(\"/users/\", response_model=schemas.User)\ndef create_user(user: schemas.UserCreate, db: Session = Depends(get_db)):\n    db_user = crud.get_user_by_email(db, email=user.email)\n    if db_user:\n        raise HTTPException(status_code=400, detail=\"Email already registered\")\n    return crud.create_user(db=db, user=user)\n\n\n@app.get(\"/users/\", response_model=list[schemas.User])\ndef read_users(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\n    users = crud.get_users(db, skip=skip, limit=limit)\n    return users\n\n\n@app.get(\"/users/{user_id}\", response_model=schemas.User)\ndef read_user(user_id: int, db: Session = Depends(get_db)):\n    db_user = crud.get_user(db, user_id=user_id)\n    if db_user is None:\n        raise HTTPException(status_code=404, detail=\"User not found\")\n    return db_user\n\n\n@app.post(\"/users/{user_id}/items/\", response_model=schemas.Item)\ndef create_item_for_user(\n    user_id: int, item: schemas.ItemCreate, db: Session = Depends(get_db)\n):\n    return crud.create_user_item(db=db, item=item, user_id=user_id)\n\n\n@app.get(\"/items/\", response_model=list[schemas.Item])\ndef read_items(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\n    items = crud.get_items(db, skip=skip, limit=limit)\n    return items\n</code></pre> <pre><code>from typing import List\n\nfrom fastapi import Depends, FastAPI, HTTPException\nfrom sqlalchemy.orm import Session\n\nfrom . import crud, models, schemas\nfrom .database import SessionLocal, engine\n\nmodels.Base.metadata.create_all(bind=engine)\n\napp = FastAPI()\n\n\n# Dependency\ndef get_db():\n    db = SessionLocal()\n    try:\n        yield db\n    finally:\n        db.close()\n\n\n@app.post(\"/users/\", response_model=schemas.User)\ndef create_user(user: schemas.UserCreate, db: Session = Depends(get_db)):\n    db_user = crud.get_user_by_email(db, email=user.email)\n    if db_user:\n        raise HTTPException(status_code=400, detail=\"Email already registered\")\n    return crud.create_user(db=db, user=user)\n\n\n@app.get(\"/users/\", response_model=List[schemas.User])\ndef read_users(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\n    users = crud.get_users(db, skip=skip, limit=limit)\n    return users\n\n\n@app.get(\"/users/{user_id}\", response_model=schemas.User)\ndef read_user(user_id: int, db: Session = Depends(get_db)):\n    db_user = crud.get_user(db, user_id=user_id)\n    if db_user is None:\n        raise HTTPException(status_code=404, detail=\"User not found\")\n    return db_user\n\n\n@app.post(\"/users/{user_id}/items/\", response_model=schemas.Item)\ndef create_item_for_user(\n    user_id: int, item: schemas.ItemCreate, db: Session = Depends(get_db)\n):\n    return crud.create_user_item(db=db, item=item, user_id=user_id)\n\n\n@app.get(\"/items/\", response_model=List[schemas.Item])\ndef read_items(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\n    items = crud.get_items(db, skip=skip, limit=limit)\n    return items\n</code></pre>"},{"location":"tutorial/sql-databases/#_12","title":"\u6267\u884c\u9879\u76ee","text":"<p>\u60a8\u53ef\u4ee5\u590d\u5236\u8fd9\u4e9b\u4ee3\u7801\u5e76\u6309\u539f\u6837\u4f7f\u7528\u5b83\u3002</p> <p>Info</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u8fd9\u91cc\u7684\u4ee3\u7801\u53ea\u662f\u5927\u591a\u6570\u6d4b\u8bd5\u4ee3\u7801\u7684\u4e00\u90e8\u5206\u3002</p> <p>\u4f60\u53ef\u4ee5\u7528 Uvicorn \u8fd0\u884c\u5b83\uff1a</p> <pre><code>$ uvicorn sql_app.main:app --reload\n\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n</code></pre> <p>\u6253\u5f00\u6d4f\u89c8\u5668\u8fdb\u5165 http://127.0.0.1:8000/docs\u3002</p> <p>\u60a8\u5c06\u80fd\u591f\u4e0e\u60a8\u7684FastAPI\u5e94\u7528\u7a0b\u5e8f\u4ea4\u4e92\uff0c\u4ece\u771f\u5b9e\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6570\u636e\uff1a</p> <p></p>"},{"location":"tutorial/sql-databases/#_13","title":"\u76f4\u63a5\u4e0e\u6570\u636e\u5e93\u4ea4\u4e92","text":"<p>\u5982\u679c\u60a8\u60f3\u72ec\u7acb\u4e8e FastAPI \u76f4\u63a5\u6d4f\u89c8 SQLite \u6570\u636e\u5e93\uff08\u6587\u4ef6\uff09\u4ee5\u8c03\u8bd5\u5176\u5185\u5bb9\u3001\u6dfb\u52a0\u8868\u3001\u5217\u3001\u8bb0\u5f55\u3001\u4fee\u6539\u6570\u636e\u7b49\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528SQLite \u7684 DB Browser</p> <p>\u5b83\u770b\u8d77\u6765\u50cf\u8fd9\u6837\uff1a</p> <p></p> <p>\u60a8\u8fd8\u53ef\u4ee5\u4f7f\u7528SQLite Viewer\u6216ExtendsClass\u7b49\u5728\u7ebf SQLite \u6d4f\u89c8\u5668\u3002</p>"},{"location":"tutorial/sql-databases/#_14","title":"\u4e2d\u95f4\u4ef6\u66ff\u4ee3\u6570\u636e\u5e93\u4f1a\u8bdd","text":"<p>\u5982\u679c\u4f60\u4e0d\u80fd\u4f7f\u7528\u4f9d\u8d56\u9879<code>yield</code>\u2014\u2014\u4f8b\u5982\uff0c\u5982\u679c\u4f60\u6ca1\u6709\u4f7f\u7528Python 3.7\u5e76\u4e14\u4e0d\u80fd\u5b89\u88c5\u4e0a\u9762\u63d0\u5230\u7684Python 3.6\u7684\u201cbackports\u201d \u2014\u2014\u4f60\u53ef\u4ee5\u5728\u7c7b\u4f3c\u7684\u201c\u4e2d\u95f4\u4ef6\u201d\u4e2d\u8bbe\u7f6e\u4f1a\u8bdd\u65b9\u6cd5\u3002</p> <p>\u201c\u4e2d\u95f4\u4ef6\u201d\u57fa\u672c\u529f\u80fd\u662f\u4e00\u4e2a\u4e3a\u6bcf\u4e2a\u8bf7\u6c42\u6267\u884c\u7684\u51fd\u6570\u5728\u8bf7\u6c42\u4e4b\u524d\u8fdb\u884c\u6267\u884c\u76f8\u5e94\u7684\u4ee3\u7801\uff0c\u4ee5\u53ca\u5728\u8bf7\u6c42\u6267\u884c\u4e4b\u540e\u6267\u884c\u76f8\u5e94\u7684\u4ee3\u7801\u3002</p>"},{"location":"tutorial/sql-databases/#_15","title":"\u521b\u5efa\u4e2d\u95f4\u4ef6","text":"<p>\u6211\u4eec\u5c06\u6dfb\u52a0\u4e2d\u95f4\u4ef6\uff08\u53ea\u662f\u4e00\u4e2a\u51fd\u6570\uff09\u5c06\u4e3a\u6bcf\u4e2a\u8bf7\u6c42\u521b\u5efa\u4e00\u4e2a\u65b0\u7684 SQLAlchemy<code>SessionLocal</code>\uff0c\u5c06\u5176\u6dfb\u52a0\u5230\u8bf7\u6c42\u4e2d\uff0c\u7136\u540e\u5728\u8bf7\u6c42\u5b8c\u6210\u540e\u5173\u95ed\u5b83\u3002</p> Python 3.9+Python 3.6+ <pre><code>from fastapi import Depends, FastAPI, HTTPException, Request, Response\nfrom sqlalchemy.orm import Session\n\nfrom . import crud, models, schemas\nfrom .database import SessionLocal, engine\n\nmodels.Base.metadata.create_all(bind=engine)\n\napp = FastAPI()\n\n\n@app.middleware(\"http\")\nasync def db_session_middleware(request: Request, call_next):\nresponse = Response(\"Internal server error\", status_code=500)\ntry:\nrequest.state.db = SessionLocal()\nresponse = await call_next(request)\nfinally:\nrequest.state.db.close()\nreturn response\n# Dependency\ndef get_db(request: Request):\n    return request.state.db\n\n\n@app.post(\"/users/\", response_model=schemas.User)\ndef create_user(user: schemas.UserCreate, db: Session = Depends(get_db)):\n    db_user = crud.get_user_by_email(db, email=user.email)\n    if db_user:\n        raise HTTPException(status_code=400, detail=\"Email already registered\")\n    return crud.create_user(db=db, user=user)\n\n\n@app.get(\"/users/\", response_model=list[schemas.User])\ndef read_users(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\n    users = crud.get_users(db, skip=skip, limit=limit)\n    return users\n\n\n@app.get(\"/users/{user_id}\", response_model=schemas.User)\ndef read_user(user_id: int, db: Session = Depends(get_db)):\n    db_user = crud.get_user(db, user_id=user_id)\n    if db_user is None:\n        raise HTTPException(status_code=404, detail=\"User not found\")\n    return db_user\n\n\n@app.post(\"/users/{user_id}/items/\", response_model=schemas.Item)\ndef create_item_for_user(\n    user_id: int, item: schemas.ItemCreate, db: Session = Depends(get_db)\n):\n    return crud.create_user_item(db=db, item=item, user_id=user_id)\n\n\n@app.get(\"/items/\", response_model=list[schemas.Item])\ndef read_items(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\n    items = crud.get_items(db, skip=skip, limit=limit)\n    return items\n</code></pre> <pre><code>from typing import List\n\nfrom fastapi import Depends, FastAPI, HTTPException, Request, Response\nfrom sqlalchemy.orm import Session\n\nfrom . import crud, models, schemas\nfrom .database import SessionLocal, engine\n\nmodels.Base.metadata.create_all(bind=engine)\n\napp = FastAPI()\n\n\n@app.middleware(\"http\")\nasync def db_session_middleware(request: Request, call_next):\nresponse = Response(\"Internal server error\", status_code=500)\ntry:\nrequest.state.db = SessionLocal()\nresponse = await call_next(request)\nfinally:\nrequest.state.db.close()\nreturn response\n# Dependency\ndef get_db(request: Request):\n    return request.state.db\n\n\n@app.post(\"/users/\", response_model=schemas.User)\ndef create_user(user: schemas.UserCreate, db: Session = Depends(get_db)):\n    db_user = crud.get_user_by_email(db, email=user.email)\n    if db_user:\n        raise HTTPException(status_code=400, detail=\"Email already registered\")\n    return crud.create_user(db=db, user=user)\n\n\n@app.get(\"/users/\", response_model=List[schemas.User])\ndef read_users(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\n    users = crud.get_users(db, skip=skip, limit=limit)\n    return users\n\n\n@app.get(\"/users/{user_id}\", response_model=schemas.User)\ndef read_user(user_id: int, db: Session = Depends(get_db)):\n    db_user = crud.get_user(db, user_id=user_id)\n    if db_user is None:\n        raise HTTPException(status_code=404, detail=\"User not found\")\n    return db_user\n\n\n@app.post(\"/users/{user_id}/items/\", response_model=schemas.Item)\ndef create_item_for_user(\n    user_id: int, item: schemas.ItemCreate, db: Session = Depends(get_db)\n):\n    return crud.create_user_item(db=db, item=item, user_id=user_id)\n\n\n@app.get(\"/items/\", response_model=List[schemas.Item])\ndef read_items(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):\n    items = crud.get_items(db, skip=skip, limit=limit)\n    return items\n</code></pre> <p>Info</p> <p>\u6211\u4eec\u5c06<code>SessionLocal()</code>\u8bf7\u6c42\u7684\u521b\u5efa\u548c\u5904\u7406\u653e\u5728\u4e00\u4e2a<code>try</code>\u5757\u4e2d\u3002</p> <p>\u7136\u540e\u6211\u4eec\u5728finally\u5757\u4e2d\u5173\u95ed\u5b83\u3002</p> <p>\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u6211\u4eec\u786e\u4fdd\u6570\u636e\u5e93\u4f1a\u8bdd\u5728\u8bf7\u6c42\u540e\u59cb\u7ec8\u5173\u95ed\uff0c\u5373\u4f7f\u5728\u5904\u7406\u8bf7\u6c42\u65f6\u51fa\u73b0\u5f02\u5e38\u4e5f\u4f1a\u5173\u95ed\u3002</p>"},{"location":"tutorial/sql-databases/#requeststate","title":"\u5173\u4e8e<code>request.state</code>","text":"<p><code>request.state</code>\u662f\u6bcf\u4e2a<code>Request</code>\u5bf9\u8c61\u7684\u5c5e\u6027\u3002\u5b83\u7528\u4e8e\u5b58\u50a8\u9644\u52a0\u5230\u8bf7\u6c42\u672c\u8eab\u7684\u4efb\u610f\u5bf9\u8c61\uff0c\u4f8b\u5982\u672c\u4f8b\u4e2d\u7684\u6570\u636e\u5e93\u4f1a\u8bdd\u3002\u60a8\u53ef\u4ee5\u5728Starlette \u7684\u5173\u4e8e<code>Request</code>state\u7684\u6587\u6863\u4e2d\u4e86\u89e3\u66f4\u591a\u4fe1\u606f\u3002</p> <p>\u5bf9\u4e8e\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5b83\u5e2e\u52a9\u6211\u4eec\u786e\u4fdd\u5728\u6240\u6709\u8bf7\u6c42\u4e2d\u4f7f\u7528\u5355\u4e2a\u6570\u636e\u5e93\u4f1a\u8bdd\uff0c\u7136\u540e\u5173\u95ed\uff08\u5728\u4e2d\u95f4\u4ef6\u4e2d\uff09\u3002</p>"},{"location":"tutorial/sql-databases/#yield","title":"\u4f7f\u7528<code>yield</code>\u4f9d\u8d56\u9879\u4e0e\u4f7f\u7528\u4e2d\u95f4\u4ef6\u7684\u533a\u522b","text":"<p>\u5728\u6b64\u5904\u6dfb\u52a0\u4e2d\u95f4\u4ef6\u4e0e<code>yield</code>\u7684\u4f9d\u8d56\u9879\u7684\u4f5c\u7528\u6548\u679c\u7c7b\u4f3c\uff0c\u4f46\u4e5f\u6709\u4e00\u4e9b\u533a\u522b\uff1a</p> <ul> <li>\u4e2d\u95f4\u4ef6\u9700\u8981\u66f4\u591a\u7684\u4ee3\u7801\u5e76\u4e14\u66f4\u590d\u6742\u4e00\u4e9b\u3002</li> <li>\u4e2d\u95f4\u4ef6\u5fc5\u987b\u662f\u4e00\u4e2a<code>async</code>\u51fd\u6570\u3002<ul> <li>\u5982\u679c\u5176\u4e2d\u6709\u4ee3\u7801\u5fc5\u987b\u201c\u7b49\u5f85\u201d\u7f51\u7edc\uff0c\u5b83\u53ef\u80fd\u4f1a\u5728\u90a3\u91cc\u201c\u963b\u6b62\u201d\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u5e76\u7a0d\u5fae\u964d\u4f4e\u6027\u80fd\u3002</li> <li>\u5c3d\u7ba1\u8fd9\u91cc\u7684<code>SQLAlchemy</code>\u5de5\u4f5c\u65b9\u5f0f\u53ef\u80fd\u4e0d\u662f\u5f88\u6210\u95ee\u9898\u3002</li> <li>\u4f46\u662f\uff0c\u5982\u679c\u60a8\u5411\u7b49\u5f85\u5927\u91cfI/O\u7684\u4e2d\u95f4\u4ef6\u6dfb\u52a0\u66f4\u591a\u4ee3\u7801\uff0c\u5219\u53ef\u80fd\u4f1a\u51fa\u73b0\u95ee\u9898\u3002</li> </ul> </li> <li>\u6bcf\u4e2a\u8bf7\u6c42\u90fd\u4f1a\u8fd0\u884c\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u3002<ul> <li>\u5c06\u4e3a\u6bcf\u4e2a\u8bf7\u6c42\u521b\u5efa\u4e00\u4e2a\u8fde\u63a5\u3002</li> <li>\u5373\u4f7f\u5904\u7406\u8be5\u8bf7\u6c42\u7684\u8def\u5f84\u64cd\u4f5c\u4e0d\u9700\u8981\u6570\u636e\u5e93\u3002</li> </ul> </li> </ul> <p>Tip</p> <p><code>tyield</code>\u5f53\u4f9d\u8d56\u9879 \u8db3\u4ee5\u6ee1\u8db3\u7528\u4f8b\u65f6\uff0c\u4f7f\u7528<code>tyield</code>\u4f9d\u8d56\u9879\u65b9\u6cd5\u4f1a\u66f4\u597d\u3002</p> <p>Info</p> <p><code>yield</code>\u7684\u4f9d\u8d56\u9879\u662f\u6700\u8fd1\u521a\u52a0\u5165FastAPI\u4e2d\u7684\u3002</p> <p>\u6240\u4ee5\u672c\u6559\u7a0b\u7684\u5148\u524d\u7248\u672c\u53ea\u6709\u5e26\u6709\u4e2d\u95f4\u4ef6\u7684\u793a\u4f8b\uff0c\u5e76\u4e14\u53ef\u80fd\u6709\u591a\u4e2a\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u4e2d\u95f4\u4ef6\u8fdb\u884c\u6570\u636e\u5e93\u4f1a\u8bdd\u7ba1\u7406\u3002</p>"},{"location":"tutorial/static-files/","title":"\u9759\u6001\u6587\u4ef6","text":"<p>\u60a8\u53ef\u4ee5\u4f7f\u7528 <code>StaticFiles</code>\u4ece\u76ee\u5f55\u4e2d\u81ea\u52a8\u63d0\u4f9b\u9759\u6001\u6587\u4ef6\u3002</p>"},{"location":"tutorial/static-files/#staticfiles","title":"\u4f7f\u7528<code>StaticFiles</code>","text":"<ul> <li>\u5bfc\u5165<code>StaticFiles</code>\u3002</li> <li>\"\u6302\u8f7d\"(Mount) \u4e00\u4e2a <code>StaticFiles()</code> \u5b9e\u4f8b\u5230\u4e00\u4e2a\u6307\u5b9a\u8def\u5f84\u3002</li> </ul> <pre><code>from fastapi import FastAPI\nfrom fastapi.staticfiles import StaticFiles\napp = FastAPI()\n\napp.mount(\"/static\", StaticFiles(directory=\"static\"), name=\"static\")\n</code></pre> <p>\u6280\u672f\u7ec6\u8282</p> <p>\u4f60\u4e5f\u53ef\u4ee5\u7528 <code>from starlette.staticfiles import StaticFiles</code>\u3002</p> <p>FastAPI \u63d0\u4f9b\u4e86\u548c <code>starlette.staticfiles</code> \u76f8\u540c\u7684 <code>fastapi.staticfiles</code> \uff0c\u53ea\u662f\u4e3a\u4e86\u65b9\u4fbf\u4f60\uff0c\u5f00\u53d1\u8005\u3002\u4f46\u5b83\u786e\u5b9e\u6765\u81eaStarlette\u3002</p>"},{"location":"tutorial/static-files/#mounting","title":"\u4ec0\u4e48\u662f\"\u6302\u8f7d\"(Mounting)","text":"<p>\"\u6302\u8f7d\" \u8868\u793a\u5728\u7279\u5b9a\u8def\u5f84\u6dfb\u52a0\u4e00\u4e2a\u5b8c\u5168\"\u72ec\u7acb\u7684\"\u5e94\u7528\uff0c\u7136\u540e\u8d1f\u8d23\u5904\u7406\u6240\u6709\u5b50\u8def\u5f84\u3002</p> <p>\u8fd9\u4e0e\u4f7f\u7528<code>APIRouter</code>\u4e0d\u540c\uff0c\u56e0\u4e3a\u5b89\u88c5\u7684\u5e94\u7528\u7a0b\u5e8f\u662f\u5b8c\u5168\u72ec\u7acb\u7684\u3002OpenAPI\u548c\u6765\u81ea\u4f60\u4e3b\u5e94\u7528\u7684\u6587\u6863\u4e0d\u4f1a\u5305\u542b\u5df2\u6302\u8f7d\u5e94\u7528\u7684\u4efb\u4f55\u4e1c\u897f\u7b49\u7b49\u3002</p> <p>\u4f60\u53ef\u4ee5\u5728\u9ad8\u7ea7\u7528\u6237\u6307\u5357\u4e2d\u4e86\u89e3\u66f4\u591a\u3002</p>"},{"location":"tutorial/static-files/#_2","title":"\u7ec6\u8282","text":"<p>\u8fd9\u4e2a \"\u5b50\u5e94\u7528\" \u4f1a\u88ab \"\u6302\u8f7d\" \u5230\u7b2c\u4e00\u4e2a <code>\"/static\"</code> \u6307\u5411\u7684\u5b50\u8def\u5f84\u3002\u56e0\u6b64\uff0c\u4efb\u4f55\u4ee5<code>\"/static\"</code>\u5f00\u5934\u7684\u8def\u5f84\u90fd\u4f1a\u88ab\u5b83\u5904\u7406\u3002</p> <p><code>directory=\"static\"</code> \u6307\u5411\u5305\u542b\u4f60\u7684\u9759\u6001\u6587\u4ef6\u7684\u76ee\u5f55\u540d\u5b57\u3002</p> <p><code>name=\"static\"</code> \u63d0\u4f9b\u4e86\u4e00\u4e2a\u80fd\u88abFastAPI\u5185\u90e8\u4f7f\u7528\u7684\u540d\u5b57\u3002</p> <p>\u6240\u6709\u8fd9\u4e9b\u53c2\u6570\u53ef\u4ee5\u4e0d\u540c\u4e8e\"<code>static</code>\"\uff0c\u6839\u636e\u4f60\u5e94\u7528\u7684\u9700\u8981\u548c\u5177\u4f53\u7ec6\u8282\u8c03\u6574\u5b83\u4eec\u3002</p>"},{"location":"tutorial/static-files/#_3","title":"\u66f4\u591a\u4fe1\u606f","text":"<p>\u66f4\u591a\u7ec6\u8282\u548c\u9009\u62e9\u67e5\u9605 Starlette's docs about Static Files.</p>"},{"location":"tutorial/testing/","title":"\u6d4b\u8bd5","text":"<p>\u611f\u8c22 Starlette\uff0c\u6d4b\u8bd5FastAPI \u5e94\u7528\u8f7b\u677e\u53c8\u6109\u5feb\u3002</p> <p>\u5b83\u57fa\u4e8e HTTPX\uff0c \u800cHTTPX\u53c8\u662f\u57fa\u4e8eRequests\u8bbe\u8ba1\u7684\uff0c\u6240\u4ee5\u5f88\u76f8\u4f3c\u4e14\u6613\u61c2\u3002</p> <p>\u6709\u4e86\u5b83\uff0c\u4f60\u53ef\u4ee5\u76f4\u63a5\u4e0eFastAPI\u4e00\u8d77\u4f7f\u7528 pytest\u3002</p>"},{"location":"tutorial/testing/#testclient","title":"\u4f7f\u7528 <code>TestClient</code>","text":"<p>\u4fe1\u606f</p> <p>\u8981\u4f7f\u7528 <code>TestClient</code>\uff0c\u5148\u8981\u5b89\u88c5 <code>httpx</code>.</p> <p>\u4f8b\uff1a<code>pip install httpx</code>.</p> <p>\u5bfc\u5165 <code>TestClient</code>.</p> <p>\u901a\u8fc7\u4f20\u5165\u4f60\u7684FastAPI\u5e94\u7528\u521b\u5efa\u4e00\u4e2a <code>TestClient</code> \u3002</p> <p>\u521b\u5efa\u540d\u5b57\u4ee5 <code>test_</code> \u5f00\u5934\u7684\u51fd\u6570\uff08\u8fd9\u662f\u6807\u51c6\u7684 <code>pytest</code> \u7ea6\u5b9a\uff09\u3002</p> <p>\u50cf\u4f7f\u7528 <code>httpx</code> \u90a3\u6837\u4f7f\u7528 <code>TestClient</code> \u5bf9\u8c61\u3002</p> <p>\u4e3a\u4f60\u9700\u8981\u68c0\u67e5\u7684\u5730\u65b9\u7528\u6807\u51c6\u7684Python\u8868\u8fbe\u5f0f\u5199\u4e2a\u7b80\u5355\u7684 <code>assert</code> \u8bed\u53e5\uff08\u91cd\u7533\uff0c\u6807\u51c6\u7684<code>pytest</code>\uff09\u3002</p> <pre><code>from fastapi import FastAPI\nfrom fastapi.testclient import TestClient\napp = FastAPI()\n\n\n@app.get(\"/\")\nasync def read_main():\n    return {\"msg\": \"Hello World\"}\n\n\nclient = TestClient(app)\ndef test_read_main():\nresponse = client.get(\"/\")\nassert response.status_code == 200\nassert response.json() == {\"msg\": \"Hello World\"}\n</code></pre> <p>\u63d0\u793a</p> <p>\u6ce8\u610f\u6d4b\u8bd5\u51fd\u6570\u662f\u666e\u901a\u7684 <code>def</code>\uff0c\u4e0d\u662f <code>async def</code>\u3002</p> <p>\u8fd8\u6709client\u7684\u8c03\u7528\u4e5f\u662f\u666e\u901a\u7684\u8c03\u7528\uff0c\u4e0d\u662f\u7528 <code>await</code>\u3002</p> <p>\u8fd9\u8ba9\u4f60\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 <code>pytest</code> \u800c\u4e0d\u4f1a\u9047\u5230\u9ebb\u70e6\u3002</p> <p>\u6280\u672f\u7ec6\u8282</p> <p>\u4f60\u4e5f\u53ef\u4ee5\u7528 <code>from starlette.testclient import TestClient</code>\u3002</p> <p>FastAPI \u63d0\u4f9b\u4e86\u548c <code>starlette.testclient</code> \u4e00\u6837\u7684 <code>fastapi.testclient</code>\uff0c\u53ea\u662f\u4e3a\u4e86\u65b9\u4fbf\u5f00\u53d1\u8005\u3002\u4f46\u5b83\u76f4\u63a5\u6765\u81eaStarlette\u3002</p> <p>\u63d0\u793a</p> <p>\u9664\u4e86\u53d1\u9001\u8bf7\u6c42\u4e4b\u5916\uff0c\u5982\u679c\u4f60\u8fd8\u60f3\u6d4b\u8bd5\u65f6\u5728FastAPI\u5e94\u7528\u4e2d\u8c03\u7528 <code>async</code> \u51fd\u6570\uff08\u4f8b\u5982\u5f02\u6b65\u6570\u636e\u5e93\u51fd\u6570\uff09\uff0c \u53ef\u4ee5\u5728\u9ad8\u7ea7\u6559\u7a0b\u4e2d\u770b\u4e0b Async Tests \u3002</p>"},{"location":"tutorial/testing/#_2","title":"\u5206\u79bb\u6d4b\u8bd5","text":"<p>\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u4f60\u53ef\u80fd\u4f1a\u628a\u4f60\u7684\u6d4b\u8bd5\u653e\u5728\u53e6\u4e00\u4e2a\u6587\u4ef6\u91cc\u3002</p> <p>\u60a8\u7684FastAPI\u5e94\u7528\u7a0b\u5e8f\u4e5f\u53ef\u80fd\u7531\u4e00\u4e9b\u6587\u4ef6/\u6a21\u5757\u7ec4\u6210\u7b49\u7b49\u3002</p>"},{"location":"tutorial/testing/#fastapi-app","title":"FastAPI app \u6587\u4ef6","text":"<p>\u5047\u8bbe\u4f60\u6709\u4e00\u4e2a\u50cf \u66f4\u5927\u7684\u5e94\u7528 \u4e2d\u6240\u63cf\u8ff0\u7684\u6587\u4ef6\u7ed3\u6784:</p> <pre><code>.\n\u251c\u2500\u2500 app\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 __init__.py\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 main.py\n</code></pre> <p>\u5728 <code>main.py</code> \u6587\u4ef6\u4e2d\u4f60\u6709\u4e00\u4e2a FastAPI app:</p> <pre><code>from fastapi import FastAPI\n\napp = FastAPI()\n\n\n@app.get(\"/\")\nasync def read_main():\n    return {\"msg\": \"Hello World\"}\n</code></pre>"},{"location":"tutorial/testing/#_3","title":"\u6d4b\u8bd5\u6587\u4ef6","text":"<p>\u7136\u540e\u4f60\u4f1a\u6709\u4e00\u4e2a\u5305\u542b\u6d4b\u8bd5\u7684\u6587\u4ef6 <code>test_main.py</code> \u3002app\u53ef\u4ee5\u50cfPython\u5305\u90a3\u6837\u5b58\u5728\uff08\u4e00\u6837\u662f\u76ee\u5f55\uff0c\u4f46\u6709\u4e2a <code>__init__.py</code> \u6587\u4ef6\uff09\uff1a</p> <pre><code>.\n\u251c\u2500\u2500 app\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 __init__.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 main.py\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 test_main.py\n</code></pre> <p>\u56e0\u4e3a\u8fd9\u6587\u4ef6\u5728\u540c\u4e00\u4e2a\u5305\u4e2d\uff0c\u6240\u4ee5\u4f60\u53ef\u4ee5\u901a\u8fc7\u76f8\u5bf9\u5bfc\u5165\u4ece <code>main</code> \u6a21\u5757\uff08<code>main.py</code>\uff09\u5bfc\u5165<code>app</code>\u5bf9\u8c61\uff1a</p> <pre><code>from fastapi.testclient import TestClient\n\nfrom .main import app\nclient = TestClient(app)\n\n\ndef test_read_main():\n    response = client.get(\"/\")\n    assert response.status_code == 200\n    assert response.json() == {\"msg\": \"Hello World\"}\n</code></pre> <p>...\u7136\u540e\u6d4b\u8bd5\u4ee3\u7801\u548c\u4e4b\u524d\u4e00\u6837\u7684\u3002</p>"},{"location":"tutorial/testing/#_4","title":"\u6d4b\u8bd5\uff1a\u6269\u5c55\u793a\u4f8b","text":"<p>\u73b0\u5728\u8ba9\u6211\u4eec\u6269\u5c55\u8fd9\u4e2a\u4f8b\u5b50\uff0c\u5e76\u6dfb\u52a0\u66f4\u591a\u7ec6\u8282\uff0c\u770b\u4e0b\u5982\u4f55\u6d4b\u8bd5\u4e0d\u540c\u90e8\u5206\u3002</p>"},{"location":"tutorial/testing/#fastapi-app_1","title":"\u6269\u5c55\u540e\u7684 FastAPI app \u6587\u4ef6","text":"<p>\u8ba9\u6211\u4eec\u7ee7\u7eed\u4e4b\u524d\u7684\u6587\u4ef6\u7ed3\u6784\uff1a</p> <pre><code>.\n\u251c\u2500\u2500 app\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 __init__.py\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 main.py\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 test_main.py\n</code></pre> <p>\u5047\u8bbe\u73b0\u5728\u5305\u542bFastAPI app\u7684\u6587\u4ef6 <code>main.py</code>  \u6709\u4e9b\u5176\u4ed6\u8def\u5f84\u64cd\u4f5c\u3002</p> <p>\u6709\u4e2a <code>GET</code> \u64cd\u4f5c\u4f1a\u8fd4\u56de\u9519\u8bef\u3002</p> <p>\u6709\u4e2a <code>POST</code> \u64cd\u4f5c\u4f1a\u8fd4\u56de\u4e00\u4e9b\u9519\u8bef\u3002</p> <p>\u6240\u6709\u8def\u5f84\u64cd\u4f5c \u90fd\u9700\u8981\u4e00\u4e2a<code>X-Token</code> \u5934\u3002</p> Python 3.10+Python 3.9+Python 3.6+Python 3.10+ non-AnnotatedPython 3.6+ non-Annotated <pre><code>from typing import Annotated\n\nfrom fastapi import FastAPI, Header, HTTPException\nfrom pydantic import BaseModel\n\nfake_secret_token = \"coneofsilence\"\n\nfake_db = {\n    \"foo\": {\"id\": \"foo\", \"title\": \"Foo\", \"description\": \"There goes my hero\"},\n    \"bar\": {\"id\": \"bar\", \"title\": \"Bar\", \"description\": \"The bartenders\"},\n}\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    id: str\n    title: str\n    description: str | None = None\n\n\n@app.get(\"/items/{item_id}\", response_model=Item)\nasync def read_main(item_id: str, x_token: Annotated[str, Header()]):\n    if x_token != fake_secret_token:\n        raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n    if item_id not in fake_db:\n        raise HTTPException(status_code=404, detail=\"Item not found\")\n    return fake_db[item_id]\n\n\n@app.post(\"/items/\", response_model=Item)\nasync def create_item(item: Item, x_token: Annotated[str, Header()]):\n    if x_token != fake_secret_token:\n        raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n    if item.id in fake_db:\n        raise HTTPException(status_code=400, detail=\"Item already exists\")\n    fake_db[item.id] = item\n    return item\n</code></pre> <pre><code>from typing import Annotated, Union\n\nfrom fastapi import FastAPI, Header, HTTPException\nfrom pydantic import BaseModel\n\nfake_secret_token = \"coneofsilence\"\n\nfake_db = {\n    \"foo\": {\"id\": \"foo\", \"title\": \"Foo\", \"description\": \"There goes my hero\"},\n    \"bar\": {\"id\": \"bar\", \"title\": \"Bar\", \"description\": \"The bartenders\"},\n}\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    id: str\n    title: str\n    description: Union[str, None] = None\n\n\n@app.get(\"/items/{item_id}\", response_model=Item)\nasync def read_main(item_id: str, x_token: Annotated[str, Header()]):\n    if x_token != fake_secret_token:\n        raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n    if item_id not in fake_db:\n        raise HTTPException(status_code=404, detail=\"Item not found\")\n    return fake_db[item_id]\n\n\n@app.post(\"/items/\", response_model=Item)\nasync def create_item(item: Item, x_token: Annotated[str, Header()]):\n    if x_token != fake_secret_token:\n        raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n    if item.id in fake_db:\n        raise HTTPException(status_code=400, detail=\"Item already exists\")\n    fake_db[item.id] = item\n    return item\n</code></pre> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI, Header, HTTPException\nfrom pydantic import BaseModel\nfrom typing_extensions import Annotated\n\nfake_secret_token = \"coneofsilence\"\n\nfake_db = {\n    \"foo\": {\"id\": \"foo\", \"title\": \"Foo\", \"description\": \"There goes my hero\"},\n    \"bar\": {\"id\": \"bar\", \"title\": \"Bar\", \"description\": \"The bartenders\"},\n}\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    id: str\n    title: str\n    description: Union[str, None] = None\n\n\n@app.get(\"/items/{item_id}\", response_model=Item)\nasync def read_main(item_id: str, x_token: Annotated[str, Header()]):\n    if x_token != fake_secret_token:\n        raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n    if item_id not in fake_db:\n        raise HTTPException(status_code=404, detail=\"Item not found\")\n    return fake_db[item_id]\n\n\n@app.post(\"/items/\", response_model=Item)\nasync def create_item(item: Item, x_token: Annotated[str, Header()]):\n    if x_token != fake_secret_token:\n        raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n    if item.id in fake_db:\n        raise HTTPException(status_code=400, detail=\"Item already exists\")\n    fake_db[item.id] = item\n    return item\n</code></pre> <p>Tip</p> <p>Prefer to use the <code>Annotated</code> version if possible.</p> <pre><code>from fastapi import FastAPI, Header, HTTPException\nfrom pydantic import BaseModel\n\nfake_secret_token = \"coneofsilence\"\n\nfake_db = {\n    \"foo\": {\"id\": \"foo\", \"title\": \"Foo\", \"description\": \"There goes my hero\"},\n    \"bar\": {\"id\": \"bar\", \"title\": \"Bar\", \"description\": \"The bartenders\"},\n}\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    id: str\n    title: str\n    description: str | None = None\n\n\n@app.get(\"/items/{item_id}\", response_model=Item)\nasync def read_main(item_id: str, x_token: str = Header()):\n    if x_token != fake_secret_token:\n        raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n    if item_id not in fake_db:\n        raise HTTPException(status_code=404, detail=\"Item not found\")\n    return fake_db[item_id]\n\n\n@app.post(\"/items/\", response_model=Item)\nasync def create_item(item: Item, x_token: str = Header()):\n    if x_token != fake_secret_token:\n        raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n    if item.id in fake_db:\n        raise HTTPException(status_code=400, detail=\"Item already exists\")\n    fake_db[item.id] = item\n    return item\n</code></pre> <p>Tip</p> <p>Prefer to use the <code>Annotated</code> version if possible.</p> <pre><code>from typing import Union\n\nfrom fastapi import FastAPI, Header, HTTPException\nfrom pydantic import BaseModel\n\nfake_secret_token = \"coneofsilence\"\n\nfake_db = {\n    \"foo\": {\"id\": \"foo\", \"title\": \"Foo\", \"description\": \"There goes my hero\"},\n    \"bar\": {\"id\": \"bar\", \"title\": \"Bar\", \"description\": \"The bartenders\"},\n}\n\napp = FastAPI()\n\n\nclass Item(BaseModel):\n    id: str\n    title: str\n    description: Union[str, None] = None\n\n\n@app.get(\"/items/{item_id}\", response_model=Item)\nasync def read_main(item_id: str, x_token: str = Header()):\n    if x_token != fake_secret_token:\n        raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n    if item_id not in fake_db:\n        raise HTTPException(status_code=404, detail=\"Item not found\")\n    return fake_db[item_id]\n\n\n@app.post(\"/items/\", response_model=Item)\nasync def create_item(item: Item, x_token: str = Header()):\n    if x_token != fake_secret_token:\n        raise HTTPException(status_code=400, detail=\"Invalid X-Token header\")\n    if item.id in fake_db:\n        raise HTTPException(status_code=400, detail=\"Item already exists\")\n    fake_db[item.id] = item\n    return item\n</code></pre>"},{"location":"tutorial/testing/#_5","title":"\u6269\u5c55\u540e\u7684\u6d4b\u8bd5\u6587\u4ef6","text":"<p>\u7136\u540e\u60a8\u53ef\u4ee5\u4f7f\u7528\u6269\u5c55\u540e\u7684\u6d4b\u8bd5\u66f4\u65b0<code>test_main.py</code>\uff1a</p> <pre><code>from fastapi.testclient import TestClient\n\nfrom .main import app\n\nclient = TestClient(app)\n\n\ndef test_read_item():\n    response = client.get(\"/items/foo\", headers={\"X-Token\": \"coneofsilence\"})\n    assert response.status_code == 200\n    assert response.json() == {\n        \"id\": \"foo\",\n        \"title\": \"Foo\",\n        \"description\": \"There goes my hero\",\n    }\n\n\ndef test_read_item_bad_token():\n    response = client.get(\"/items/foo\", headers={\"X-Token\": \"hailhydra\"})\n    assert response.status_code == 400\n    assert response.json() == {\"detail\": \"Invalid X-Token header\"}\n\n\ndef test_read_inexistent_item():\n    response = client.get(\"/items/baz\", headers={\"X-Token\": \"coneofsilence\"})\n    assert response.status_code == 404\n    assert response.json() == {\"detail\": \"Item not found\"}\n\n\ndef test_create_item():\n    response = client.post(\n        \"/items/\",\n        headers={\"X-Token\": \"coneofsilence\"},\n        json={\"id\": \"foobar\", \"title\": \"Foo Bar\", \"description\": \"The Foo Barters\"},\n    )\n    assert response.status_code == 200\n    assert response.json() == {\n        \"id\": \"foobar\",\n        \"title\": \"Foo Bar\",\n        \"description\": \"The Foo Barters\",\n    }\n\n\ndef test_create_item_bad_token():\n    response = client.post(\n        \"/items/\",\n        headers={\"X-Token\": \"hailhydra\"},\n        json={\"id\": \"bazz\", \"title\": \"Bazz\", \"description\": \"Drop the bazz\"},\n    )\n    assert response.status_code == 400\n    assert response.json() == {\"detail\": \"Invalid X-Token header\"}\n\n\ndef test_create_existing_item():\n    response = client.post(\n        \"/items/\",\n        headers={\"X-Token\": \"coneofsilence\"},\n        json={\n            \"id\": \"foo\",\n            \"title\": \"The Foo ID Stealers\",\n            \"description\": \"There goes my stealer\",\n        },\n    )\n    assert response.status_code == 400\n    assert response.json() == {\"detail\": \"Item already exists\"}\n</code></pre> <p>\u6bcf\u5f53\u4f60\u9700\u8981\u5ba2\u6237\u7aef\u5728\u8bf7\u6c42\u4e2d\u4f20\u9012\u4fe1\u606f\uff0c\u4f46\u4f60\u4e0d\u77e5\u9053\u5982\u4f55\u4f20\u9012\u65f6\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u641c\u7d22\uff08\u8c37\u6b4c\uff09\u5982\u4f55\u7528 <code>httpx</code>\u505a\uff0c\u6216\u8005\u662f\u7528 <code>requests</code> \u505a\uff0c\u6bd5\u7adfHTTPX\u7684\u8bbe\u8ba1\u662f\u57fa\u4e8eRequests\u7684\u8bbe\u8ba1\u7684\u3002</p> <p>\u63a5\u7740\u53ea\u9700\u5728\u6d4b\u8bd5\u4e2d\u540c\u6837\u64cd\u4f5c\u3002</p> <p>\u793a\u4f8b\uff1a</p> <ul> <li>\u4f20\u4e00\u4e2a\u8def\u5f84 \u6216\u67e5\u8be2 \u53c2\u6570\uff0c\u6dfb\u52a0\u5230URL\u4e0a\u3002</li> <li>\u4f20\u4e00\u4e2aJSON\u4f53\uff0c\u4f20\u4e00\u4e2aPython\u5bf9\u8c61(\u4f8b\u5982\u4e00\u4e2a<code>dict</code>)\u5230\u53c2\u6570 <code>json</code>\u3002</li> <li>\u5982\u679c\u4f60\u9700\u8981\u53d1\u9001 Form Data \u800c\u4e0d\u662f JSON\uff0c\u4f7f\u7528 <code>data</code> \u53c2\u6570\u3002</li> <li>\u8981\u53d1\u9001 headers\uff0c\u4f20 <code>dict</code> \u7ed9 <code>headers</code> \u53c2\u6570\u3002</li> <li>\u5bf9\u4e8e cookies\uff0c\u4f20 <code>dict</code> \u7ed9 <code>cookies</code> \u53c2\u6570\u3002</li> </ul> <p>\u5173\u4e8e\u5982\u4f55\u4f20\u6570\u636e\u7ed9\u540e\u7aef\u7684\u66f4\u591a\u4fe1\u606f (\u4f7f\u7528<code>httpx</code> \u6216 <code>TestClient</code>)\uff0c\u8bf7\u67e5\u9605 HTTPX \u6587\u6863.</p> <p>\u4fe1\u606f</p> <p>\u6ce8\u610f <code>TestClient</code> \u63a5\u6536\u53ef\u4ee5\u88ab\u8f6c\u5316\u4e3aJSON\u7684\u6570\u636e\uff0c\u800c\u4e0d\u662fPydantic\u6a21\u578b\u3002</p> <p>\u5982\u679c\u4f60\u5728\u6d4b\u8bd5\u4e2d\u6709\u4e00\u4e2aPydantic\u6a21\u578b\uff0c\u5e76\u4e14\u4f60\u60f3\u5728\u6d4b\u8bd5\u65f6\u53d1\u9001\u5b83\u7684\u6570\u636e\u7ed9\u5e94\u7528\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u5728JSON Compatible Encoder\u4ecb\u7ecd\u7684<code>jsonable_encoder</code> \u3002</p>"},{"location":"tutorial/testing/#_6","title":"\u8fd0\u884c\u8d77\u6765","text":"<p>\u4e4b\u540e\uff0c\u4f60\u53ea\u9700\u8981\u5b89\u88c5 <code>pytest</code>:</p> <pre><code>$ pip install pytest\n\n---&gt; 100%\n</code></pre> <p>\u4ed6\u4f1a\u81ea\u52a8\u68c0\u6d4b\u6587\u4ef6\u548c\u6d4b\u8bd5\uff0c\u6267\u884c\u6d4b\u8bd5\uff0c\u7136\u540e\u5411\u4f60\u62a5\u544a\u7ed3\u679c\u3002</p> <p>\u6267\u884c\u6d4b\u8bd5\uff1a</p> <pre><code>$ pytest\n\n================ test session starts ================\nplatform linux -- Python 3.6.9, pytest-5.3.5, py-1.8.1, pluggy-0.13.1\nrootdir: /home/user/code/superawesome-cli/app\nplugins: forked-1.1.3, xdist-1.31.0, cov-2.8.1\ncollected 6 items\n\n---&gt; 100%\n\ntest_main.py &lt;span style=\"color: green; white-space: pre;\"&gt;......                            [100%]&lt;/span&gt;\n\n&lt;span style=\"color: green;\"&gt;================= 1 passed in 0.03s =================&lt;/span&gt;\n</code></pre>"},{"location":"tutorial/dependencies/","title":"\u4f9d\u8d56\u9879 - \u7b2c\u4e00\u6b65","text":"<p>FastAPI \u63d0\u4f9b\u4e86\u7b80\u5355\u6613\u7528\uff0c\u4f46\u529f\u80fd\u5f3a\u5927\u7684\u4f9d\u8d56\u6ce8\u5165\u7cfb\u7edf\u3002</p> <p>\u8fd9\u4e2a\u4f9d\u8d56\u7cfb\u7edf\u8bbe\u8ba1\u7684\u7b80\u5355\u6613\u7528\uff0c\u53ef\u4ee5\u8ba9\u5f00\u53d1\u4eba\u5458\u8f7b\u677e\u5730\u628a\u7ec4\u4ef6\u96c6\u6210\u81f3 FastAPI\u3002</p>"},{"location":"tutorial/dependencies/#_1","title":"\u4ec0\u4e48\u662f\u300c\u4f9d\u8d56\u6ce8\u5165\u300d","text":"<p>\u7f16\u7a0b\u4e2d\u7684\u300c\u4f9d\u8d56\u6ce8\u5165\u300d\u662f\u58f0\u660e\u4ee3\u7801\uff08\u672c\u6587\u4e2d\u4e3a\u8def\u5f84\u64cd\u4f5c\u51fd\u6570 \uff09\u8fd0\u884c\u6240\u9700\u7684\uff0c\u6216\u8981\u4f7f\u7528\u7684\u300c\u4f9d\u8d56\u300d\u7684\u4e00\u79cd\u65b9\u5f0f\u3002</p> <p>\u7136\u540e\uff0c\u7531\u7cfb\u7edf\uff08\u672c\u6587\u4e2d\u4e3a FastAPI\uff09\u8d1f\u8d23\u6267\u884c\u4efb\u610f\u9700\u8981\u7684\u903b\u8f91\uff0c\u4e3a\u4ee3\u7801\u63d0\u4f9b\u8fd9\u4e9b\u4f9d\u8d56\uff08\u300c\u6ce8\u5165\u300d\u4f9d\u8d56\u9879\uff09\u3002</p> <p>\u4f9d\u8d56\u6ce8\u5165\u5e38\u7528\u4e8e\u4ee5\u4e0b\u573a\u666f\uff1a</p> <ul> <li>\u5171\u4eab\u4e1a\u52a1\u903b\u8f91\uff08\u590d\u7528\u76f8\u540c\u7684\u4ee3\u7801\u903b\u8f91\uff09</li> <li>\u5171\u4eab\u6570\u636e\u5e93\u8fde\u63a5</li> <li>\u5b9e\u73b0\u5b89\u5168\u3001\u9a8c\u8bc1\u3001\u89d2\u8272\u6743\u9650</li> <li>\u7b49\u2026\u2026</li> </ul> <p>\u4e0a\u8ff0\u573a\u666f\u5747\u53ef\u4ee5\u4f7f\u7528\u4f9d\u8d56\u6ce8\u5165\uff0c\u5c06\u4ee3\u7801\u91cd\u590d\u6700\u5c0f\u5316\u3002</p>"},{"location":"tutorial/dependencies/#_2","title":"\u7b2c\u4e00\u6b65","text":"<p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5b66\u4e60\u4e00\u4e2a\u975e\u5e38\u7b80\u5355\u7684\u4f8b\u5b50\uff0c\u5c3d\u7ba1\u5b83\u8fc7\u4e8e\u7b80\u5355\uff0c\u4e0d\u662f\u5f88\u5b9e\u7528\u3002</p> <p>\u4f46\u901a\u8fc7\u8fd9\u4e2a\u4f8b\u5b50\uff0c\u60a8\u53ef\u4ee5\u521d\u6b65\u4e86\u89e3\u300c\u4f9d\u8d56\u6ce8\u5165\u300d\u7684\u5de5\u4f5c\u673a\u5236\u3002</p>"},{"location":"tutorial/dependencies/#_3","title":"\u521b\u5efa\u4f9d\u8d56\u9879","text":"<p>\u9996\u5148\uff0c\u8981\u5173\u6ce8\u7684\u662f\u4f9d\u8d56\u9879\u3002</p> <p>\u4f9d\u8d56\u9879\u5c31\u662f\u4e00\u4e2a\u51fd\u6570\uff0c\u4e14\u53ef\u4ee5\u4f7f\u7528\u4e0e\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u76f8\u540c\u7684\u53c2\u6570\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import Depends, FastAPI\n\napp = FastAPI()\n\n\nasync def common_parameters(\nq: Union[str, None] = None, skip: int = 0, limit: int = 100\n):\nreturn {\"q\": q, \"skip\": skip, \"limit\": limit}\n@app.get(\"/items/\")\nasync def read_items(commons: dict = Depends(common_parameters)):\n    return commons\n\n\n@app.get(\"/users/\")\nasync def read_users(commons: dict = Depends(common_parameters)):\n    return commons\n</code></pre> <p>\u5927\u529f\u544a\u6210\u3002</p> <p>\u53ea\u7528\u4e862 \u884c\u4ee3\u7801\u3002</p> <p>\u4f9d\u8d56\u9879\u51fd\u6570\u7684\u5f62\u5f0f\u548c\u7ed3\u6784\u4e0e\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u4e00\u6837\u3002</p> <p>\u56e0\u6b64\uff0c\u53ef\u4ee5\u628a\u4f9d\u8d56\u9879\u5f53\u4f5c\u6ca1\u6709\u300c\u88c5\u9970\u5668\u300d\uff08\u5373\uff0c\u6ca1\u6709 <code>@app.get(\"/some-path\")</code> \uff09\u7684\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u3002</p> <p>\u4f9d\u8d56\u9879\u53ef\u4ee5\u8fd4\u56de\u5404\u79cd\u5185\u5bb9\u3002</p> <p>\u672c\u4f8b\u4e2d\u7684\u4f9d\u8d56\u9879\u9884\u671f\u63a5\u6536\u5982\u4e0b\u53c2\u6570\uff1a</p> <ul> <li>\u7c7b\u578b\u4e3a <code>str</code> \u7684\u53ef\u9009\u67e5\u8be2\u53c2\u6570 <code>q</code></li> <li>\u7c7b\u578b\u4e3a <code>int</code> \u7684\u53ef\u9009\u67e5\u8be2\u53c2\u6570 <code>skip</code>\uff0c\u9ed8\u8ba4\u503c\u662f <code>0</code></li> <li>\u7c7b\u578b\u4e3a <code>int</code> \u7684\u53ef\u9009\u67e5\u8be2\u53c2\u6570 <code>limit</code>\uff0c\u9ed8\u8ba4\u503c\u662f <code>100</code></li> </ul> <p>\u7136\u540e\uff0c\u4f9d\u8d56\u9879\u51fd\u6570\u8fd4\u56de\u5305\u542b\u8fd9\u4e9b\u503c\u7684 <code>dict</code>\u3002</p>"},{"location":"tutorial/dependencies/#depends","title":"\u5bfc\u5165 <code>Depends</code>","text":"<pre><code>from typing import Union\n\nfrom fastapi import Depends, FastAPI\napp = FastAPI()\n\n\nasync def common_parameters(\n    q: Union[str, None] = None, skip: int = 0, limit: int = 100\n):\n    return {\"q\": q, \"skip\": skip, \"limit\": limit}\n\n\n@app.get(\"/items/\")\nasync def read_items(commons: dict = Depends(common_parameters)):\n    return commons\n\n\n@app.get(\"/users/\")\nasync def read_users(commons: dict = Depends(common_parameters)):\n    return commons\n</code></pre>"},{"location":"tutorial/dependencies/#_4","title":"\u58f0\u660e\u4f9d\u8d56\u9879","text":"<p>\u4e0e\u5728\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u53c2\u6570\u4e2d\u4f7f\u7528 <code>Body</code>\u3001<code>Query</code> \u7684\u65b9\u5f0f\u76f8\u540c\uff0c\u58f0\u660e\u4f9d\u8d56\u9879\u9700\u8981\u4f7f\u7528 <code>Depends</code> \u548c\u4e00\u4e2a\u65b0\u7684\u53c2\u6570\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import Depends, FastAPI\n\napp = FastAPI()\n\n\nasync def common_parameters(\n    q: Union[str, None] = None, skip: int = 0, limit: int = 100\n):\n    return {\"q\": q, \"skip\": skip, \"limit\": limit}\n\n\n@app.get(\"/items/\")\nasync def read_items(commons: dict = Depends(common_parameters)):\nreturn commons\n\n\n@app.get(\"/users/\")\nasync def read_users(commons: dict = Depends(common_parameters)):\nreturn commons\n</code></pre> <p>\u867d\u7136\uff0c\u5728\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u7684\u53c2\u6570\u4e2d\u4f7f\u7528 <code>Depends</code> \u7684\u65b9\u5f0f\u4e0e <code>Body</code>\u3001<code>Query</code> \u76f8\u540c\uff0c\u4f46 <code>Depends</code> \u7684\u5de5\u4f5c\u65b9\u5f0f\u7565\u6709\u4e0d\u540c\u3002</p> <p>\u8fd9\u91cc\u53ea\u80fd\u4f20\u7ed9 Depends \u4e00\u4e2a\u53c2\u6570\u3002</p> <p>\u4e14\u8be5\u53c2\u6570\u5fc5\u987b\u662f\u53ef\u8c03\u7528\u5bf9\u8c61\uff0c\u6bd4\u5982\u51fd\u6570\u3002</p> <p>\u8be5\u51fd\u6570\u63a5\u6536\u7684\u53c2\u6570\u548c\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u7684\u53c2\u6570\u4e00\u6837\u3002</p> <p>\u63d0\u793a</p> <p>\u4e0b\u4e00\u7ae0\u4ecb\u7ecd\uff0c\u9664\u4e86\u51fd\u6570\u8fd8\u6709\u54ea\u4e9b\u300c\u5bf9\u8c61\u300d\u53ef\u4ee5\u7528\u4f5c\u4f9d\u8d56\u9879\u3002</p> <p>\u63a5\u6536\u5230\u65b0\u7684\u8bf7\u6c42\u65f6\uff0cFastAPI \u6267\u884c\u5982\u4e0b\u64cd\u4f5c\uff1a</p> <ul> <li>\u7528\u6b63\u786e\u7684\u53c2\u6570\u8c03\u7528\u4f9d\u8d56\u9879\u51fd\u6570\uff08\u300c\u53ef\u4f9d\u8d56\u9879\u300d\uff09</li> <li>\u83b7\u53d6\u51fd\u6570\u8fd4\u56de\u7684\u7ed3\u679c</li> <li>\u628a\u51fd\u6570\u8fd4\u56de\u7684\u7ed3\u679c\u8d4b\u503c\u7ed9\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u7684\u53c2\u6570</li> </ul> <pre><code>graph TB\n\ncommon_parameters([\"common_parameters\"])\nread_items[\"/items/\"]\nread_users[\"/users/\"]\n\ncommon_parameters --&gt; read_items\ncommon_parameters --&gt; read_users</code></pre> <p>\u8fd9\u6837\uff0c\u53ea\u7f16\u5199\u4e00\u6b21\u4ee3\u7801\uff0cFastAPI \u5c31\u53ef\u4ee5\u4e3a\u591a\u4e2a\u8def\u5f84\u64cd\u4f5c\u5171\u4eab\u8fd9\u6bb5\u4ee3\u7801 \u3002</p> <p>\u68c0\u67e5</p> <p>\u6ce8\u610f\uff0c\u65e0\u9700\u521b\u5efa\u4e13\u95e8\u7684\u7c7b\uff0c\u5e76\u5c06\u4e4b\u4f20\u9012\u7ed9 FastAPI \u4ee5\u8fdb\u884c\u300c\u6ce8\u518c\u300d\u6216\u6267\u884c\u7c7b\u4f3c\u7684\u64cd\u4f5c\u3002</p> <p>\u53ea\u8981\u628a\u5b83\u4f20\u9012\u7ed9 <code>Depends</code>\uff0cFastAPI \u5c31\u77e5\u9053\u8be5\u5982\u4f55\u6267\u884c\u540e\u7eed\u64cd\u4f5c\u3002</p>"},{"location":"tutorial/dependencies/#async","title":"\u8981\u4e0d\u8981\u4f7f\u7528 <code>async</code>\uff1f","text":"<p>FastAPI \u8c03\u7528\u4f9d\u8d56\u9879\u7684\u65b9\u5f0f\u4e0e\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u4e00\u6837\uff0c\u56e0\u6b64\uff0c\u5b9a\u4e49\u4f9d\u8d56\u9879\u51fd\u6570\uff0c\u4e5f\u8981\u5e94\u7528\u4e0e\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u76f8\u540c\u7684\u89c4\u5219\u3002</p> <p>\u5373\uff0c\u65e2\u53ef\u4ee5\u4f7f\u7528\u5f02\u6b65\u7684 <code>async def</code>\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u666e\u901a\u7684 <code>def</code> \u5b9a\u4e49\u4f9d\u8d56\u9879\u3002</p> <p>\u5728\u666e\u901a\u7684 <code>def</code> \u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u4e2d\uff0c\u53ef\u4ee5\u58f0\u660e\u5f02\u6b65\u7684 <code>async def</code> \u4f9d\u8d56\u9879\uff1b\u4e5f\u53ef\u4ee5\u5728\u5f02\u6b65\u7684 <code>async def</code> \u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u4e2d\u58f0\u660e\u666e\u901a\u7684 <code>def</code> \u4f9d\u8d56\u9879\u3002</p> <p>\u4e0a\u8ff0\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u662f\u53ef\u884c\u7684\uff0cFastAPI \u77e5\u9053\u8be5\u600e\u4e48\u5904\u7406\u3002</p> <p>\u7b14\u8bb0</p> <p>\u5982\u91cc\u4e0d\u4e86\u89e3\u5f02\u6b65\uff0c\u8bf7\u53c2\u9605\u5f02\u6b65\uff1a\u201c\u7740\u6025\u4e86\uff1f\u201d \u4e00\u7ae0\u4e2d <code>async</code> \u548c <code>await</code> \u7684\u5185\u5bb9\u3002</p>"},{"location":"tutorial/dependencies/#openapi","title":"\u4e0e OpenAPI \u96c6\u6210","text":"<p>\u4f9d\u8d56\u9879\u53ca\u5b50\u4f9d\u8d56\u9879\u7684\u6240\u6709\u8bf7\u6c42\u58f0\u660e\u3001\u9a8c\u8bc1\u548c\u9700\u6c42\u90fd\u53ef\u4ee5\u96c6\u6210\u81f3\u540c\u4e00\u4e2a OpenAPI \u6982\u56fe\u3002</p> <p>\u6240\u4ee5\uff0c\u4ea4\u4e92\u6587\u6863\u91cc\u4e5f\u4f1a\u663e\u793a\u4f9d\u8d56\u9879\u7684\u6240\u6709\u4fe1\u606f\uff1a</p> <p></p>"},{"location":"tutorial/dependencies/#_5","title":"\u7b80\u5355\u7528\u6cd5","text":"<p>\u89c2\u5bdf\u4e00\u4e0b\u5c31\u4f1a\u53d1\u73b0\uff0c\u53ea\u8981\u8def\u5f84 \u548c\u64cd\u4f5c\u5339\u914d\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u58f0\u660e\u7684\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u3002\u7136\u540e\uff0cFastAPI \u4f1a\u7528\u6b63\u786e\u7684\u53c2\u6570\u8c03\u7528\u51fd\u6570\uff0c\u5e76\u63d0\u53d6\u8bf7\u6c42\u4e2d\u7684\u6570\u636e\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u6240\u6709\uff08\u6216\u5927\u591a\u6570\uff09\u7f51\u7edc\u6846\u67b6\u7684\u5de5\u4f5c\u65b9\u5f0f\u90fd\u662f\u8fd9\u6837\u7684\u3002</p> <p>\u5f00\u53d1\u4eba\u5458\u6c38\u8fdc\u90fd\u4e0d\u9700\u8981\u76f4\u63a5\u8c03\u7528\u8fd9\u4e9b\u51fd\u6570\uff0c\u8fd9\u4e9b\u51fd\u6570\u662f\u7531\u6846\u67b6\uff08\u5728\u6b64\u4e3a FastAPI \uff09\u8c03\u7528\u7684\u3002</p> <p>\u901a\u8fc7\u4f9d\u8d56\u6ce8\u5165\u7cfb\u7edf\uff0c\u53ea\u8981\u544a\u8bc9 FastAPI \u8def\u5f84\u64cd\u4f5c\u51fd\u6570 \u8fd8\u8981\u300c\u4f9d\u8d56\u300d\u5176\u4ed6\u5728\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u4e4b\u524d\u6267\u884c\u7684\u5185\u5bb9\uff0cFastAPI \u5c31\u4f1a\u6267\u884c\u51fd\u6570\u4ee3\u7801\uff0c\u5e76\u300c\u6ce8\u5165\u300d\u51fd\u6570\u8fd4\u56de\u7684\u7ed3\u679c\u3002</p> <p>\u5176\u4ed6\u4e0e\u300c\u4f9d\u8d56\u6ce8\u5165\u300d\u6982\u5ff5\u76f8\u540c\u7684\u672f\u8bed\u4e3a\uff1a</p> <ul> <li>\u8d44\u6e90\uff08Resource\uff09</li> <li>\u63d0\u4f9b\u65b9\uff08Provider\uff09</li> <li>\u670d\u52a1\uff08Service\uff09</li> <li>\u53ef\u6ce8\u5165\uff08Injectable\uff09</li> <li>\u7ec4\u4ef6\uff08Component\uff09</li> </ul>"},{"location":"tutorial/dependencies/#fastapi","title":"FastAPI \u63d2\u4ef6","text":"<p>\u4f9d\u8d56\u6ce8\u5165\u7cfb\u7edf\u652f\u6301\u6784\u5efa\u96c6\u6210\u548c\u300c\u63d2\u4ef6\u300d\u3002\u4f46\u5b9e\u9645\u4e0a\uff0cFastAPI \u6839\u672c\u4e0d\u9700\u8981\u521b\u5efa\u300c\u63d2\u4ef6\u300d\uff0c\u56e0\u4e3a\u4f7f\u7528\u4f9d\u8d56\u9879\u53ef\u4ee5\u58f0\u660e\u4e0d\u9650\u6570\u91cf\u7684\u3001\u53ef\u7528\u4e8e\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u7684\u96c6\u6210\u4e0e\u4ea4\u4e92\u3002</p> <p>\u521b\u5efa\u4f9d\u8d56\u9879\u975e\u5e38\u7b80\u5355\u3001\u76f4\u89c2\uff0c\u5e76\u4e14\u8fd8\u652f\u6301\u5bfc\u5165 Python \u5305\u3002\u6beb\u4e0d\u5938\u5f20\u5730\u8bf4\uff0c\u53ea\u8981\u51e0\u884c\u4ee3\u7801\u5c31\u53ef\u4ee5\u628a\u9700\u8981\u7684 Python \u5305\u4e0e API \u51fd\u6570\u96c6\u6210\u5728\u4e00\u8d77\u3002</p> <p>\u4e0b\u4e00\u7ae0\u5c06\u8be6\u7ec6\u4ecb\u7ecd\u5728\u5173\u7cfb\u578b\u6570\u636e\u5e93\u3001NoSQL \u6570\u636e\u5e93\u3001\u5b89\u5168\u7b49\u65b9\u9762\u4f7f\u7528\u4f9d\u8d56\u9879\u7684\u4f8b\u5b50\u3002</p>"},{"location":"tutorial/dependencies/#fastapi_1","title":"FastAPI \u517c\u5bb9\u6027","text":"<p>\u4f9d\u8d56\u6ce8\u5165\u7cfb\u7edf\u5982\u6b64\u7b80\u6d01\u7684\u7279\u6027\uff0c\u8ba9 FastAPI \u53ef\u4ee5\u4e0e\u4e0b\u5217\u7cfb\u7edf\u517c\u5bb9\uff1a</p> <ul> <li>\u5173\u7cfb\u578b\u6570\u636e\u5e93</li> <li>NoSQL \u6570\u636e\u5e93</li> <li>\u5916\u90e8\u652f\u6301\u5e93</li> <li>\u5916\u90e8 API</li> <li>\u8ba4\u8bc1\u548c\u9274\u6743\u7cfb\u7edf</li> <li>API \u4f7f\u7528\u76d1\u63a7\u7cfb\u7edf</li> <li>\u54cd\u5e94\u6570\u636e\u6ce8\u5165\u7cfb\u7edf</li> <li>\u7b49\u7b49\u2026\u2026</li> </ul>"},{"location":"tutorial/dependencies/#_6","title":"\u7b80\u5355\u800c\u5f3a\u5927","text":"<p>\u867d\u7136\uff0c\u5c42\u7ea7\u5f0f\u4f9d\u8d56\u6ce8\u5165\u7cfb\u7edf\u7684\u5b9a\u4e49\u4e0e\u4f7f\u7528\u5341\u5206\u7b80\u5355\uff0c\u4f46\u5b83\u5374\u975e\u5e38\u5f3a\u5927\u3002</p> <p>\u6bd4\u5982\uff0c\u53ef\u4ee5\u5b9a\u4e49\u4f9d\u8d56\u5176\u4ed6\u4f9d\u8d56\u9879\u7684\u4f9d\u8d56\u9879\u3002</p> <p>\u6700\u540e\uff0c\u4f9d\u8d56\u9879\u5c42\u7ea7\u6811\u6784\u5efa\u540e\uff0c\u4f9d\u8d56\u6ce8\u5165\u7cfb\u7edf\u4f1a\u5904\u7406\u6240\u6709\u4f9d\u8d56\u9879\u53ca\u5176\u5b50\u4f9d\u8d56\u9879\uff0c\u5e76\u4e3a\u6bcf\u4e00\u6b65\u64cd\u4f5c\u63d0\u4f9b\uff08\u6ce8\u5165\uff09\u7ed3\u679c\u3002</p> <p>\u6bd4\u5982\uff0c\u4e0b\u9762\u6709 4 \u4e2a API \u8def\u5f84\u64cd\u4f5c\uff08\u7aef\u70b9\uff09\uff1a</p> <ul> <li><code>/items/public/</code></li> <li><code>/items/private/</code></li> <li><code>/users/{user_id}/activate</code></li> <li><code>/items/pro/</code></li> </ul> <p>\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u4f7f\u7528\u4f9d\u8d56\u9879\u53ca\u5176\u5b50\u4f9d\u8d56\u9879\u4e3a\u8fd9\u4e9b\u8def\u5f84\u64cd\u4f5c\u6dfb\u52a0\u4e0d\u540c\u7684\u6743\u9650\uff1a</p> <pre><code>graph TB\n\ncurrent_user([\"current_user\"])\nactive_user([\"active_user\"])\nadmin_user([\"admin_user\"])\npaying_user([\"paying_user\"])\n\npublic[\"/items/public/\"]\nprivate[\"/items/private/\"]\nactivate_user[\"/users/{user_id}/activate\"]\npro_items[\"/items/pro/\"]\n\ncurrent_user --&gt; active_user\nactive_user --&gt; admin_user\nactive_user --&gt; paying_user\n\ncurrent_user --&gt; public\nactive_user --&gt; private\nadmin_user --&gt; activate_user\npaying_user --&gt; pro_items</code></pre>"},{"location":"tutorial/dependencies/#openapi_1","title":"\u4e0e OpenAPI \u96c6\u6210","text":"<p>\u5728\u58f0\u660e\u9700\u6c42\u65f6\uff0c\u6240\u6709\u8fd9\u4e9b\u4f9d\u8d56\u9879\u8fd8\u4f1a\u628a\u53c2\u6570\u3001\u9a8c\u8bc1\u7b49\u529f\u80fd\u6dfb\u52a0\u81f3\u8def\u5f84\u64cd\u4f5c\u3002</p> <p>FastAPI \u8d1f\u8d23\u628a\u4e0a\u8ff0\u5185\u5bb9\u5168\u90e8\u6dfb\u52a0\u5230 OpenAPI \u6982\u56fe\uff0c\u5e76\u663e\u793a\u5728\u4ea4\u4e92\u6587\u6863\u4e2d\u3002</p>"},{"location":"tutorial/dependencies/classes-as-dependencies/","title":"\u7c7b\u4f5c\u4e3a\u4f9d\u8d56\u9879","text":"<p>\u5728\u6df1\u5165\u63a2\u7a76 \u4f9d\u8d56\u6ce8\u5165 \u7cfb\u7edf\u4e4b\u524d\uff0c\u8ba9\u6211\u4eec\u5347\u7ea7\u4e4b\u524d\u7684\u4f8b\u5b50\u3002</p>"},{"location":"tutorial/dependencies/classes-as-dependencies/#dict","title":"\u6765\u81ea\u524d\u4e00\u4e2a\u4f8b\u5b50\u7684<code>dict</code>","text":"<p>\u5728\u524d\u9762\u7684\u4f8b\u5b50\u4e2d, \u6211\u4eec\u4ece\u4f9d\u8d56\u9879 (\"\u53ef\u4f9d\u8d56\u5bf9\u8c61\") \u4e2d\u8fd4\u56de\u4e86\u4e00\u4e2a <code>dict</code>:</p> Python 3.10+Python 3.6+ <pre><code>from fastapi import Depends, FastAPI\n\napp = FastAPI()\n\n\nasync def common_parameters(q: str | None = None, skip: int = 0, limit: int = 100):\nreturn {\"q\": q, \"skip\": skip, \"limit\": limit}\n@app.get(\"/items/\")\nasync def read_items(commons: dict = Depends(common_parameters)):\n    return commons\n\n\n@app.get(\"/users/\")\nasync def read_users(commons: dict = Depends(common_parameters)):\n    return commons\n</code></pre> <pre><code>from typing import Union\n\nfrom fastapi import Depends, FastAPI\n\napp = FastAPI()\n\n\nasync def common_parameters(\nq: Union[str, None] = None, skip: int = 0, limit: int = 100\n):\n    return {\"q\": q, \"skip\": skip, \"limit\": limit}\n\n\n@app.get(\"/items/\")\nasync def read_items(commons: dict = Depends(common_parameters)):\n    return commons\n\n\n@app.get(\"/users/\")\nasync def read_users(commons: dict = Depends(common_parameters)):\n    return commons\n</code></pre> <p>\u4f46\u662f\u540e\u9762\u6211\u4eec\u5728\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u7684\u53c2\u6570 <code>commons</code> \u4e2d\u5f97\u5230\u4e86\u4e00\u4e2a <code>dict</code>\u3002</p> <p>\u6211\u4eec\u77e5\u9053\u7f16\u8f91\u5668\u4e0d\u80fd\u4e3a <code>dict</code> \u63d0\u4f9b\u5f88\u591a\u652f\u6301(\u6bd4\u5982\u8865\u5168)\uff0c\u56e0\u4e3a\u7f16\u8f91\u5668\u4e0d\u77e5\u9053 <code>dict</code> \u7684\u952e\u548c\u503c\u7c7b\u578b\u3002</p> <p>\u5bf9\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u505a\u7684\u66f4\u597d...</p>"},{"location":"tutorial/dependencies/classes-as-dependencies/#_2","title":"\u4ec0\u4e48\u6784\u6210\u4e86\u4f9d\u8d56\u9879\uff1f","text":"<p>\u5230\u76ee\u524d\u4e3a\u6b62\uff0c\u60a8\u770b\u5230\u7684\u4f9d\u8d56\u9879\u90fd\u88ab\u58f0\u660e\u4e3a\u51fd\u6570\u3002</p> <p>\u4f46\u8fd9\u5e76\u4e0d\u662f\u58f0\u660e\u4f9d\u8d56\u9879\u7684\u552f\u4e00\u65b9\u6cd5(\u5c3d\u7ba1\u5b83\u53ef\u80fd\u662f\u66f4\u5e38\u89c1\u7684\u65b9\u6cd5)\u3002</p> <p>\u5173\u952e\u56e0\u7d20\u662f\u4f9d\u8d56\u9879\u5e94\u8be5\u662f \"\u53ef\u8c03\u7528\u5bf9\u8c61\"\u3002</p> <p>Python \u4e2d\u7684 \"\u53ef\u8c03\u7528\u5bf9\u8c61\" \u662f\u6307\u4efb\u4f55 Python \u53ef\u4ee5\u50cf\u51fd\u6570\u4e00\u6837 \"\u8c03\u7528\" \u7684\u5bf9\u8c61\u3002</p> <p>\u6240\u4ee5\uff0c\u5982\u679c\u4f60\u6709\u4e00\u4e2a\u5bf9\u8c61 <code>something</code> (\u53ef\u80fd\u4e0d\u662f\u4e00\u4e2a\u51fd\u6570)\uff0c\u4f60\u53ef\u4ee5 \"\u8c03\u7528\" \u5b83(\u6267\u884c\u5b83)\uff0c\u5c31\u50cf\uff1a</p> <pre><code>something()\n</code></pre> <p>\u6216\u8005</p> <pre><code>something(some_argument, some_keyword_argument=\"foo\")\n</code></pre> <p>\u8fd9\u5c31\u662f \"\u53ef\u8c03\u7528\u5bf9\u8c61\"\u3002</p>"},{"location":"tutorial/dependencies/classes-as-dependencies/#_3","title":"\u7c7b\u4f5c\u4e3a\u4f9d\u8d56\u9879","text":"<p>\u60a8\u53ef\u80fd\u4f1a\u6ce8\u610f\u5230\uff0c\u8981\u521b\u5efa\u4e00\u4e2a Python \u7c7b\u7684\u5b9e\u4f8b\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u76f8\u540c\u7684\u8bed\u6cd5\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50:</p> <pre><code>class Cat:\n    def __init__(self, name: str):\n        self.name = name\n\n\nfluffy = Cat(name=\"Mr Fluffy\")\n</code></pre> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d, <code>fluffy</code> \u662f\u4e00\u4e2a <code>Cat</code> \u7c7b\u7684\u5b9e\u4f8b\u3002</p> <p>\u4e3a\u4e86\u521b\u5efa <code>fluffy</code>\uff0c\u4f60\u8c03\u7528\u4e86 <code>Cat</code> \u3002</p> <p>\u6240\u4ee5\uff0cPython \u7c7b\u4e5f\u662f \u53ef\u8c03\u7528\u5bf9\u8c61\u3002</p> <p>\u56e0\u6b64\uff0c\u5728 FastAPI \u4e2d\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e2a Python \u7c7b\u4f5c\u4e3a\u4e00\u4e2a\u4f9d\u8d56\u9879\u3002</p> <p>\u5b9e\u9645\u4e0a FastAPI \u68c0\u67e5\u7684\u662f\u5b83\u662f\u4e00\u4e2a \"\u53ef\u8c03\u7528\u5bf9\u8c61\"\uff08\u51fd\u6570\uff0c\u7c7b\u6216\u5176\u4ed6\u4efb\u4f55\u7c7b\u578b\uff09\u4ee5\u53ca\u5b9a\u4e49\u7684\u53c2\u6570\u3002</p> <p>\u5982\u679c\u60a8\u5728 FastAPI \u4e2d\u4f20\u9012\u4e00\u4e2a \"\u53ef\u8c03\u7528\u5bf9\u8c61\" \u4f5c\u4e3a\u4f9d\u8d56\u9879\uff0c\u5b83\u5c06\u5206\u6790\u8be5 \"\u53ef\u8c03\u7528\u5bf9\u8c61\" \u7684\u53c2\u6570\uff0c\u5e76\u4ee5\u5904\u7406\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u7684\u53c2\u6570\u7684\u65b9\u5f0f\u6765\u5904\u7406\u5b83\u4eec\u3002\u5305\u62ec\u5b50\u4f9d\u8d56\u9879\u3002</p> <p>\u8fd9\u4e5f\u9002\u7528\u4e8e\u5b8c\u5168\u6ca1\u6709\u53c2\u6570\u7684\u53ef\u8c03\u7528\u5bf9\u8c61\u3002\u8fd9\u4e0e\u4e0d\u5e26\u53c2\u6570\u7684\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u4e00\u6837\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u4e0a\u9762\u7684\u4f9d\u8d56\u9879 \"\u53ef\u4f9d\u8d56\u5bf9\u8c61\" <code>common_parameters</code> \u66f4\u6539\u4e3a\u7c7b <code>CommonQueryParams</code>:</p> Python 3.10+Python 3.6+ <pre><code>from fastapi import Depends, FastAPI\n\napp = FastAPI()\n\n\nfake_items_db = [{\"item_name\": \"Foo\"}, {\"item_name\": \"Bar\"}, {\"item_name\": \"Baz\"}]\n\n\nclass CommonQueryParams:\ndef __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):\nself.q = q\nself.skip = skip\nself.limit = limit\n@app.get(\"/items/\")\nasync def read_items(commons: CommonQueryParams = Depends(CommonQueryParams)):\n    response = {}\n    if commons.q:\n        response.update({\"q\": commons.q})\n    items = fake_items_db[commons.skip : commons.skip + commons.limit]\n    response.update({\"items\": items})\n    return response\n</code></pre> <pre><code>from typing import Union\n\nfrom fastapi import Depends, FastAPI\n\napp = FastAPI()\n\n\nfake_items_db = [{\"item_name\": \"Foo\"}, {\"item_name\": \"Bar\"}, {\"item_name\": \"Baz\"}]\n\n\nclass CommonQueryParams:\ndef __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):\nself.q = q\nself.skip = skip\nself.limit = limit\n@app.get(\"/items/\")\nasync def read_items(commons: CommonQueryParams = Depends(CommonQueryParams)):\n    response = {}\n    if commons.q:\n        response.update({\"q\": commons.q})\n    items = fake_items_db[commons.skip : commons.skip + commons.limit]\n    response.update({\"items\": items})\n    return response\n</code></pre> <p>\u6ce8\u610f\u7528\u4e8e\u521b\u5efa\u7c7b\u5b9e\u4f8b\u7684 <code>__init__</code> \u65b9\u6cd5\uff1a</p> Python 3.10+Python 3.6+ <pre><code>from fastapi import Depends, FastAPI\n\napp = FastAPI()\n\n\nfake_items_db = [{\"item_name\": \"Foo\"}, {\"item_name\": \"Bar\"}, {\"item_name\": \"Baz\"}]\n\n\nclass CommonQueryParams:\ndef __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):\nself.q = q\n        self.skip = skip\n        self.limit = limit\n\n\n@app.get(\"/items/\")\nasync def read_items(commons: CommonQueryParams = Depends(CommonQueryParams)):\n    response = {}\n    if commons.q:\n        response.update({\"q\": commons.q})\n    items = fake_items_db[commons.skip : commons.skip + commons.limit]\n    response.update({\"items\": items})\n    return response\n</code></pre> <pre><code>from typing import Union\n\nfrom fastapi import Depends, FastAPI\n\napp = FastAPI()\n\n\nfake_items_db = [{\"item_name\": \"Foo\"}, {\"item_name\": \"Bar\"}, {\"item_name\": \"Baz\"}]\n\n\nclass CommonQueryParams:\ndef __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):\nself.q = q\n        self.skip = skip\n        self.limit = limit\n\n\n@app.get(\"/items/\")\nasync def read_items(commons: CommonQueryParams = Depends(CommonQueryParams)):\n    response = {}\n    if commons.q:\n        response.update({\"q\": commons.q})\n    items = fake_items_db[commons.skip : commons.skip + commons.limit]\n    response.update({\"items\": items})\n    return response\n</code></pre> <p>...\u5b83\u4e0e\u6211\u4eec\u4ee5\u524d\u7684 <code>common_parameters</code> \u5177\u6709\u76f8\u540c\u7684\u53c2\u6570\uff1a</p> Python 3.10+Python 3.6+ <pre><code>from fastapi import Depends, FastAPI\n\napp = FastAPI()\n\n\nasync def common_parameters(q: str | None = None, skip: int = 0, limit: int = 100):\nreturn {\"q\": q, \"skip\": skip, \"limit\": limit}\n\n\n@app.get(\"/items/\")\nasync def read_items(commons: dict = Depends(common_parameters)):\n    return commons\n\n\n@app.get(\"/users/\")\nasync def read_users(commons: dict = Depends(common_parameters)):\n    return commons\n</code></pre> <pre><code>from typing import Union\n\nfrom fastapi import Depends, FastAPI\n\napp = FastAPI()\n\n\nasync def common_parameters(\nq: Union[str, None] = None, skip: int = 0, limit: int = 100\n):\n    return {\"q\": q, \"skip\": skip, \"limit\": limit}\n\n\n@app.get(\"/items/\")\nasync def read_items(commons: dict = Depends(common_parameters)):\n    return commons\n\n\n@app.get(\"/users/\")\nasync def read_users(commons: dict = Depends(common_parameters)):\n    return commons\n</code></pre> <p>\u8fd9\u4e9b\u53c2\u6570\u5c31\u662f FastAPI \u7528\u6765 \"\u5904\u7406\" \u4f9d\u8d56\u9879\u7684\u3002</p> <p>\u5728\u4e24\u4e2a\u4f8b\u5b50\u4e0b\uff0c\u90fd\u6709\uff1a</p> <ul> <li>\u4e00\u4e2a\u53ef\u9009\u7684 <code>q</code> \u67e5\u8be2\u53c2\u6570\uff0c\u662f <code>str</code> \u7c7b\u578b\u3002</li> <li>\u4e00\u4e2a <code>skip</code> \u67e5\u8be2\u53c2\u6570\uff0c\u662f <code>int</code> \u7c7b\u578b\uff0c\u9ed8\u8ba4\u503c\u4e3a <code>0</code>\u3002</li> <li>\u4e00\u4e2a <code>limit</code> \u67e5\u8be2\u53c2\u6570\uff0c\u662f <code>int</code> \u7c7b\u578b\uff0c\u9ed8\u8ba4\u503c\u4e3a <code>100</code>\u3002</li> </ul> <p>\u5728\u4e24\u4e2a\u4f8b\u5b50\u4e0b\uff0c\u6570\u636e\u90fd\u5c06\u88ab\u8f6c\u6362\u3001\u9a8c\u8bc1\u3001\u5728 OpenAPI schema \u4e0a\u6587\u6863\u5316\uff0c\u7b49\u7b49\u3002</p>"},{"location":"tutorial/dependencies/classes-as-dependencies/#_4","title":"\u4f7f\u7528\u5b83","text":"<p>\u73b0\u5728\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u7c7b\u6765\u58f0\u660e\u4f60\u7684\u4f9d\u8d56\u9879\u4e86\u3002</p> Python 3.10+Python 3.6+ <pre><code>from fastapi import Depends, FastAPI\n\napp = FastAPI()\n\n\nfake_items_db = [{\"item_name\": \"Foo\"}, {\"item_name\": \"Bar\"}, {\"item_name\": \"Baz\"}]\n\n\nclass CommonQueryParams:\n    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):\n        self.q = q\n        self.skip = skip\n        self.limit = limit\n\n\n@app.get(\"/items/\")\nasync def read_items(commons: CommonQueryParams = Depends(CommonQueryParams)):\nresponse = {}\n    if commons.q:\n        response.update({\"q\": commons.q})\n    items = fake_items_db[commons.skip : commons.skip + commons.limit]\n    response.update({\"items\": items})\n    return response\n</code></pre> <pre><code>from typing import Union\n\nfrom fastapi import Depends, FastAPI\n\napp = FastAPI()\n\n\nfake_items_db = [{\"item_name\": \"Foo\"}, {\"item_name\": \"Bar\"}, {\"item_name\": \"Baz\"}]\n\n\nclass CommonQueryParams:\n    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):\n        self.q = q\n        self.skip = skip\n        self.limit = limit\n\n\n@app.get(\"/items/\")\nasync def read_items(commons: CommonQueryParams = Depends(CommonQueryParams)):\nresponse = {}\n    if commons.q:\n        response.update({\"q\": commons.q})\n    items = fake_items_db[commons.skip : commons.skip + commons.limit]\n    response.update({\"items\": items})\n    return response\n</code></pre> <p>FastAPI \u8c03\u7528 <code>CommonQueryParams</code> \u7c7b\u3002\u8fd9\u5c06\u521b\u5efa\u8be5\u7c7b\u7684\u4e00\u4e2a \"\u5b9e\u4f8b\"\uff0c\u8be5\u5b9e\u4f8b\u5c06\u4f5c\u4e3a\u53c2\u6570 <code>commons</code> \u88ab\u4f20\u9012\u7ed9\u4f60\u7684\u51fd\u6570\u3002</p>"},{"location":"tutorial/dependencies/classes-as-dependencies/#vs-depends","title":"\u7c7b\u578b\u6ce8\u89e3 vs <code>Depends</code>","text":"<p>\u6ce8\u610f\uff0c\u6211\u4eec\u5728\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\u7f16\u5199\u4e86\u4e24\u6b21<code>CommonQueryParams</code>\uff1a</p> <pre><code>commons: CommonQueryParams = Depends(CommonQueryParams)\n</code></pre> <p>\u6700\u540e\u7684 <code>CommonQueryParams</code>:</p> <pre><code>... = Depends(CommonQueryParams)\n</code></pre> <p>...\u5b9e\u9645\u4e0a\u662f Fastapi \u7528\u6765\u77e5\u9053\u4f9d\u8d56\u9879\u662f\u4ec0\u4e48\u7684\u3002</p> <p>FastAPI \u5c06\u4ece\u4f9d\u8d56\u9879\u4e2d\u63d0\u53d6\u58f0\u660e\u7684\u53c2\u6570\uff0c\u8fd9\u624d\u662f FastAPI \u5b9e\u9645\u8c03\u7528\u7684\u3002</p> <p>\u5728\u672c\u4f8b\u4e2d\uff0c\u7b2c\u4e00\u4e2a <code>CommonQueryParams</code> \uff1a</p> <pre><code>commons: CommonQueryParams ...\n</code></pre> <p>...\u5bf9\u4e8e FastAPI \u6ca1\u6709\u4efb\u4f55\u7279\u6b8a\u7684\u610f\u4e49\u3002FastAPI \u4e0d\u4f1a\u4f7f\u7528\u5b83\u8fdb\u884c\u6570\u636e\u8f6c\u6362\u3001\u9a8c\u8bc1\u7b49 (\u56e0\u4e3a\u5bf9\u4e8e\u8fd9\uff0c\u5b83\u4f7f\u7528 <code>= Depends(CommonQueryParams)</code>)\u3002</p> <p>\u4f60\u5b9e\u9645\u4e0a\u53ef\u4ee5\u53ea\u8fd9\u6837\u7f16\u5199:</p> <pre><code>commons = Depends(CommonQueryParams)\n</code></pre> <p>..\u5c31\u50cf:</p> Python 3.10+Python 3.6+ <pre><code>from fastapi import Depends, FastAPI\n\napp = FastAPI()\n\n\nfake_items_db = [{\"item_name\": \"Foo\"}, {\"item_name\": \"Bar\"}, {\"item_name\": \"Baz\"}]\n\n\nclass CommonQueryParams:\n    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):\n        self.q = q\n        self.skip = skip\n        self.limit = limit\n\n\n@app.get(\"/items/\")\nasync def read_items(commons=Depends(CommonQueryParams)):\nresponse = {}\n    if commons.q:\n        response.update({\"q\": commons.q})\n    items = fake_items_db[commons.skip : commons.skip + commons.limit]\n    response.update({\"items\": items})\n    return response\n</code></pre> <pre><code>from typing import Union\n\nfrom fastapi import Depends, FastAPI\n\napp = FastAPI()\n\n\nfake_items_db = [{\"item_name\": \"Foo\"}, {\"item_name\": \"Bar\"}, {\"item_name\": \"Baz\"}]\n\n\nclass CommonQueryParams:\n    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):\n        self.q = q\n        self.skip = skip\n        self.limit = limit\n\n\n@app.get(\"/items/\")\nasync def read_items(commons=Depends(CommonQueryParams)):\nresponse = {}\n    if commons.q:\n        response.update({\"q\": commons.q})\n    items = fake_items_db[commons.skip : commons.skip + commons.limit]\n    response.update({\"items\": items})\n    return response\n</code></pre> <p>\u4f46\u662f\u58f0\u660e\u7c7b\u578b\u662f\u88ab\u9f13\u52b1\u7684\uff0c\u56e0\u4e3a\u90a3\u6837\u4f60\u7684\u7f16\u8f91\u5668\u5c31\u4f1a\u77e5\u9053\u5c06\u4f20\u9012\u4ec0\u4e48\u4f5c\u4e3a\u53c2\u6570 <code>commons</code> \uff0c\u7136\u540e\u5b83\u53ef\u4ee5\u5e2e\u52a9\u4f60\u5b8c\u6210\u4ee3\u7801\uff0c\u7c7b\u578b\u68c0\u67e5\uff0c\u7b49\u7b49\uff1a</p> <p></p>"},{"location":"tutorial/dependencies/classes-as-dependencies/#_5","title":"\u5feb\u6377\u65b9\u5f0f","text":"<p>\u4f46\u662f\u60a8\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u5728\u8fd9\u91cc\u6709\u4e00\u4e9b\u4ee3\u7801\u91cd\u590d\u4e86\uff0c\u7f16\u5199\u4e86<code>CommonQueryParams</code>\u4e24\u6b21\uff1a</p> <pre><code>commons: CommonQueryParams = Depends(CommonQueryParams)\n</code></pre> <p>FastAPI \u4e3a\u8fd9\u4e9b\u60c5\u51b5\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5feb\u6377\u65b9\u5f0f\uff0c\u5728\u8fd9\u4e9b\u60c5\u51b5\u4e0b\uff0c\u4f9d\u8d56\u9879 \u660e\u786e\u5730 \u662f\u4e00\u4e2a\u7c7b\uff0cFastAPI \u5c06 \"\u8c03\u7528\" \u5b83\u6765\u521b\u5efa\u7c7b\u672c\u8eab\u7684\u4e00\u4e2a\u5b9e\u4f8b\u3002</p> <p>\u5bf9\u4e8e\u8fd9\u4e9b\u7279\u5b9a\u7684\u60c5\u51b5\uff0c\u60a8\u53ef\u4ee5\u8ddf\u968f\u4ee5\u4e0b\u64cd\u4f5c\uff1a</p> <p>\u4e0d\u662f\u5199\u6210\u8fd9\u6837\uff1a</p> <pre><code>commons: CommonQueryParams = Depends(CommonQueryParams)\n</code></pre> <p>...\u800c\u662f\u8fd9\u6837\u5199:</p> <pre><code>commons: CommonQueryParams = Depends()\n</code></pre> <p>\u60a8\u58f0\u660e\u4f9d\u8d56\u9879\u4f5c\u4e3a\u53c2\u6570\u7684\u7c7b\u578b\uff0c\u5e76\u4f7f\u7528 <code>Depends()</code> \u4f5c\u4e3a\u8be5\u51fd\u6570\u7684\u53c2\u6570\u7684 \"\u9ed8\u8ba4\" \u503c(\u5728 <code>=</code> \u4e4b\u540e)\uff0c\u800c\u5728 <code>Depends()</code> \u4e2d\u6ca1\u6709\u4efb\u4f55\u53c2\u6570\uff0c\u800c\u4e0d\u662f\u5728 <code>Depends(CommonQueryParams)</code> \u7f16\u5199\u5b8c\u6574\u7684\u7c7b\u3002</p> <p>\u540c\u6837\u7684\u4f8b\u5b50\u770b\u8d77\u6765\u50cf\u8fd9\u6837\uff1a</p> Python 3.10+Python 3.6+ <pre><code>from fastapi import Depends, FastAPI\n\napp = FastAPI()\n\n\nfake_items_db = [{\"item_name\": \"Foo\"}, {\"item_name\": \"Bar\"}, {\"item_name\": \"Baz\"}]\n\n\nclass CommonQueryParams:\n    def __init__(self, q: str | None = None, skip: int = 0, limit: int = 100):\n        self.q = q\n        self.skip = skip\n        self.limit = limit\n\n\n@app.get(\"/items/\")\nasync def read_items(commons: CommonQueryParams = Depends()):\nresponse = {}\n    if commons.q:\n        response.update({\"q\": commons.q})\n    items = fake_items_db[commons.skip : commons.skip + commons.limit]\n    response.update({\"items\": items})\n    return response\n</code></pre> <pre><code>from typing import Union\n\nfrom fastapi import Depends, FastAPI\n\napp = FastAPI()\n\n\nfake_items_db = [{\"item_name\": \"Foo\"}, {\"item_name\": \"Bar\"}, {\"item_name\": \"Baz\"}]\n\n\nclass CommonQueryParams:\n    def __init__(self, q: Union[str, None] = None, skip: int = 0, limit: int = 100):\n        self.q = q\n        self.skip = skip\n        self.limit = limit\n\n\n@app.get(\"/items/\")\nasync def read_items(commons: CommonQueryParams = Depends()):\nresponse = {}\n    if commons.q:\n        response.update({\"q\": commons.q})\n    items = fake_items_db[commons.skip : commons.skip + commons.limit]\n    response.update({\"items\": items})\n    return response\n</code></pre> <p>... FastAPI \u4f1a\u77e5\u9053\u600e\u4e48\u5904\u7406\u3002</p> <p>Tip</p> <p>\u5982\u679c\u8fd9\u770b\u8d77\u6765\u66f4\u52a0\u6df7\u4e71\u800c\u4e0d\u662f\u66f4\u52a0\u6709\u5e2e\u52a9\uff0c\u90a3\u4e48\u8bf7\u5ffd\u7565\u5b83\uff0c\u4f60\u4e0d\u9700\u8981\u5b83\u3002</p> <p>\u8fd9\u53ea\u662f\u4e00\u4e2a\u5feb\u6377\u65b9\u5f0f\u3002\u56e0\u4e3a FastAPI \u5173\u5fc3\u7684\u662f\u5e2e\u52a9\u60a8\u51cf\u5c11\u4ee3\u7801\u91cd\u590d\u3002</p>"},{"location":"tutorial/dependencies/dependencies-in-path-operation-decorators/","title":"\u8def\u5f84\u64cd\u4f5c\u88c5\u9970\u5668\u4f9d\u8d56\u9879","text":"<p>\u6709\u65f6\uff0c\u6211\u4eec\u5e76\u4e0d\u9700\u8981\u5728\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u4e2d\u4f7f\u7528\u4f9d\u8d56\u9879\u7684\u8fd4\u56de\u503c\u3002</p> <p>\u6216\u8005\u8bf4\uff0c\u6709\u4e9b\u4f9d\u8d56\u9879\u4e0d\u8fd4\u56de\u503c\u3002</p> <p>\u4f46\u4ecd\u8981\u6267\u884c\u6216\u89e3\u6790\u8be5\u4f9d\u8d56\u9879\u3002</p> <p>\u5bf9\u4e8e\u8fd9\u79cd\u60c5\u51b5\uff0c\u4e0d\u5fc5\u5728\u58f0\u660e\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u7684\u53c2\u6570\u65f6\u4f7f\u7528 <code>Depends</code>\uff0c\u800c\u662f\u53ef\u4ee5\u5728\u8def\u5f84\u64cd\u4f5c\u88c5\u9970\u5668\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u7531 <code>dependencies</code> \u7ec4\u6210\u7684 <code>list</code>\u3002</p>"},{"location":"tutorial/dependencies/dependencies-in-path-operation-decorators/#dependencies","title":"\u5728\u8def\u5f84\u64cd\u4f5c\u88c5\u9970\u5668\u4e2d\u6dfb\u52a0 <code>dependencies</code> \u53c2\u6570","text":"<p>\u8def\u5f84\u64cd\u4f5c\u88c5\u9970\u5668\u652f\u6301\u53ef\u9009\u53c2\u6570 ~ <code>dependencies</code>\u3002</p> <p>\u8be5\u53c2\u6570\u7684\u503c\u662f\u7531 <code>Depends()</code> \u7ec4\u6210\u7684 <code>list</code>\uff1a</p> <pre><code>from fastapi import Depends, FastAPI, Header, HTTPException\n\napp = FastAPI()\n\n\nasync def verify_token(x_token: str = Header()):\n    if x_token != \"fake-super-secret-token\":\n        raise HTTPException(status_code=400, detail=\"X-Token header invalid\")\n\n\nasync def verify_key(x_key: str = Header()):\n    if x_key != \"fake-super-secret-key\":\n        raise HTTPException(status_code=400, detail=\"X-Key header invalid\")\n    return x_key\n\n\n@app.get(\"/items/\", dependencies=[Depends(verify_token), Depends(verify_key)])\nasync def read_items():\n    return [{\"item\": \"Foo\"}, {\"item\": \"Bar\"}]\n</code></pre> <p>\u8def\u5f84\u64cd\u4f5c\u88c5\u9970\u5668\u4f9d\u8d56\u9879\uff08\u4ee5\u4e0b\u7b80\u79f0\u4e3a\u201c\u8def\u5f84\u88c5\u9970\u5668\u4f9d\u8d56\u9879\u201d\uff09\u7684\u6267\u884c\u6216\u89e3\u6790\u65b9\u5f0f\u548c\u666e\u901a\u4f9d\u8d56\u9879\u4e00\u6837\uff0c\u4f46\u5c31\u7b97\u8fd9\u4e9b\u4f9d\u8d56\u9879\u4f1a\u8fd4\u56de\u503c\uff0c\u5b83\u4eec\u7684\u503c\u4e5f\u4e0d\u4f1a\u4f20\u9012\u7ed9\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u3002</p> <p>\u63d0\u793a</p> <p>\u6709\u4e9b\u7f16\u8f91\u5668\u4f1a\u68c0\u67e5\u4ee3\u7801\u4e2d\u6ca1\u4f7f\u7528\u8fc7\u7684\u51fd\u6570\u53c2\u6570\uff0c\u5e76\u663e\u793a\u9519\u8bef\u63d0\u793a\u3002</p> <p>\u5728\u8def\u5f84\u64cd\u4f5c\u88c5\u9970\u5668\u4e2d\u4f7f\u7528 <code>dependencies</code> \u53c2\u6570\uff0c\u53ef\u4ee5\u786e\u4fdd\u5728\u6267\u884c\u4f9d\u8d56\u9879\u7684\u540c\u65f6\uff0c\u907f\u514d\u7f16\u8f91\u5668\u663e\u793a\u9519\u8bef\u63d0\u793a\u3002</p> <p>\u4f7f\u7528\u8def\u5f84\u88c5\u9970\u5668\u4f9d\u8d56\u9879\u8fd8\u53ef\u4ee5\u907f\u514d\u5f00\u53d1\u65b0\u4eba\u8bef\u4f1a\u4ee3\u7801\u4e2d\u5305\u542b\u65e0\u7528\u7684\u672a\u4f7f\u7528\u53c2\u6570\u3002</p> <p>\u8bf4\u660e</p> <p>\u672c\u4f8b\u4e2d\uff0c\u4f7f\u7528\u7684\u662f\u81ea\u5b9a\u4e49\u54cd\u5e94\u5934 <code>X-Key</code> \u548c <code>X-Token</code>\u3002</p> <p>\u4f46\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0c\u5c24\u5176\u662f\u5728\u5b9e\u73b0\u5b89\u5168\u63aa\u65bd\u65f6\uff0c\u6700\u597d\u4f7f\u7528 FastAPI \u5185\u7f6e\u7684\u5b89\u5168\u5de5\u5177\uff08\u8be6\u89c1\u4e0b\u4e00\u7ae0\uff09\u3002</p>"},{"location":"tutorial/dependencies/dependencies-in-path-operation-decorators/#_2","title":"\u4f9d\u8d56\u9879\u9519\u8bef\u548c\u8fd4\u56de\u503c","text":"<p>\u8def\u5f84\u88c5\u9970\u5668\u4f9d\u8d56\u9879\u4e5f\u53ef\u4ee5\u4f7f\u7528\u666e\u901a\u7684\u4f9d\u8d56\u9879\u51fd\u6570\u3002</p>"},{"location":"tutorial/dependencies/dependencies-in-path-operation-decorators/#_3","title":"\u4f9d\u8d56\u9879\u7684\u9700\u6c42\u9879","text":"<p>\u8def\u5f84\u88c5\u9970\u5668\u4f9d\u8d56\u9879\u53ef\u4ee5\u58f0\u660e\u8bf7\u6c42\u7684\u9700\u6c42\u9879\uff08\u6bd4\u5982\u54cd\u5e94\u5934\uff09\u6216\u5176\u4ed6\u5b50\u4f9d\u8d56\u9879\uff1a</p> <pre><code>from fastapi import Depends, FastAPI, Header, HTTPException\n\napp = FastAPI()\n\n\nasync def verify_token(x_token: str = Header()):\nif x_token != \"fake-super-secret-token\":\n        raise HTTPException(status_code=400, detail=\"X-Token header invalid\")\n\n\nasync def verify_key(x_key: str = Header()):\nif x_key != \"fake-super-secret-key\":\n        raise HTTPException(status_code=400, detail=\"X-Key header invalid\")\n    return x_key\n\n\n@app.get(\"/items/\", dependencies=[Depends(verify_token), Depends(verify_key)])\nasync def read_items():\n    return [{\"item\": \"Foo\"}, {\"item\": \"Bar\"}]\n</code></pre>"},{"location":"tutorial/dependencies/dependencies-in-path-operation-decorators/#_4","title":"\u89e6\u53d1\u5f02\u5e38","text":"<p>\u8def\u5f84\u88c5\u9970\u5668\u4f9d\u8d56\u9879\u4e0e\u6b63\u5e38\u7684\u4f9d\u8d56\u9879\u4e00\u6837\uff0c\u53ef\u4ee5 <code>raise</code> \u5f02\u5e38\uff1a</p> <pre><code>from fastapi import Depends, FastAPI, Header, HTTPException\n\napp = FastAPI()\n\n\nasync def verify_token(x_token: str = Header()):\n    if x_token != \"fake-super-secret-token\":\nraise HTTPException(status_code=400, detail=\"X-Token header invalid\")\nasync def verify_key(x_key: str = Header()):\n    if x_key != \"fake-super-secret-key\":\nraise HTTPException(status_code=400, detail=\"X-Key header invalid\")\nreturn x_key\n\n\n@app.get(\"/items/\", dependencies=[Depends(verify_token), Depends(verify_key)])\nasync def read_items():\n    return [{\"item\": \"Foo\"}, {\"item\": \"Bar\"}]\n</code></pre>"},{"location":"tutorial/dependencies/dependencies-in-path-operation-decorators/#_5","title":"\u8fd4\u56de\u503c","text":"<p>\u65e0\u8bba\u8def\u5f84\u88c5\u9970\u5668\u4f9d\u8d56\u9879\u662f\u5426\u8fd4\u56de\u503c\uff0c\u8def\u5f84\u64cd\u4f5c\u90fd\u4e0d\u4f1a\u4f7f\u7528\u8fd9\u4e9b\u503c\u3002</p> <p>\u56e0\u6b64\uff0c\u53ef\u4ee5\u590d\u7528\u5728\u5176\u4ed6\u4f4d\u7f6e\u4f7f\u7528\u8fc7\u7684\u3001\uff08\u80fd\u8fd4\u56de\u503c\u7684\uff09\u666e\u901a\u4f9d\u8d56\u9879\uff0c\u5373\u4f7f\u6ca1\u6709\u4f7f\u7528\u8fd9\u4e2a\u503c\uff0c\u4e5f\u4f1a\u6267\u884c\u8be5\u4f9d\u8d56\u9879\uff1a</p> <pre><code>from fastapi import Depends, FastAPI, Header, HTTPException\n\napp = FastAPI()\n\n\nasync def verify_token(x_token: str = Header()):\n    if x_token != \"fake-super-secret-token\":\n        raise HTTPException(status_code=400, detail=\"X-Token header invalid\")\nasync def verify_key(x_key: str = Header()):\n    if x_key != \"fake-super-secret-key\":\n        raise HTTPException(status_code=400, detail=\"X-Key header invalid\")\nreturn x_key\n@app.get(\"/items/\", dependencies=[Depends(verify_token), Depends(verify_key)])\nasync def read_items():\n    return [{\"item\": \"Foo\"}, {\"item\": \"Bar\"}]\n</code></pre>"},{"location":"tutorial/dependencies/dependencies-in-path-operation-decorators/#_6","title":"\u4e3a\u4e00\u7ec4\u8def\u5f84\u64cd\u4f5c\u5b9a\u4e49\u4f9d\u8d56\u9879","text":"<p>\u7a0d\u540e\uff0c\u5927\u578b\u5e94\u7528 - \u591a\u6587\u4ef6\u4e00\u7ae0\u4e2d\u4f1a\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528\u591a\u4e2a\u6587\u4ef6\u521b\u5efa\u5927\u578b\u5e94\u7528\u7a0b\u5e8f\uff0c\u5728\u8fd9\u4e00\u7ae0\u4e2d\uff0c\u60a8\u5c06\u4e86\u89e3\u5230\u5982\u4f55\u4e3a\u4e00\u7ec4\u8def\u5f84\u64cd\u4f5c\u58f0\u660e\u5355\u4e2a <code>dependencies</code> \u53c2\u6570\u3002</p>"},{"location":"tutorial/dependencies/dependencies-in-path-operation-decorators/#_7","title":"\u5168\u5c40\u4f9d\u8d56\u9879","text":"<p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c06\u5b66\u4e60\u5982\u4f55\u4e3a <code>FastAPI</code> \u5e94\u7528\u7a0b\u5e8f\u6dfb\u52a0\u5168\u5c40\u4f9d\u8d56\u9879\uff0c\u521b\u5efa\u5e94\u7528\u4e8e\u6bcf\u4e2a\u8def\u5f84\u64cd\u4f5c\u7684\u4f9d\u8d56\u9879\u3002</p>"},{"location":"tutorial/dependencies/global-dependencies/","title":"\u5168\u5c40\u4f9d\u8d56\u9879","text":"<p>\u6709\u65f6\uff0c\u6211\u4eec\u8981\u4e3a\u6574\u4e2a\u5e94\u7528\u6dfb\u52a0\u4f9d\u8d56\u9879\u3002</p> <p>\u901a\u8fc7\u4e0e\u5b9a\u4e49\u8def\u5f84\u88c5\u9970\u5668\u4f9d\u8d56\u9879 \u7c7b\u4f3c\u7684\u65b9\u5f0f\uff0c\u53ef\u4ee5\u628a\u4f9d\u8d56\u9879\u6dfb\u52a0\u81f3\u6574\u4e2a <code>FastAPI</code> \u5e94\u7528\u3002</p> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u5c31\u53ef\u4ee5\u4e3a\u6240\u6709\u8def\u5f84\u64cd\u4f5c\u5e94\u7528\u8be5\u4f9d\u8d56\u9879\uff1a</p> <pre><code>from fastapi import Depends, FastAPI, Header, HTTPException\n\n\nasync def verify_token(x_token: str = Header()):\n    if x_token != \"fake-super-secret-token\":\n        raise HTTPException(status_code=400, detail=\"X-Token header invalid\")\n\n\nasync def verify_key(x_key: str = Header()):\n    if x_key != \"fake-super-secret-key\":\n        raise HTTPException(status_code=400, detail=\"X-Key header invalid\")\n    return x_key\n\n\napp = FastAPI(dependencies=[Depends(verify_token), Depends(verify_key)])\n@app.get(\"/items/\")\nasync def read_items():\n    return [{\"item\": \"Portal Gun\"}, {\"item\": \"Plumbus\"}]\n\n\n@app.get(\"/users/\")\nasync def read_users():\n    return [{\"username\": \"Rick\"}, {\"username\": \"Morty\"}]\n</code></pre> <p>\u8def\u5f84\u88c5\u9970\u5668\u4f9d\u8d56\u9879 \u4e00\u7ae0\u7684\u601d\u8def\u5747\u9002\u7528\u4e8e\u5168\u5c40\u4f9d\u8d56\u9879\uff0c \u5728\u672c\u4f8b\u4e2d\uff0c\u8fd9\u4e9b\u4f9d\u8d56\u9879\u53ef\u4ee5\u7528\u4e8e\u5e94\u7528\u4e2d\u7684\u6240\u6709\u8def\u5f84\u64cd\u4f5c\u3002</p>"},{"location":"tutorial/dependencies/global-dependencies/#_2","title":"\u4e3a\u4e00\u7ec4\u8def\u5f84\u64cd\u4f5c\u5b9a\u4e49\u4f9d\u8d56\u9879","text":"<p>\u7a0d\u540e\uff0c\u5927\u578b\u5e94\u7528 - \u591a\u6587\u4ef6\u4e00\u7ae0\u4e2d\u4f1a\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528\u591a\u4e2a\u6587\u4ef6\u521b\u5efa\u5927\u578b\u5e94\u7528\u7a0b\u5e8f\uff0c\u5728\u8fd9\u4e00\u7ae0\u4e2d\uff0c\u60a8\u5c06\u4e86\u89e3\u5230\u5982\u4f55\u4e3a\u4e00\u7ec4\u8def\u5f84\u64cd\u4f5c\u58f0\u660e\u5355\u4e2a <code>dependencies</code> \u53c2\u6570\u3002</p>"},{"location":"tutorial/dependencies/sub-dependencies/","title":"\u5b50\u4f9d\u8d56\u9879","text":"<p>FastAPI \u652f\u6301\u521b\u5efa\u542b\u5b50\u4f9d\u8d56\u9879\u7684\u4f9d\u8d56\u9879\u3002</p> <p>\u5e76\u4e14\uff0c\u53ef\u4ee5\u6309\u9700\u58f0\u660e\u4efb\u610f\u6df1\u5ea6\u7684\u5b50\u4f9d\u8d56\u9879\u5d4c\u5957\u5c42\u7ea7\u3002</p> <p>FastAPI \u8d1f\u8d23\u5904\u7406\u89e3\u6790\u4e0d\u540c\u6df1\u5ea6\u7684\u5b50\u4f9d\u8d56\u9879\u3002</p>"},{"location":"tutorial/dependencies/sub-dependencies/#_2","title":"\u7b2c\u4e00\u5c42\u4f9d\u8d56\u9879","text":"<p>\u4e0b\u5217\u4ee3\u7801\u521b\u5efa\u4e86\u7b2c\u4e00\u5c42\u4f9d\u8d56\u9879\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import Cookie, Depends, FastAPI\n\napp = FastAPI()\n\n\ndef query_extractor(q: Union[str, None] = None):\nreturn q\ndef query_or_cookie_extractor(\n    q: str = Depends(query_extractor),\n    last_query: Union[str, None] = Cookie(default=None),\n):\n    if not q:\n        return last_query\n    return q\n\n\n@app.get(\"/items/\")\nasync def read_query(query_or_default: str = Depends(query_or_cookie_extractor)):\n    return {\"q_or_cookie\": query_or_default}\n</code></pre> <p>\u8fd9\u6bb5\u4ee3\u7801\u58f0\u660e\u4e86\u7c7b\u578b\u4e3a <code>str</code> \u7684\u53ef\u9009\u67e5\u8be2\u53c2\u6570 <code>q</code>\uff0c\u7136\u540e\u8fd4\u56de\u8fd9\u4e2a\u67e5\u8be2\u53c2\u6570\u3002</p> <p>\u8fd9\u4e2a\u51fd\u6570\u5f88\u7b80\u5355\uff08\u4e0d\u8fc7\u4e5f\u6ca1\u4ec0\u4e48\u7528\uff09\uff0c\u4f46\u5374\u6709\u52a9\u4e8e\u8ba9\u6211\u4eec\u4e13\u6ce8\u4e8e\u4e86\u89e3\u5b50\u4f9d\u8d56\u9879\u7684\u5de5\u4f5c\u65b9\u5f0f\u3002</p>"},{"location":"tutorial/dependencies/sub-dependencies/#_3","title":"\u7b2c\u4e8c\u5c42\u4f9d\u8d56\u9879","text":"<p>\u63a5\u4e0b\u6765\uff0c\u521b\u5efa\u53e6\u4e00\u4e2a\u4f9d\u8d56\u9879\u51fd\u6570\uff0c\u5e76\u540c\u65f6\u7528\u8be5\u4f9d\u8d56\u9879\u81ea\u8eab\u518d\u58f0\u660e\u4e00\u4e2a\u4f9d\u8d56\u9879\uff08\u6240\u4ee5\u8fd9\u4e5f\u662f\u4e00\u4e2a\u300c\u4f9d\u8d56\u9879\u300d\uff09\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import Cookie, Depends, FastAPI\n\napp = FastAPI()\n\n\ndef query_extractor(q: Union[str, None] = None):\n    return q\n\n\ndef query_or_cookie_extractor(\nq: str = Depends(query_extractor),\nlast_query: Union[str, None] = Cookie(default=None),\n):\n    if not q:\n        return last_query\n    return q\n\n\n@app.get(\"/items/\")\nasync def read_query(query_or_default: str = Depends(query_or_cookie_extractor)):\n    return {\"q_or_cookie\": query_or_default}\n</code></pre> <p>\u8fd9\u91cc\u91cd\u70b9\u8bf4\u660e\u4e00\u4e0b\u58f0\u660e\u7684\u53c2\u6570\uff1a</p> <ul> <li>\u5c3d\u7ba1\u8be5\u51fd\u6570\u81ea\u8eab\u662f\u4f9d\u8d56\u9879\uff0c\u4f46\u8fd8\u58f0\u660e\u4e86\u53e6\u4e00\u4e2a\u4f9d\u8d56\u9879\uff08\u5b83\u300c\u4f9d\u8d56\u300d\u4e8e\u5176\u4ed6\u5bf9\u8c61\uff09<ul> <li>\u8be5\u51fd\u6570\u4f9d\u8d56 <code>query_extractor</code>, \u5e76\u628a <code>query_extractor</code> \u7684\u8fd4\u56de\u503c\u8d4b\u7ed9\u53c2\u6570 <code>q</code></li> </ul> </li> <li>\u540c\u65f6\uff0c\u8be5\u51fd\u6570\u8fd8\u58f0\u660e\u4e86\u7c7b\u578b\u662f <code>str</code> \u7684\u53ef\u9009 cookie\uff08<code>last_query</code>\uff09<ul> <li>\u7528\u6237\u672a\u63d0\u4f9b\u67e5\u8be2\u53c2\u6570 <code>q</code> \u65f6\uff0c\u5219\u4f7f\u7528\u4e0a\u6b21\u4f7f\u7528\u540e\u4fdd\u5b58\u5728 cookie \u4e2d\u7684\u67e5\u8be2</li> </ul> </li> </ul>"},{"location":"tutorial/dependencies/sub-dependencies/#_4","title":"\u4f7f\u7528\u4f9d\u8d56\u9879","text":"<p>\u63a5\u4e0b\u6765\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u4f9d\u8d56\u9879\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import Cookie, Depends, FastAPI\n\napp = FastAPI()\n\n\ndef query_extractor(q: Union[str, None] = None):\n    return q\n\n\ndef query_or_cookie_extractor(\n    q: str = Depends(query_extractor),\n    last_query: Union[str, None] = Cookie(default=None),\n):\n    if not q:\n        return last_query\n    return q\n\n\n@app.get(\"/items/\")\nasync def read_query(query_or_default: str = Depends(query_or_cookie_extractor)):\nreturn {\"q_or_cookie\": query_or_default}\n</code></pre> <p>\u4fe1\u606f</p> <p>\u6ce8\u610f\uff0c\u8fd9\u91cc\u5728\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u4e2d\u53ea\u58f0\u660e\u4e86\u4e00\u4e2a\u4f9d\u8d56\u9879\uff0c\u5373 <code>query_or_cookie_extractor</code> \u3002</p> <p>\u4f46 FastAPI \u5fc5\u987b\u5148\u5904\u7406 <code>query_extractor</code>\uff0c\u4ee5\u4fbf\u5728\u8c03\u7528 <code>query_or_cookie_extractor</code> \u65f6\u4f7f\u7528 <code>query_extractor</code> \u8fd4\u56de\u7684\u7ed3\u679c\u3002</p> <pre><code>graph TB\n\nquery_extractor([\"query_extractor\"])\nquery_or_cookie_extractor([\"query_or_cookie_extractor\"])\n\nread_query[\"/items/\"]\n\nquery_extractor --&gt; query_or_cookie_extractor --&gt; read_query</code></pre>"},{"location":"tutorial/dependencies/sub-dependencies/#_5","title":"\u591a\u6b21\u4f7f\u7528\u540c\u4e00\u4e2a\u4f9d\u8d56\u9879","text":"<p>\u5982\u679c\u5728\u540c\u4e00\u4e2a\u8def\u5f84\u64cd\u4f5c \u591a\u6b21\u58f0\u660e\u4e86\u540c\u4e00\u4e2a\u4f9d\u8d56\u9879\uff0c\u4f8b\u5982\uff0c\u591a\u4e2a\u4f9d\u8d56\u9879\u5171\u7528\u4e00\u4e2a\u5b50\u4f9d\u8d56\u9879\uff0cFastAPI \u5728\u5904\u7406\u540c\u4e00\u8bf7\u6c42\u65f6\uff0c\u53ea\u8c03\u7528\u4e00\u6b21\u8be5\u5b50\u4f9d\u8d56\u9879\u3002</p> <p>FastAPI \u4e0d\u4f1a\u4e3a\u540c\u4e00\u4e2a\u8bf7\u6c42\u591a\u6b21\u8c03\u7528\u540c\u4e00\u4e2a\u4f9d\u8d56\u9879\uff0c\u800c\u662f\u628a\u4f9d\u8d56\u9879\u7684\u8fd4\u56de\u503c\u8fdb\u884c\u300c\u7f13\u5b58\u300d\uff0c\u5e76\u628a\u5b83\u4f20\u9012\u7ed9\u540c\u4e00\u8bf7\u6c42\u4e2d\u6240\u6709\u9700\u8981\u4f7f\u7528\u8be5\u8fd4\u56de\u503c\u7684\u300c\u4f9d\u8d56\u9879\u300d\u3002</p> <p>\u5728\u9ad8\u7ea7\u4f7f\u7528\u573a\u666f\u4e2d\uff0c\u5982\u679c\u4e0d\u60f3\u4f7f\u7528\u300c\u7f13\u5b58\u300d\u503c\uff0c\u800c\u662f\u4e3a\u9700\u8981\u5728\u540c\u4e00\u8bf7\u6c42\u7684\u6bcf\u4e00\u6b65\u64cd\u4f5c\uff08\u591a\u6b21\uff09\u4e2d\u90fd\u5b9e\u9645\u8c03\u7528\u4f9d\u8d56\u9879\uff0c\u53ef\u4ee5\u628a <code>Depends</code> \u7684\u53c2\u6570 <code>use_cache</code> \u7684\u503c\u8bbe\u7f6e\u4e3a <code>False</code> :</p> <pre><code>async def needy_dependency(fresh_value: str = Depends(get_value, use_cache=False)):\nreturn {\"fresh_value\": fresh_value}\n</code></pre>"},{"location":"tutorial/dependencies/sub-dependencies/#_6","title":"\u5c0f\u7ed3","text":"<p>\u5343\u4e07\u522b\u88ab\u672c\u7ae0\u91cc\u8fd9\u4e9b\u82b1\u91cc\u80e1\u54e8\u7684\u8bcd\u85fb\u5413\u5012\u4e86\uff0c\u5176\u5b9e\u4f9d\u8d56\u6ce8\u5165\u7cfb\u7edf\u975e\u5e38\u7b80\u5355\u3002</p> <p>\u4f9d\u8d56\u6ce8\u5165\u65e0\u975e\u662f\u4e0e\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u4e00\u6837\u7684\u51fd\u6570\u7f62\u4e86\u3002</p> <p>\u4f46\u5b83\u4f9d\u7136\u975e\u5e38\u5f3a\u5927\uff0c\u80fd\u591f\u58f0\u660e\u4efb\u610f\u5d4c\u5957\u6df1\u5ea6\u7684\u300c\u56fe\u300d\u6216\u6811\u72b6\u7684\u4f9d\u8d56\u7ed3\u6784\u3002</p> <p>\u63d0\u793a</p> <p>\u8fd9\u4e9b\u7b80\u5355\u7684\u4f8b\u5b50\u73b0\u5728\u770b\u4e0a\u53bb\u867d\u7136\u6ca1\u6709\u4ec0\u4e48\u5b9e\u7528\u4ef7\u503c\uff0c</p> <p>\u4f46\u5728\u5b89\u5168\u4e00\u7ae0\u4e2d\uff0c\u60a8\u4f1a\u4e86\u89e3\u5230\u8fd9\u4e9b\u4f8b\u5b50\u7684\u7528\u9014\uff0c</p> <p>\u4ee5\u53ca\u8fd9\u4e9b\u4f8b\u5b50\u6240\u80fd\u8282\u7701\u7684\u4ee3\u7801\u91cf\u3002</p>"},{"location":"tutorial/security/","title":"\u5b89\u5168\u6027\u7b80\u4ecb","text":"<p>\u6709\u8bb8\u591a\u65b9\u6cd5\u53ef\u4ee5\u5904\u7406\u5b89\u5168\u6027\u3001\u8eab\u4efd\u8ba4\u8bc1\u548c\u6388\u6743\u7b49\u95ee\u9898\u3002</p> <p>\u800c\u4e14\u8fd9\u901a\u5e38\u662f\u4e00\u4e2a\u590d\u6742\u800c\u300c\u56f0\u96be\u300d\u7684\u8bdd\u9898\u3002</p> <p>\u5728\u8bb8\u591a\u6846\u67b6\u548c\u7cfb\u7edf\u4e2d\uff0c\u4ec5\u5904\u7406\u5b89\u5168\u6027\u548c\u8eab\u4efd\u8ba4\u8bc1\u5c31\u4f1a\u82b1\u8d39\u5927\u91cf\u7684\u7cbe\u529b\u548c\u4ee3\u7801\uff08\u5728\u8bb8\u591a\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u5360\u7f16\u5199\u7684\u6240\u6709\u4ee3\u7801\u7684 50\uff05 \u6216\u66f4\u591a\uff09\u3002</p> <p>FastAPI \u63d0\u4f9b\u4e86\u591a\u79cd\u5de5\u5177\uff0c\u53ef\u5e2e\u52a9\u4f60\u4ee5\u6807\u51c6\u7684\u65b9\u5f0f\u8f7b\u677e\u3001\u5feb\u901f\u5730\u5904\u7406\u5b89\u5168\u6027\uff0c\u800c\u65e0\u9700\u7814\u7a76\u548c\u5b66\u4e60\u6240\u6709\u7684\u5b89\u5168\u89c4\u8303\u3002</p> <p>\u4f46\u9996\u5148\uff0c\u8ba9\u6211\u4eec\u6765\u770b\u4e00\u4e9b\u5c0f\u7684\u6982\u5ff5\u3002</p>"},{"location":"tutorial/security/#_2","title":"\u6ca1\u6709\u65f6\u95f4\uff1f","text":"<p>\u5982\u679c\u4f60\u4e0d\u5173\u5fc3\u8fd9\u4e9b\u672f\u8bed\uff0c\u800c\u53ea\u9700\u8981\u7acb\u5373\u901a\u8fc7\u57fa\u4e8e\u7528\u6237\u540d\u548c\u5bc6\u7801\u7684\u8eab\u4efd\u8ba4\u8bc1\u6765\u589e\u52a0\u5b89\u5168\u6027\uff0c\u8bf7\u8df3\u8f6c\u5230\u4e0b\u4e00\u7ae0\u3002</p>"},{"location":"tutorial/security/#oauth2","title":"OAuth2","text":"<p>OAuth2\u662f\u4e00\u4e2a\u89c4\u8303\uff0c\u5b83\u5b9a\u4e49\u4e86\u51e0\u79cd\u5904\u7406\u8eab\u4efd\u8ba4\u8bc1\u548c\u6388\u6743\u7684\u65b9\u6cd5\u3002</p> <p>\u5b83\u662f\u4e00\u4e2a\u76f8\u5f53\u5e7f\u6cdb\u7684\u89c4\u8303\uff0c\u6db5\u76d6\u4e86\u4e00\u4e9b\u590d\u6742\u7684\u4f7f\u7528\u573a\u666f\u3002</p> <p>\u5b83\u5305\u62ec\u4e86\u4f7f\u7528\u300c\u7b2c\u4e09\u65b9\u300d\u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\u7684\u65b9\u6cd5\u3002</p> <p>\u8fd9\u5c31\u662f\u6240\u6709\u5e26\u6709\u300c\u4f7f\u7528 Facebook\uff0cGoogle\uff0cTwitter\uff0cGitHub \u767b\u5f55\u300d\u7684\u7cfb\u7edf\u80cc\u540e\u6240\u4f7f\u7528\u7684\u673a\u5236\u3002</p>"},{"location":"tutorial/security/#oauth-1","title":"OAuth 1","text":"<p>\u6709\u4e00\u4e2a OAuth 1\uff0c\u5b83\u4e0e OAuth2 \u5b8c\u5168\u4e0d\u540c\uff0c\u5e76\u4e14\u66f4\u4e3a\u590d\u6742\uff0c\u56e0\u4e3a\u5b83\u76f4\u63a5\u5305\u542b\u4e86\u6709\u5173\u5982\u4f55\u52a0\u5bc6\u901a\u4fe1\u7684\u89c4\u8303\u3002</p> <p>\u5982\u4eca\u5b83\u5df2\u7ecf\u4e0d\u662f\u5f88\u6d41\u884c\uff0c\u6ca1\u6709\u88ab\u5e7f\u6cdb\u4f7f\u7528\u4e86\u3002</p> <p>OAuth2 \u6ca1\u6709\u6307\u5b9a\u5982\u4f55\u52a0\u5bc6\u901a\u4fe1\uff0c\u5b83\u671f\u671b\u4f60\u4e3a\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528 HTTPS \u8fdb\u884c\u901a\u4fe1\u3002</p> <p>Tip</p> <p>\u5728\u6709\u5173\u90e8\u7f72\u7684\u7ae0\u8282\u4e2d\uff0c\u4f60\u5c06\u4e86\u89e3\u5982\u4f55\u4f7f\u7528 Traefik \u548c Let's Encrypt \u514d\u8d39\u8bbe\u7f6e HTTPS\u3002</p>"},{"location":"tutorial/security/#openid-connect","title":"OpenID Connect","text":"<p>OpenID Connect \u662f\u53e6\u4e00\u4e2a\u57fa\u4e8e OAuth2 \u7684\u89c4\u8303\u3002</p> <p>\u5b83\u53ea\u662f\u6269\u5c55\u4e86 OAuth2\uff0c\u5e76\u660e\u786e\u4e86\u4e00\u4e9b\u5728 OAuth2 \u4e2d\u76f8\u5bf9\u6a21\u7cca\u7684\u5185\u5bb9\uff0c\u4ee5\u5c1d\u8bd5\u4f7f\u5176\u66f4\u5177\u4e92\u64cd\u4f5c\u6027\u3002</p> <p>\u4f8b\u5982\uff0cGoogle \u767b\u5f55\u4f7f\u7528 OpenID Connect\uff08\u5e95\u5c42\u4f7f\u7528OAuth2\uff09\u3002</p> <p>\u4f46\u662f Facebook \u767b\u5f55\u4e0d\u652f\u6301 OpenID Connect\u3002\u5b83\u5177\u6709\u81ea\u5df1\u7684 OAuth2 \u98ce\u683c\u3002</p>"},{"location":"tutorial/security/#openidopenid-connect","title":"OpenID\uff08\u975e\u300cOpenID Connect\u300d\uff09","text":"<p>\u8fd8\u6709\u4e00\u4e2a\u300cOpenID\u300d\u89c4\u8303\u3002\u5b83\u8bd5\u56fe\u89e3\u51b3\u4e0e OpenID Connect \u76f8\u540c\u7684\u95ee\u9898\uff0c\u4f46\u5b83\u4e0d\u662f\u57fa\u4e8e OAuth2\u3002</p> <p>\u56e0\u6b64\uff0c\u5b83\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u9644\u52a0\u7cfb\u7edf\u3002</p> <p>\u5982\u4eca\u5b83\u5df2\u7ecf\u4e0d\u662f\u5f88\u6d41\u884c\uff0c\u6ca1\u6709\u88ab\u5e7f\u6cdb\u4f7f\u7528\u4e86\u3002</p>"},{"location":"tutorial/security/#openapi","title":"OpenAPI","text":"<p>OpenAPI\uff08\u4ee5\u524d\u79f0\u4e3a Swagger\uff09\u662f\u7528\u4e8e\u6784\u5efa API \u7684\u5f00\u653e\u89c4\u8303\uff08\u73b0\u5df2\u6210\u4e3a Linux Foundation \u7684\u4e00\u90e8\u5206\uff09\u3002</p> <p>FastAPI \u57fa\u4e8e OpenAPI\u3002</p> <p>\u8fd9\u5c31\u662f\u4f7f\u591a\u4e2a\u81ea\u52a8\u4ea4\u4e92\u5f0f\u6587\u6863\u754c\u9762\uff0c\u4ee3\u7801\u751f\u6210\u7b49\u6210\u4e3a\u53ef\u80fd\u7684\u539f\u56e0\u3002</p> <p>OpenAPI \u6709\u4e00\u79cd\u5b9a\u4e49\u591a\u4e2a\u5b89\u5168\u300c\u65b9\u6848\u300d\u7684\u65b9\u6cd5\u3002</p> <p>\u901a\u8fc7\u4f7f\u7528\u5b83\u4eec\uff0c\u4f60\u53ef\u4ee5\u5229\u7528\u6240\u6709\u8fd9\u4e9b\u57fa\u4e8e\u6807\u51c6\u7684\u5de5\u5177\uff0c\u5305\u62ec\u8fd9\u4e9b\u4ea4\u4e92\u5f0f\u6587\u6863\u7cfb\u7edf\u3002</p> <p>OpenAPI \u5b9a\u4e49\u4e86\u4ee5\u4e0b\u5b89\u5168\u65b9\u6848\uff1a</p> <ul> <li><code>apiKey</code>\uff1a\u4e00\u4e2a\u7279\u5b9a\u4e8e\u5e94\u7528\u7a0b\u5e8f\u7684\u5bc6\u94a5\uff0c\u53ef\u4ee5\u6765\u81ea\uff1a<ul> <li>\u67e5\u8be2\u53c2\u6570\u3002</li> <li>\u8bf7\u6c42\u5934\u3002</li> <li>cookie\u3002</li> </ul> </li> <li><code>http</code>\uff1a\u6807\u51c6\u7684 HTTP \u8eab\u4efd\u8ba4\u8bc1\u7cfb\u7edf\uff0c\u5305\u62ec\uff1a<ul> <li><code>bearer</code>: \u4e00\u4e2a\u503c\u4e3a <code>Bearer</code> \u52a0\u4ee4\u724c\u5b57\u7b26\u4e32\u7684 <code>Authorization</code> \u8bf7\u6c42\u5934\u3002\u8fd9\u662f\u4ece OAuth2 \u7ee7\u627f\u7684\u3002</li> <li>HTTP Basic \u8ba4\u8bc1\u65b9\u5f0f\u3002</li> <li>HTTP Digest\uff0c\u7b49\u7b49\u3002</li> </ul> </li> <li><code>oauth2</code>\uff1a\u6240\u6709\u7684 OAuth2 \u5904\u7406\u5b89\u5168\u6027\u7684\u65b9\u5f0f\uff08\u79f0\u4e3a\u300c\u6d41\u7a0b\u300d\uff09\u3002     *\u4ee5\u4e0b\u51e0\u79cd\u6d41\u7a0b\u9002\u5408\u6784\u5efa OAuth 2.0 \u8eab\u4efd\u8ba4\u8bc1\u7684\u63d0\u4f9b\u8005\uff08\u4f8b\u5982 Google\uff0cFacebook\uff0cTwitter\uff0cGitHub \u7b49\uff09\uff1a         * <code>implicit</code>         * <code>clientCredentials</code>         * <code>authorizationCode</code><ul> <li>\u4f46\u662f\u6709\u4e00\u4e2a\u7279\u5b9a\u7684\u300c\u6d41\u7a0b\u300d\u53ef\u4ee5\u5b8c\u7f8e\u5730\u7528\u4e8e\u76f4\u63a5\u5728\u540c\u4e00\u5e94\u7528\u7a0b\u5e8f\u4e2d\u5904\u7406\u8eab\u4efd\u8ba4\u8bc1\uff1a<ul> <li><code>password</code>\uff1a\u63a5\u4e0b\u6765\u7684\u51e0\u7ae0\u5c06\u4ecb\u7ecd\u5b83\u7684\u793a\u4f8b\u3002</li> </ul> </li> </ul> </li> <li><code>openIdConnect</code>\uff1a\u63d0\u4f9b\u4e86\u4e00\u79cd\u5b9a\u4e49\u5982\u4f55\u81ea\u52a8\u53d1\u73b0 OAuth2 \u8eab\u4efd\u8ba4\u8bc1\u6570\u636e\u7684\u65b9\u6cd5\u3002<ul> <li>\u6b64\u81ea\u52a8\u53d1\u73b0\u673a\u5236\u662f OpenID Connect \u89c4\u8303\u4e2d\u5b9a\u4e49\u7684\u5185\u5bb9\u3002</li> </ul> </li> </ul> <p>Tip</p> <p>\u96c6\u6210\u5176\u4ed6\u8eab\u4efd\u8ba4\u8bc1/\u6388\u6743\u63d0\u4f9b\u8005\uff08\u4f8b\u5982Google\uff0cFacebook\uff0cTwitter\uff0cGitHub\u7b49\uff09\u4e5f\u662f\u53ef\u80fd\u7684\uff0c\u800c\u4e14\u8f83\u4e3a\u5bb9\u6613\u3002</p> <p>\u6700\u590d\u6742\u7684\u95ee\u9898\u662f\u521b\u5efa\u4e00\u4e2a\u50cf\u8fd9\u6837\u7684\u8eab\u4efd\u8ba4\u8bc1/\u6388\u6743\u63d0\u4f9b\u7a0b\u5e8f\uff0c\u4f46\u662f FastAPI \u4e3a\u4f60\u63d0\u4f9b\u4e86\u8f7b\u677e\u5b8c\u6210\u4efb\u52a1\u7684\u5de5\u5177\uff0c\u540c\u65f6\u4e3a\u4f60\u89e3\u51b3\u4e86\u91cd\u6d3b\u3002</p>"},{"location":"tutorial/security/#fastapi","title":"FastAPI \u5b9e\u7528\u5de5\u5177","text":"<p>FastAPI \u5728 <code>fastapi.security</code> \u6a21\u5757\u4e2d\u4e3a\u6bcf\u4e2a\u5b89\u5168\u65b9\u6848\u63d0\u4f9b\u4e86\u51e0\u79cd\u5de5\u5177\uff0c\u8fd9\u4e9b\u5de5\u5177\u7b80\u5316\u4e86\u8fd9\u4e9b\u5b89\u5168\u673a\u5236\u7684\u4f7f\u7528\u65b9\u6cd5\u3002</p> <p>\u5728\u4e0b\u4e00\u7ae0\u4e2d\uff0c\u4f60\u5c06\u770b\u5230\u5982\u4f55\u4f7f\u7528 FastAPI \u6240\u63d0\u4f9b\u7684\u8fd9\u4e9b\u5de5\u5177\u4e3a\u4f60\u7684 API \u589e\u52a0\u5b89\u5168\u6027\u3002</p> <p>\u800c\u4e14\u4f60\u8fd8\u5c06\u770b\u5230\u5b83\u5982\u4f55\u81ea\u52a8\u5730\u88ab\u96c6\u6210\u5230\u4ea4\u4e92\u5f0f\u6587\u6863\u7cfb\u7edf\u4e2d\u3002</p>"},{"location":"tutorial/security/first-steps/","title":"\u5b89\u5168 - \u7b2c\u4e00\u6b65","text":"<p>\u5047\u8bbe\u540e\u7aef API \u5728\u67d0\u4e2a\u57df\u3002</p> <p>\u524d\u7aef\u5728\u53e6\u4e00\u4e2a\u57df\uff0c\u6216\uff08\u79fb\u52a8\u5e94\u7528\u4e2d\uff09\u5728\u540c\u4e00\u4e2a\u57df\u7684\u4e0d\u540c\u8def\u5f84\u4e0b\u3002</p> <p>\u5e76\u4e14\uff0c\u524d\u7aef\u8981\u4f7f\u7528\u540e\u7aef\u7684 username \u4e0e password \u9a8c\u8bc1\u7528\u6237\u8eab\u4efd\u3002</p> <p>\u56fa\u7136\uff0cFastAPI \u652f\u6301 OAuth2 \u8eab\u4efd\u9a8c\u8bc1\u3002</p> <p>\u4f46\u4e3a\u4e86\u8282\u7701\u5f00\u53d1\u8005\u7684\u65f6\u95f4\uff0c\u4e0d\u8981\u53ea\u4e3a\u4e86\u67e5\u627e\u5f88\u5c11\u7684\u5185\u5bb9\uff0c\u4e0d\u5f97\u4e0d\u9605\u8bfb\u5197\u957f\u7684\u89c4\u8303\u6587\u6863\u3002</p> <p>\u6211\u4eec\u5efa\u8bae\u4f7f\u7528 FastAPI \u7684\u5b89\u5168\u5de5\u5177\u3002</p>"},{"location":"tutorial/security/first-steps/#_1","title":"\u6982\u89c8","text":"<p>\u9996\u5148\uff0c\u770b\u770b\u4e0b\u9762\u7684\u4ee3\u7801\u662f\u600e\u4e48\u8fd0\u884c\u7684\uff0c\u7136\u540e\u518d\u56de\u8fc7\u5934\u6765\u4e86\u89e3\u5176\u80cc\u540e\u7684\u539f\u7406\u3002</p>"},{"location":"tutorial/security/first-steps/#mainpy","title":"\u521b\u5efa <code>main.py</code>","text":"<p>\u628a\u4e0b\u9762\u7684\u793a\u4f8b\u4ee3\u7801\u590d\u5236\u5230 <code>main.py</code>\uff1a</p> <pre><code>from fastapi import Depends, FastAPI\nfrom fastapi.security import OAuth2PasswordBearer\n\napp = FastAPI()\n\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")\n\n\n@app.get(\"/items/\")\nasync def read_items(token: str = Depends(oauth2_scheme)):\n    return {\"token\": token}\n</code></pre>"},{"location":"tutorial/security/first-steps/#_2","title":"\u8fd0\u884c","text":"<p>\u8bf4\u660e</p> <p>\u5148\u5b89\u88c5 <code>python-multipart</code>\u3002</p> <p>\u5b89\u88c5\u547d\u4ee4\uff1a <code>pip install python-multipart</code>\u3002</p> <p>\u8fd9\u662f\u56e0\u4e3a OAuth2 \u4f7f\u7528\u8868\u5355\u6570\u636e\u53d1\u9001 <code>username</code> \u4e0e <code>password</code>\u3002</p> <p>\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u8fd0\u884c\u8be5\u793a\u4f8b\uff1a</p> <pre><code>$ uvicorn main:app --reload\n\n&lt;span style=\"color: green;\"&gt;INFO&lt;/span&gt;:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\n</code></pre>"},{"location":"tutorial/security/first-steps/#_3","title":"\u67e5\u770b\u6587\u6863","text":"<p>\u6253\u5f00 API \u6587\u6863\uff1a http://127.0.0.1:8000/docs\u3002</p> <p>\u754c\u9762\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>Authorize \u6309\u94ae\uff01</p> <p>\u9875\u9762\u53f3\u4e0a\u89d2\u51fa\u73b0\u4e86\u4e00\u4e2a\u300cAuthorize\u300d\u6309\u94ae\u3002</p> <p>\u8def\u5f84\u64cd\u4f5c\u7684\u53f3\u4e0a\u89d2\u4e5f\u51fa\u73b0\u4e86\u4e00\u4e2a\u53ef\u4ee5\u70b9\u51fb\u7684\u5c0f\u9501\u56fe\u6807\u3002</p> <p>\u70b9\u51fb Authorize \u6309\u94ae\uff0c\u5f39\u51fa\u6388\u6743\u8868\u5355\uff0c\u8f93\u5165 <code>username</code> \u4e0e <code>password</code> \u53ca\u5176\u5b83\u53ef\u9009\u5b57\u6bb5\uff1a</p> <p></p> <p>\u7b14\u8bb0</p> <p>\u76ee\u524d\uff0c\u5728\u8868\u5355\u4e2d\u8f93\u5165\u5185\u5bb9\u4e0d\u4f1a\u6709\u4efb\u4f55\u53cd\u5e94\uff0c\u540e\u6587\u4f1a\u4ecb\u7ecd\u76f8\u5173\u5185\u5bb9\u3002</p> <p>\u867d\u7136\u6b64\u6587\u6863\u4e0d\u662f\u7ed9\u524d\u7aef\u6700\u7ec8\u7528\u6237\u4f7f\u7528\u7684\uff0c\u4f46\u8fd9\u4e2a\u81ea\u52a8\u5de5\u5177\u975e\u5e38\u5b9e\u7528\uff0c\u53ef\u5728\u6587\u6863\u4e2d\u4e0e\u6240\u6709 API \u4ea4\u4e92\u3002</p> <p>\u524d\u7aef\u56e2\u961f\uff08\u53ef\u80fd\u5c31\u662f\u5f00\u53d1\u8005\u672c\u4eba\uff09\u53ef\u4ee5\u4f7f\u7528\u672c\u5de5\u5177\u3002</p> <p>\u7b2c\u4e09\u65b9\u5e94\u7528\u4e0e\u7cfb\u7edf\u4e5f\u53ef\u4ee5\u8c03\u7528\u672c\u5de5\u5177\u3002</p> <p>\u5f00\u53d1\u8005\u4e5f\u53ef\u4ee5\u7528\u5b83\u6765\u8c03\u8bd5\u3001\u68c0\u67e5\u3001\u6d4b\u8bd5\u5e94\u7528\u3002</p>"},{"location":"tutorial/security/first-steps/#_4","title":"\u5bc6\u7801\u6d41","text":"<p>\u73b0\u5728\uff0c\u6211\u4eec\u56de\u8fc7\u5934\u6765\u4ecb\u7ecd\u8fd9\u6bb5\u4ee3\u7801\u7684\u539f\u7406\u3002</p> <p><code>Password</code> \u6d41\u662f OAuth2 \u5b9a\u4e49\u7684\uff0c\u7528\u4e8e\u5904\u7406\u5b89\u5168\u4e0e\u8eab\u4efd\u9a8c\u8bc1\u7684\u65b9\u5f0f\uff08\u6d41\uff09\u3002</p> <p>OAuth2 \u7684\u8bbe\u8ba1\u76ee\u6807\u662f\u4e3a\u4e86\u8ba9\u540e\u7aef\u6216 API \u72ec\u7acb\u4e8e\u670d\u52a1\u5668\u9a8c\u8bc1\u7528\u6237\u8eab\u4efd\u3002</p> <p>\u4f46\u5728\u672c\u4f8b\u4e2d\uff0cFastAPI \u5e94\u7528\u4f1a\u5904\u7406 API \u4e0e\u8eab\u4efd\u9a8c\u8bc1\u3002</p> <p>\u4e0b\u9762\uff0c\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u7b80\u5316\u7684\u8fd0\u884c\u6d41\u7a0b\uff1a</p> <ul> <li>\u7528\u6237\u5728\u524d\u7aef\u8f93\u5165 <code>username</code> \u4e0e<code>password</code>\uff0c\u5e76\u70b9\u51fb\u56de\u8f66</li> <li>\uff08\u7528\u6237\u6d4f\u89c8\u5668\u4e2d\u8fd0\u884c\u7684\uff09\u524d\u7aef\u628a <code>username</code> \u4e0e<code>password</code> \u53d1\u9001\u81f3 API \u4e2d\u6307\u5b9a\u7684 URL\uff08\u4f7f\u7528 <code>tokenUrl=\"token\"</code> \u58f0\u660e\uff09</li> <li>API \u68c0\u67e5 <code>username</code> \u4e0e<code>password</code>\uff0c\u5e76\u7528\u4ee4\u724c\uff08<code>Token</code>\uff09 \u54cd\u5e94\uff08\u6682\u672a\u5b9e\u73b0\u6b64\u529f\u80fd\uff09\uff1a</li> <li>\u4ee4\u724c\u53ea\u662f\u7528\u4e8e\u9a8c\u8bc1\u7528\u6237\u7684\u5b57\u7b26\u4e32</li> <li>\u4e00\u822c\u6765\u8bf4\uff0c\u4ee4\u724c\u4f1a\u5728\u4e00\u6bb5\u65f6\u95f4\u540e\u8fc7\u671f<ul> <li>\u8fc7\u65f6\u540e\uff0c\u7528\u6237\u8981\u518d\u6b21\u767b\u5f55</li> <li>\u8fd9\u6837\u4e00\u6765\uff0c\u5c31\u7b97\u4ee4\u724c\u88ab\u4eba\u7a83\u53d6\uff0c\u98ce\u9669\u4e5f\u8f83\u4f4e\u3002\u56e0\u4e3a\u5b83\u4e0e\u6c38\u4e45\u5bc6\u94a5\u4e0d\u540c\uff0c\u5728\u7edd\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u4e0d\u4f1a\u957f\u671f\u6709\u6548</li> </ul> </li> <li>\u524d\u7aef\u4e34\u65f6\u5c06\u4ee4\u724c\u5b58\u50a8\u5728\u67d0\u4e2a\u4f4d\u7f6e</li> <li>\u7528\u6237\u70b9\u51fb\u524d\u7aef\uff0c\u524d\u5f80\u524d\u7aef\u5e94\u7528\u7684\u5176\u5b83\u90e8\u4ef6</li> <li>\u524d\u7aef\u9700\u8981\u4ece API \u4e2d\u63d0\u53d6\u66f4\u591a\u6570\u636e\uff1a<ul> <li>\u4e3a\u6307\u5b9a\u7684\u7aef\u70b9\uff08Endpoint\uff09\u8fdb\u884c\u8eab\u4efd\u9a8c\u8bc1</li> <li>\u56e0\u6b64\uff0c\u7528 API \u9a8c\u8bc1\u8eab\u4efd\u65f6\uff0c\u8981\u53d1\u9001\u503c\u4e3a <code>Bearer</code> + \u4ee4\u724c\u7684\u8bf7\u6c42\u5934 <code>Authorization</code></li> <li>\u5047\u5982\u4ee4\u724c\u4e3a <code>foobar</code>\uff0c<code>Authorization</code> \u8bf7\u6c42\u5934\u5c31\u662f\uff1a <code>Bearer foobar</code></li> </ul> </li> </ul>"},{"location":"tutorial/security/first-steps/#fastapi-oauth2passwordbearer","title":"FastAPI \u7684 <code>OAuth2PasswordBearer</code>","text":"<p>FastAPI \u63d0\u4f9b\u4e86\u4e0d\u540c\u62bd\u8c61\u7ea7\u522b\u7684\u5b89\u5168\u5de5\u5177\u3002</p> <p>\u672c\u4f8b\u4f7f\u7528 OAuth2 \u7684 Password \u6d41\u4ee5\u53ca Bearer \u4ee4\u724c\uff08<code>Token</code>\uff09\u3002\u4e3a\u6b64\u8981\u4f7f\u7528 <code>OAuth2PasswordBearer</code> \u7c7b\u3002</p> <p>\u8bf4\u660e</p> <p><code>Bearer</code> \u4ee4\u724c\u4e0d\u662f\u552f\u4e00\u7684\u9009\u62e9\u3002</p> <p>\u4f46\u5b83\u662f\u6700\u9002\u5408\u8fd9\u4e2a\u7528\u4f8b\u7684\u65b9\u6848\u3002</p> <p>\u751a\u81f3\u53ef\u4ee5\u8bf4\uff0c\u5b83\u662f\u9002\u7528\u4e8e\u7edd\u5927\u591a\u6570\u7528\u4f8b\u7684\u6700\u4f73\u65b9\u6848\uff0c\u9664\u975e\u60a8\u662f OAuth2 \u7684\u4e13\u5bb6\uff0c\u77e5\u9053\u4e3a\u4ec0\u4e48\u5176\u5b83\u65b9\u6848\u66f4\u5408\u9002\u3002</p> <p>\u672c\u4f8b\u4e2d\uff0cFastAPI \u8fd8\u63d0\u4f9b\u4e86\u6784\u5efa\u5de5\u5177\u3002</p> <p>\u521b\u5efa <code>OAuth2PasswordBearer</code> \u7684\u7c7b\u5b9e\u4f8b\u65f6\uff0c\u8981\u4f20\u9012 <code>tokenUrl</code> \u53c2\u6570\u3002\u8be5\u53c2\u6570\u5305\u542b\u5ba2\u6237\u7aef\uff08\u7528\u6237\u6d4f\u89c8\u5668\u4e2d\u8fd0\u884c\u7684\u524d\u7aef\uff09 \u7684 URL\uff0c\u7528\u4e8e\u53d1\u9001 <code>username</code> \u4e0e <code>password</code>\uff0c\u5e76\u83b7\u53d6\u4ee4\u724c\u3002</p> <pre><code>from fastapi import Depends, FastAPI\nfrom fastapi.security import OAuth2PasswordBearer\n\napp = FastAPI()\n\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")\n@app.get(\"/items/\")\nasync def read_items(token: str = Depends(oauth2_scheme)):\n    return {\"token\": token}\n</code></pre> <p>\u63d0\u793a</p> <p>\u5728\u6b64\uff0c<code>tokenUrl=\"token\"</code> \u6307\u5411\u7684\u662f\u6682\u672a\u521b\u5efa\u7684\u76f8\u5bf9 URL <code>token</code>\u3002\u8fd9\u4e2a\u76f8\u5bf9 URL \u76f8\u5f53\u4e8e <code>./token</code>\u3002</p> <p>\u56e0\u4e3a\u4f7f\u7528\u7684\u662f\u76f8\u5bf9 URL\uff0c\u5982\u679c API \u4f4d\u4e8e <code>https://example.com/</code>\uff0c\u5219\u6307\u5411 <code>https://example.com/token</code>\u3002\u4f46\u5982\u679c API \u4f4d\u4e8e <code>https://example.com/api/v1/</code>\uff0c\u5b83\u6307\u5411\u7684\u5c31\u662f<code>https://example.com/api/v1/token</code>\u3002</p> <p>\u4f7f\u7528\u76f8\u5bf9 URL \u975e\u5e38\u91cd\u8981\uff0c\u53ef\u4ee5\u786e\u4fdd\u5e94\u7528\u5728\u9047\u5230\u4f7f\u7528\u4ee3\u7406\u8fd9\u6837\u7684\u9ad8\u7ea7\u7528\u4f8b\u65f6\uff0c\u4e5f\u80fd\u6b63\u5e38\u8fd0\u884c\u3002</p> <p>\u8be5\u53c2\u6570\u4e0d\u4f1a\u521b\u5efa\u7aef\u70b9\u6216\u8def\u5f84\u64cd\u4f5c\uff0c\u4f46\u4f1a\u58f0\u660e\u5ba2\u6237\u7aef\u7528\u6765\u83b7\u53d6\u4ee4\u724c\u7684 URL <code>/token</code> \u3002\u6b64\u4fe1\u606f\u7528\u4e8e OpenAPI \u53ca API \u6587\u6863\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u5b66\u4e60\u5982\u4f55\u521b\u5efa\u5b9e\u9645\u7684\u8def\u5f84\u64cd\u4f5c\u3002</p> <p>\u8bf4\u660e</p> <p>\u4e25\u82db\u7684 Pythonista \u53ef\u80fd\u4e0d\u559c\u6b22\u7528 <code>tokenUrl</code> \u8fd9\u79cd\u547d\u540d\u98ce\u683c\u4ee3\u66ff <code>token_url</code>\u3002</p> <p>\u8fd9\u79cd\u547d\u540d\u65b9\u5f0f\u662f\u56e0\u4e3a\u8981\u4f7f\u7528\u4e0e OpenAPI \u89c4\u8303\u4e2d\u76f8\u540c\u7684\u540d\u5b57\u3002\u4ee5\u4fbf\u5728\u6df1\u5165\u6821\u9a8c\u5b89\u5168\u65b9\u6848\u65f6\uff0c\u80fd\u901a\u8fc7\u590d\u5236\u7c98\u8d34\u67e5\u627e\u66f4\u591a\u76f8\u5173\u4fe1\u606f\u3002</p> <p><code>oauth2_scheme</code> \u53d8\u91cf\u662f <code>OAuth2PasswordBearer</code> \u7684\u5b9e\u4f8b\uff0c\u4e5f\u662f\u53ef\u8c03\u7528\u9879\u3002</p> <p>\u4ee5\u5982\u4e0b\u65b9\u5f0f\u8c03\u7528\uff1a</p> <pre><code>oauth2_scheme(some, parameters)\n</code></pre> <p>\u56e0\u6b64\uff0c<code>Depends</code> \u53ef\u4ee5\u8c03\u7528 <code>oauth2_scheme</code> \u53d8\u91cf\u3002</p>"},{"location":"tutorial/security/first-steps/#_5","title":"\u4f7f\u7528","text":"<p>\u63a5\u4e0b\u6765\uff0c\u4f7f\u7528 <code>Depends</code> \u628a <code>oauth2_scheme</code> \u4f20\u5165\u4f9d\u8d56\u9879\u3002</p> <pre><code>from fastapi import Depends, FastAPI\nfrom fastapi.security import OAuth2PasswordBearer\n\napp = FastAPI()\n\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")\n\n\n@app.get(\"/items/\")\nasync def read_items(token: str = Depends(oauth2_scheme)):\nreturn {\"token\": token}\n</code></pre> <p>\u8be5\u4f9d\u8d56\u9879\u4f7f\u7528\u5b57\u7b26\u4e32\uff08<code>str</code>\uff09\u63a5\u6536\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u7684\u53c2\u6570 <code>token</code> \u3002</p> <p>FastAPI \u4f7f\u7528\u4f9d\u8d56\u9879\u5728 OpenAPI \u6982\u56fe\uff08\u53ca API \u6587\u6863\uff09\u4e2d\u5b9a\u4e49\u5b89\u5168\u65b9\u6848\u3002</p> <p>\u6280\u672f\u7ec6\u8282</p> <p>FastAPI \u4f7f\u7528\uff08\u5728\u4f9d\u8d56\u9879\u4e2d\u58f0\u660e\u7684\uff09\u7c7b <code>OAuth2PasswordBearer</code> \u5728 OpenAPI \u4e2d\u5b9a\u4e49\u5b89\u5168\u65b9\u6848\uff0c\u8fd9\u662f\u56e0\u4e3a\u5b83\u7ee7\u627f\u81ea <code>fastapi.security.oauth2.OAuth2</code>\uff0c\u800c\u8be5\u7c7b\u53c8\u662f\u7ee7\u627f\u81ea<code>fastapi.security.base.SecurityBase</code>\u3002</p> <p>\u6240\u6709\u4e0e OpenAPI\uff08\u53ca API \u6587\u6863\uff09\u96c6\u6210\u7684\u5b89\u5168\u5de5\u5177\u90fd\u7ee7\u627f\u81ea <code>SecurityBase</code>\uff0c \u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48 FastAPI \u80fd\u628a\u5b83\u4eec\u96c6\u6210\u81f3 OpenAPI \u7684\u539f\u56e0\u3002</p>"},{"location":"tutorial/security/first-steps/#_6","title":"\u5b9e\u73b0\u7684\u64cd\u4f5c","text":"<p>FastAPI \u6821\u9a8c\u8bf7\u6c42\u4e2d\u7684 <code>Authorization</code> \u8bf7\u6c42\u5934\uff0c\u6838\u5bf9\u8bf7\u6c42\u5934\u7684\u503c\u662f\u4e0d\u662f\u7531 <code>Bearer</code> \uff0b \u4ee4\u724c\u7ec4\u6210\uff0c \u5e76\u8fd4\u56de\u4ee4\u724c\u5b57\u7b26\u4e32\uff08<code>str</code>\uff09\u3002</p> <p>\u5982\u679c\u6ca1\u6709\u627e\u5230 <code>Authorization</code> \u8bf7\u6c42\u5934\uff0c\u6216\u8bf7\u6c42\u5934\u7684\u503c\u4e0d\u662f <code>Bearer</code> \uff0b \u4ee4\u724c\u3002FastAPI \u76f4\u63a5\u8fd4\u56de 401 \u9519\u8bef\u72b6\u6001\u7801\uff08<code>UNAUTHORIZED</code>\uff09\u3002</p> <p>\u5f00\u53d1\u8005\u4e0d\u9700\u8981\u68c0\u67e5\u9519\u8bef\u4fe1\u606f\uff0c\u67e5\u770b\u4ee4\u724c\u662f\u5426\u5b58\u5728\uff0c\u53ea\u8981\u8be5\u51fd\u6570\u80fd\u591f\u6267\u884c\uff0c\u51fd\u6570\u4e2d\u5c31\u4f1a\u5305\u542b\u4ee4\u724c\u5b57\u7b26\u4e32\u3002</p> <p>\u6b63\u5982\u4e0b\u56fe\u6240\u793a\uff0cAPI \u6587\u6863\u5df2\u7ecf\u5305\u542b\u4e86\u8fd9\u9879\u529f\u80fd\uff1a</p> <p></p> <p>\u76ee\u524d\uff0c\u6682\u65f6\u8fd8\u6ca1\u6709\u5b9e\u73b0\u9a8c\u8bc1\u4ee4\u724c\u662f\u5426\u6709\u6548\u7684\u529f\u80fd\uff0c\u4e0d\u8fc7\u540e\u6587\u5f88\u5feb\u5c31\u4f1a\u4ecb\u7ecd\u7684\u3002</p>"},{"location":"tutorial/security/first-steps/#_7","title":"\u5c0f\u7ed3","text":"<p>\u770b\u5230\u4e86\u5427\uff0c\u53ea\u8981\u591a\u5199\u4e09\u56db\u884c\u4ee3\u7801\uff0c\u5c31\u53ef\u4ee5\u6dfb\u52a0\u57fa\u7840\u7684\u5b89\u5168\u8868\u5355\u3002</p>"},{"location":"tutorial/security/get-current-user/","title":"\u83b7\u53d6\u5f53\u524d\u7528\u6237","text":"<p>\u5728\u4e0a\u4e00\u7ae0\u8282\u4e2d\uff0c\uff08\u57fa\u4e8e\u4f9d\u8d56\u9879\u6ce8\u5165\u7cfb\u7edf\u7684\uff09\u5b89\u5168\u7cfb\u7edf\u5411\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u63d0\u4f9b\u4e86\u4e00\u4e2a <code>str</code> \u7c7b\u578b\u7684 <code>token</code>\uff1a</p> <pre><code>from fastapi import Depends, FastAPI\nfrom fastapi.security import OAuth2PasswordBearer\n\napp = FastAPI()\n\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")\n\n\n@app.get(\"/items/\")\nasync def read_items(token: str = Depends(oauth2_scheme)):\nreturn {\"token\": token}\n</code></pre> <p>\u4f46\u8fd9\u8fd8\u4e0d\u662f\u5f88\u5b9e\u7528\u3002</p> <p>\u8ba9\u6211\u4eec\u6765\u4f7f\u5b83\u8fd4\u56de\u5f53\u524d\u7528\u6237\u7ed9\u6211\u4eec\u3002</p>"},{"location":"tutorial/security/get-current-user/#_2","title":"\u521b\u5efa\u4e00\u4e2a\u7528\u6237\u6a21\u578b","text":"<p>\u9996\u5148\uff0c\u8ba9\u6211\u4eec\u6765\u521b\u5efa\u4e00\u4e2a\u7528\u6237 Pydantic \u6a21\u578b\u3002</p> <p>\u4e0e\u4f7f\u7528 Pydantic \u58f0\u660e\u8bf7\u6c42\u4f53\u7684\u65b9\u5f0f\u76f8\u540c\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u5176\u4ed6\u4efb\u4f55\u5730\u65b9\u4f7f\u7528\u5b83\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import Depends, FastAPI\nfrom fastapi.security import OAuth2PasswordBearer\nfrom pydantic import BaseModel\napp = FastAPI()\n\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")\n\n\nclass User(BaseModel):\nusername: str\nemail: Union[str, None] = None\nfull_name: Union[str, None] = None\ndisabled: Union[bool, None] = None\ndef fake_decode_token(token):\n    return User(\n        username=token + \"fakedecoded\", email=\"john@example.com\", full_name=\"John Doe\"\n    )\n\n\nasync def get_current_user(token: str = Depends(oauth2_scheme)):\n    user = fake_decode_token(token)\n    return user\n\n\n@app.get(\"/users/me\")\nasync def read_users_me(current_user: User = Depends(get_current_user)):\n    return current_user\n</code></pre>"},{"location":"tutorial/security/get-current-user/#get_current_user","title":"\u521b\u5efa\u4e00\u4e2a <code>get_current_user</code> \u4f9d\u8d56\u9879","text":"<p>\u8ba9\u6211\u4eec\u6765\u521b\u5efa\u4e00\u4e2a <code>get_current_user</code> \u4f9d\u8d56\u9879\u3002</p> <p>\u8fd8\u8bb0\u5f97\u4f9d\u8d56\u9879\u53ef\u4ee5\u6709\u5b50\u4f9d\u8d56\u9879\u5417\uff1f</p> <p><code>get_current_user</code> \u5c06\u5177\u6709\u4e00\u4e2a\u6211\u4eec\u4e4b\u524d\u6240\u521b\u5efa\u7684\u540c\u4e00\u4e2a <code>oauth2_scheme</code> \u4f5c\u4e3a\u4f9d\u8d56\u9879\u3002</p> <p>\u4e0e\u6211\u4eec\u4e4b\u524d\u76f4\u63a5\u5728\u8def\u5f84\u64cd\u4f5c\u4e2d\u6240\u505a\u7684\u76f8\u540c\uff0c\u6211\u4eec\u65b0\u7684\u4f9d\u8d56\u9879 <code>get_current_user</code> \u5c06\u4ece\u5b50\u4f9d\u8d56\u9879 <code>oauth2_scheme</code> \u4e2d\u63a5\u6536\u4e00\u4e2a <code>str</code> \u7c7b\u578b\u7684 <code>token</code>\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import Depends, FastAPI\nfrom fastapi.security import OAuth2PasswordBearer\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")\n\n\nclass User(BaseModel):\n    username: str\n    email: Union[str, None] = None\n    full_name: Union[str, None] = None\n    disabled: Union[bool, None] = None\n\n\ndef fake_decode_token(token):\n    return User(\n        username=token + \"fakedecoded\", email=\"john@example.com\", full_name=\"John Doe\"\n    )\n\n\nasync def get_current_user(token: str = Depends(oauth2_scheme)):\nuser = fake_decode_token(token)\n    return user\n\n\n@app.get(\"/users/me\")\nasync def read_users_me(current_user: User = Depends(get_current_user)):\n    return current_user\n</code></pre>"},{"location":"tutorial/security/get-current-user/#_3","title":"\u83b7\u53d6\u7528\u6237","text":"<p><code>get_current_user</code> \u5c06\u4f7f\u7528\u6211\u4eec\u521b\u5efa\u7684\uff08\u4f2a\uff09\u5de5\u5177\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u63a5\u6536 <code>str</code> \u7c7b\u578b\u7684\u4ee4\u724c\u5e76\u8fd4\u56de\u6211\u4eec\u7684 Pydantic <code>User</code> \u6a21\u578b\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import Depends, FastAPI\nfrom fastapi.security import OAuth2PasswordBearer\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")\n\n\nclass User(BaseModel):\n    username: str\n    email: Union[str, None] = None\n    full_name: Union[str, None] = None\n    disabled: Union[bool, None] = None\n\n\ndef fake_decode_token(token):\nreturn User(\nusername=token + \"fakedecoded\", email=\"john@example.com\", full_name=\"John Doe\"\n)\nasync def get_current_user(token: str = Depends(oauth2_scheme)):\nuser = fake_decode_token(token)\nreturn user\n@app.get(\"/users/me\")\nasync def read_users_me(current_user: User = Depends(get_current_user)):\n    return current_user\n</code></pre>"},{"location":"tutorial/security/get-current-user/#_4","title":"\u6ce8\u5165\u5f53\u524d\u7528\u6237","text":"<p>\u56e0\u6b64\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u5728\u8def\u5f84\u64cd\u4f5c\u4e2d\u4f7f\u7528 <code>get_current_user</code> \u4f5c\u4e3a <code>Depends</code> \u4e86\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import Depends, FastAPI\nfrom fastapi.security import OAuth2PasswordBearer\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")\n\n\nclass User(BaseModel):\n    username: str\n    email: Union[str, None] = None\n    full_name: Union[str, None] = None\n    disabled: Union[bool, None] = None\n\n\ndef fake_decode_token(token):\n    return User(\n        username=token + \"fakedecoded\", email=\"john@example.com\", full_name=\"John Doe\"\n    )\n\n\nasync def get_current_user(token: str = Depends(oauth2_scheme)):\n    user = fake_decode_token(token)\n    return user\n\n\n@app.get(\"/users/me\")\nasync def read_users_me(current_user: User = Depends(get_current_user)):\nreturn current_user\n</code></pre> <p>\u6ce8\u610f\u6211\u4eec\u5c06 <code>current_user</code> \u7684\u7c7b\u578b\u58f0\u660e\u4e3a Pydantic \u6a21\u578b <code>User</code>\u3002</p> <p>\u8fd9\u5c06\u5e2e\u52a9\u6211\u4eec\u5728\u51fd\u6570\u5185\u90e8\u4f7f\u7528\u6240\u6709\u7684\u4ee3\u7801\u8865\u5168\u548c\u7c7b\u578b\u68c0\u67e5\u3002</p> <p>Tip</p> <p>\u4f60\u53ef\u80fd\u8fd8\u8bb0\u5f97\u8bf7\u6c42\u4f53\u4e5f\u662f\u4f7f\u7528 Pydantic \u6a21\u578b\u6765\u58f0\u660e\u7684\u3002</p> <p>\u5728\u8fd9\u91cc FastAPI \u4e0d\u4f1a\u641e\u6df7\uff0c\u56e0\u4e3a\u4f60\u6b63\u5728\u4f7f\u7528\u7684\u662f <code>Depends</code>\u3002</p> <p>Check</p> <p>\u8fd9\u79cd\u4f9d\u8d56\u7cfb\u7edf\u7684\u8bbe\u8ba1\u65b9\u5f0f\u4f7f\u6211\u4eec\u53ef\u4ee5\u62e5\u6709\u4e0d\u540c\u7684\u4f9d\u8d56\u9879\uff08\u4e0d\u540c\u7684\u300c\u53ef\u4f9d\u8d56\u7c7b\u578b\u300d\uff09\uff0c\u5e76\u4e14\u5b83\u4eec\u90fd\u8fd4\u56de\u4e00\u4e2a <code>User</code> \u6a21\u578b\u3002</p> <p>\u6211\u4eec\u5e76\u672a\u88ab\u5c40\u9650\u4e8e\u53ea\u80fd\u6709\u4e00\u4e2a\u8fd4\u56de\u8be5\u7c7b\u578b\u6570\u636e\u7684\u4f9d\u8d56\u9879\u3002</p>"},{"location":"tutorial/security/get-current-user/#_5","title":"\u5176\u4ed6\u6a21\u578b","text":"<p>\u73b0\u5728\u4f60\u53ef\u4ee5\u76f4\u63a5\u5728\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u4e2d\u83b7\u53d6\u5f53\u524d\u7528\u6237\uff0c\u5e76\u4f7f\u7528 <code>Depends</code> \u5728\u4f9d\u8d56\u6ce8\u5165\u7ea7\u522b\u5904\u7406\u5b89\u5168\u6027\u673a\u5236\u3002</p> <p>\u4f60\u53ef\u4ee5\u4f7f\u7528\u4efb\u4f55\u6a21\u578b\u6216\u6570\u636e\u6765\u6ee1\u8db3\u5b89\u5168\u6027\u8981\u6c42\uff08\u5728\u8fd9\u4e2a\u793a\u4f8b\u4e2d\uff0c\u4f7f\u7528\u7684\u662f Pydantic \u6a21\u578b <code>User</code>\uff09\u3002</p> <p>\u4f46\u662f\u4f60\u5e76\u672a\u88ab\u9650\u5236\u53ea\u80fd\u4f7f\u7528\u67d0\u4e9b\u7279\u5b9a\u7684\u6570\u636e\u6a21\u578b\uff0c\u7c7b\u6216\u7c7b\u578b\u3002</p> <p>\u4f60\u60f3\u8981\u5728\u6a21\u578b\u4e2d\u4f7f\u7528 <code>id</code> \u548c <code>email</code> \u800c\u4e0d\u4f7f\u7528\u4efb\u4f55\u7684 <code>username</code>\uff1f\u5f53\u7136\u53ef\u4ee5\u3002\u4f60\u53ef\u4ee5\u540c\u6837\u5730\u4f7f\u7528\u8fd9\u4e9b\u5de5\u5177\u3002</p> <p>\u4f60\u53ea\u60f3\u8981\u4e00\u4e2a <code>str</code>\uff1f\u6216\u8005\u4ec5\u4ec5\u4e00\u4e2a <code>dict</code>\uff1f\u8fd8\u662f\u76f4\u63a5\u4e00\u4e2a\u6570\u636e\u5e93\u6a21\u578b\u7c7b\u7684\u5b9e\u4f8b\uff1f\u5b83\u4eec\u7684\u5de5\u4f5c\u65b9\u5f0f\u90fd\u662f\u4e00\u6837\u7684\u3002</p> <p>\u5b9e\u9645\u4e0a\u4f60\u6ca1\u6709\u7528\u6237\u767b\u5f55\u5230\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u800c\u662f\u53ea\u62e5\u6709\u8bbf\u95ee\u4ee4\u724c\u7684\u673a\u5668\u4eba\uff0c\u7a0b\u5e8f\u6216\u5176\u4ed6\u7cfb\u7edf\uff1f\u518d\u4e00\u6b21\uff0c\u5b83\u4eec\u7684\u5de5\u4f5c\u65b9\u5f0f\u4e5f\u662f\u4e00\u6837\u7684\u3002</p> <p>\u5c3d\u7ba1\u53bb\u4f7f\u7528\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u6240\u9700\u8981\u7684\u4efb\u4f55\u6a21\u578b\uff0c\u4efb\u4f55\u7c7b\uff0c\u4efb\u4f55\u6570\u636e\u5e93\u3002FastAPI \u901a\u8fc7\u4f9d\u8d56\u9879\u6ce8\u5165\u7cfb\u7edf\u90fd\u5e2e\u4f60\u641e\u5b9a\u3002</p>"},{"location":"tutorial/security/get-current-user/#_6","title":"\u4ee3\u7801\u4f53\u79ef","text":"<p>\u8fd9\u4e2a\u793a\u4f8b\u4f3c\u4e4e\u770b\u8d77\u6765\u5f88\u5197\u957f\u3002\u8003\u8651\u5230\u6211\u4eec\u5728\u540c\u4e00\u6587\u4ef6\u4e2d\u6df7\u5408\u4e86\u5b89\u5168\u6027\uff0c\u6570\u636e\u6a21\u578b\u5de5\u5177\u51fd\u6570\u548c\u8def\u5f84\u64cd\u4f5c\u7b49\u4ee3\u7801\u3002</p> <p>\u4f46\u5173\u952e\u7684\u662f\u3002</p> <p>\u5b89\u5168\u6027\u548c\u4f9d\u8d56\u9879\u6ce8\u5165\u5185\u5bb9\u53ea\u9700\u8981\u7f16\u5199\u4e00\u6b21\u3002</p> <p>\u4f60\u53ef\u4ee5\u6839\u636e\u9700\u8981\u4f7f\u5176\u53d8\u5f97\u5f88\u590d\u6742\u3002\u800c\u4e14\u53ea\u9700\u8981\u5728\u4e00\u4e2a\u5730\u65b9\u5199\u4e00\u6b21\u3002\u4f46\u4ecd\u7136\u5177\u5907\u6240\u6709\u7684\u7075\u6d3b\u6027\u3002</p> <p>\u4f46\u662f\uff0c\u4f60\u53ef\u4ee5\u6709\u65e0\u6570\u4e2a\u4f7f\u7528\u540c\u4e00\u5b89\u5168\u7cfb\u7edf\u7684\u7aef\u70b9\uff08\u8def\u5f84\u64cd\u4f5c\uff09\u3002</p> <p>\u6240\u6709\uff08\u6216\u6240\u9700\u7684\u4efb\u4f55\u90e8\u5206\uff09\u7684\u7aef\u70b9\uff0c\u90fd\u53ef\u4ee5\u5229\u7528\u5bf9\u8fd9\u4e9b\u6216\u4f60\u521b\u5efa\u7684\u5176\u4ed6\u4f9d\u8d56\u9879\u8fdb\u884c\u590d\u7528\u6240\u5e26\u6765\u7684\u4f18\u52bf\u3002</p> <p>\u6240\u6709\u7684\u8fd9\u65e0\u6570\u4e2a\u8def\u5f84\u64cd\u4f5c\u751a\u81f3\u53ef\u4ee5\u5c0f\u5230\u53ea\u9700 3 \u884c\u4ee3\u7801\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import Depends, FastAPI\nfrom fastapi.security import OAuth2PasswordBearer\nfrom pydantic import BaseModel\n\napp = FastAPI()\n\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")\n\n\nclass User(BaseModel):\n    username: str\n    email: Union[str, None] = None\n    full_name: Union[str, None] = None\n    disabled: Union[bool, None] = None\n\n\ndef fake_decode_token(token):\n    return User(\n        username=token + \"fakedecoded\", email=\"john@example.com\", full_name=\"John Doe\"\n    )\n\n\nasync def get_current_user(token: str = Depends(oauth2_scheme)):\n    user = fake_decode_token(token)\n    return user\n\n\n@app.get(\"/users/me\")\nasync def read_users_me(current_user: User = Depends(get_current_user)):\nreturn current_user\n</code></pre>"},{"location":"tutorial/security/get-current-user/#_7","title":"\u603b\u7ed3","text":"<p>\u73b0\u5728\u4f60\u53ef\u4ee5\u76f4\u63a5\u5728\u8def\u5f84\u64cd\u4f5c\u51fd\u6570\u4e2d\u83b7\u53d6\u5f53\u524d\u7528\u6237\u3002</p> <p>\u6211\u4eec\u5df2\u7ecf\u8fdb\u884c\u5230\u4e00\u534a\u4e86\u3002</p> <p>\u6211\u4eec\u53ea\u9700\u8981\u518d\u4e3a\u7528\u6237/\u5ba2\u6237\u7aef\u6dfb\u52a0\u4e00\u4e2a\u771f\u6b63\u53d1\u9001 <code>username</code> \u548c <code>password</code> \u7684\u8def\u5f84\u64cd\u4f5c\u3002</p> <p>\u8fd9\u4e9b\u5185\u5bb9\u5728\u4e0b\u4e00\u7ae0\u8282\u3002</p>"},{"location":"tutorial/security/oauth2-jwt/","title":"OAuth2 \u5b9e\u73b0\u5bc6\u7801\u54c8\u5e0c\u4e0e Bearer  JWT \u4ee4\u724c\u9a8c\u8bc1","text":"<p>\u81f3\u6b64\uff0c\u6211\u4eec\u5df2\u7ecf\u7f16\u5199\u4e86\u6240\u6709\u5b89\u5168\u6d41\uff0c\u672c\u7ae0\u5b66\u4e60\u5982\u4f55\u4f7f\u7528 JWT \u4ee4\u724c\uff08Token\uff09\u548c\u5b89\u5168\u5bc6\u7801\u54c8\u5e0c\uff08Hash\uff09\u5b9e\u73b0\u771f\u6b63\u7684\u5b89\u5168\u673a\u5236\u3002</p> <p>\u672c\u7ae0\u7684\u793a\u4f8b\u4ee3\u7801\u771f\u6b63\u5b9e\u73b0\u4e86\u5728\u5e94\u7528\u7684\u6570\u636e\u5e93\u4e2d\u4fdd\u5b58\u54c8\u5e0c\u5bc6\u7801\u7b49\u529f\u80fd\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u7d27\u63a5\u4e0a\u4e00\u7ae0\uff0c\u7ee7\u7eed\u5b8c\u5584\u5b89\u5168\u673a\u5236\u3002</p>"},{"location":"tutorial/security/oauth2-jwt/#jwt","title":"JWT \u7b80\u4ecb","text":"<p>JWT \u5373JSON \u7f51\u7edc\u4ee4\u724c\uff08JSON Web Tokens\uff09\u3002</p> <p>JWT \u662f\u4e00\u79cd\u5c06 JSON \u5bf9\u8c61\u7f16\u7801\u4e3a\u6ca1\u6709\u7a7a\u683c\uff0c\u4e14\u96be\u4ee5\u7406\u89e3\u7684\u957f\u5b57\u7b26\u4e32\u7684\u6807\u51c6\u3002JWT \u7684\u5185\u5bb9\u5982\u4e0b\u6240\u793a\uff1a</p> <pre><code>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c\n</code></pre> <p>JWT \u5b57\u7b26\u4e32\u6ca1\u6709\u52a0\u5bc6\uff0c\u4efb\u4f55\u4eba\u90fd\u80fd\u7528\u5b83\u6062\u590d\u539f\u59cb\u4fe1\u606f\u3002</p> <p>\u4f46 JWT \u4f7f\u7528\u4e86\u7b7e\u540d\u673a\u5236\u3002\u63a5\u53d7\u4ee4\u724c\u65f6\uff0c\u53ef\u4ee5\u7528\u7b7e\u540d\u6821\u9a8c\u4ee4\u724c\u3002</p> <p>\u4f7f\u7528 JWT \u521b\u5efa\u6709\u6548\u671f\u4e3a\u4e00\u5468\u7684\u4ee4\u724c\u3002\u7b2c\u4e8c\u5929\uff0c\u7528\u6237\u6301\u4ee4\u724c\u518d\u6b21\u8bbf\u95ee\u65f6\uff0c\u4ecd\u4e3a\u767b\u5f55\u72b6\u6001\u3002</p> <p>\u4ee4\u724c\u4e8e\u4e00\u5468\u540e\u8fc7\u671f\uff0c\u5c4a\u65f6\uff0c\u7528\u6237\u8eab\u4efd\u9a8c\u8bc1\u5c31\u4f1a\u5931\u8d25\u3002\u53ea\u6709\u518d\u6b21\u767b\u5f55\uff0c\u624d\u80fd\u83b7\u5f97\u65b0\u7684\u4ee4\u724c\u3002\u5982\u679c\u7528\u6237\uff08\u6216\u7b2c\u4e09\u65b9\uff09\u7be1\u6539\u4ee4\u724c\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u56e0\u4e3a\u7b7e\u540d\u4e0d\u5339\u914d\u4f1a\u5bfc\u81f4\u8eab\u4efd\u9a8c\u8bc1\u5931\u8d25\u3002</p> <p>\u5982\u9700\u6df1\u5165\u4e86\u89e3 JWT \u4ee4\u724c\uff0c\u4e86\u89e3\u5b83\u7684\u5de5\u4f5c\u65b9\u5f0f\uff0c\u8bf7\u53c2\u9605 https://jwt.io\u3002</p>"},{"location":"tutorial/security/oauth2-jwt/#python-jose","title":"\u5b89\u88c5 <code>python-jose</code>","text":"<p>\u5b89\u88c5 <code>python-jose</code>\uff0c\u5728 Python \u4e2d\u751f\u6210\u548c\u6821\u9a8c JWT \u4ee4\u724c\uff1a</p> <pre><code>$ pip install python-jose[cryptography]\n\n---&gt; 100%\n</code></pre> <p>Python-jose \u9700\u8981\u5b89\u88c5\u914d\u5957\u7684\u52a0\u5bc6\u540e\u7aef\u3002</p> <p>\u672c\u6559\u7a0b\u63a8\u8350\u7684\u540e\u7aef\u662f\uff1apyca/cryptography\u3002</p> <p>\u63d0\u793a</p> <p>\u672c\u6559\u7a0b\u4ee5\u524d\u4f7f\u7528 PyJWT\u3002</p> <p>\u4f46\u540e\u6765\u6362\u6210\u4e86 Python-jose\uff0c\u56e0\u4e3a Python-jose \u652f\u6301 PyJWT \u7684\u6240\u6709\u529f\u80fd\uff0c\u8fd8\u652f\u6301\u4e0e\u5176\u5b83\u5de5\u5177\u96c6\u6210\u65f6\u53ef\u80fd\u4f1a\u7528\u5230\u7684\u4e00\u4e9b\u5176\u5b83\u529f\u80fd\u3002</p>"},{"location":"tutorial/security/oauth2-jwt/#_1","title":"\u5bc6\u7801\u54c8\u5e0c","text":"<p>\u54c8\u5e0c\u662f\u6307\u628a\u7279\u5b9a\u5185\u5bb9\uff08\u672c\u4f8b\u4e2d\u4e3a\u5bc6\u7801\uff09\u8f6c\u6362\u4e3a\u4e71\u7801\u5f62\u5f0f\u7684\u5b57\u8282\u5e8f\u5217\uff08\u5176\u5b9e\u5c31\u662f\u5b57\u7b26\u4e32\uff09\u3002</p> <p>\u6bcf\u6b21\u4f20\u5165\u5b8c\u5168\u76f8\u540c\u7684\u5185\u5bb9\u65f6\uff08\u6bd4\u5982\uff0c\u5b8c\u5168\u76f8\u540c\u7684\u5bc6\u7801\uff09\uff0c\u8fd4\u56de\u7684\u90fd\u662f\u5b8c\u5168\u76f8\u540c\u7684\u4e71\u7801\u3002</p> <p>\u4f46\u8fd9\u4e2a\u4e71\u7801\u65e0\u6cd5\u8f6c\u6362\u56de\u4f20\u5165\u7684\u5bc6\u7801\u3002</p>"},{"location":"tutorial/security/oauth2-jwt/#_2","title":"\u4e3a\u4ec0\u4e48\u4f7f\u7528\u5bc6\u7801\u54c8\u5e0c","text":"<p>\u539f\u56e0\u5f88\u7b80\u5355\uff0c\u5047\u5982\u6570\u636e\u5e93\u88ab\u76d7\uff0c\u7a83\u8d3c\u65e0\u6cd5\u83b7\u53d6\u7528\u6237\u7684\u660e\u6587\u5bc6\u7801\uff0c\u5f97\u5230\u7684\u53ea\u662f\u54c8\u5e0c\u503c\u3002</p> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u7a83\u8d3c\u5c31\u65e0\u6cd5\u5728\u5176\u5b83\u5e94\u7528\u4e2d\u4f7f\u7528\u7a83\u53d6\u7684\u5bc6\u7801\uff0c\u8981\u77e5\u9053\uff0c\u5f88\u591a\u7528\u6237\u5728\u6240\u6709\u7cfb\u7edf\u4e2d\u90fd\u4f7f\u7528\u76f8\u540c\u7684\u5bc6\u7801\uff0c\u98ce\u9669\u8d85\u5927\uff09\u3002</p>"},{"location":"tutorial/security/oauth2-jwt/#passlib","title":"\u5b89\u88c5 <code>passlib</code>","text":"<p>Passlib \u662f\u5904\u7406\u5bc6\u7801\u54c8\u5e0c\u7684 Python \u5305\u3002</p> <p>\u5b83\u652f\u6301\u5f88\u591a\u5b89\u5168\u54c8\u5e0c\u7b97\u6cd5\u53ca\u914d\u5957\u5de5\u5177\u3002</p> <p>\u672c\u6559\u7a0b\u63a8\u8350\u7684\u7b97\u6cd5\u662f Bcrypt\u3002</p> <p>\u56e0\u6b64\uff0c\u8bf7\u5148\u5b89\u88c5\u9644\u5e26 Bcrypt \u7684 PassLib\uff1a</p> <pre><code>$ pip install passlib[bcrypt]\n\n---&gt; 100%\n</code></pre> <p>\u63d0\u793a</p> <p><code>passlib</code> \u751a\u81f3\u53ef\u4ee5\u8bfb\u53d6 Django\u3001Flask \u7684\u5b89\u5168\u63d2\u4ef6\u7b49\u5de5\u5177\u521b\u5efa\u7684\u5bc6\u7801\u3002</p> <p>\u4f8b\u5982\uff0c\u628a Django \u5e94\u7528\u7684\u6570\u636e\u5171\u4eab\u7ed9 FastAPI \u5e94\u7528\u7684\u6570\u636e\u5e93\u3002\u6216\u5229\u7528\u540c\u4e00\u4e2a\u6570\u636e\u5e93\uff0c\u53ef\u4ee5\u9010\u6b65\u628a\u5e94\u7528\u4ece Django \u8fc1\u79fb\u5230 FastAPI\u3002</p> <p>\u5e76\u4e14\uff0c\u7528\u6237\u53ef\u4ee5\u540c\u65f6\u4ece Django \u5e94\u7528\u6216 FastAPI \u5e94\u7528\u767b\u5f55\u3002</p>"},{"location":"tutorial/security/oauth2-jwt/#_3","title":"\u5bc6\u7801\u54c8\u5e0c\u4e0e\u6821\u9a8c","text":"<p>\u4ece <code>passlib</code> \u5bfc\u5165\u6240\u9700\u5de5\u5177\u3002</p> <p>\u521b\u5efa\u7528\u4e8e\u5bc6\u7801\u54c8\u5e0c\u548c\u8eab\u4efd\u6821\u9a8c\u7684 PassLib \u4e0a\u4e0b\u6587\u3002</p> <p>\u63d0\u793a</p> <p>PassLib \u4e0a\u4e0b\u6587\u8fd8\u652f\u6301\u4f7f\u7528\u4e0d\u540c\u54c8\u5e0c\u7b97\u6cd5\u7684\u529f\u80fd\uff0c\u5305\u62ec\u53ea\u80fd\u6821\u9a8c\u7684\u5df2\u5f03\u7528\u65e7\u7b97\u6cd5\u7b49\u3002</p> <p>\u4f8b\u5982\uff0c\u7528\u5b83\u8bfb\u53d6\u548c\u6821\u9a8c\u5176\u5b83\u7cfb\u7edf\uff08\u5982 Django\uff09\u751f\u6210\u7684\u5bc6\u7801\uff0c\u4f46\u8981\u4f7f\u7528\u5176\u5b83\u7b97\u6cd5\uff0c\u5982 Bcrypt\uff0c\u751f\u6210\u65b0\u7684\u54c8\u5e0c\u5bc6\u7801\u3002</p> <p>\u540c\u65f6\uff0c\u8fd9\u4e9b\u529f\u80fd\u90fd\u662f\u517c\u5bb9\u7684\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u521b\u5efa\u4e09\u4e2a\u5de5\u5177\u51fd\u6570\uff0c\u5176\u4e2d\u4e00\u4e2a\u51fd\u6570\u7528\u4e8e\u54c8\u5e0c\u7528\u6237\u7684\u5bc6\u7801\u3002</p> <p>\u7b2c\u4e00\u4e2a\u51fd\u6570\u7528\u4e8e\u6821\u9a8c\u63a5\u6536\u7684\u5bc6\u7801\u662f\u5426\u5339\u914d\u5b58\u50a8\u7684\u54c8\u5e0c\u503c\u3002</p> <p>\u7b2c\u4e09\u4e2a\u51fd\u6570\u7528\u4e8e\u8eab\u4efd\u9a8c\u8bc1\uff0c\u5e76\u8fd4\u56de\u7528\u6237\u3002</p> <pre><code>from datetime import datetime, timedelta\nfrom typing import Union\n\nfrom fastapi import Depends, FastAPI, HTTPException, status\nfrom fastapi.security import OAuth2PasswordBearer, OAuth2PasswordRequestForm\nfrom jose import JWTError, jwt\nfrom passlib.context import CryptContext\nfrom pydantic import BaseModel\n\n# to get a string like this run:\n# openssl rand -hex 32\nSECRET_KEY = \"09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7\"\nALGORITHM = \"HS256\"\nACCESS_TOKEN_EXPIRE_MINUTES = 30\n\n\nfake_users_db = {\n    \"johndoe\": {\n        \"username\": \"johndoe\",\n        \"full_name\": \"John Doe\",\n        \"email\": \"johndoe@example.com\",\n        \"hashed_password\": \"$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW\",\n        \"disabled\": False,\n    }\n}\n\n\nclass Token(BaseModel):\n    access_token: str\n    token_type: str\n\n\nclass TokenData(BaseModel):\n    username: Union[str, None] = None\n\n\nclass User(BaseModel):\n    username: str\n    email: Union[str, None] = None\n    full_name: Union[str, None] = None\n    disabled: Union[bool, None] = None\n\n\nclass UserInDB(User):\n    hashed_password: str\n\n\npwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")\n\napp = FastAPI()\n\n\ndef verify_password(plain_password, hashed_password):\nreturn pwd_context.verify(plain_password, hashed_password)\ndef get_password_hash(password):\nreturn pwd_context.hash(password)\ndef get_user(db, username: str):\n    if username in db:\n        user_dict = db[username]\n        return UserInDB(**user_dict)\n\n\ndef authenticate_user(fake_db, username: str, password: str):\nuser = get_user(fake_db, username)\nif not user:\nreturn False\nif not verify_password(password, user.hashed_password):\nreturn False\nreturn user\ndef create_access_token(data: dict, expires_delta: Union[timedelta, None] = None):\n    to_encode = data.copy()\n    if expires_delta:\n        expire = datetime.utcnow() + expires_delta\n    else:\n        expire = datetime.utcnow() + timedelta(minutes=15)\n    to_encode.update({\"exp\": expire})\n    encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)\n    return encoded_jwt\n\n\nasync def get_current_user(token: str = Depends(oauth2_scheme)):\n    credentials_exception = HTTPException(\n        status_code=status.HTTP_401_UNAUTHORIZED,\n        detail=\"Could not validate credentials\",\n        headers={\"WWW-Authenticate\": \"Bearer\"},\n    )\n    try:\n        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])\n        username: str = payload.get(\"sub\")\n        if username is None:\n            raise credentials_exception\n        token_data = TokenData(username=username)\n    except JWTError:\n        raise credentials_exception\n    user = get_user(fake_users_db, username=token_data.username)\n    if user is None:\n        raise credentials_exception\n    return user\n\n\nasync def get_current_active_user(current_user: User = Depends(get_current_user)):\n    if current_user.disabled:\n        raise HTTPException(status_code=400, detail=\"Inactive user\")\n    return current_user\n\n\n@app.post(\"/token\", response_model=Token)\nasync def login_for_access_token(form_data: OAuth2PasswordRequestForm = Depends()):\n    user = authenticate_user(fake_users_db, form_data.username, form_data.password)\n    if not user:\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Incorrect username or password\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n    access_token_expires = timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)\n    access_token = create_access_token(\n        data={\"sub\": user.username}, expires_delta=access_token_expires\n    )\n    return {\"access_token\": access_token, \"token_type\": \"bearer\"}\n\n\n@app.get(\"/users/me/\", response_model=User)\nasync def read_users_me(current_user: User = Depends(get_current_active_user)):\n    return current_user\n\n\n@app.get(\"/users/me/items/\")\nasync def read_own_items(current_user: User = Depends(get_current_active_user)):\n    return [{\"item_id\": \"Foo\", \"owner\": current_user.username}]\n</code></pre> <p>\u7b14\u8bb0</p> <p>\u67e5\u770b\u65b0\u7684\uff08\u4f2a\uff09\u6570\u636e\u5e93 <code>fake_users_db</code>\uff0c\u5c31\u80fd\u770b\u5230\u54c8\u5e0c\u540e\u7684\u5bc6\u7801\uff1a<code>\"$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW\"</code>\u3002</p>"},{"location":"tutorial/security/oauth2-jwt/#jwt_1","title":"\u5904\u7406 JWT \u4ee4\u724c","text":"<p>\u5bfc\u5165\u5df2\u5b89\u88c5\u7684\u6a21\u5757\u3002</p> <p>\u521b\u5efa\u7528\u4e8e JWT \u4ee4\u724c\u7b7e\u540d\u7684\u968f\u673a\u5bc6\u94a5\u3002</p> <p>\u4f7f\u7528\u4ee5\u4e0b\u547d\u4ee4\uff0c\u751f\u6210\u5b89\u5168\u7684\u968f\u673a\u5bc6\u94a5\uff1a</p> <pre><code>$ openssl rand -hex 32\n\n09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7\n</code></pre> <p>\u7136\u540e\uff0c\u628a\u751f\u6210\u7684\u5bc6\u94a5\u590d\u5236\u5230\u53d8\u91cfSECRET_KEY\uff0c\u6ce8\u610f\uff0c\u4e0d\u8981\u4f7f\u7528\u672c\u4f8b\u6240\u793a\u7684\u5bc6\u94a5\u3002</p> <p>\u521b\u5efa\u6307\u5b9a JWT \u4ee4\u724c\u7b7e\u540d\u7b97\u6cd5\u7684\u53d8\u91cf ALGORITHM\uff0c\u672c\u4f8b\u4e2d\u7684\u503c\u4e3a <code>\"HS256\"</code>\u3002</p> <p>\u521b\u5efa\u8bbe\u7f6e\u4ee4\u724c\u8fc7\u671f\u65f6\u95f4\u7684\u53d8\u91cf\u3002</p> <p>\u5b9a\u4e49\u4ee4\u724c\u7aef\u70b9\u54cd\u5e94\u7684 Pydantic \u6a21\u578b\u3002</p> <p>\u521b\u5efa\u751f\u6210\u65b0\u7684\u8bbf\u95ee\u4ee4\u724c\u7684\u5de5\u5177\u51fd\u6570\u3002</p> <pre><code>from datetime import datetime, timedelta\nfrom typing import Union\n\nfrom fastapi import Depends, FastAPI, HTTPException, status\nfrom fastapi.security import OAuth2PasswordBearer, OAuth2PasswordRequestForm\nfrom jose import JWTError, jwt\nfrom passlib.context import CryptContext\nfrom pydantic import BaseModel\n\n# to get a string like this run:\n# openssl rand -hex 32\nSECRET_KEY = \"09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7\"\nALGORITHM = \"HS256\"\nACCESS_TOKEN_EXPIRE_MINUTES = 30\nfake_users_db = {\n    \"johndoe\": {\n        \"username\": \"johndoe\",\n        \"full_name\": \"John Doe\",\n        \"email\": \"johndoe@example.com\",\n        \"hashed_password\": \"$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW\",\n        \"disabled\": False,\n    }\n}\n\n\nclass Token(BaseModel):\naccess_token: str\ntoken_type: str\nclass TokenData(BaseModel):\n    username: Union[str, None] = None\n\n\nclass User(BaseModel):\n    username: str\n    email: Union[str, None] = None\n    full_name: Union[str, None] = None\n    disabled: Union[bool, None] = None\n\n\nclass UserInDB(User):\n    hashed_password: str\n\n\npwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")\n\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")\n\napp = FastAPI()\n\n\ndef verify_password(plain_password, hashed_password):\n    return pwd_context.verify(plain_password, hashed_password)\n\n\ndef get_password_hash(password):\n    return pwd_context.hash(password)\n\n\ndef get_user(db, username: str):\n    if username in db:\n        user_dict = db[username]\n        return UserInDB(**user_dict)\n\n\ndef authenticate_user(fake_db, username: str, password: str):\n    user = get_user(fake_db, username)\n    if not user:\n        return False\n    if not verify_password(password, user.hashed_password):\n        return False\n    return user\n\n\ndef create_access_token(data: dict, expires_delta: Union[timedelta, None] = None):\nto_encode = data.copy()\nif expires_delta:\nexpire = datetime.utcnow() + expires_delta\nelse:\nexpire = datetime.utcnow() + timedelta(minutes=15)\nto_encode.update({\"exp\": expire})\nencoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)\nreturn encoded_jwt\nasync def get_current_user(token: str = Depends(oauth2_scheme)):\n    credentials_exception = HTTPException(\n        status_code=status.HTTP_401_UNAUTHORIZED,\n        detail=\"Could not validate credentials\",\n        headers={\"WWW-Authenticate\": \"Bearer\"},\n    )\n    try:\n        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])\n        username: str = payload.get(\"sub\")\n        if username is None:\n            raise credentials_exception\n        token_data = TokenData(username=username)\n    except JWTError:\n        raise credentials_exception\n    user = get_user(fake_users_db, username=token_data.username)\n    if user is None:\n        raise credentials_exception\n    return user\n\n\nasync def get_current_active_user(current_user: User = Depends(get_current_user)):\n    if current_user.disabled:\n        raise HTTPException(status_code=400, detail=\"Inactive user\")\n    return current_user\n\n\n@app.post(\"/token\", response_model=Token)\nasync def login_for_access_token(form_data: OAuth2PasswordRequestForm = Depends()):\n    user = authenticate_user(fake_users_db, form_data.username, form_data.password)\n    if not user:\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Incorrect username or password\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n    access_token_expires = timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)\n    access_token = create_access_token(\n        data={\"sub\": user.username}, expires_delta=access_token_expires\n    )\n    return {\"access_token\": access_token, \"token_type\": \"bearer\"}\n\n\n@app.get(\"/users/me/\", response_model=User)\nasync def read_users_me(current_user: User = Depends(get_current_active_user)):\n    return current_user\n\n\n@app.get(\"/users/me/items/\")\nasync def read_own_items(current_user: User = Depends(get_current_active_user)):\n    return [{\"item_id\": \"Foo\", \"owner\": current_user.username}]\n</code></pre>"},{"location":"tutorial/security/oauth2-jwt/#_4","title":"\u66f4\u65b0\u4f9d\u8d56\u9879","text":"<p>\u66f4\u65b0 <code>get_current_user</code> \u4ee5\u63a5\u6536\u4e0e\u4e4b\u524d\u76f8\u540c\u7684\u4ee4\u724c\uff0c\u4f46\u8fd9\u91cc\u7528\u7684\u662f JWT \u4ee4\u724c\u3002</p> <p>\u89e3\u7801\u5e76\u6821\u9a8c\u63a5\u6536\u5230\u7684\u4ee4\u724c\uff0c\u7136\u540e\uff0c\u8fd4\u56de\u5f53\u524d\u7528\u6237\u3002</p> <p>\u5982\u679c\u4ee4\u724c\u65e0\u6548\uff0c\u5219\u76f4\u63a5\u8fd4\u56de HTTP \u9519\u8bef\u3002</p> <pre><code>from datetime import datetime, timedelta\nfrom typing import Union\n\nfrom fastapi import Depends, FastAPI, HTTPException, status\nfrom fastapi.security import OAuth2PasswordBearer, OAuth2PasswordRequestForm\nfrom jose import JWTError, jwt\nfrom passlib.context import CryptContext\nfrom pydantic import BaseModel\n\n# to get a string like this run:\n# openssl rand -hex 32\nSECRET_KEY = \"09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7\"\nALGORITHM = \"HS256\"\nACCESS_TOKEN_EXPIRE_MINUTES = 30\n\n\nfake_users_db = {\n    \"johndoe\": {\n        \"username\": \"johndoe\",\n        \"full_name\": \"John Doe\",\n        \"email\": \"johndoe@example.com\",\n        \"hashed_password\": \"$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW\",\n        \"disabled\": False,\n    }\n}\n\n\nclass Token(BaseModel):\n    access_token: str\n    token_type: str\n\n\nclass TokenData(BaseModel):\n    username: Union[str, None] = None\n\n\nclass User(BaseModel):\n    username: str\n    email: Union[str, None] = None\n    full_name: Union[str, None] = None\n    disabled: Union[bool, None] = None\n\n\nclass UserInDB(User):\n    hashed_password: str\n\n\npwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")\n\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")\n\napp = FastAPI()\n\n\ndef verify_password(plain_password, hashed_password):\n    return pwd_context.verify(plain_password, hashed_password)\n\n\ndef get_password_hash(password):\n    return pwd_context.hash(password)\n\n\ndef get_user(db, username: str):\n    if username in db:\n        user_dict = db[username]\n        return UserInDB(**user_dict)\n\n\ndef authenticate_user(fake_db, username: str, password: str):\n    user = get_user(fake_db, username)\n    if not user:\n        return False\n    if not verify_password(password, user.hashed_password):\n        return False\n    return user\n\n\ndef create_access_token(data: dict, expires_delta: Union[timedelta, None] = None):\n    to_encode = data.copy()\n    if expires_delta:\n        expire = datetime.utcnow() + expires_delta\n    else:\n        expire = datetime.utcnow() + timedelta(minutes=15)\n    to_encode.update({\"exp\": expire})\n    encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)\n    return encoded_jwt\n\n\nasync def get_current_user(token: str = Depends(oauth2_scheme)):\ncredentials_exception = HTTPException(\nstatus_code=status.HTTP_401_UNAUTHORIZED,\ndetail=\"Could not validate credentials\",\nheaders={\"WWW-Authenticate\": \"Bearer\"},\n)\ntry:\npayload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])\nusername: str = payload.get(\"sub\")\nif username is None:\nraise credentials_exception\ntoken_data = TokenData(username=username)\nexcept JWTError:\nraise credentials_exception\nuser = get_user(fake_users_db, username=token_data.username)\nif user is None:\nraise credentials_exception\nreturn user\nasync def get_current_active_user(current_user: User = Depends(get_current_user)):\n    if current_user.disabled:\n        raise HTTPException(status_code=400, detail=\"Inactive user\")\n    return current_user\n\n\n@app.post(\"/token\", response_model=Token)\nasync def login_for_access_token(form_data: OAuth2PasswordRequestForm = Depends()):\n    user = authenticate_user(fake_users_db, form_data.username, form_data.password)\n    if not user:\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Incorrect username or password\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n    access_token_expires = timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)\n    access_token = create_access_token(\n        data={\"sub\": user.username}, expires_delta=access_token_expires\n    )\n    return {\"access_token\": access_token, \"token_type\": \"bearer\"}\n\n\n@app.get(\"/users/me/\", response_model=User)\nasync def read_users_me(current_user: User = Depends(get_current_active_user)):\n    return current_user\n\n\n@app.get(\"/users/me/items/\")\nasync def read_own_items(current_user: User = Depends(get_current_active_user)):\n    return [{\"item_id\": \"Foo\", \"owner\": current_user.username}]\n</code></pre>"},{"location":"tutorial/security/oauth2-jwt/#token","title":"\u66f4\u65b0 <code>/token</code> \u8def\u5f84\u64cd\u4f5c","text":"<p>\u7528\u4ee4\u724c\u8fc7\u671f\u65f6\u95f4\u521b\u5efa <code>timedelta</code> \u5bf9\u8c61\u3002</p> <p>\u521b\u5efa\u5e76\u8fd4\u56de\u771f\u6b63\u7684 JWT \u8bbf\u95ee\u4ee4\u724c\u3002</p> <pre><code>from datetime import datetime, timedelta\nfrom typing import Union\n\nfrom fastapi import Depends, FastAPI, HTTPException, status\nfrom fastapi.security import OAuth2PasswordBearer, OAuth2PasswordRequestForm\nfrom jose import JWTError, jwt\nfrom passlib.context import CryptContext\nfrom pydantic import BaseModel\n\n# to get a string like this run:\n# openssl rand -hex 32\nSECRET_KEY = \"09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7\"\nALGORITHM = \"HS256\"\nACCESS_TOKEN_EXPIRE_MINUTES = 30\n\n\nfake_users_db = {\n    \"johndoe\": {\n        \"username\": \"johndoe\",\n        \"full_name\": \"John Doe\",\n        \"email\": \"johndoe@example.com\",\n        \"hashed_password\": \"$2b$12$EixZaYVK1fsbw1ZfbX3OXePaWxn96p36WQoeG6Lruj3vjPGga31lW\",\n        \"disabled\": False,\n    }\n}\n\n\nclass Token(BaseModel):\n    access_token: str\n    token_type: str\n\n\nclass TokenData(BaseModel):\n    username: Union[str, None] = None\n\n\nclass User(BaseModel):\n    username: str\n    email: Union[str, None] = None\n    full_name: Union[str, None] = None\n    disabled: Union[bool, None] = None\n\n\nclass UserInDB(User):\n    hashed_password: str\n\n\npwd_context = CryptContext(schemes=[\"bcrypt\"], deprecated=\"auto\")\n\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")\n\napp = FastAPI()\n\n\ndef verify_password(plain_password, hashed_password):\n    return pwd_context.verify(plain_password, hashed_password)\n\n\ndef get_password_hash(password):\n    return pwd_context.hash(password)\n\n\ndef get_user(db, username: str):\n    if username in db:\n        user_dict = db[username]\n        return UserInDB(**user_dict)\n\n\ndef authenticate_user(fake_db, username: str, password: str):\n    user = get_user(fake_db, username)\n    if not user:\n        return False\n    if not verify_password(password, user.hashed_password):\n        return False\n    return user\n\n\ndef create_access_token(data: dict, expires_delta: Union[timedelta, None] = None):\n    to_encode = data.copy()\n    if expires_delta:\n        expire = datetime.utcnow() + expires_delta\n    else:\n        expire = datetime.utcnow() + timedelta(minutes=15)\n    to_encode.update({\"exp\": expire})\n    encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)\n    return encoded_jwt\n\n\nasync def get_current_user(token: str = Depends(oauth2_scheme)):\n    credentials_exception = HTTPException(\n        status_code=status.HTTP_401_UNAUTHORIZED,\n        detail=\"Could not validate credentials\",\n        headers={\"WWW-Authenticate\": \"Bearer\"},\n    )\n    try:\n        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])\n        username: str = payload.get(\"sub\")\n        if username is None:\n            raise credentials_exception\n        token_data = TokenData(username=username)\n    except JWTError:\n        raise credentials_exception\n    user = get_user(fake_users_db, username=token_data.username)\n    if user is None:\n        raise credentials_exception\n    return user\n\n\nasync def get_current_active_user(current_user: User = Depends(get_current_user)):\n    if current_user.disabled:\n        raise HTTPException(status_code=400, detail=\"Inactive user\")\n    return current_user\n\n\n@app.post(\"/token\", response_model=Token)\nasync def login_for_access_token(form_data: OAuth2PasswordRequestForm = Depends()):\nuser = authenticate_user(fake_users_db, form_data.username, form_data.password)\nif not user:\nraise HTTPException(\nstatus_code=status.HTTP_401_UNAUTHORIZED,\ndetail=\"Incorrect username or password\",\nheaders={\"WWW-Authenticate\": \"Bearer\"},\n)\naccess_token_expires = timedelta(minutes=ACCESS_TOKEN_EXPIRE_MINUTES)\naccess_token = create_access_token(\ndata={\"sub\": user.username}, expires_delta=access_token_expires\n)\nreturn {\"access_token\": access_token, \"token_type\": \"bearer\"}\n@app.get(\"/users/me/\", response_model=User)\nasync def read_users_me(current_user: User = Depends(get_current_active_user)):\n    return current_user\n\n\n@app.get(\"/users/me/items/\")\nasync def read_own_items(current_user: User = Depends(get_current_active_user)):\n    return [{\"item_id\": \"Foo\", \"owner\": current_user.username}]\n</code></pre>"},{"location":"tutorial/security/oauth2-jwt/#jwt-sub","title":"JWT <code>sub</code> \u7684\u6280\u672f\u7ec6\u8282","text":"<p>JWT \u89c4\u8303\u8fd8\u5305\u62ec <code>sub</code> \u952e\uff0c\u503c\u662f\u4ee4\u724c\u7684\u4e3b\u9898\u3002</p> <p>\u8be5\u952e\u662f\u53ef\u9009\u7684\uff0c\u4f46\u8981\u628a\u7528\u6237\u6807\u8bc6\u653e\u5728\u8fd9\u4e2a\u952e\u91cc\uff0c\u6240\u4ee5\u672c\u4f8b\u4f7f\u7528\u4e86\u8be5\u952e\u3002</p> <p>\u9664\u4e86\u8bc6\u522b\u7528\u6237\u4e0e\u8bb8\u53ef\u7528\u6237\u5728 API \u4e0a\u76f4\u63a5\u6267\u884c\u64cd\u4f5c\u4e4b\u5916\uff0cJWT \u8fd8\u53ef\u80fd\u7528\u4e8e\u5176\u5b83\u4e8b\u60c5\u3002</p> <p>\u4f8b\u5982\uff0c\u8bc6\u522b\u6c7d\u8f66\u6216\u535a\u5ba2\u3002</p> <p>\u63a5\u7740\uff0c\u4e3a\u5b9e\u4f53\u6dfb\u52a0\u6743\u9650\uff0c\u6bd4\u5982\u9a7e\u9a76\uff08\u6c7d\u8f66\uff09\u6216\u7f16\u8f91\uff08\u535a\u5ba2\uff09\u3002</p> <p>\u7136\u540e\uff0c\u628a JWT \u4ee4\u724c\u4ea4\u7ed9\u7528\u6237\uff08\u6216\u673a\u5668\u4eba\uff09\uff0c\u4ed6\u4eec\u5c31\u53ef\u4ee5\u6267\u884c\u9a7e\u9a76\u6c7d\u8f66\uff0c\u6216\u7f16\u8f91\u535a\u5ba2\u7b49\u64cd\u4f5c\u3002\u65e0\u9700\u6ce8\u518c\u8d26\u6237\uff0c\u53ea\u8981\u6709 API \u751f\u6210\u7684 JWT \u4ee4\u724c\u5c31\u53ef\u4ee5\u3002</p> <p>\u540c\u7406\uff0cJWT \u53ef\u4ee5\u7528\u4e8e\u66f4\u590d\u6742\u7684\u573a\u666f\u3002</p> <p>\u5728\u8fd9\u4e9b\u60c5\u51b5\u4e0b\uff0c\u591a\u4e2a\u5b9e\u4f53\u7684 ID \u53ef\u80fd\u662f\u76f8\u540c\u7684\uff0c\u4ee5 ID  <code>foo</code> \u4e3a\u4f8b\uff0c\u7528\u6237\u7684 ID \u662f <code>foo</code>\uff0c\u8f66\u7684 ID \u662f <code>foo</code>\uff0c\u535a\u5ba2\u7684 ID \u4e5f\u662f  <code>foo</code>\u3002</p> <p>\u4e3a\u4e86\u907f\u514d ID \u51b2\u7a81\uff0c\u5728\u7ed9\u7528\u6237\u521b\u5efa JWT \u4ee4\u724c\u65f6\uff0c\u53ef\u4ee5\u4e3a <code>sub</code> \u952e\u7684\u503c\u52a0\u4e0a\u524d\u7f00\uff0c\u4f8b\u5982 <code>username:</code>\u3002\u56e0\u6b64\uff0c\u5728\u672c\u4f8b\u4e2d\uff0c<code>sub</code> \u7684\u503c\u53ef\u4ee5\u662f\uff1a<code>username:johndoe</code>\u3002</p> <p>\u6ce8\u610f\uff0c\u5212\u91cd\u70b9\uff0c<code>sub</code> \u952e\u5728\u6574\u4e2a\u5e94\u7528\u4e2d\u5e94\u8be5\u53ea\u6709\u4e00\u4e2a\u552f\u4e00\u7684\u6807\u8bc6\u7b26\uff0c\u800c\u4e14\u5e94\u8be5\u662f\u5b57\u7b26\u4e32\u3002</p>"},{"location":"tutorial/security/oauth2-jwt/#_5","title":"\u68c0\u67e5","text":"<p>\u8fd0\u884c\u670d\u52a1\u5668\u5e76\u8bbf\u95ee\u6587\u6863\uff1a http://127.0.0.1:8000/docs\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\u5982\u4e0b\u7528\u6237\u754c\u9762\uff1a</p> <p></p> <p>\u7528\u4e0e\u4e0a\u4e00\u7ae0\u540c\u6837\u7684\u65b9\u5f0f\u5b9e\u73b0\u5e94\u7528\u6388\u6743\u3002</p> <p>\u4f7f\u7528\u5982\u4e0b\u51ed\u8bc1\uff1a</p> <p>\u7528\u6237\u540d: <code>johndoe</code> \u5bc6\u7801: <code>secret</code></p> <p>\u68c0\u67e5</p> <p>\u6ce8\u610f\uff0c\u4ee3\u7801\u4e2d\u6ca1\u6709\u660e\u6587\u5bc6\u7801<code>secret</code>\uff0c\u53ea\u4fdd\u5b58\u4e86\u5b83\u7684\u54c8\u5e0c\u503c\u3002</p> <p></p> <p>\u8c03\u7528 <code>/users/me/</code> \u7aef\u70b9\uff0c\u6536\u5230\u4e0b\u9762\u7684\u54cd\u5e94\uff1a</p> <pre><code>{\n\"username\": \"johndoe\",\n\"email\": \"johndoe@example.com\",\n\"full_name\": \"John Doe\",\n\"disabled\": false\n}\n</code></pre> <p></p> <p>\u6253\u5f00\u6d4f\u89c8\u5668\u7684\u5f00\u53d1\u8005\u5de5\u5177\uff0c\u67e5\u770b\u6570\u636e\u662f\u600e\u4e48\u53d1\u9001\u7684\uff0c\u800c\u4e14\u6570\u636e\u91cc\u53ea\u5305\u542b\u4e86\u4ee4\u724c\uff0c\u53ea\u6709\u9a8c\u8bc1\u7528\u6237\u7684\u7b2c\u4e00\u4e2a\u8bf7\u6c42\u624d\u53d1\u9001\u5bc6\u7801\uff0c\u5e76\u83b7\u53d6\u8bbf\u95ee\u4ee4\u724c\uff0c\u4f46\u4e4b\u540e\u4e0d\u4f1a\u518d\u53d1\u9001\u5bc6\u7801\uff1a</p> <p></p> <p>\u7b14\u8bb0</p> <p>\u6ce8\u610f\uff0c\u8bf7\u6c42\u4e2d <code>Authorization</code> \u54cd\u5e94\u5934\u7684\u503c\u4ee5 <code>Bearer</code> \u5f00\u5934\u3002</p>"},{"location":"tutorial/security/oauth2-jwt/#scopes","title":"<code>scopes</code> \u9ad8\u7ea7\u7528\u6cd5","text":"<p>OAuth2 \u652f\u6301<code>scopes</code>\uff08\u4f5c\u7528\u57df\uff09\u3002</p> <p><code>scopes</code>\u4e3a JWT \u4ee4\u724c\u6dfb\u52a0\u6307\u5b9a\u6743\u9650\u3002</p> <p>\u8ba9\u6301\u6709\u4ee4\u724c\u7684\u7528\u6237\u6216\u7b2c\u4e09\u65b9\u5728\u6307\u5b9a\u9650\u5236\u6761\u4ef6\u4e0b\u4e0e API \u4ea4\u4e92\u3002</p> <p>\u9ad8\u7ea7\u7528\u6237\u6307\u5357\u4e2d\u5c06\u4ecb\u7ecd\u5982\u4f55\u4f7f\u7528 <code>scopes</code>\uff0c\u53ca\u5982\u4f55\u628a <code>scopes</code> \u96c6\u6210\u81f3 FastAPI\u3002</p>"},{"location":"tutorial/security/oauth2-jwt/#_6","title":"\u5c0f\u7ed3","text":"<p>\u81f3\u6b64\uff0c\u60a8\u53ef\u4ee5\u4f7f\u7528 OAuth2 \u548c JWT \u7b49\u6807\u51c6\u914d\u7f6e\u5b89\u5168\u7684 FastAPI \u5e94\u7528\u3002</p> <p>\u51e0\u4e4e\u5728\u6240\u6709\u6846\u67b6\u4e2d\uff0c\u5904\u7406\u5b89\u5168\u95ee\u9898\u5f88\u5feb\u90fd\u4f1a\u53d8\u5f97\u975e\u5e38\u590d\u6742\u3002</p> <p>\u6709\u4e9b\u5305\u4e3a\u4e86\u7b80\u5316\u5b89\u5168\u6d41\uff0c\u4e0d\u5f97\u4e0d\u5728\u6570\u636e\u6a21\u578b\u3001\u6570\u636e\u5e93\u548c\u529f\u80fd\u4e0a\u505a\u51fa\u59a5\u534f\u3002\u800c\u6709\u4e9b\u8fc7\u4e8e\u7b80\u5316\u7684\u8f6f\u4ef6\u5305\u5176\u5b9e\u5b58\u5728\u4e86\u5b89\u5168\u9690\u60a3\u3002</p> <p>FastAPI \u4e0d\u5411\u4efb\u4f55\u6570\u636e\u5e93\u3001\u6570\u636e\u6a21\u578b\u6216\u5de5\u5177\u505a\u59a5\u534f\u3002</p> <p>\u5f00\u53d1\u8005\u53ef\u4ee5\u7075\u6d3b\u9009\u62e9\u6700\u9002\u5408\u9879\u76ee\u7684\u5b89\u5168\u673a\u5236\u3002</p> <p>\u8fd8\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 <code>passlib</code> \u548c <code>python-jose</code> \u7b49\u7ef4\u62a4\u826f\u597d\u3001\u4f7f\u7528\u5e7f\u6cdb\u7684\u5305\uff0c\u8fd9\u662f\u56e0\u4e3a FastAPI \u4e0d\u9700\u8981\u4efb\u4f55\u590d\u6742\u673a\u5236\uff0c\u5c31\u80fd\u96c6\u6210\u5916\u90e8\u7684\u5305\u3002</p> <p>\u800c\u4e14\uff0cFastAPI \u8fd8\u63d0\u4f9b\u4e86\u4e00\u4e9b\u5de5\u5177\uff0c\u5728\u4e0d\u5f71\u54cd\u7075\u6d3b\u3001\u7a33\u5b9a\u548c\u5b89\u5168\u7684\u524d\u63d0\u4e0b\uff0c\u5c3d\u53ef\u80fd\u5730\u7b80\u5316\u5b89\u5168\u673a\u5236\u3002</p> <p>FastAPI \u8fd8\u652f\u6301\u4ee5\u76f8\u5bf9\u7b80\u5355\u7684\u65b9\u5f0f\uff0c\u4f7f\u7528 OAuth2 \u7b49\u5b89\u5168\u3001\u6807\u51c6\u7684\u534f\u8bae\u3002</p> <p>\u9ad8\u7ea7\u7528\u6237\u6307\u5357\u4e2d\u8be6\u7ec6\u4ecb\u7ecd\u4e86 OAuth2<code>scopes</code>\u7684\u5185\u5bb9\uff0c\u9075\u5faa\u540c\u6837\u7684\u6807\u51c6\uff0c\u5b9e\u73b0\u66f4\u7cbe\u5bc6\u7684\u6743\u9650\u7cfb\u7edf\u3002OAuth2 \u7684\u4f5c\u7528\u57df\u662f\u8138\u4e66\u3001\u8c37\u6b4c\u3001GitHub\u3001\u5fae\u8f6f\u3001\u63a8\u7279\u7b49\u7b2c\u4e09\u65b9\u8eab\u4efd\u9a8c\u8bc1\u5e94\u7528\u4f7f\u7528\u7684\u673a\u5236\uff0c\u8ba9\u7528\u6237\u6388\u6743\u7b2c\u4e09\u65b9\u5e94\u7528\u4e0e API \u4ea4\u4e92\u3002</p>"},{"location":"tutorial/security/simple-oauth2/","title":"\u4f7f\u7528\u5bc6\u7801\u548c Bearer \u7684\u7b80\u5355 OAuth2","text":"<p>\u73b0\u5728\u8ba9\u6211\u4eec\u63a5\u7740\u4e0a\u4e00\u7ae0\u7ee7\u7eed\u5f00\u53d1\uff0c\u5e76\u6dfb\u52a0\u7f3a\u5c11\u7684\u90e8\u5206\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u5b8c\u6574\u7684\u5b89\u5168\u6027\u6d41\u7a0b\u3002</p>"},{"location":"tutorial/security/simple-oauth2/#username-password","title":"\u83b7\u53d6 <code>username</code> \u548c <code>password</code>","text":"<p>\u6211\u4eec\u5c06\u4f7f\u7528 FastAPI \u7684\u5b89\u5168\u6027\u5b9e\u7528\u5de5\u5177\u6765\u83b7\u53d6 <code>username</code> \u548c <code>password</code>\u3002</p> <p>OAuth2 \u89c4\u5b9a\u5728\u4f7f\u7528\uff08\u6211\u4eec\u6253\u7b97\u7528\u7684\uff09\u300cpassword \u6d41\u7a0b\u300d\u65f6\uff0c\u5ba2\u6237\u7aef/\u7528\u6237\u5fc5\u987b\u5c06 <code>username</code> \u548c <code>password</code> \u5b57\u6bb5\u4f5c\u4e3a\u8868\u5355\u6570\u636e\u53d1\u9001\u3002</p> <p>\u800c\u4e14\u89c4\u8303\u660e\u786e\u4e86\u5b57\u6bb5\u5fc5\u987b\u8fd9\u6837\u547d\u540d\u3002\u56e0\u6b64 <code>user-name</code> \u6216 <code>email</code> \u662f\u884c\u4e0d\u901a\u7684\u3002</p> <p>\u4e0d\u8fc7\u4e0d\u7528\u62c5\u5fc3\uff0c\u4f60\u53ef\u4ee5\u5728\u524d\u7aef\u6309\u7167\u4f60\u7684\u60f3\u6cd5\u5c06\u5b83\u5c55\u793a\u7ed9\u6700\u7ec8\u7528\u6237\u3002</p> <p>\u800c\u4e14\u4f60\u7684\u6570\u636e\u5e93\u6a21\u578b\u4e5f\u53ef\u4ee5\u4f7f\u7528\u4f60\u60f3\u7528\u7684\u4efb\u4f55\u5176\u4ed6\u540d\u79f0\u3002</p> <p>\u4f46\u662f\u5bf9\u4e8e\u767b\u5f55\u8def\u5f84\u64cd\u4f5c\uff0c\u6211\u4eec\u9700\u8981\u4f7f\u7528\u8fd9\u4e9b\u540d\u79f0\u6765\u4e0e\u89c4\u8303\u517c\u5bb9\uff08\u4ee5\u5177\u5907\u4f8b\u5982\u4f7f\u7528\u96c6\u6210\u7684 API \u6587\u6863\u7cfb\u7edf\u7684\u80fd\u529b\uff09\u3002</p> <p>\u89c4\u8303\u8fd8\u5199\u660e\u4e86 <code>username</code> \u548c <code>password</code> \u5fc5\u987b\u4f5c\u4e3a\u8868\u5355\u6570\u636e\u53d1\u9001\uff08\u56e0\u6b64\uff0c\u6b64\u5904\u4e0d\u80fd\u4f7f\u7528 JSON\uff09\u3002</p>"},{"location":"tutorial/security/simple-oauth2/#scope","title":"<code>scope</code>","text":"<p>\u89c4\u8303\u8fd8\u63d0\u5230\u5ba2\u6237\u7aef\u53ef\u4ee5\u53d1\u9001\u53e6\u4e00\u4e2a\u8868\u5355\u5b57\u6bb5\u300c<code>scope</code>\u300d\u3002</p> <p>\u8fd9\u4e2a\u8868\u5355\u5b57\u6bb5\u7684\u540d\u79f0\u4e3a <code>scope</code>\uff08\u5355\u6570\u5f62\u5f0f\uff09\uff0c\u4f46\u5b9e\u9645\u4e0a\u5b83\u662f\u4e00\u4e2a\u7531\u7a7a\u683c\u5206\u9694\u7684\u300c\u4f5c\u7528\u57df\u300d\u7ec4\u6210\u7684\u957f\u5b57\u7b26\u4e32\u3002</p> <p>\u6bcf\u4e2a\u300c\u4f5c\u7528\u57df\u300d\u53ea\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff08\u4e2d\u95f4\u6ca1\u6709\u7a7a\u683c\uff09\u3002</p> <p>\u5b83\u4eec\u901a\u5e38\u7528\u4e8e\u58f0\u660e\u7279\u5b9a\u7684\u5b89\u5168\u6743\u9650\uff0c\u4f8b\u5982\uff1a</p> <ul> <li><code>users:read</code> \u6216\u8005 <code>users:write</code> \u662f\u5e38\u89c1\u7684\u4f8b\u5b50\u3002</li> <li>Facebook / Instagram \u4f7f\u7528 <code>instagram_basic</code>\u3002</li> <li>Google \u4f7f\u7528\u4e86 <code>https://www.googleapis.com/auth/drive</code> \u3002</li> </ul> <p>Info</p> <p>\u5728 OAuth2 \u4e2d\u300c\u4f5c\u7528\u57df\u300d\u53ea\u662f\u4e00\u4e2a\u58f0\u660e\u6240\u9700\u7279\u5b9a\u6743\u9650\u7684\u5b57\u7b26\u4e32\u3002</p> <p>\u5b83\u6709\u6ca1\u6709 <code>:</code> \u8fd9\u6837\u7684\u5176\u4ed6\u5b57\u7b26\u6216\u8005\u662f\u4e0d\u662f URL \u90fd\u6ca1\u6709\u5173\u7cfb\u3002</p> <p>\u8fd9\u4e9b\u7ec6\u8282\u662f\u5177\u4f53\u7684\u5b9e\u73b0\u3002</p> <p>\u5bf9 OAuth2 \u6765\u8bf4\u5b83\u4eec\u5c31\u53ea\u662f\u5b57\u7b26\u4e32\u800c\u5df2\u3002</p>"},{"location":"tutorial/security/simple-oauth2/#username-password_1","title":"\u83b7\u53d6 <code>username</code> \u548c <code>password</code> \u7684\u4ee3\u7801","text":"<p>\u73b0\u5728\uff0c\u8ba9\u6211\u4eec\u4f7f\u7528 FastAPI \u63d0\u4f9b\u7684\u5b9e\u7528\u5de5\u5177\u6765\u5904\u7406\u6b64\u95ee\u9898\u3002</p>"},{"location":"tutorial/security/simple-oauth2/#oauth2passwordrequestform","title":"<code>OAuth2PasswordRequestForm</code>","text":"<p>\u9996\u5148\uff0c\u5bfc\u5165 <code>OAuth2PasswordRequestForm</code>\uff0c\u7136\u540e\u5728 <code>token</code> \u7684\u8def\u5f84\u64cd\u4f5c\u4e2d\u901a\u8fc7 <code>Depends</code> \u5c06\u5176\u4f5c\u4e3a\u4f9d\u8d56\u9879\u4f7f\u7528\u3002</p> <pre><code>from typing import Union\n\nfrom fastapi import Depends, FastAPI, HTTPException, status\nfrom fastapi.security import OAuth2PasswordBearer, OAuth2PasswordRequestForm\nfrom pydantic import BaseModel\n\nfake_users_db = {\n    \"johndoe\": {\n        \"username\": \"johndoe\",\n        \"full_name\": \"John Doe\",\n        \"email\": \"johndoe@example.com\",\n        \"hashed_password\": \"fakehashedsecret\",\n        \"disabled\": False,\n    },\n    \"alice\": {\n        \"username\": \"alice\",\n        \"full_name\": \"Alice Wonderson\",\n        \"email\": \"alice@example.com\",\n        \"hashed_password\": \"fakehashedsecret2\",\n        \"disabled\": True,\n    },\n}\n\napp = FastAPI()\n\n\ndef fake_hash_password(password: str):\n    return \"fakehashed\" + password\n\n\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")\n\n\nclass User(BaseModel):\n    username: str\n    email: Union[str, None] = None\n    full_name: Union[str, None] = None\n    disabled: Union[bool, None] = None\n\n\nclass UserInDB(User):\n    hashed_password: str\n\n\ndef get_user(db, username: str):\n    if username in db:\n        user_dict = db[username]\n        return UserInDB(**user_dict)\n\n\ndef fake_decode_token(token):\n    # This doesn't provide any security at all\n    # Check the next version\n    user = get_user(fake_users_db, token)\n    return user\n\n\nasync def get_current_user(token: str = Depends(oauth2_scheme)):\n    user = fake_decode_token(token)\n    if not user:\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Invalid authentication credentials\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n    return user\n\n\nasync def get_current_active_user(current_user: User = Depends(get_current_user)):\n    if current_user.disabled:\n        raise HTTPException(status_code=400, detail=\"Inactive user\")\n    return current_user\n\n\n@app.post(\"/token\")\nasync def login(form_data: OAuth2PasswordRequestForm = Depends()):\nuser_dict = fake_users_db.get(form_data.username)\n    if not user_dict:\n        raise HTTPException(status_code=400, detail=\"Incorrect username or password\")\n    user = UserInDB(**user_dict)\n    hashed_password = fake_hash_password(form_data.password)\n    if not hashed_password == user.hashed_password:\n        raise HTTPException(status_code=400, detail=\"Incorrect username or password\")\n\n    return {\"access_token\": user.username, \"token_type\": \"bearer\"}\n\n\n@app.get(\"/users/me\")\nasync def read_users_me(current_user: User = Depends(get_current_active_user)):\n    return current_user\n</code></pre> <p><code>OAuth2PasswordRequestForm</code> \u662f\u4e00\u4e2a\u7c7b\u4f9d\u8d56\u9879\uff0c\u58f0\u660e\u4e86\u5982\u4e0b\u7684\u8bf7\u6c42\u8868\u5355\uff1a</p> <ul> <li><code>username</code>\u3002</li> <li><code>password</code>\u3002</li> <li>\u4e00\u4e2a\u53ef\u9009\u7684 <code>scope</code> \u5b57\u6bb5\uff0c\u662f\u4e00\u4e2a\u7531\u7a7a\u683c\u5206\u9694\u7684\u5b57\u7b26\u4e32\u7ec4\u6210\u7684\u5927\u5b57\u7b26\u4e32\u3002</li> <li>\u4e00\u4e2a\u53ef\u9009\u7684 <code>grant_type</code>.</li> </ul> <p>Tip</p> <p>OAuth2 \u89c4\u8303\u5b9e\u9645\u4e0a\u8981\u6c42 <code>grant_type</code> \u5b57\u6bb5\u4f7f\u7528\u4e00\u4e2a\u56fa\u5b9a\u7684\u503c <code>password</code>\uff0c\u4f46\u662f <code>OAuth2PasswordRequestForm</code> \u6ca1\u6709\u4f5c\u5f3a\u5236\u7ea6\u675f\u3002</p> <p>\u5982\u679c\u4f60\u9700\u8981\u5f3a\u5236\u8981\u6c42\u8fd9\u4e00\u70b9\uff0c\u8bf7\u4f7f\u7528 <code>OAuth2PasswordRequestFormStrict</code> \u800c\u4e0d\u662f <code>OAuth2PasswordRequestForm</code>\u3002</p> <ul> <li>\u4e00\u4e2a\u53ef\u9009\u7684 <code>client_id</code>\uff08\u6211\u4eec\u7684\u793a\u4f8b\u4e0d\u9700\u8981\u5b83\uff09\u3002</li> <li>\u4e00\u4e2a\u53ef\u9009\u7684 <code>client_secret</code>\uff08\u6211\u4eec\u7684\u793a\u4f8b\u4e0d\u9700\u8981\u5b83\uff09\u3002</li> </ul> <p>Info</p> <p><code>OAuth2PasswordRequestForm</code> \u5e76\u4e0d\u50cf <code>OAuth2PasswordBearer</code> \u4e00\u6837\u662f FastAPI \u7684\u4e00\u4e2a\u7279\u6b8a\u7684\u7c7b\u3002</p> <p><code>OAuth2PasswordBearer</code> \u4f7f\u5f97 FastAPI \u660e\u767d\u5b83\u662f\u4e00\u4e2a\u5b89\u5168\u65b9\u6848\u3002\u6240\u4ee5\u5b83\u5f97\u4ee5\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u6dfb\u52a0\u5230 OpenAPI \u4e2d\u3002</p> <p>\u4f46 <code>OAuth2PasswordRequestForm</code> \u53ea\u662f\u4e00\u4e2a\u4f60\u53ef\u4ee5\u81ea\u5df1\u7f16\u5199\u7684\u7c7b\u4f9d\u8d56\u9879\uff0c\u6216\u8005\u4f60\u4e5f\u53ef\u4ee5\u76f4\u63a5\u58f0\u660e <code>Form</code> \u53c2\u6570\u3002</p> <p>\u4f46\u662f\u7531\u4e8e\u8fd9\u662f\u4e00\u79cd\u5e38\u89c1\u7684\u4f7f\u7528\u573a\u666f\uff0c\u56e0\u6b64 FastAPI \u51fa\u4e8e\u7b80\u4fbf\u76f4\u63a5\u63d0\u4f9b\u4e86\u5b83\u3002</p>"},{"location":"tutorial/security/simple-oauth2/#_1","title":"\u4f7f\u7528\u8868\u5355\u6570\u636e","text":"<p>Tip</p> <p>\u7c7b\u4f9d\u8d56\u9879 <code>OAuth2PasswordRequestForm</code> \u7684\u5b9e\u4f8b\u4e0d\u4f1a\u6709\u7528\u7a7a\u683c\u5206\u9694\u7684\u957f\u5b57\u7b26\u4e32\u5c5e\u6027 <code>scope</code>\uff0c\u800c\u662f\u5177\u6709\u4e00\u4e2a <code>scopes</code> \u5c5e\u6027\uff0c\u8be5\u5c5e\u6027\u5c06\u5305\u542b\u5b9e\u9645\u88ab\u53d1\u9001\u7684\u6bcf\u4e2a\u4f5c\u7528\u57df\u5b57\u7b26\u4e32\u7ec4\u6210\u7684\u5217\u8868\u3002</p> <p>\u5728\u6b64\u793a\u4f8b\u4e2d\u6211\u4eec\u6ca1\u6709\u4f7f\u7528 <code>scopes</code>\uff0c\u4f46\u5982\u679c\u4f60\u9700\u8981\u7684\u8bdd\u53ef\u4ee5\u4f7f\u7528\u8be5\u529f\u80fd\u3002</p> <p>\u73b0\u5728\uff0c\u4f7f\u7528\u8868\u5355\u5b57\u6bb5\u4e2d\u7684 <code>username</code> \u4ece\uff08\u4f2a\uff09\u6570\u636e\u5e93\u4e2d\u83b7\u53d6\u7528\u6237\u6570\u636e\u3002</p> <p>\u5982\u679c\u6ca1\u6709\u8fd9\u4e2a\u7528\u6237\uff0c\u6211\u4eec\u5c06\u8fd4\u56de\u4e00\u4e2a\u9519\u8bef\u6d88\u606f\uff0c\u63d0\u793a\u300c\u7528\u6237\u540d\u6216\u5bc6\u7801\u9519\u8bef\u300d\u3002</p> <p>\u5bf9\u4e8e\u8fd9\u4e2a\u9519\u8bef\uff0c\u6211\u4eec\u4f7f\u7528 <code>HTTPException</code> \u5f02\u5e38\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import Depends, FastAPI, HTTPException, status\nfrom fastapi.security import OAuth2PasswordBearer, OAuth2PasswordRequestForm\nfrom pydantic import BaseModel\n\nfake_users_db = {\n    \"johndoe\": {\n        \"username\": \"johndoe\",\n        \"full_name\": \"John Doe\",\n        \"email\": \"johndoe@example.com\",\n        \"hashed_password\": \"fakehashedsecret\",\n        \"disabled\": False,\n    },\n    \"alice\": {\n        \"username\": \"alice\",\n        \"full_name\": \"Alice Wonderson\",\n        \"email\": \"alice@example.com\",\n        \"hashed_password\": \"fakehashedsecret2\",\n        \"disabled\": True,\n    },\n}\n\napp = FastAPI()\n\n\ndef fake_hash_password(password: str):\n    return \"fakehashed\" + password\n\n\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")\n\n\nclass User(BaseModel):\n    username: str\n    email: Union[str, None] = None\n    full_name: Union[str, None] = None\n    disabled: Union[bool, None] = None\n\n\nclass UserInDB(User):\n    hashed_password: str\n\n\ndef get_user(db, username: str):\n    if username in db:\n        user_dict = db[username]\n        return UserInDB(**user_dict)\n\n\ndef fake_decode_token(token):\n    # This doesn't provide any security at all\n    # Check the next version\n    user = get_user(fake_users_db, token)\n    return user\n\n\nasync def get_current_user(token: str = Depends(oauth2_scheme)):\n    user = fake_decode_token(token)\n    if not user:\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Invalid authentication credentials\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n    return user\n\n\nasync def get_current_active_user(current_user: User = Depends(get_current_user)):\n    if current_user.disabled:\n        raise HTTPException(status_code=400, detail=\"Inactive user\")\n    return current_user\n\n\n@app.post(\"/token\")\nasync def login(form_data: OAuth2PasswordRequestForm = Depends()):\nuser_dict = fake_users_db.get(form_data.username)\nif not user_dict:\nraise HTTPException(status_code=400, detail=\"Incorrect username or password\")\nuser = UserInDB(**user_dict)\n    hashed_password = fake_hash_password(form_data.password)\n    if not hashed_password == user.hashed_password:\n        raise HTTPException(status_code=400, detail=\"Incorrect username or password\")\n\n    return {\"access_token\": user.username, \"token_type\": \"bearer\"}\n\n\n@app.get(\"/users/me\")\nasync def read_users_me(current_user: User = Depends(get_current_active_user)):\n    return current_user\n</code></pre>"},{"location":"tutorial/security/simple-oauth2/#_2","title":"\u6821\u9a8c\u5bc6\u7801","text":"<p>\u76ee\u524d\u6211\u4eec\u5df2\u7ecf\u4ece\u6570\u636e\u5e93\u4e2d\u83b7\u53d6\u4e86\u7528\u6237\u6570\u636e\uff0c\u4f46\u5c1a\u672a\u6821\u9a8c\u5bc6\u7801\u3002</p> <p>\u8ba9\u6211\u4eec\u9996\u5148\u5c06\u8fd9\u4e9b\u6570\u636e\u653e\u5165 Pydantic <code>UserInDB</code> \u6a21\u578b\u4e2d\u3002</p> <p>\u6c38\u8fdc\u4e0d\u8981\u4fdd\u5b58\u660e\u6587\u5bc6\u7801\uff0c\u56e0\u6b64\uff0c\u6211\u4eec\u5c06\u4f7f\u7528\uff08\u4f2a\uff09\u54c8\u5e0c\u5bc6\u7801\u7cfb\u7edf\u3002</p> <p>\u5982\u679c\u5bc6\u7801\u4e0d\u5339\u914d\uff0c\u6211\u4eec\u5c06\u8fd4\u56de\u540c\u4e00\u4e2a\u9519\u8bef\u3002</p>"},{"location":"tutorial/security/simple-oauth2/#_3","title":"\u54c8\u5e0c\u5bc6\u7801","text":"<p>\u300c\u54c8\u5e0c\u300d\u7684\u610f\u601d\u662f\uff1a\u5c06\u67d0\u4e9b\u5185\u5bb9\uff08\u5728\u672c\u4f8b\u4e2d\u4e3a\u5bc6\u7801\uff09\u8f6c\u6362\u4e3a\u770b\u8d77\u6765\u50cf\u4e71\u7801\u7684\u5b57\u8282\u5e8f\u5217\uff08\u53ea\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff09\u3002</p> <p>\u6bcf\u6b21\u4f60\u4f20\u5165\u5b8c\u5168\u76f8\u540c\u7684\u5185\u5bb9\uff08\u5b8c\u5168\u76f8\u540c\u7684\u5bc6\u7801\uff09\u65f6\uff0c\u4f60\u90fd\u4f1a\u5f97\u5230\u5b8c\u5168\u76f8\u540c\u7684\u4e71\u7801\u3002</p> <p>\u4f46\u662f\u4f60\u4e0d\u80fd\u4ece\u4e71\u7801\u8f6c\u6362\u56de\u5bc6\u7801\u3002</p>"},{"location":"tutorial/security/simple-oauth2/#_4","title":"\u4e3a\u4ec0\u4e48\u4f7f\u7528\u54c8\u5e0c\u5bc6\u7801","text":"<p>\u5982\u679c\u4f60\u7684\u6570\u636e\u5e93\u88ab\u76d7\uff0c\u5c0f\u5077\u5c06\u65e0\u6cd5\u83b7\u5f97\u7528\u6237\u7684\u660e\u6587\u5bc6\u7801\uff0c\u53ea\u6709\u54c8\u5e0c\u503c\u3002</p> <p>\u56e0\u6b64\uff0c\u5c0f\u5077\u5c06\u65e0\u6cd5\u5c1d\u8bd5\u5728\u53e6\u4e00\u4e2a\u7cfb\u7edf\u4e2d\u4f7f\u7528\u8fd9\u4e9b\u76f8\u540c\u7684\u5bc6\u7801\uff08\u7531\u4e8e\u8bb8\u591a\u7528\u6237\u5728\u4efb\u4f55\u5730\u65b9\u90fd\u4f7f\u7528\u76f8\u540c\u7684\u5bc6\u7801\uff0c\u56e0\u6b64\u8fd9\u5f88\u5371\u9669\uff09\u3002</p> <pre><code>from typing import Union\n\nfrom fastapi import Depends, FastAPI, HTTPException, status\nfrom fastapi.security import OAuth2PasswordBearer, OAuth2PasswordRequestForm\nfrom pydantic import BaseModel\n\nfake_users_db = {\n    \"johndoe\": {\n        \"username\": \"johndoe\",\n        \"full_name\": \"John Doe\",\n        \"email\": \"johndoe@example.com\",\n        \"hashed_password\": \"fakehashedsecret\",\n        \"disabled\": False,\n    },\n    \"alice\": {\n        \"username\": \"alice\",\n        \"full_name\": \"Alice Wonderson\",\n        \"email\": \"alice@example.com\",\n        \"hashed_password\": \"fakehashedsecret2\",\n        \"disabled\": True,\n    },\n}\n\napp = FastAPI()\n\n\ndef fake_hash_password(password: str):\n    return \"fakehashed\" + password\n\n\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")\n\n\nclass User(BaseModel):\n    username: str\n    email: Union[str, None] = None\n    full_name: Union[str, None] = None\n    disabled: Union[bool, None] = None\n\n\nclass UserInDB(User):\n    hashed_password: str\n\n\ndef get_user(db, username: str):\n    if username in db:\n        user_dict = db[username]\n        return UserInDB(**user_dict)\n\n\ndef fake_decode_token(token):\n    # This doesn't provide any security at all\n    # Check the next version\n    user = get_user(fake_users_db, token)\n    return user\n\n\nasync def get_current_user(token: str = Depends(oauth2_scheme)):\n    user = fake_decode_token(token)\n    if not user:\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Invalid authentication credentials\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n    return user\n\n\nasync def get_current_active_user(current_user: User = Depends(get_current_user)):\n    if current_user.disabled:\n        raise HTTPException(status_code=400, detail=\"Inactive user\")\n    return current_user\n\n\n@app.post(\"/token\")\nasync def login(form_data: OAuth2PasswordRequestForm = Depends()):\n    user_dict = fake_users_db.get(form_data.username)\n    if not user_dict:\n        raise HTTPException(status_code=400, detail=\"Incorrect username or password\")\nuser = UserInDB(**user_dict)\nhashed_password = fake_hash_password(form_data.password)\nif not hashed_password == user.hashed_password:\nraise HTTPException(status_code=400, detail=\"Incorrect username or password\")\nreturn {\"access_token\": user.username, \"token_type\": \"bearer\"}\n\n\n@app.get(\"/users/me\")\nasync def read_users_me(current_user: User = Depends(get_current_active_user)):\n    return current_user\n</code></pre>"},{"location":"tutorial/security/simple-oauth2/#user_dict","title":"\u5173\u4e8e <code>**user_dict</code>","text":"<p><code>UserInDB(**user_dict)</code> \u8868\u793a\uff1a</p> <p>\u76f4\u63a5\u5c06 <code>user_dict</code> \u7684\u952e\u548c\u503c\u4f5c\u4e3a\u5173\u952e\u5b57\u53c2\u6570\u4f20\u9012\uff0c\u7b49\u540c\u4e8e\uff1a</p> <pre><code>UserInDB(\n    username = user_dict[\"username\"],\n    email = user_dict[\"email\"],\n    full_name = user_dict[\"full_name\"],\n    disabled = user_dict[\"disabled\"],\n    hashed_password = user_dict[\"hashed_password\"],\n)\n</code></pre> <p>Info</p> <p>\u6709\u5173 <code>user_dict</code> \u7684\u66f4\u5b8c\u6574\u8bf4\u660e\uff0c\u8bf7\u53c2\u9605\u989d\u5916\u7684\u6a21\u578b\u6587\u6863\u3002</p>"},{"location":"tutorial/security/simple-oauth2/#_5","title":"\u8fd4\u56de\u4ee4\u724c","text":"<p><code>token</code> \u7aef\u70b9\u7684\u54cd\u5e94\u5fc5\u987b\u662f\u4e00\u4e2a JSON \u5bf9\u8c61\u3002</p> <p>\u5b83\u5e94\u8be5\u6709\u4e00\u4e2a <code>token_type</code>\u3002\u5728\u6211\u4eec\u7684\u4f8b\u5b50\u4e2d\uff0c\u7531\u4e8e\u6211\u4eec\u4f7f\u7528\u7684\u662f\u300cBearer\u300d\u4ee4\u724c\uff0c\u56e0\u6b64\u4ee4\u724c\u7c7b\u578b\u5e94\u4e3a\u300c<code>bearer</code>\u300d\u3002</p> <p>\u5e76\u4e14\u8fd8\u5e94\u8be5\u6709\u4e00\u4e2a <code>access_token</code> \u5b57\u6bb5\uff0c\u5b83\u662f\u4e00\u4e2a\u5305\u542b\u6211\u4eec\u7684\u8bbf\u95ee\u4ee4\u724c\u7684\u5b57\u7b26\u4e32\u3002</p> <p>\u5bf9\u4e8e\u8fd9\u4e2a\u7b80\u5355\u7684\u793a\u4f8b\uff0c\u6211\u4eec\u5c06\u6781\u5176\u4e0d\u5b89\u5168\u5730\u8fd4\u56de\u76f8\u540c\u7684 <code>username</code> \u4f5c\u4e3a\u4ee4\u724c\u3002</p> <p>Tip</p> <p>\u5728\u4e0b\u4e00\u7ae0\u4e2d\uff0c\u4f60\u5c06\u770b\u5230\u4e00\u4e2a\u771f\u5b9e\u7684\u5b89\u5168\u5b9e\u73b0\uff0c\u4f7f\u7528\u4e86\u54c8\u5e0c\u5bc6\u7801\u548c JWT \u4ee4\u724c\u3002</p> <p>\u4f46\u73b0\u5728\uff0c\u8ba9\u6211\u4eec\u4ec5\u5173\u6ce8\u6211\u4eec\u9700\u8981\u7684\u7279\u5b9a\u7ec6\u8282\u3002</p> <pre><code>from typing import Union\n\nfrom fastapi import Depends, FastAPI, HTTPException, status\nfrom fastapi.security import OAuth2PasswordBearer, OAuth2PasswordRequestForm\nfrom pydantic import BaseModel\n\nfake_users_db = {\n    \"johndoe\": {\n        \"username\": \"johndoe\",\n        \"full_name\": \"John Doe\",\n        \"email\": \"johndoe@example.com\",\n        \"hashed_password\": \"fakehashedsecret\",\n        \"disabled\": False,\n    },\n    \"alice\": {\n        \"username\": \"alice\",\n        \"full_name\": \"Alice Wonderson\",\n        \"email\": \"alice@example.com\",\n        \"hashed_password\": \"fakehashedsecret2\",\n        \"disabled\": True,\n    },\n}\n\napp = FastAPI()\n\n\ndef fake_hash_password(password: str):\n    return \"fakehashed\" + password\n\n\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")\n\n\nclass User(BaseModel):\n    username: str\n    email: Union[str, None] = None\n    full_name: Union[str, None] = None\n    disabled: Union[bool, None] = None\n\n\nclass UserInDB(User):\n    hashed_password: str\n\n\ndef get_user(db, username: str):\n    if username in db:\n        user_dict = db[username]\n        return UserInDB(**user_dict)\n\n\ndef fake_decode_token(token):\n    # This doesn't provide any security at all\n    # Check the next version\n    user = get_user(fake_users_db, token)\n    return user\n\n\nasync def get_current_user(token: str = Depends(oauth2_scheme)):\n    user = fake_decode_token(token)\n    if not user:\n        raise HTTPException(\n            status_code=status.HTTP_401_UNAUTHORIZED,\n            detail=\"Invalid authentication credentials\",\n            headers={\"WWW-Authenticate\": \"Bearer\"},\n        )\n    return user\n\n\nasync def get_current_active_user(current_user: User = Depends(get_current_user)):\n    if current_user.disabled:\n        raise HTTPException(status_code=400, detail=\"Inactive user\")\n    return current_user\n\n\n@app.post(\"/token\")\nasync def login(form_data: OAuth2PasswordRequestForm = Depends()):\n    user_dict = fake_users_db.get(form_data.username)\n    if not user_dict:\n        raise HTTPException(status_code=400, detail=\"Incorrect username or password\")\n    user = UserInDB(**user_dict)\n    hashed_password = fake_hash_password(form_data.password)\n    if not hashed_password == user.hashed_password:\n        raise HTTPException(status_code=400, detail=\"Incorrect username or password\")\n\nreturn {\"access_token\": user.username, \"token_type\": \"bearer\"}\n@app.get(\"/users/me\")\nasync def read_users_me(current_user: User = Depends(get_current_active_user)):\n    return current_user\n</code></pre> <p>Tip</p> <p>\u6839\u636e\u89c4\u8303\uff0c\u4f60\u5e94\u8be5\u50cf\u672c\u793a\u4f8b\u4e00\u6837\uff0c\u8fd4\u56de\u4e00\u4e2a\u5e26\u6709 <code>access_token</code> \u548c <code>token_type</code> \u7684 JSON\u3002</p> <p>\u8fd9\u662f\u4f60\u5fc5\u987b\u5728\u4ee3\u7801\u4e2d\u81ea\u884c\u5b8c\u6210\u7684\u5de5\u4f5c\uff0c\u5e76\u4e14\u8981\u786e\u4fdd\u4f7f\u7528\u4e86\u8fd9\u4e9b JSON \u5b57\u6bb5\u3002</p> <p>\u8fd9\u51e0\u4e4e\u662f\u552f\u4e00\u7684\u4f60\u9700\u8981\u81ea\u5df1\u8bb0\u4f4f\u5e76\u6b63\u786e\u5730\u6267\u884c\u4ee5\u7b26\u5408\u89c4\u8303\u7684\u4e8b\u60c5\u3002</p> <p>\u5176\u4f59\u7684\uff0cFastAPI \u90fd\u4f1a\u4e3a\u4f60\u5904\u7406\u3002</p>"},{"location":"tutorial/security/simple-oauth2/#_6","title":"\u66f4\u65b0\u4f9d\u8d56\u9879","text":"<p>\u73b0\u5728\u6211\u4eec\u5c06\u66f4\u65b0\u6211\u4eec\u7684\u4f9d\u8d56\u9879\u3002</p> <p>\u6211\u4eec\u60f3\u8981\u4ec5\u5f53\u6b64\u7528\u6237\u5904\u4e8e\u542f\u7528\u72b6\u6001\u65f6\u624d\u80fd\u83b7\u53d6 <code>current_user</code>\u3002</p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u521b\u5efa\u4e86\u4e00\u4e2a\u989d\u5916\u7684\u4f9d\u8d56\u9879 <code>get_current_active_user</code>\uff0c\u800c\u8be5\u4f9d\u8d56\u9879\u53c8\u4ee5 <code>get_current_user</code> \u4f5c\u4e3a\u4f9d\u8d56\u9879\u3002</p> <p>\u5982\u679c\u7528\u6237\u4e0d\u5b58\u5728\u6216\u5904\u4e8e\u672a\u542f\u7528\u72b6\u6001\uff0c\u5219\u8fd9\u4e24\u4e2a\u4f9d\u8d56\u9879\u90fd\u5c06\u4ec5\u8fd4\u56de HTTP \u9519\u8bef\u3002</p> <p>\u56e0\u6b64\uff0c\u5728\u6211\u4eec\u7684\u7aef\u70b9\u4e2d\uff0c\u53ea\u6709\u5f53\u7528\u6237\u5b58\u5728\uff0c\u8eab\u4efd\u8ba4\u8bc1\u901a\u8fc7\u4e14\u5904\u4e8e\u542f\u7528\u72b6\u6001\u65f6\uff0c\u6211\u4eec\u624d\u80fd\u83b7\u5f97\u8be5\u7528\u6237\uff1a</p> <pre><code>from typing import Union\n\nfrom fastapi import Depends, FastAPI, HTTPException, status\nfrom fastapi.security import OAuth2PasswordBearer, OAuth2PasswordRequestForm\nfrom pydantic import BaseModel\n\nfake_users_db = {\n    \"johndoe\": {\n        \"username\": \"johndoe\",\n        \"full_name\": \"John Doe\",\n        \"email\": \"johndoe@example.com\",\n        \"hashed_password\": \"fakehashedsecret\",\n        \"disabled\": False,\n    },\n    \"alice\": {\n        \"username\": \"alice\",\n        \"full_name\": \"Alice Wonderson\",\n        \"email\": \"alice@example.com\",\n        \"hashed_password\": \"fakehashedsecret2\",\n        \"disabled\": True,\n    },\n}\n\napp = FastAPI()\n\n\ndef fake_hash_password(password: str):\n    return \"fakehashed\" + password\n\n\noauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"token\")\n\n\nclass User(BaseModel):\n    username: str\n    email: Union[str, None] = None\n    full_name: Union[str, None] = None\n    disabled: Union[bool, None] = None\n\n\nclass UserInDB(User):\n    hashed_password: str\n\n\ndef get_user(db, username: str):\n    if username in db:\n        user_dict = db[username]\n        return UserInDB(**user_dict)\n\n\ndef fake_decode_token(token):\n    # This doesn't provide any security at all\n    # Check the next version\n    user = get_user(fake_users_db, token)\n    return user\n\n\nasync def get_current_user(token: str = Depends(oauth2_scheme)):\nuser = fake_decode_token(token)\nif not user:\nraise HTTPException(\nstatus_code=status.HTTP_401_UNAUTHORIZED,\ndetail=\"Invalid authentication credentials\",\nheaders={\"WWW-Authenticate\": \"Bearer\"},\n)\nreturn user\nasync def get_current_active_user(current_user: User = Depends(get_current_user)):\nif current_user.disabled:\nraise HTTPException(status_code=400, detail=\"Inactive user\")\nreturn current_user\n@app.post(\"/token\")\nasync def login(form_data: OAuth2PasswordRequestForm = Depends()):\n    user_dict = fake_users_db.get(form_data.username)\n    if not user_dict:\n        raise HTTPException(status_code=400, detail=\"Incorrect username or password\")\n    user = UserInDB(**user_dict)\n    hashed_password = fake_hash_password(form_data.password)\n    if not hashed_password == user.hashed_password:\n        raise HTTPException(status_code=400, detail=\"Incorrect username or password\")\n\n    return {\"access_token\": user.username, \"token_type\": \"bearer\"}\n\n\n@app.get(\"/users/me\")\nasync def read_users_me(current_user: User = Depends(get_current_active_user)):\nreturn current_user\n</code></pre> <p>Info</p> <p>\u6211\u4eec\u5728\u6b64\u5904\u8fd4\u56de\u7684\u503c\u4e3a <code>Bearer</code> \u7684\u989d\u5916\u54cd\u5e94\u5934 <code>WWW-Authenticate</code> \u4e5f\u662f\u89c4\u8303\u7684\u4e00\u90e8\u5206\u3002</p> <p>\u4efb\u4f55\u7684 401\u300c\u672a\u8ba4\u8bc1\u300dHTTP\uff08\u9519\u8bef\uff09\u72b6\u6001\u7801\u90fd\u5e94\u8be5\u8fd4\u56de <code>WWW-Authenticate</code> \u54cd\u5e94\u5934\u3002</p> <p>\u5bf9\u4e8e bearer \u4ee4\u724c\uff08\u6211\u4eec\u7684\u4f8b\u5b50\uff09\uff0c\u8be5\u54cd\u5e94\u5934\u7684\u503c\u5e94\u4e3a <code>Bearer</code>\u3002</p> <p>\u5b9e\u9645\u4e0a\u4f60\u53ef\u4ee5\u5ffd\u7565\u8fd9\u4e2a\u989d\u5916\u7684\u54cd\u5e94\u5934\uff0c\u4e0d\u4f1a\u6709\u4ec0\u4e48\u95ee\u9898\u3002</p> <p>\u4f46\u6b64\u5904\u63d0\u4f9b\u4e86\u5b83\u4ee5\u7b26\u5408\u89c4\u8303\u3002</p> <p>\u800c\u4e14\uff0c\uff08\u73b0\u5728\u6216\u5c06\u6765\uff09\u53ef\u80fd\u4f1a\u6709\u5de5\u5177\u671f\u671b\u5f97\u5230\u5e76\u4f7f\u7528\u5b83\uff0c\u7136\u540e\u5bf9\u4f60\u6216\u4f60\u7684\u7528\u6237\u6709\u7528\u5904\u3002</p> <p>\u8fd9\u5c31\u662f\u9075\u5faa\u6807\u51c6\u7684\u597d\u5904...</p>"},{"location":"tutorial/security/simple-oauth2/#_7","title":"\u5b9e\u9645\u6548\u679c","text":"<p>\u6253\u5f00\u4ea4\u4e92\u5f0f\u6587\u6863\uff1ahttp://127.0.0.1:8000/docs\u3002</p>"},{"location":"tutorial/security/simple-oauth2/#_8","title":"\u8eab\u4efd\u8ba4\u8bc1","text":"<p>\u70b9\u51fb\u300cAuthorize\u300d\u6309\u94ae\u3002</p> <p>\u4f7f\u7528\u4ee5\u4e0b\u51ed\u8bc1\uff1a</p> <p>\u7528\u6237\u540d\uff1a<code>johndoe</code></p> <p>\u5bc6\u7801\uff1a<code>secret</code></p> <p></p> <p>\u5728\u7cfb\u7edf\u4e2d\u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\u540e\uff0c\u4f60\u5c06\u770b\u5230\uff1a</p> <p></p>"},{"location":"tutorial/security/simple-oauth2/#_9","title":"\u83b7\u53d6\u672c\u4eba\u7684\u7528\u6237\u6570\u636e","text":"<p>\u73b0\u5728\u6267\u884c <code>/users/me</code> \u8def\u5f84\u7684 <code>GET</code> \u64cd\u4f5c\u3002</p> <p>\u4f60\u5c06\u83b7\u5f97\u4f60\u7684\u7528\u6237\u6570\u636e\uff0c\u5982\uff1a</p> <pre><code>{\n\"username\": \"johndoe\",\n\"email\": \"johndoe@example.com\",\n\"full_name\": \"John Doe\",\n\"disabled\": false,\n\"hashed_password\": \"fakehashedsecret\"\n}\n</code></pre> <p></p> <p>\u5982\u679c\u4f60\u70b9\u51fb\u9501\u5b9a\u56fe\u6807\u5e76\u6ce8\u9500\uff0c\u7136\u540e\u518d\u6b21\u5c1d\u8bd5\u540c\u4e00\u64cd\u4f5c\uff0c\u5219\u4f1a\u5f97\u5230 HTTP 401 \u9519\u8bef\uff1a</p> <pre><code>{\n\"detail\": \"Not authenticated\"\n}\n</code></pre>"},{"location":"tutorial/security/simple-oauth2/#_10","title":"\u672a\u542f\u7528\u7684\u7528\u6237","text":"<p>\u73b0\u5728\u5c1d\u8bd5\u4f7f\u7528\u672a\u542f\u7528\u7684\u7528\u6237\uff0c\u5e76\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u8fdb\u884c\u8eab\u4efd\u8ba4\u8bc1\uff1a</p> <p>\u7528\u6237\u540d\uff1a<code>alice</code></p> <p>\u5bc6\u7801\uff1a<code>secret2</code></p> <p>\u7136\u540e\u5c1d\u8bd5\u6267\u884c <code>/users/me</code> \u8def\u5f84\u7684 <code>GET</code> \u64cd\u4f5c\u3002</p> <p>\u4f60\u5c06\u5f97\u5230\u4e00\u4e2a\u300c\u672a\u542f\u7528\u7684\u7528\u6237\u300d\u9519\u8bef\uff0c\u5982\uff1a</p> <pre><code>{\n\"detail\": \"Inactive user\"\n}\n</code></pre>"},{"location":"tutorial/security/simple-oauth2/#_11","title":"\u603b\u7ed3","text":"<p>\u73b0\u5728\u4f60\u638c\u63e1\u4e86\u4e3a\u4f60\u7684 API \u5b9e\u73b0\u4e00\u4e2a\u57fa\u4e8e <code>username</code> \u548c <code>password</code> \u7684\u5b8c\u6574\u5b89\u5168\u7cfb\u7edf\u7684\u5de5\u5177\u3002</p> <p>\u4f7f\u7528\u8fd9\u4e9b\u5de5\u5177\uff0c\u4f60\u53ef\u4ee5\u4f7f\u5b89\u5168\u7cfb\u7edf\u4e0e\u4efb\u4f55\u6570\u636e\u5e93\u4ee5\u53ca\u4efb\u4f55\u7528\u6237\u6216\u6570\u636e\u6a21\u578b\u517c\u5bb9\u3002</p> <p>\u552f\u4e00\u7f3a\u5c11\u7684\u7ec6\u8282\u662f\u5b83\u5b9e\u9645\u4e0a\u8fd8\u5e76\u4e0d\u300c\u5b89\u5168\u300d\u3002</p> <p>\u5728\u4e0b\u4e00\u7ae0\u4e2d\uff0c\u4f60\u5c06\u770b\u5230\u5982\u4f55\u4f7f\u7528\u4e00\u4e2a\u5b89\u5168\u7684\u54c8\u5e0c\u5bc6\u7801\u5e93\u548c JWT \u4ee4\u724c\u3002</p>"}]}